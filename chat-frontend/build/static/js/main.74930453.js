/*! For license information please see main.74930453.js.LICENSE.txt */
(()=>{"use strict";var e={4:(e,t,n)=>{var r=n(853),a=n(43),s=n(950);function o(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function l(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function c(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function u(e){if(l(e)!==e)throw Error(o(188))}function d(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e;for(e=e.child;null!==e;){if(null!==(t=d(e)))return t;e=e.sibling}return null}var f=Object.assign,h=Symbol.for("react.element"),m=Symbol.for("react.transitional.element"),p=Symbol.for("react.portal"),g=Symbol.for("react.fragment"),y=Symbol.for("react.strict_mode"),v=Symbol.for("react.profiler"),b=Symbol.for("react.provider"),x=Symbol.for("react.consumer"),w=Symbol.for("react.context"),k=Symbol.for("react.forward_ref"),S=Symbol.for("react.suspense"),N=Symbol.for("react.suspense_list"),j=Symbol.for("react.memo"),_=Symbol.for("react.lazy");Symbol.for("react.scope");var C=Symbol.for("react.activity");Symbol.for("react.legacy_hidden"),Symbol.for("react.tracing_marker");var E=Symbol.for("react.memo_cache_sentinel");Symbol.for("react.view_transition");var T=Symbol.iterator;function A(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=T&&e[T]||e["@@iterator"])?e:null}var P=Symbol.for("react.client.reference");function O(e){if(null==e)return null;if("function"===typeof e)return e.$$typeof===P?null:e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case g:return"Fragment";case v:return"Profiler";case y:return"StrictMode";case S:return"Suspense";case N:return"SuspenseList";case C:return"Activity"}if("object"===typeof e)switch(e.$$typeof){case p:return"Portal";case w:return(e.displayName||"Context")+".Provider";case x:return(e._context.displayName||"Context")+".Consumer";case k:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case j:return null!==(t=e.displayName||null)?t:O(e.type)||"Memo";case _:t=e._payload,e=e._init;try{return O(e(t))}catch(n){}}return null}var U=Array.isArray,R=a.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,I=s.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,M={pending:!1,data:null,method:null,action:null},L=[],D=-1;function F(e){return{current:e}}function B(e){0>D||(e.current=L[D],L[D]=null,D--)}function z(e,t){D++,L[D]=e.current,e.current=t}var q=F(null),V=F(null),H=F(null),W=F(null);function K(e,t){switch(z(H,t),z(V,e),z(q,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?ad(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)e=sd(t=ad(t),e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}B(q),z(q,e)}function G(){B(q),B(V),B(H)}function $(e){null!==e.memoizedState&&z(W,e);var t=q.current,n=sd(t,e.type);t!==n&&(z(V,e),z(q,n))}function Y(e){V.current===e&&(B(q),B(V)),W.current===e&&(B(W),$d._currentValue=M)}var Q=Object.prototype.hasOwnProperty,J=r.unstable_scheduleCallback,X=r.unstable_cancelCallback,Z=r.unstable_shouldYield,ee=r.unstable_requestPaint,te=r.unstable_now,ne=r.unstable_getCurrentPriorityLevel,re=r.unstable_ImmediatePriority,ae=r.unstable_UserBlockingPriority,se=r.unstable_NormalPriority,oe=r.unstable_LowPriority,ie=r.unstable_IdlePriority,le=r.log,ce=r.unstable_setDisableYieldValue,ue=null,de=null;function fe(e){if("function"===typeof le&&ce(e),de&&"function"===typeof de.setStrictMode)try{de.setStrictMode(ue,e)}catch(t){}}var he=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(me(e)/pe|0)|0},me=Math.log,pe=Math.LN2;var ge=256,ye=4194304;function ve(e){var t=42&e;if(0!==t)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194048&e;case 4194304:case 8388608:case 16777216:case 33554432:return 62914560&e;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function be(e,t,n){var r=e.pendingLanes;if(0===r)return 0;var a=0,s=e.suspendedLanes,o=e.pingedLanes;e=e.warmLanes;var i=134217727&r;return 0!==i?0!==(r=i&~s)?a=ve(r):0!==(o&=i)?a=ve(o):n||0!==(n=i&~e)&&(a=ve(n)):0!==(i=r&~s)?a=ve(i):0!==o?a=ve(o):n||0!==(n=r&~e)&&(a=ve(n)),0===a?0:0!==t&&t!==a&&0===(t&s)&&((s=a&-a)>=(n=t&-t)||32===s&&0!==(4194048&n))?t:a}function xe(e,t){return 0===(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)}function we(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function ke(){var e=ge;return 0===(4194048&(ge<<=1))&&(ge=256),e}function Se(){var e=ye;return 0===(62914560&(ye<<=1))&&(ye=4194304),e}function Ne(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function je(e,t){e.pendingLanes|=t,268435456!==t&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function _e(e,t,n){e.pendingLanes|=t,e.suspendedLanes&=~t;var r=31-he(t);e.entangledLanes|=t,e.entanglements[r]=1073741824|e.entanglements[r]|4194090&n}function Ce(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-he(n),a=1<<r;a&t|e[r]&t&&(e[r]|=t),n&=~a}}function Ee(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function Te(e){return 2<(e&=-e)?8<e?0!==(134217727&e)?32:268435456:8:2}function Ae(){var e=I.p;return 0!==e?e:void 0===(e=window.event)?32:uf(e.type)}var Pe=Math.random().toString(36).slice(2),Oe="__reactFiber$"+Pe,Ue="__reactProps$"+Pe,Re="__reactContainer$"+Pe,Ie="__reactEvents$"+Pe,Me="__reactListeners$"+Pe,Le="__reactHandles$"+Pe,De="__reactResources$"+Pe,Fe="__reactMarker$"+Pe;function Be(e){delete e[Oe],delete e[Ue],delete e[Ie],delete e[Me],delete e[Le]}function ze(e){var t=e[Oe];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Re]||n[Oe]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=bd(e);null!==e;){if(n=e[Oe])return n;e=bd(e)}return t}n=(e=n).parentNode}return null}function qe(e){if(e=e[Oe]||e[Re]){var t=e.tag;if(5===t||6===t||13===t||26===t||27===t||3===t)return e}return null}function Ve(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e.stateNode;throw Error(o(33))}function He(e){var t=e[De];return t||(t=e[De]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function We(e){e[Fe]=!0}var Ke=new Set,Ge={};function $e(e,t){Ye(e,t),Ye(e+"Capture",t)}function Ye(e,t){for(Ge[e]=t,e=0;e<t.length;e++)Ke.add(t[e])}var Qe,Je,Xe=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Ze={},et={};function tt(e,t,n){if(a=t,Q.call(et,a)||!Q.call(Ze,a)&&(Xe.test(a)?et[a]=!0:(Ze[a]=!0,0)))if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":return void e.removeAttribute(t);case"boolean":var r=t.toLowerCase().slice(0,5);if("data-"!==r&&"aria-"!==r)return void e.removeAttribute(t)}e.setAttribute(t,""+n)}var a}function nt(e,t,n){if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(t)}e.setAttribute(t,""+n)}}function rt(e,t,n,r){if(null===r)e.removeAttribute(n);else{switch(typeof r){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(n)}e.setAttributeNS(t,n,""+r)}}function at(e){if(void 0===Qe)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);Qe=t&&t[1]||"",Je=-1<n.stack.indexOf("\n    at")?" (<anonymous>)":-1<n.stack.indexOf("@")?"@unknown:0:0":""}return"\n"+Qe+e+Je}var st=!1;function ot(e,t){if(!e||st)return"";st=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var r={DetermineComponentFrameRoot:function(){try{if(t){var n=function(){throw Error()};if(Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(n,[])}catch(a){var r=a}Reflect.construct(e,[],n)}else{try{n.call()}catch(s){r=s}e.call(n.prototype)}}else{try{throw Error()}catch(o){r=o}(n=e())&&"function"===typeof n.catch&&n.catch(function(){})}}catch(i){if(i&&r&&"string"===typeof i.stack)return[i.stack,r.stack]}return[null,null]}};r.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var a=Object.getOwnPropertyDescriptor(r.DetermineComponentFrameRoot,"name");a&&a.configurable&&Object.defineProperty(r.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var s=r.DetermineComponentFrameRoot(),o=s[0],i=s[1];if(o&&i){var l=o.split("\n"),c=i.split("\n");for(a=r=0;r<l.length&&!l[r].includes("DetermineComponentFrameRoot");)r++;for(;a<c.length&&!c[a].includes("DetermineComponentFrameRoot");)a++;if(r===l.length||a===c.length)for(r=l.length-1,a=c.length-1;1<=r&&0<=a&&l[r]!==c[a];)a--;for(;1<=r&&0<=a;r--,a--)if(l[r]!==c[a]){if(1!==r||1!==a)do{if(r--,0>--a||l[r]!==c[a]){var u="\n"+l[r].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}}while(1<=r&&0<=a);break}}}finally{st=!1,Error.prepareStackTrace=n}return(n=e?e.displayName||e.name:"")?at(n):""}function it(e){switch(e.tag){case 26:case 27:case 5:return at(e.type);case 16:return at("Lazy");case 13:return at("Suspense");case 19:return at("SuspenseList");case 0:case 15:return ot(e.type,!1);case 11:return ot(e.type.render,!1);case 1:return ot(e.type,!0);case 31:return at("Activity");default:return""}}function lt(e){try{var t="";do{t+=it(e),e=e.return}while(e);return t}catch(n){return"\nError generating stack: "+n.message+"\n"+n.stack}}function ct(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function ut(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function dt(e){e._valueTracker||(e._valueTracker=function(e){var t=ut(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var a=n.get,s=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(e){r=""+e,s.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function ft(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=ut(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function ht(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}var mt=/[\n"\\]/g;function pt(e){return e.replace(mt,function(e){return"\\"+e.charCodeAt(0).toString(16)+" "})}function gt(e,t,n,r,a,s,o,i){e.name="",null!=o&&"function"!==typeof o&&"symbol"!==typeof o&&"boolean"!==typeof o?e.type=o:e.removeAttribute("type"),null!=t?"number"===o?(0===t&&""===e.value||e.value!=t)&&(e.value=""+ct(t)):e.value!==""+ct(t)&&(e.value=""+ct(t)):"submit"!==o&&"reset"!==o||e.removeAttribute("value"),null!=t?vt(e,o,ct(t)):null!=n?vt(e,o,ct(n)):null!=r&&e.removeAttribute("value"),null==a&&null!=s&&(e.defaultChecked=!!s),null!=a&&(e.checked=a&&"function"!==typeof a&&"symbol"!==typeof a),null!=i&&"function"!==typeof i&&"symbol"!==typeof i&&"boolean"!==typeof i?e.name=""+ct(i):e.removeAttribute("name")}function yt(e,t,n,r,a,s,o,i){if(null!=s&&"function"!==typeof s&&"symbol"!==typeof s&&"boolean"!==typeof s&&(e.type=s),null!=t||null!=n){if(!("submit"!==s&&"reset"!==s||void 0!==t&&null!==t))return;n=null!=n?""+ct(n):"",t=null!=t?""+ct(t):n,i||t===e.value||(e.value=t),e.defaultValue=t}r="function"!==typeof(r=null!=r?r:a)&&"symbol"!==typeof r&&!!r,e.checked=i?e.checked:!!r,e.defaultChecked=!!r,null!=o&&"function"!==typeof o&&"symbol"!==typeof o&&"boolean"!==typeof o&&(e.name=o)}function vt(e,t,n){"number"===t&&ht(e.ownerDocument)===e||e.defaultValue===""+n||(e.defaultValue=""+n)}function bt(e,t,n,r){if(e=e.options,t){t={};for(var a=0;a<n.length;a++)t["$"+n[a]]=!0;for(n=0;n<e.length;n++)a=t.hasOwnProperty("$"+e[n].value),e[n].selected!==a&&(e[n].selected=a),a&&r&&(e[n].defaultSelected=!0)}else{for(n=""+ct(n),t=null,a=0;a<e.length;a++){if(e[a].value===n)return e[a].selected=!0,void(r&&(e[a].defaultSelected=!0));null!==t||e[a].disabled||(t=e[a])}null!==t&&(t.selected=!0)}}function xt(e,t,n){null==t||((t=""+ct(t))!==e.value&&(e.value=t),null!=n)?e.defaultValue=null!=n?""+ct(n):"":e.defaultValue!==t&&(e.defaultValue=t)}function wt(e,t,n,r){if(null==t){if(null!=r){if(null!=n)throw Error(o(92));if(U(r)){if(1<r.length)throw Error(o(93));r=r[0]}n=r}null==n&&(n=""),t=n}n=ct(t),e.defaultValue=n,(r=e.textContent)===n&&""!==r&&null!==r&&(e.value=r)}function kt(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var St=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Nt(e,t,n){var r=0===t.indexOf("--");null==n||"boolean"===typeof n||""===n?r?e.setProperty(t,""):"float"===t?e.cssFloat="":e[t]="":r?e.setProperty(t,n):"number"!==typeof n||0===n||St.has(t)?"float"===t?e.cssFloat=n:e[t]=(""+n).trim():e[t]=n+"px"}function jt(e,t,n){if(null!=t&&"object"!==typeof t)throw Error(o(62));if(e=e.style,null!=n){for(var r in n)!n.hasOwnProperty(r)||null!=t&&t.hasOwnProperty(r)||(0===r.indexOf("--")?e.setProperty(r,""):"float"===r?e.cssFloat="":e[r]="");for(var a in t)r=t[a],t.hasOwnProperty(a)&&n[a]!==r&&Nt(e,a,r)}else for(var s in t)t.hasOwnProperty(s)&&Nt(e,s,t[s])}function _t(e){if(-1===e.indexOf("-"))return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ct=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Et=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Tt(e){return Et.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}var At=null;function Pt(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Ot=null,Ut=null;function Rt(e){var t=qe(e);if(t&&(e=t.stateNode)){var n=e[Ue]||null;e:switch(e=t.stateNode,t.type){case"input":if(gt(e,n.value,n.defaultValue,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll('input[name="'+pt(""+t)+'"][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var a=r[Ue]||null;if(!a)throw Error(o(90));gt(r,a.value,a.defaultValue,a.defaultValue,a.checked,a.defaultChecked,a.type,a.name)}}for(t=0;t<n.length;t++)(r=n[t]).form===e.form&&ft(r)}break e;case"textarea":xt(e,n.value,n.defaultValue);break e;case"select":null!=(t=n.value)&&bt(e,!!n.multiple,t,!1)}}}var It=!1;function Mt(e,t,n){if(It)return e(t,n);It=!0;try{return e(t)}finally{if(It=!1,(null!==Ot||null!==Ut)&&(zc(),Ot&&(t=Ot,e=Ut,Ut=Ot=null,Rt(t),e)))for(t=0;t<e.length;t++)Rt(e[t])}}function Lt(e,t){var n=e.stateNode;if(null===n)return null;var r=n[Ue]||null;if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(o(231,t,typeof n));return n}var Dt=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),Ft=!1;if(Dt)try{var Bt={};Object.defineProperty(Bt,"passive",{get:function(){Ft=!0}}),window.addEventListener("test",Bt,Bt),window.removeEventListener("test",Bt,Bt)}catch(Rf){Ft=!1}var zt=null,qt=null,Vt=null;function Ht(){if(Vt)return Vt;var e,t,n=qt,r=n.length,a="value"in zt?zt.value:zt.textContent,s=a.length;for(e=0;e<r&&n[e]===a[e];e++);var o=r-e;for(t=1;t<=o&&n[r-t]===a[s-t];t++);return Vt=a.slice(e,1<t?1-t:void 0)}function Wt(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function Kt(){return!0}function Gt(){return!1}function $t(e){function t(t,n,r,a,s){for(var o in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=a,this.target=s,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(a):a[o]);return this.isDefaultPrevented=(null!=a.defaultPrevented?a.defaultPrevented:!1===a.returnValue)?Kt:Gt,this.isPropagationStopped=Gt,this}return f(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=Kt)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=Kt)},persist:function(){},isPersistent:Kt}),t}var Yt,Qt,Jt,Xt={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Zt=$t(Xt),en=f({},Xt,{view:0,detail:0}),tn=$t(en),nn=f({},en,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:mn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Jt&&(Jt&&"mousemove"===e.type?(Yt=e.screenX-Jt.screenX,Qt=e.screenY-Jt.screenY):Qt=Yt=0,Jt=e),Yt)},movementY:function(e){return"movementY"in e?e.movementY:Qt}}),rn=$t(nn),an=$t(f({},nn,{dataTransfer:0})),sn=$t(f({},en,{relatedTarget:0})),on=$t(f({},Xt,{animationName:0,elapsedTime:0,pseudoElement:0})),ln=$t(f({},Xt,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),cn=$t(f({},Xt,{data:0})),un={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},dn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},fn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function hn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=fn[e])&&!!t[e]}function mn(){return hn}var pn=$t(f({},en,{key:function(e){if(e.key){var t=un[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=Wt(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?dn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:mn,charCode:function(e){return"keypress"===e.type?Wt(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?Wt(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),gn=$t(f({},nn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),yn=$t(f({},en,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:mn})),vn=$t(f({},Xt,{propertyName:0,elapsedTime:0,pseudoElement:0})),bn=$t(f({},nn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),xn=$t(f({},Xt,{newState:0,oldState:0})),wn=[9,13,27,32],kn=Dt&&"CompositionEvent"in window,Sn=null;Dt&&"documentMode"in document&&(Sn=document.documentMode);var Nn=Dt&&"TextEvent"in window&&!Sn,jn=Dt&&(!kn||Sn&&8<Sn&&11>=Sn),_n=String.fromCharCode(32),Cn=!1;function En(e,t){switch(e){case"keyup":return-1!==wn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Tn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var An=!1;var Pn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function On(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Pn[e.type]:"textarea"===t}function Un(e,t,n,r){Ot?Ut?Ut.push(r):Ut=[r]:Ot=r,0<(t=Hu(t,"onChange")).length&&(n=new Zt("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Rn=null,In=null;function Mn(e){Mu(e,0)}function Ln(e){if(ft(Ve(e)))return e}function Dn(e,t){if("change"===e)return t}var Fn=!1;if(Dt){var Bn;if(Dt){var zn="oninput"in document;if(!zn){var qn=document.createElement("div");qn.setAttribute("oninput","return;"),zn="function"===typeof qn.oninput}Bn=zn}else Bn=!1;Fn=Bn&&(!document.documentMode||9<document.documentMode)}function Vn(){Rn&&(Rn.detachEvent("onpropertychange",Hn),In=Rn=null)}function Hn(e){if("value"===e.propertyName&&Ln(In)){var t=[];Un(t,In,e,Pt(e)),Mt(Mn,t)}}function Wn(e,t,n){"focusin"===e?(Vn(),In=n,(Rn=t).attachEvent("onpropertychange",Hn)):"focusout"===e&&Vn()}function Kn(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Ln(In)}function Gn(e,t){if("click"===e)return Ln(t)}function $n(e,t){if("input"===e||"change"===e)return Ln(t)}var Yn="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function Qn(e,t){if(Yn(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var a=n[r];if(!Q.call(t,a)||!Yn(e[a],t[a]))return!1}return!0}function Jn(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Xn(e,t){var n,r=Jn(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=Jn(r)}}function Zn(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?Zn(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function er(e){for(var t=ht((e=null!=e&&null!=e.ownerDocument&&null!=e.ownerDocument.defaultView?e.ownerDocument.defaultView:window).document);t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=ht((e=t.contentWindow).document)}return t}function tr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var nr=Dt&&"documentMode"in document&&11>=document.documentMode,rr=null,ar=null,sr=null,or=!1;function ir(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;or||null==rr||rr!==ht(r)||("selectionStart"in(r=rr)&&tr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},sr&&Qn(sr,r)||(sr=r,0<(r=Hu(ar,"onSelect")).length&&(t=new Zt("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=rr)))}function lr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var cr={animationend:lr("Animation","AnimationEnd"),animationiteration:lr("Animation","AnimationIteration"),animationstart:lr("Animation","AnimationStart"),transitionrun:lr("Transition","TransitionRun"),transitionstart:lr("Transition","TransitionStart"),transitioncancel:lr("Transition","TransitionCancel"),transitionend:lr("Transition","TransitionEnd")},ur={},dr={};function fr(e){if(ur[e])return ur[e];if(!cr[e])return e;var t,n=cr[e];for(t in n)if(n.hasOwnProperty(t)&&t in dr)return ur[e]=n[t];return e}Dt&&(dr=document.createElement("div").style,"AnimationEvent"in window||(delete cr.animationend.animation,delete cr.animationiteration.animation,delete cr.animationstart.animation),"TransitionEvent"in window||delete cr.transitionend.transition);var hr=fr("animationend"),mr=fr("animationiteration"),pr=fr("animationstart"),gr=fr("transitionrun"),yr=fr("transitionstart"),vr=fr("transitioncancel"),br=fr("transitionend"),xr=new Map,wr="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function kr(e,t){xr.set(e,t),$e(t,[e])}wr.push("scrollEnd");var Sr=new WeakMap;function Nr(e,t){if("object"===typeof e&&null!==e){var n=Sr.get(e);return void 0!==n?n:(t={value:e,source:t,stack:lt(t)},Sr.set(e,t),t)}return{value:e,source:t,stack:lt(t)}}var jr=[],_r=0,Cr=0;function Er(){for(var e=_r,t=Cr=_r=0;t<e;){var n=jr[t];jr[t++]=null;var r=jr[t];jr[t++]=null;var a=jr[t];jr[t++]=null;var s=jr[t];if(jr[t++]=null,null!==r&&null!==a){var o=r.pending;null===o?a.next=a:(a.next=o.next,o.next=a),r.pending=a}0!==s&&Or(n,a,s)}}function Tr(e,t,n,r){jr[_r++]=e,jr[_r++]=t,jr[_r++]=n,jr[_r++]=r,Cr|=r,e.lanes|=r,null!==(e=e.alternate)&&(e.lanes|=r)}function Ar(e,t,n,r){return Tr(e,t,n,r),Ur(e)}function Pr(e,t){return Tr(e,null,null,t),Ur(e)}function Or(e,t,n){e.lanes|=n;var r=e.alternate;null!==r&&(r.lanes|=n);for(var a=!1,s=e.return;null!==s;)s.childLanes|=n,null!==(r=s.alternate)&&(r.childLanes|=n),22===s.tag&&(null===(e=s.stateNode)||1&e._visibility||(a=!0)),e=s,s=s.return;return 3===e.tag?(s=e.stateNode,a&&null!==t&&(a=31-he(n),null===(r=(e=s.hiddenUpdates)[a])?e[a]=[t]:r.push(t),t.lane=536870912|n),s):null}function Ur(e){if(50<Oc)throw Oc=0,Uc=null,Error(o(185));for(var t=e.return;null!==t;)t=(e=t).return;return 3===e.tag?e.stateNode:null}var Rr={};function Ir(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Mr(e,t,n,r){return new Ir(e,t,n,r)}function Lr(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Dr(e,t){var n=e.alternate;return null===n?((n=Mr(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=65011712&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n.refCleanup=e.refCleanup,n}function Fr(e,t){e.flags&=65011714;var n=e.alternate;return null===n?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=n.childLanes,e.lanes=n.lanes,e.child=n.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=n.memoizedProps,e.memoizedState=n.memoizedState,e.updateQueue=n.updateQueue,e.type=n.type,t=n.dependencies,e.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function Br(e,t,n,r,a,s){var i=0;if(r=e,"function"===typeof e)Lr(e)&&(i=1);else if("string"===typeof e)i=function(e,t,n){if(1===n||null!=t.itemProp)return!1;switch(e){case"meta":case"title":return!0;case"style":if("string"!==typeof t.precedence||"string"!==typeof t.href||""===t.href)break;return!0;case"link":if("string"!==typeof t.rel||"string"!==typeof t.href||""===t.href||t.onLoad||t.onError)break;return"stylesheet"!==t.rel||(e=t.disabled,"string"===typeof t.precedence&&null==e);case"script":if(t.async&&"function"!==typeof t.async&&"symbol"!==typeof t.async&&!t.onLoad&&!t.onError&&t.src&&"string"===typeof t.src)return!0}return!1}(e,n,q.current)?26:"html"===e||"head"===e||"body"===e?27:5;else e:switch(e){case C:return(e=Mr(31,n,t,a)).elementType=C,e.lanes=s,e;case g:return zr(n.children,a,s,t);case y:i=8,a|=24;break;case v:return(e=Mr(12,n,t,2|a)).elementType=v,e.lanes=s,e;case S:return(e=Mr(13,n,t,a)).elementType=S,e.lanes=s,e;case N:return(e=Mr(19,n,t,a)).elementType=N,e.lanes=s,e;default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case b:case w:i=10;break e;case x:i=9;break e;case k:i=11;break e;case j:i=14;break e;case _:i=16,r=null;break e}i=29,n=Error(o(130,null===e?"null":typeof e,"")),r=null}return(t=Mr(i,n,t,a)).elementType=e,t.type=r,t.lanes=s,t}function zr(e,t,n,r){return(e=Mr(7,e,r,t)).lanes=n,e}function qr(e,t,n){return(e=Mr(6,e,null,t)).lanes=n,e}function Vr(e,t,n){return(t=Mr(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var Hr=[],Wr=0,Kr=null,Gr=0,$r=[],Yr=0,Qr=null,Jr=1,Xr="";function Zr(e,t){Hr[Wr++]=Gr,Hr[Wr++]=Kr,Kr=e,Gr=t}function ea(e,t,n){$r[Yr++]=Jr,$r[Yr++]=Xr,$r[Yr++]=Qr,Qr=e;var r=Jr;e=Xr;var a=32-he(r)-1;r&=~(1<<a),n+=1;var s=32-he(t)+a;if(30<s){var o=a-a%5;s=(r&(1<<o)-1).toString(32),r>>=o,a-=o,Jr=1<<32-he(t)+a|n<<a|r,Xr=s+e}else Jr=1<<s|n<<a|r,Xr=e}function ta(e){null!==e.return&&(Zr(e,1),ea(e,1,0))}function na(e){for(;e===Kr;)Kr=Hr[--Wr],Hr[Wr]=null,Gr=Hr[--Wr],Hr[Wr]=null;for(;e===Qr;)Qr=$r[--Yr],$r[Yr]=null,Xr=$r[--Yr],$r[Yr]=null,Jr=$r[--Yr],$r[Yr]=null}var ra=null,aa=null,sa=!1,oa=null,ia=!1,la=Error(o(519));function ca(e){throw pa(Nr(Error(o(418,"")),e)),la}function ua(e){var t=e.stateNode,n=e.type,r=e.memoizedProps;switch(t[Oe]=e,t[Ue]=r,n){case"dialog":Lu("cancel",t),Lu("close",t);break;case"iframe":case"object":case"embed":Lu("load",t);break;case"video":case"audio":for(n=0;n<Ru.length;n++)Lu(Ru[n],t);break;case"source":Lu("error",t);break;case"img":case"image":case"link":Lu("error",t),Lu("load",t);break;case"details":Lu("toggle",t);break;case"input":Lu("invalid",t),yt(t,r.value,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name,!0),dt(t);break;case"select":Lu("invalid",t);break;case"textarea":Lu("invalid",t),wt(t,r.value,r.defaultValue,r.children),dt(t)}"string"!==typeof(n=r.children)&&"number"!==typeof n&&"bigint"!==typeof n||t.textContent===""+n||!0===r.suppressHydrationWarning||Qu(t.textContent,n)?(null!=r.popover&&(Lu("beforetoggle",t),Lu("toggle",t)),null!=r.onScroll&&Lu("scroll",t),null!=r.onScrollEnd&&Lu("scrollend",t),null!=r.onClick&&(t.onclick=Ju),t=!0):t=!1,t||ca(e)}function da(e){for(ra=e.return;ra;)switch(ra.tag){case 5:case 13:return void(ia=!1);case 27:case 3:return void(ia=!0);default:ra=ra.return}}function fa(e){if(e!==ra)return!1;if(!sa)return da(e),sa=!0,!1;var t,n=e.tag;if((t=3!==n&&27!==n)&&((t=5===n)&&(t=!("form"!==(t=e.type)&&"button"!==t)||od(e.type,e.memoizedProps)),t=!t),t&&aa&&ca(e),da(e),13===n){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(o(317));e:{for(e=e.nextSibling,n=0;e;){if(8===e.nodeType)if("/$"===(t=e.data)){if(0===n){aa=yd(e.nextSibling);break e}n--}else"$"!==t&&"$!"!==t&&"$?"!==t||n++;e=e.nextSibling}aa=null}}else 27===n?(n=aa,hd(e.type)?(e=vd,vd=null,aa=e):aa=n):aa=ra?yd(e.stateNode.nextSibling):null;return!0}function ha(){aa=ra=null,sa=!1}function ma(){var e=oa;return null!==e&&(null===bc?bc=e:bc.push.apply(bc,e),oa=null),e}function pa(e){null===oa?oa=[e]:oa.push(e)}var ga=F(null),ya=null,va=null;function ba(e,t,n){z(ga,t._currentValue),t._currentValue=n}function xa(e){e._currentValue=ga.current,B(ga)}function wa(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function ka(e,t,n,r){var a=e.child;for(null!==a&&(a.return=e);null!==a;){var s=a.dependencies;if(null!==s){var i=a.child;s=s.firstContext;e:for(;null!==s;){var l=s;s=a;for(var c=0;c<t.length;c++)if(l.context===t[c]){s.lanes|=n,null!==(l=s.alternate)&&(l.lanes|=n),wa(s.return,n,e),r||(i=null);break e}s=l.next}}else if(18===a.tag){if(null===(i=a.return))throw Error(o(341));i.lanes|=n,null!==(s=i.alternate)&&(s.lanes|=n),wa(i,n,e),i=null}else i=a.child;if(null!==i)i.return=a;else for(i=a;null!==i;){if(i===e){i=null;break}if(null!==(a=i.sibling)){a.return=i.return,i=a;break}i=i.return}a=i}}function Sa(e,t,n,r){e=null;for(var a=t,s=!1;null!==a;){if(!s)if(0!==(524288&a.flags))s=!0;else if(0!==(262144&a.flags))break;if(10===a.tag){var i=a.alternate;if(null===i)throw Error(o(387));if(null!==(i=i.memoizedProps)){var l=a.type;Yn(a.pendingProps.value,i.value)||(null!==e?e.push(l):e=[l])}}else if(a===W.current){if(null===(i=a.alternate))throw Error(o(387));i.memoizedState.memoizedState!==a.memoizedState.memoizedState&&(null!==e?e.push($d):e=[$d])}a=a.return}null!==e&&ka(t,e,n,r),t.flags|=262144}function Na(e){for(e=e.firstContext;null!==e;){if(!Yn(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function ja(e){ya=e,va=null,null!==(e=e.dependencies)&&(e.firstContext=null)}function _a(e){return Ea(ya,e)}function Ca(e,t){return null===ya&&ja(e),Ea(e,t)}function Ea(e,t){var n=t._currentValue;if(t={context:t,memoizedValue:n,next:null},null===va){if(null===e)throw Error(o(308));va=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else va=va.next=t;return n}var Ta="undefined"!==typeof AbortController?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(t,n){e.push(n)}};this.abort=function(){t.aborted=!0,e.forEach(function(e){return e()})}},Aa=r.unstable_scheduleCallback,Pa=r.unstable_NormalPriority,Oa={$$typeof:w,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Ua(){return{controller:new Ta,data:new Map,refCount:0}}function Ra(e){e.refCount--,0===e.refCount&&Aa(Pa,function(){e.controller.abort()})}var Ia=null,Ma=0,La=0,Da=null;function Fa(){if(0===--Ma&&null!==Ia){null!==Da&&(Da.status="fulfilled");var e=Ia;Ia=null,La=0,Da=null;for(var t=0;t<e.length;t++)(0,e[t])()}}var Ba=R.S;R.S=function(e,t){"object"===typeof t&&null!==t&&"function"===typeof t.then&&function(e,t){if(null===Ia){var n=Ia=[];Ma=0,La=Tu(),Da={status:"pending",value:void 0,then:function(e){n.push(e)}}}Ma++,t.then(Fa,Fa)}(0,t),null!==Ba&&Ba(e,t)};var za=F(null);function qa(){var e=za.current;return null!==e?e:rc.pooledCache}function Va(e,t){z(za,null===t?za.current:t.pool)}function Ha(){var e=qa();return null===e?null:{parent:Oa._currentValue,pool:e}}var Wa=Error(o(460)),Ka=Error(o(474)),Ga=Error(o(542)),$a={then:function(){}};function Ya(e){return"fulfilled"===(e=e.status)||"rejected"===e}function Qa(){}function Ja(e,t,n){switch(void 0===(n=e[n])?e.push(t):n!==t&&(t.then(Qa,Qa),t=n),t.status){case"fulfilled":return t.value;case"rejected":throw es(e=t.reason),e;default:if("string"===typeof t.status)t.then(Qa,Qa);else{if(null!==(e=rc)&&100<e.shellSuspendCounter)throw Error(o(482));(e=t).status="pending",e.then(function(e){if("pending"===t.status){var n=t;n.status="fulfilled",n.value=e}},function(e){if("pending"===t.status){var n=t;n.status="rejected",n.reason=e}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw es(e=t.reason),e}throw Xa=t,Wa}}var Xa=null;function Za(){if(null===Xa)throw Error(o(459));var e=Xa;return Xa=null,e}function es(e){if(e===Wa||e===Ga)throw Error(o(483))}var ts=!1;function ns(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function rs(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function as(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function ss(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&nc)){var a=r.pending;return null===a?t.next=t:(t.next=a.next,a.next=t),r.pending=t,t=Ur(e),Or(e,null,n),t}return Tr(e,r,t,n),Ur(e)}function os(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194048&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,Ce(e,n)}}function is(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var a=null,s=null;if(null!==(n=n.firstBaseUpdate)){do{var o={lane:n.lane,tag:n.tag,payload:n.payload,callback:null,next:null};null===s?a=s=o:s=s.next=o,n=n.next}while(null!==n);null===s?a=s=t:s=s.next=t}else a=s=t;return n={baseState:r.baseState,firstBaseUpdate:a,lastBaseUpdate:s,shared:r.shared,callbacks:r.callbacks},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}var ls=!1;function cs(){if(ls){if(null!==Da)throw Da}}function us(e,t,n,r){ls=!1;var a=e.updateQueue;ts=!1;var s=a.firstBaseUpdate,o=a.lastBaseUpdate,i=a.shared.pending;if(null!==i){a.shared.pending=null;var l=i,c=l.next;l.next=null,null===o?s=c:o.next=c,o=l;var u=e.alternate;null!==u&&((i=(u=u.updateQueue).lastBaseUpdate)!==o&&(null===i?u.firstBaseUpdate=c:i.next=c,u.lastBaseUpdate=l))}if(null!==s){var d=a.baseState;for(o=0,u=c=l=null,i=s;;){var h=-536870913&i.lane,m=h!==i.lane;if(m?(sc&h)===h:(r&h)===h){0!==h&&h===La&&(ls=!0),null!==u&&(u=u.next={lane:0,tag:i.tag,payload:i.payload,callback:null,next:null});e:{var p=e,g=i;h=t;var y=n;switch(g.tag){case 1:if("function"===typeof(p=g.payload)){d=p.call(y,d,h);break e}d=p;break e;case 3:p.flags=-65537&p.flags|128;case 0:if(null===(h="function"===typeof(p=g.payload)?p.call(y,d,h):p)||void 0===h)break e;d=f({},d,h);break e;case 2:ts=!0}}null!==(h=i.callback)&&(e.flags|=64,m&&(e.flags|=8192),null===(m=a.callbacks)?a.callbacks=[h]:m.push(h))}else m={lane:h,tag:i.tag,payload:i.payload,callback:i.callback,next:null},null===u?(c=u=m,l=d):u=u.next=m,o|=h;if(null===(i=i.next)){if(null===(i=a.shared.pending))break;i=(m=i).next,m.next=null,a.lastBaseUpdate=m,a.shared.pending=null}}null===u&&(l=d),a.baseState=l,a.firstBaseUpdate=c,a.lastBaseUpdate=u,null===s&&(a.shared.lanes=0),hc|=o,e.lanes=o,e.memoizedState=d}}function ds(e,t){if("function"!==typeof e)throw Error(o(191,e));e.call(t)}function fs(e,t){var n=e.callbacks;if(null!==n)for(e.callbacks=null,e=0;e<n.length;e++)ds(n[e],t)}var hs=F(null),ms=F(0);function ps(e,t){z(ms,e=dc),z(hs,t),dc=e|t.baseLanes}function gs(){z(ms,dc),z(hs,hs.current)}function ys(){dc=ms.current,B(hs),B(ms)}var vs=0,bs=null,xs=null,ws=null,ks=!1,Ss=!1,Ns=!1,js=0,_s=0,Cs=null,Es=0;function Ts(){throw Error(o(321))}function As(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Yn(e[n],t[n]))return!1;return!0}function Ps(e,t,n,r,a,s){return vs=s,bs=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,R.H=null===e||null===e.memoizedState?Ko:Go,Ns=!1,s=n(r,a),Ns=!1,Ss&&(s=Us(t,n,r,a)),Os(e),s}function Os(e){R.H=Wo;var t=null!==xs&&null!==xs.next;if(vs=0,ws=xs=bs=null,ks=!1,_s=0,Cs=null,t)throw Error(o(300));null===e||Ci||null!==(e=e.dependencies)&&Na(e)&&(Ci=!0)}function Us(e,t,n,r){bs=e;var a=0;do{if(Ss&&(Cs=null),_s=0,Ss=!1,25<=a)throw Error(o(301));if(a+=1,ws=xs=null,null!=e.updateQueue){var s=e.updateQueue;s.lastEffect=null,s.events=null,s.stores=null,null!=s.memoCache&&(s.memoCache.index=0)}R.H=$o,s=t(n,r)}while(Ss);return s}function Rs(){var e=R.H,t=e.useState()[0];return t="function"===typeof t.then?Bs(t):t,e=e.useState()[0],(null!==xs?xs.memoizedState:null)!==e&&(bs.flags|=1024),t}function Is(){var e=0!==js;return js=0,e}function Ms(e,t,n){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n}function Ls(e){if(ks){for(e=e.memoizedState;null!==e;){var t=e.queue;null!==t&&(t.pending=null),e=e.next}ks=!1}vs=0,ws=xs=bs=null,Ss=!1,_s=js=0,Cs=null}function Ds(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===ws?bs.memoizedState=ws=e:ws=ws.next=e,ws}function Fs(){if(null===xs){var e=bs.alternate;e=null!==e?e.memoizedState:null}else e=xs.next;var t=null===ws?bs.memoizedState:ws.next;if(null!==t)ws=t,xs=e;else{if(null===e){if(null===bs.alternate)throw Error(o(467));throw Error(o(310))}e={memoizedState:(xs=e).memoizedState,baseState:xs.baseState,baseQueue:xs.baseQueue,queue:xs.queue,next:null},null===ws?bs.memoizedState=ws=e:ws=ws.next=e}return ws}function Bs(e){var t=_s;return _s+=1,null===Cs&&(Cs=[]),e=Ja(Cs,e,t),t=bs,null===(null===ws?t.memoizedState:ws.next)&&(t=t.alternate,R.H=null===t||null===t.memoizedState?Ko:Go),e}function zs(e){if(null!==e&&"object"===typeof e){if("function"===typeof e.then)return Bs(e);if(e.$$typeof===w)return _a(e)}throw Error(o(438,String(e)))}function qs(e){var t=null,n=bs.updateQueue;if(null!==n&&(t=n.memoCache),null==t){var r=bs.alternate;null!==r&&(null!==(r=r.updateQueue)&&(null!=(r=r.memoCache)&&(t={data:r.data.map(function(e){return e.slice()}),index:0})))}if(null==t&&(t={data:[],index:0}),null===n&&(n={lastEffect:null,events:null,stores:null,memoCache:null},bs.updateQueue=n),n.memoCache=t,void 0===(n=t.data[t.index]))for(n=t.data[t.index]=Array(e),r=0;r<e;r++)n[r]=E;return t.index++,n}function Vs(e,t){return"function"===typeof t?t(e):t}function Hs(e){return Ws(Fs(),xs,e)}function Ws(e,t,n){var r=e.queue;if(null===r)throw Error(o(311));r.lastRenderedReducer=n;var a=e.baseQueue,s=r.pending;if(null!==s){if(null!==a){var i=a.next;a.next=s.next,s.next=i}t.baseQueue=a=s,r.pending=null}if(s=e.baseState,null===a)e.memoizedState=s;else{var l=i=null,c=null,u=t=a.next,d=!1;do{var f=-536870913&u.lane;if(f!==u.lane?(sc&f)===f:(vs&f)===f){var h=u.revertLane;if(0===h)null!==c&&(c=c.next={lane:0,revertLane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),f===La&&(d=!0);else{if((vs&h)===h){u=u.next,h===La&&(d=!0);continue}f={lane:0,revertLane:u.revertLane,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},null===c?(l=c=f,i=s):c=c.next=f,bs.lanes|=h,hc|=h}f=u.action,Ns&&n(s,f),s=u.hasEagerState?u.eagerState:n(s,f)}else h={lane:f,revertLane:u.revertLane,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},null===c?(l=c=h,i=s):c=c.next=h,bs.lanes|=f,hc|=f;u=u.next}while(null!==u&&u!==t);if(null===c?i=s:c.next=l,!Yn(s,e.memoizedState)&&(Ci=!0,d&&null!==(n=Da)))throw n;e.memoizedState=s,e.baseState=i,e.baseQueue=c,r.lastRenderedState=s}return null===a&&(r.lanes=0),[e.memoizedState,r.dispatch]}function Ks(e){var t=Fs(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var r=n.dispatch,a=n.pending,s=t.memoizedState;if(null!==a){n.pending=null;var i=a=a.next;do{s=e(s,i.action),i=i.next}while(i!==a);Yn(s,t.memoizedState)||(Ci=!0),t.memoizedState=s,null===t.baseQueue&&(t.baseState=s),n.lastRenderedState=s}return[s,r]}function Gs(e,t,n){var r=bs,a=Fs(),s=sa;if(s){if(void 0===n)throw Error(o(407));n=n()}else n=t();var i=!Yn((xs||a).memoizedState,n);if(i&&(a.memoizedState=n,Ci=!0),a=a.queue,yo(2048,8,Qs.bind(null,r,a,e),[e]),a.getSnapshot!==t||i||null!==ws&&1&ws.memoizedState.tag){if(r.flags|=2048,mo(9,{destroy:void 0,resource:void 0},Ys.bind(null,r,a,n,t),null),null===rc)throw Error(o(349));s||0!==(124&vs)||$s(r,t,n)}return n}function $s(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=bs.updateQueue)?(t={lastEffect:null,events:null,stores:null,memoCache:null},bs.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Ys(e,t,n,r){t.value=n,t.getSnapshot=r,Js(t)&&Xs(e)}function Qs(e,t,n){return n(function(){Js(t)&&Xs(e)})}function Js(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Yn(e,n)}catch(r){return!0}}function Xs(e){var t=Pr(e,2);null!==t&&Mc(t,e,2)}function Zs(e){var t=Ds();if("function"===typeof e){var n=e;if(e=n(),Ns){fe(!0);try{n()}finally{fe(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Vs,lastRenderedState:e},t}function eo(e,t,n,r){return e.baseState=n,Ws(e,xs,"function"===typeof r?r:Vs)}function to(e,t,n,r,a){if(qo(e))throw Error(o(485));if(null!==(e=t.action)){var s={payload:a,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(e){s.listeners.push(e)}};null!==R.T?n(!0):s.isTransition=!1,r(s),null===(n=t.pending)?(s.next=t.pending=s,no(t,s)):(s.next=n.next,t.pending=n.next=s)}}function no(e,t){var n=t.action,r=t.payload,a=e.state;if(t.isTransition){var s=R.T,o={};R.T=o;try{var i=n(a,r),l=R.S;null!==l&&l(o,i),ro(e,t,i)}catch(c){so(e,t,c)}finally{R.T=s}}else try{ro(e,t,s=n(a,r))}catch(u){so(e,t,u)}}function ro(e,t,n){null!==n&&"object"===typeof n&&"function"===typeof n.then?n.then(function(n){ao(e,t,n)},function(n){return so(e,t,n)}):ao(e,t,n)}function ao(e,t,n){t.status="fulfilled",t.value=n,oo(t),e.state=n,null!==(t=e.pending)&&((n=t.next)===t?e.pending=null:(n=n.next,t.next=n,no(e,n)))}function so(e,t,n){var r=e.pending;if(e.pending=null,null!==r){r=r.next;do{t.status="rejected",t.reason=n,oo(t),t=t.next}while(t!==r)}e.action=null}function oo(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function io(e,t){return t}function lo(e,t){if(sa){var n=rc.formState;if(null!==n){e:{var r=bs;if(sa){if(aa){t:{for(var a=aa,s=ia;8!==a.nodeType;){if(!s){a=null;break t}if(null===(a=yd(a.nextSibling))){a=null;break t}}a="F!"===(s=a.data)||"F"===s?a:null}if(a){aa=yd(a.nextSibling),r="F!"===a.data;break e}}ca(r)}r=!1}r&&(t=n[0])}}return(n=Ds()).memoizedState=n.baseState=t,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:io,lastRenderedState:t},n.queue=r,n=Fo.bind(null,bs,r),r.dispatch=n,r=Zs(!1),s=zo.bind(null,bs,!1,r.queue),a={state:t,dispatch:null,action:e,pending:null},(r=Ds()).queue=a,n=to.bind(null,bs,a,s,n),a.dispatch=n,r.memoizedState=e,[t,n,!1]}function co(e){return uo(Fs(),xs,e)}function uo(e,t,n){if(t=Ws(e,t,io)[0],e=Hs(Vs)[0],"object"===typeof t&&null!==t&&"function"===typeof t.then)try{var r=Bs(t)}catch(o){if(o===Wa)throw Ga;throw o}else r=t;var a=(t=Fs()).queue,s=a.dispatch;return n!==t.memoizedState&&(bs.flags|=2048,mo(9,{destroy:void 0,resource:void 0},fo.bind(null,a,n),null)),[r,s,e]}function fo(e,t){e.action=t}function ho(e){var t=Fs(),n=xs;if(null!==n)return uo(t,n,e);Fs(),t=t.memoizedState;var r=(n=Fs()).queue.dispatch;return n.memoizedState=e,[t,r,!1]}function mo(e,t,n,r){return e={tag:e,create:n,deps:r,inst:t,next:null},null===(t=bs.updateQueue)&&(t={lastEffect:null,events:null,stores:null,memoCache:null},bs.updateQueue=t),null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function po(){return Fs().memoizedState}function go(e,t,n,r){var a=Ds();r=void 0===r?null:r,bs.flags|=e,a.memoizedState=mo(1|t,{destroy:void 0,resource:void 0},n,r)}function yo(e,t,n,r){var a=Fs();r=void 0===r?null:r;var s=a.memoizedState.inst;null!==xs&&null!==r&&As(r,xs.memoizedState.deps)?a.memoizedState=mo(t,s,n,r):(bs.flags|=e,a.memoizedState=mo(1|t,s,n,r))}function vo(e,t){go(8390656,8,e,t)}function bo(e,t){yo(2048,8,e,t)}function xo(e,t){return yo(4,2,e,t)}function wo(e,t){return yo(4,4,e,t)}function ko(e,t){if("function"===typeof t){e=e();var n=t(e);return function(){"function"===typeof n?n():t(null)}}if(null!==t&&void 0!==t)return e=e(),t.current=e,function(){t.current=null}}function So(e,t,n){n=null!==n&&void 0!==n?n.concat([e]):null,yo(4,4,ko.bind(null,t,e),n)}function No(){}function jo(e,t){var n=Fs();t=void 0===t?null:t;var r=n.memoizedState;return null!==t&&As(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function _o(e,t){var n=Fs();t=void 0===t?null:t;var r=n.memoizedState;if(null!==t&&As(t,r[1]))return r[0];if(r=e(),Ns){fe(!0);try{e()}finally{fe(!1)}}return n.memoizedState=[r,t],r}function Co(e,t,n){return void 0===n||0!==(1073741824&vs)?e.memoizedState=t:(e.memoizedState=n,e=Ic(),bs.lanes|=e,hc|=e,n)}function Eo(e,t,n,r){return Yn(n,t)?n:null!==hs.current?(e=Co(e,n,r),Yn(e,t)||(Ci=!0),e):0===(42&vs)?(Ci=!0,e.memoizedState=n):(e=Ic(),bs.lanes|=e,hc|=e,t)}function To(e,t,n,r,a){var s=I.p;I.p=0!==s&&8>s?s:8;var o=R.T,i={};R.T=i,zo(e,!1,t,n);try{var l=a(),c=R.S;if(null!==c&&c(i,l),null!==l&&"object"===typeof l&&"function"===typeof l.then)Bo(e,t,function(e,t){var n=[],r={status:"pending",value:null,reason:null,then:function(e){n.push(e)}};return e.then(function(){r.status="fulfilled",r.value=t;for(var e=0;e<n.length;e++)(0,n[e])(t)},function(e){for(r.status="rejected",r.reason=e,e=0;e<n.length;e++)(0,n[e])(void 0)}),r}(l,r),Rc());else Bo(e,t,r,Rc())}catch(u){Bo(e,t,{then:function(){},status:"rejected",reason:u},Rc())}finally{I.p=s,R.T=o}}function Ao(){}function Po(e,t,n,r){if(5!==e.tag)throw Error(o(476));var a=Oo(e).queue;To(e,a,t,M,null===n?Ao:function(){return Uo(e),n(r)})}function Oo(e){var t=e.memoizedState;if(null!==t)return t;var n={};return(t={memoizedState:M,baseState:M,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Vs,lastRenderedState:M},next:null}).next={memoizedState:n,baseState:n,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Vs,lastRenderedState:n},next:null},e.memoizedState=t,null!==(e=e.alternate)&&(e.memoizedState=t),t}function Uo(e){Bo(e,Oo(e).next.queue,{},Rc())}function Ro(){return _a($d)}function Io(){return Fs().memoizedState}function Mo(){return Fs().memoizedState}function Lo(e){for(var t=e.return;null!==t;){switch(t.tag){case 24:case 3:var n=Rc(),r=ss(t,e=as(n),n);return null!==r&&(Mc(r,t,n),os(r,t,n)),t={cache:Ua()},void(e.payload=t)}t=t.return}}function Do(e,t,n){var r=Rc();n={lane:r,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null},qo(e)?Vo(t,n):null!==(n=Ar(e,t,n,r))&&(Mc(n,e,r),Ho(n,t,r))}function Fo(e,t,n){Bo(e,t,n,Rc())}function Bo(e,t,n,r){var a={lane:r,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null};if(qo(e))Vo(t,a);else{var s=e.alternate;if(0===e.lanes&&(null===s||0===s.lanes)&&null!==(s=t.lastRenderedReducer))try{var o=t.lastRenderedState,i=s(o,n);if(a.hasEagerState=!0,a.eagerState=i,Yn(i,o))return Tr(e,t,a,0),null===rc&&Er(),!1}catch(l){}if(null!==(n=Ar(e,t,a,r)))return Mc(n,e,r),Ho(n,t,r),!0}return!1}function zo(e,t,n,r){if(r={lane:2,revertLane:Tu(),action:r,hasEagerState:!1,eagerState:null,next:null},qo(e)){if(t)throw Error(o(479))}else null!==(t=Ar(e,n,r,2))&&Mc(t,e,2)}function qo(e){var t=e.alternate;return e===bs||null!==t&&t===bs}function Vo(e,t){Ss=ks=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Ho(e,t,n){if(0!==(4194048&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,Ce(e,n)}}var Wo={readContext:_a,use:zs,useCallback:Ts,useContext:Ts,useEffect:Ts,useImperativeHandle:Ts,useLayoutEffect:Ts,useInsertionEffect:Ts,useMemo:Ts,useReducer:Ts,useRef:Ts,useState:Ts,useDebugValue:Ts,useDeferredValue:Ts,useTransition:Ts,useSyncExternalStore:Ts,useId:Ts,useHostTransitionStatus:Ts,useFormState:Ts,useActionState:Ts,useOptimistic:Ts,useMemoCache:Ts,useCacheRefresh:Ts},Ko={readContext:_a,use:zs,useCallback:function(e,t){return Ds().memoizedState=[e,void 0===t?null:t],e},useContext:_a,useEffect:vo,useImperativeHandle:function(e,t,n){n=null!==n&&void 0!==n?n.concat([e]):null,go(4194308,4,ko.bind(null,t,e),n)},useLayoutEffect:function(e,t){return go(4194308,4,e,t)},useInsertionEffect:function(e,t){go(4,2,e,t)},useMemo:function(e,t){var n=Ds();t=void 0===t?null:t;var r=e();if(Ns){fe(!0);try{e()}finally{fe(!1)}}return n.memoizedState=[r,t],r},useReducer:function(e,t,n){var r=Ds();if(void 0!==n){var a=n(t);if(Ns){fe(!0);try{n(t)}finally{fe(!1)}}}else a=t;return r.memoizedState=r.baseState=a,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:a},r.queue=e,e=e.dispatch=Do.bind(null,bs,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},Ds().memoizedState=e},useState:function(e){var t=(e=Zs(e)).queue,n=Fo.bind(null,bs,t);return t.dispatch=n,[e.memoizedState,n]},useDebugValue:No,useDeferredValue:function(e,t){return Co(Ds(),e,t)},useTransition:function(){var e=Zs(!1);return e=To.bind(null,bs,e.queue,!0,!1),Ds().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,n){var r=bs,a=Ds();if(sa){if(void 0===n)throw Error(o(407));n=n()}else{if(n=t(),null===rc)throw Error(o(349));0!==(124&sc)||$s(r,t,n)}a.memoizedState=n;var s={value:n,getSnapshot:t};return a.queue=s,vo(Qs.bind(null,r,s,e),[e]),r.flags|=2048,mo(9,{destroy:void 0,resource:void 0},Ys.bind(null,r,s,n,t),null),n},useId:function(){var e=Ds(),t=rc.identifierPrefix;if(sa){var n=Xr;t="\xab"+t+"R"+(n=(Jr&~(1<<32-he(Jr)-1)).toString(32)+n),0<(n=js++)&&(t+="H"+n.toString(32)),t+="\xbb"}else t="\xab"+t+"r"+(n=Es++).toString(32)+"\xbb";return e.memoizedState=t},useHostTransitionStatus:Ro,useFormState:lo,useActionState:lo,useOptimistic:function(e){var t=Ds();t.memoizedState=t.baseState=e;var n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=n,t=zo.bind(null,bs,!0,n),n.dispatch=t,[e,t]},useMemoCache:qs,useCacheRefresh:function(){return Ds().memoizedState=Lo.bind(null,bs)}},Go={readContext:_a,use:zs,useCallback:jo,useContext:_a,useEffect:bo,useImperativeHandle:So,useInsertionEffect:xo,useLayoutEffect:wo,useMemo:_o,useReducer:Hs,useRef:po,useState:function(){return Hs(Vs)},useDebugValue:No,useDeferredValue:function(e,t){return Eo(Fs(),xs.memoizedState,e,t)},useTransition:function(){var e=Hs(Vs)[0],t=Fs().memoizedState;return["boolean"===typeof e?e:Bs(e),t]},useSyncExternalStore:Gs,useId:Io,useHostTransitionStatus:Ro,useFormState:co,useActionState:co,useOptimistic:function(e,t){return eo(Fs(),0,e,t)},useMemoCache:qs,useCacheRefresh:Mo},$o={readContext:_a,use:zs,useCallback:jo,useContext:_a,useEffect:bo,useImperativeHandle:So,useInsertionEffect:xo,useLayoutEffect:wo,useMemo:_o,useReducer:Ks,useRef:po,useState:function(){return Ks(Vs)},useDebugValue:No,useDeferredValue:function(e,t){var n=Fs();return null===xs?Co(n,e,t):Eo(n,xs.memoizedState,e,t)},useTransition:function(){var e=Ks(Vs)[0],t=Fs().memoizedState;return["boolean"===typeof e?e:Bs(e),t]},useSyncExternalStore:Gs,useId:Io,useHostTransitionStatus:Ro,useFormState:ho,useActionState:ho,useOptimistic:function(e,t){var n=Fs();return null!==xs?eo(n,0,e,t):(n.baseState=e,[e,n.queue.dispatch])},useMemoCache:qs,useCacheRefresh:Mo},Yo=null,Qo=0;function Jo(e){var t=Qo;return Qo+=1,null===Yo&&(Yo=[]),Ja(Yo,e,t)}function Xo(e,t){t=t.props.ref,e.ref=void 0!==t?t:null}function Zo(e,t){if(t.$$typeof===h)throw Error(o(525));throw e=Object.prototype.toString.call(t),Error(o(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function ei(e){return(0,e._init)(e._payload)}function ti(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e){for(var t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function a(e,t){return(e=Dr(e,t)).index=0,e.sibling=null,e}function s(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=67108866,n):r:(t.flags|=67108866,n):(t.flags|=1048576,n)}function i(t){return e&&null===t.alternate&&(t.flags|=67108866),t}function l(e,t,n,r){return null===t||6!==t.tag?((t=qr(n,e.mode,r)).return=e,t):((t=a(t,n)).return=e,t)}function c(e,t,n,r){var s=n.type;return s===g?d(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===s||"object"===typeof s&&null!==s&&s.$$typeof===_&&ei(s)===t.type)?(Xo(t=a(t,n.props),n),t.return=e,t):(Xo(t=Br(n.type,n.key,n.props,null,e.mode,r),n),t.return=e,t)}function u(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Vr(n,e.mode,r)).return=e,t):((t=a(t,n.children||[])).return=e,t)}function d(e,t,n,r,s){return null===t||7!==t.tag?((t=zr(n,e.mode,r,s)).return=e,t):((t=a(t,n)).return=e,t)}function f(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t||"bigint"===typeof t)return(t=qr(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case m:return Xo(n=Br(t.type,t.key,t.props,null,e.mode,n),t),n.return=e,n;case p:return(t=Vr(t,e.mode,n)).return=e,t;case _:return f(e,t=(0,t._init)(t._payload),n)}if(U(t)||A(t))return(t=zr(t,e.mode,n,null)).return=e,t;if("function"===typeof t.then)return f(e,Jo(t),n);if(t.$$typeof===w)return f(e,Ca(e,t),n);Zo(e,t)}return null}function h(e,t,n,r){var a=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n||"bigint"===typeof n)return null!==a?null:l(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case m:return n.key===a?c(e,t,n,r):null;case p:return n.key===a?u(e,t,n,r):null;case _:return h(e,t,n=(a=n._init)(n._payload),r)}if(U(n)||A(n))return null!==a?null:d(e,t,n,r,null);if("function"===typeof n.then)return h(e,t,Jo(n),r);if(n.$$typeof===w)return h(e,t,Ca(e,n),r);Zo(e,n)}return null}function y(e,t,n,r,a){if("string"===typeof r&&""!==r||"number"===typeof r||"bigint"===typeof r)return l(t,e=e.get(n)||null,""+r,a);if("object"===typeof r&&null!==r){switch(r.$$typeof){case m:return c(t,e=e.get(null===r.key?n:r.key)||null,r,a);case p:return u(t,e=e.get(null===r.key?n:r.key)||null,r,a);case _:return y(e,t,n,r=(0,r._init)(r._payload),a)}if(U(r)||A(r))return d(t,e=e.get(n)||null,r,a,null);if("function"===typeof r.then)return y(e,t,n,Jo(r),a);if(r.$$typeof===w)return y(e,t,n,Ca(t,r),a);Zo(t,r)}return null}function v(l,c,u,d){if("object"===typeof u&&null!==u&&u.type===g&&null===u.key&&(u=u.props.children),"object"===typeof u&&null!==u){switch(u.$$typeof){case m:e:{for(var b=u.key;null!==c;){if(c.key===b){if((b=u.type)===g){if(7===c.tag){n(l,c.sibling),(d=a(c,u.props.children)).return=l,l=d;break e}}else if(c.elementType===b||"object"===typeof b&&null!==b&&b.$$typeof===_&&ei(b)===c.type){n(l,c.sibling),Xo(d=a(c,u.props),u),d.return=l,l=d;break e}n(l,c);break}t(l,c),c=c.sibling}u.type===g?((d=zr(u.props.children,l.mode,d,u.key)).return=l,l=d):(Xo(d=Br(u.type,u.key,u.props,null,l.mode,d),u),d.return=l,l=d)}return i(l);case p:e:{for(b=u.key;null!==c;){if(c.key===b){if(4===c.tag&&c.stateNode.containerInfo===u.containerInfo&&c.stateNode.implementation===u.implementation){n(l,c.sibling),(d=a(c,u.children||[])).return=l,l=d;break e}n(l,c);break}t(l,c),c=c.sibling}(d=Vr(u,l.mode,d)).return=l,l=d}return i(l);case _:return v(l,c,u=(b=u._init)(u._payload),d)}if(U(u))return function(a,o,i,l){for(var c=null,u=null,d=o,m=o=0,p=null;null!==d&&m<i.length;m++){d.index>m?(p=d,d=null):p=d.sibling;var g=h(a,d,i[m],l);if(null===g){null===d&&(d=p);break}e&&d&&null===g.alternate&&t(a,d),o=s(g,o,m),null===u?c=g:u.sibling=g,u=g,d=p}if(m===i.length)return n(a,d),sa&&Zr(a,m),c;if(null===d){for(;m<i.length;m++)null!==(d=f(a,i[m],l))&&(o=s(d,o,m),null===u?c=d:u.sibling=d,u=d);return sa&&Zr(a,m),c}for(d=r(d);m<i.length;m++)null!==(p=y(d,a,m,i[m],l))&&(e&&null!==p.alternate&&d.delete(null===p.key?m:p.key),o=s(p,o,m),null===u?c=p:u.sibling=p,u=p);return e&&d.forEach(function(e){return t(a,e)}),sa&&Zr(a,m),c}(l,c,u,d);if(A(u)){if("function"!==typeof(b=A(u)))throw Error(o(150));return function(a,i,l,c){if(null==l)throw Error(o(151));for(var u=null,d=null,m=i,p=i=0,g=null,v=l.next();null!==m&&!v.done;p++,v=l.next()){m.index>p?(g=m,m=null):g=m.sibling;var b=h(a,m,v.value,c);if(null===b){null===m&&(m=g);break}e&&m&&null===b.alternate&&t(a,m),i=s(b,i,p),null===d?u=b:d.sibling=b,d=b,m=g}if(v.done)return n(a,m),sa&&Zr(a,p),u;if(null===m){for(;!v.done;p++,v=l.next())null!==(v=f(a,v.value,c))&&(i=s(v,i,p),null===d?u=v:d.sibling=v,d=v);return sa&&Zr(a,p),u}for(m=r(m);!v.done;p++,v=l.next())null!==(v=y(m,a,p,v.value,c))&&(e&&null!==v.alternate&&m.delete(null===v.key?p:v.key),i=s(v,i,p),null===d?u=v:d.sibling=v,d=v);return e&&m.forEach(function(e){return t(a,e)}),sa&&Zr(a,p),u}(l,c,u=b.call(u),d)}if("function"===typeof u.then)return v(l,c,Jo(u),d);if(u.$$typeof===w)return v(l,c,Ca(l,u),d);Zo(l,u)}return"string"===typeof u&&""!==u||"number"===typeof u||"bigint"===typeof u?(u=""+u,null!==c&&6===c.tag?(n(l,c.sibling),(d=a(c,u)).return=l,l=d):(n(l,c),(d=qr(u,l.mode,d)).return=l,l=d),i(l)):n(l,c)}return function(e,t,n,r){try{Qo=0;var a=v(e,t,n,r);return Yo=null,a}catch(o){if(o===Wa||o===Ga)throw o;var s=Mr(29,o,null,e.mode);return s.lanes=r,s.return=e,s}}}var ni=ti(!0),ri=ti(!1),ai=F(null),si=null;function oi(e){var t=e.alternate;z(ui,1&ui.current),z(ai,e),null===si&&(null===t||null!==hs.current||null!==t.memoizedState)&&(si=e)}function ii(e){if(22===e.tag){if(z(ui,ui.current),z(ai,e),null===si){var t=e.alternate;null!==t&&null!==t.memoizedState&&(si=e)}}else li()}function li(){z(ui,ui.current),z(ai,ai.current)}function ci(e){B(ai),si===e&&(si=null),B(ui)}var ui=F(0);function di(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||gd(n)))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function fi(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:f({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var hi={enqueueSetState:function(e,t,n){e=e._reactInternals;var r=Rc(),a=as(r);a.payload=t,void 0!==n&&null!==n&&(a.callback=n),null!==(t=ss(e,a,r))&&(Mc(t,e,r),os(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=Rc(),a=as(r);a.tag=1,a.payload=t,void 0!==n&&null!==n&&(a.callback=n),null!==(t=ss(e,a,r))&&(Mc(t,e,r),os(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Rc(),r=as(n);r.tag=2,void 0!==t&&null!==t&&(r.callback=t),null!==(t=ss(e,r,n))&&(Mc(t,e,n),os(t,e,n))}};function mi(e,t,n,r,a,s,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,s,o):!t.prototype||!t.prototype.isPureReactComponent||(!Qn(n,r)||!Qn(a,s))}function pi(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&hi.enqueueReplaceState(t,t.state,null)}function gi(e,t){var n=t;if("ref"in t)for(var r in n={},t)"ref"!==r&&(n[r]=t[r]);if(e=e.defaultProps)for(var a in n===t&&(n=f({},n)),e)void 0===n[a]&&(n[a]=e[a]);return n}var yi="function"===typeof reportError?reportError:function(e){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof e&&null!==e&&"string"===typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)};function vi(e){yi(e)}function bi(e){console.error(e)}function xi(e){yi(e)}function wi(e,t){try{(0,e.onUncaughtError)(t.value,{componentStack:t.stack})}catch(n){setTimeout(function(){throw n})}}function ki(e,t,n){try{(0,e.onCaughtError)(n.value,{componentStack:n.stack,errorBoundary:1===t.tag?t.stateNode:null})}catch(r){setTimeout(function(){throw r})}}function Si(e,t,n){return(n=as(n)).tag=3,n.payload={element:null},n.callback=function(){wi(e,t)},n}function Ni(e){return(e=as(e)).tag=3,e}function ji(e,t,n,r){var a=n.type.getDerivedStateFromError;if("function"===typeof a){var s=r.value;e.payload=function(){return a(s)},e.callback=function(){ki(t,n,r)}}var o=n.stateNode;null!==o&&"function"===typeof o.componentDidCatch&&(e.callback=function(){ki(t,n,r),"function"!==typeof a&&(null===Nc?Nc=new Set([this]):Nc.add(this));var e=r.stack;this.componentDidCatch(r.value,{componentStack:null!==e?e:""})})}var _i=Error(o(461)),Ci=!1;function Ei(e,t,n,r){t.child=null===e?ri(t,null,n,r):ni(t,e.child,n,r)}function Ti(e,t,n,r,a){n=n.render;var s=t.ref;if("ref"in r){var o={};for(var i in r)"ref"!==i&&(o[i]=r[i])}else o=r;return ja(t),r=Ps(e,t,n,o,s,a),i=Is(),null===e||Ci?(sa&&i&&ta(t),t.flags|=1,Ei(e,t,r,a),t.child):(Ms(e,t,a),Yi(e,t,a))}function Ai(e,t,n,r,a){if(null===e){var s=n.type;return"function"!==typeof s||Lr(s)||void 0!==s.defaultProps||null!==n.compare?((e=Br(n.type,null,r,t,t.mode,a)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=s,Pi(e,t,s,r,a))}if(s=e.child,!Qi(e,a)){var o=s.memoizedProps;if((n=null!==(n=n.compare)?n:Qn)(o,r)&&e.ref===t.ref)return Yi(e,t,a)}return t.flags|=1,(e=Dr(s,r)).ref=t.ref,e.return=t,t.child=e}function Pi(e,t,n,r,a){if(null!==e){var s=e.memoizedProps;if(Qn(s,r)&&e.ref===t.ref){if(Ci=!1,t.pendingProps=r=s,!Qi(e,a))return t.lanes=e.lanes,Yi(e,t,a);0!==(131072&e.flags)&&(Ci=!0)}}return Ii(e,t,n,r,a)}function Oi(e,t,n){var r=t.pendingProps,a=r.children,s=null!==e?e.memoizedState:null;if("hidden"===r.mode){if(0!==(128&t.flags)){if(r=null!==s?s.baseLanes|n:n,null!==e){for(a=t.child=e.child,s=0;null!==a;)s=s|a.lanes|a.childLanes,a=a.sibling;t.childLanes=s&~r}else t.childLanes=0,t.child=null;return Ui(e,t,r,n)}if(0===(536870912&n))return t.lanes=t.childLanes=536870912,Ui(e,t,null!==s?s.baseLanes|n:n,n);t.memoizedState={baseLanes:0,cachePool:null},null!==e&&Va(0,null!==s?s.cachePool:null),null!==s?ps(t,s):gs(),ii(t)}else null!==s?(Va(0,s.cachePool),ps(t,s),li(),t.memoizedState=null):(null!==e&&Va(0,null),gs(),li());return Ei(e,t,a,n),t.child}function Ui(e,t,n,r){var a=qa();return a=null===a?null:{parent:Oa._currentValue,pool:a},t.memoizedState={baseLanes:n,cachePool:a},null!==e&&Va(0,null),gs(),ii(t),null!==e&&Sa(e,t,r,!0),null}function Ri(e,t){var n=t.ref;if(null===n)null!==e&&null!==e.ref&&(t.flags|=4194816);else{if("function"!==typeof n&&"object"!==typeof n)throw Error(o(284));null!==e&&e.ref===n||(t.flags|=4194816)}}function Ii(e,t,n,r,a){return ja(t),n=Ps(e,t,n,r,void 0,a),r=Is(),null===e||Ci?(sa&&r&&ta(t),t.flags|=1,Ei(e,t,n,a),t.child):(Ms(e,t,a),Yi(e,t,a))}function Mi(e,t,n,r,a,s){return ja(t),t.updateQueue=null,n=Us(t,r,n,a),Os(e),r=Is(),null===e||Ci?(sa&&r&&ta(t),t.flags|=1,Ei(e,t,n,s),t.child):(Ms(e,t,s),Yi(e,t,s))}function Li(e,t,n,r,a){if(ja(t),null===t.stateNode){var s=Rr,o=n.contextType;"object"===typeof o&&null!==o&&(s=_a(o)),s=new n(r,s),t.memoizedState=null!==s.state&&void 0!==s.state?s.state:null,s.updater=hi,t.stateNode=s,s._reactInternals=t,(s=t.stateNode).props=r,s.state=t.memoizedState,s.refs={},ns(t),o=n.contextType,s.context="object"===typeof o&&null!==o?_a(o):Rr,s.state=t.memoizedState,"function"===typeof(o=n.getDerivedStateFromProps)&&(fi(t,n,o,r),s.state=t.memoizedState),"function"===typeof n.getDerivedStateFromProps||"function"===typeof s.getSnapshotBeforeUpdate||"function"!==typeof s.UNSAFE_componentWillMount&&"function"!==typeof s.componentWillMount||(o=s.state,"function"===typeof s.componentWillMount&&s.componentWillMount(),"function"===typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount(),o!==s.state&&hi.enqueueReplaceState(s,s.state,null),us(t,r,s,a),cs(),s.state=t.memoizedState),"function"===typeof s.componentDidMount&&(t.flags|=4194308),r=!0}else if(null===e){s=t.stateNode;var i=t.memoizedProps,l=gi(n,i);s.props=l;var c=s.context,u=n.contextType;o=Rr,"object"===typeof u&&null!==u&&(o=_a(u));var d=n.getDerivedStateFromProps;u="function"===typeof d||"function"===typeof s.getSnapshotBeforeUpdate,i=t.pendingProps!==i,u||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(i||c!==o)&&pi(t,s,r,o),ts=!1;var f=t.memoizedState;s.state=f,us(t,r,s,a),cs(),c=t.memoizedState,i||f!==c||ts?("function"===typeof d&&(fi(t,n,d,r),c=t.memoizedState),(l=ts||mi(t,n,l,r,f,c,o))?(u||"function"!==typeof s.UNSAFE_componentWillMount&&"function"!==typeof s.componentWillMount||("function"===typeof s.componentWillMount&&s.componentWillMount(),"function"===typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount()),"function"===typeof s.componentDidMount&&(t.flags|=4194308)):("function"===typeof s.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=c),s.props=r,s.state=c,s.context=o,r=l):("function"===typeof s.componentDidMount&&(t.flags|=4194308),r=!1)}else{s=t.stateNode,rs(e,t),u=gi(n,o=t.memoizedProps),s.props=u,d=t.pendingProps,f=s.context,c=n.contextType,l=Rr,"object"===typeof c&&null!==c&&(l=_a(c)),(c="function"===typeof(i=n.getDerivedStateFromProps)||"function"===typeof s.getSnapshotBeforeUpdate)||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(o!==d||f!==l)&&pi(t,s,r,l),ts=!1,f=t.memoizedState,s.state=f,us(t,r,s,a),cs();var h=t.memoizedState;o!==d||f!==h||ts||null!==e&&null!==e.dependencies&&Na(e.dependencies)?("function"===typeof i&&(fi(t,n,i,r),h=t.memoizedState),(u=ts||mi(t,n,u,r,f,h,l)||null!==e&&null!==e.dependencies&&Na(e.dependencies))?(c||"function"!==typeof s.UNSAFE_componentWillUpdate&&"function"!==typeof s.componentWillUpdate||("function"===typeof s.componentWillUpdate&&s.componentWillUpdate(r,h,l),"function"===typeof s.UNSAFE_componentWillUpdate&&s.UNSAFE_componentWillUpdate(r,h,l)),"function"===typeof s.componentDidUpdate&&(t.flags|=4),"function"===typeof s.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof s.componentDidUpdate||o===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||o===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=h),s.props=r,s.state=h,s.context=l,r=u):("function"!==typeof s.componentDidUpdate||o===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||o===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),r=!1)}return s=r,Ri(e,t),r=0!==(128&t.flags),s||r?(s=t.stateNode,n=r&&"function"!==typeof n.getDerivedStateFromError?null:s.render(),t.flags|=1,null!==e&&r?(t.child=ni(t,e.child,null,a),t.child=ni(t,null,n,a)):Ei(e,t,n,a),t.memoizedState=s.state,e=t.child):e=Yi(e,t,a),e}function Di(e,t,n,r){return ha(),t.flags|=256,Ei(e,t,n,r),t.child}var Fi={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Bi(e){return{baseLanes:e,cachePool:Ha()}}function zi(e,t,n){return e=null!==e?e.childLanes&~n:0,t&&(e|=gc),e}function qi(e,t,n){var r,a=t.pendingProps,s=!1,i=0!==(128&t.flags);if((r=i)||(r=(null===e||null!==e.memoizedState)&&0!==(2&ui.current)),r&&(s=!0,t.flags&=-129),r=0!==(32&t.flags),t.flags&=-33,null===e){if(sa){if(s?oi(t):li(),sa){var l,c=aa;if(l=c){e:{for(l=c,c=ia;8!==l.nodeType;){if(!c){c=null;break e}if(null===(l=yd(l.nextSibling))){c=null;break e}}c=l}null!==c?(t.memoizedState={dehydrated:c,treeContext:null!==Qr?{id:Jr,overflow:Xr}:null,retryLane:536870912,hydrationErrors:null},(l=Mr(18,null,null,0)).stateNode=c,l.return=t,t.child=l,ra=t,aa=null,l=!0):l=!1}l||ca(t)}if(null!==(c=t.memoizedState)&&null!==(c=c.dehydrated))return gd(c)?t.lanes=32:t.lanes=536870912,null;ci(t)}return c=a.children,a=a.fallback,s?(li(),c=Hi({mode:"hidden",children:c},s=t.mode),a=zr(a,s,n,null),c.return=t,a.return=t,c.sibling=a,t.child=c,(s=t.child).memoizedState=Bi(n),s.childLanes=zi(e,r,n),t.memoizedState=Fi,a):(oi(t),Vi(t,c))}if(null!==(l=e.memoizedState)&&null!==(c=l.dehydrated)){if(i)256&t.flags?(oi(t),t.flags&=-257,t=Wi(e,t,n)):null!==t.memoizedState?(li(),t.child=e.child,t.flags|=128,t=null):(li(),s=a.fallback,c=t.mode,a=Hi({mode:"visible",children:a.children},c),(s=zr(s,c,n,null)).flags|=2,a.return=t,s.return=t,a.sibling=s,t.child=a,ni(t,e.child,null,n),(a=t.child).memoizedState=Bi(n),a.childLanes=zi(e,r,n),t.memoizedState=Fi,t=s);else if(oi(t),gd(c)){if(r=c.nextSibling&&c.nextSibling.dataset)var u=r.dgst;r=u,(a=Error(o(419))).stack="",a.digest=r,pa({value:a,source:null,stack:null}),t=Wi(e,t,n)}else if(Ci||Sa(e,t,n,!1),r=0!==(n&e.childLanes),Ci||r){if(null!==(r=rc)&&(0!==(a=0!==((a=0!==(42&(a=n&-n))?1:Ee(a))&(r.suspendedLanes|n))?0:a)&&a!==l.retryLane))throw l.retryLane=a,Pr(e,a),Mc(r,e,a),_i;"$?"===c.data||Gc(),t=Wi(e,t,n)}else"$?"===c.data?(t.flags|=192,t.child=e.child,t=null):(e=l.treeContext,aa=yd(c.nextSibling),ra=t,sa=!0,oa=null,ia=!1,null!==e&&($r[Yr++]=Jr,$r[Yr++]=Xr,$r[Yr++]=Qr,Jr=e.id,Xr=e.overflow,Qr=t),(t=Vi(t,a.children)).flags|=4096);return t}return s?(li(),s=a.fallback,c=t.mode,u=(l=e.child).sibling,(a=Dr(l,{mode:"hidden",children:a.children})).subtreeFlags=65011712&l.subtreeFlags,null!==u?s=Dr(u,s):(s=zr(s,c,n,null)).flags|=2,s.return=t,a.return=t,a.sibling=s,t.child=a,a=s,s=t.child,null===(c=e.child.memoizedState)?c=Bi(n):(null!==(l=c.cachePool)?(u=Oa._currentValue,l=l.parent!==u?{parent:u,pool:u}:l):l=Ha(),c={baseLanes:c.baseLanes|n,cachePool:l}),s.memoizedState=c,s.childLanes=zi(e,r,n),t.memoizedState=Fi,a):(oi(t),e=(n=e.child).sibling,(n=Dr(n,{mode:"visible",children:a.children})).return=t,n.sibling=null,null!==e&&(null===(r=t.deletions)?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n)}function Vi(e,t){return(t=Hi({mode:"visible",children:t},e.mode)).return=e,e.child=t}function Hi(e,t){return(e=Mr(22,e,null,t)).lanes=0,e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},e}function Wi(e,t,n){return ni(t,e.child,null,n),(e=Vi(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Ki(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),wa(e.return,t,n)}function Gi(e,t,n,r,a){var s=e.memoizedState;null===s?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:a}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailMode=a)}function $i(e,t,n){var r=t.pendingProps,a=r.revealOrder,s=r.tail;if(Ei(e,t,r.children,n),0!==(2&(r=ui.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Ki(e,n,t);else if(19===e.tag)Ki(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}switch(z(ui,r),a){case"forwards":for(n=t.child,a=null;null!==n;)null!==(e=n.alternate)&&null===di(e)&&(a=n),n=n.sibling;null===(n=a)?(a=t.child,t.child=null):(a=n.sibling,n.sibling=null),Gi(t,!1,a,n,s);break;case"backwards":for(n=null,a=t.child,t.child=null;null!==a;){if(null!==(e=a.alternate)&&null===di(e)){t.child=a;break}e=a.sibling,a.sibling=n,n=a,a=e}Gi(t,!0,n,null,s);break;case"together":Gi(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Yi(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),hc|=t.lanes,0===(n&t.childLanes)){if(null===e)return null;if(Sa(e,t,n,!1),0===(n&t.childLanes))return null}if(null!==e&&t.child!==e.child)throw Error(o(153));if(null!==t.child){for(n=Dr(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Dr(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Qi(e,t){return 0!==(e.lanes&t)||!(null===(e=e.dependencies)||!Na(e))}function Ji(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps)Ci=!0;else{if(!Qi(e,n)&&0===(128&t.flags))return Ci=!1,function(e,t,n){switch(t.tag){case 3:K(t,t.stateNode.containerInfo),ba(0,Oa,e.memoizedState.cache),ha();break;case 27:case 5:$(t);break;case 4:K(t,t.stateNode.containerInfo);break;case 10:ba(0,t.type,t.memoizedProps.value);break;case 13:var r=t.memoizedState;if(null!==r)return null!==r.dehydrated?(oi(t),t.flags|=128,null):0!==(n&t.child.childLanes)?qi(e,t,n):(oi(t),null!==(e=Yi(e,t,n))?e.sibling:null);oi(t);break;case 19:var a=0!==(128&e.flags);if((r=0!==(n&t.childLanes))||(Sa(e,t,n,!1),r=0!==(n&t.childLanes)),a){if(r)return $i(e,t,n);t.flags|=128}if(null!==(a=t.memoizedState)&&(a.rendering=null,a.tail=null,a.lastEffect=null),z(ui,ui.current),r)break;return null;case 22:case 23:return t.lanes=0,Oi(e,t,n);case 24:ba(0,Oa,e.memoizedState.cache)}return Yi(e,t,n)}(e,t,n);Ci=0!==(131072&e.flags)}else Ci=!1,sa&&0!==(1048576&t.flags)&&ea(t,Gr,t.index);switch(t.lanes=0,t.tag){case 16:e:{e=t.pendingProps;var r=t.elementType,a=r._init;if(r=a(r._payload),t.type=r,"function"!==typeof r){if(void 0!==r&&null!==r){if((a=r.$$typeof)===k){t.tag=11,t=Ti(null,t,r,e,n);break e}if(a===j){t.tag=14,t=Ai(null,t,r,e,n);break e}}throw t=O(r)||r,Error(o(306,t,""))}Lr(r)?(e=gi(r,e),t.tag=1,t=Li(null,t,r,e,n)):(t.tag=0,t=Ii(null,t,r,e,n))}return t;case 0:return Ii(e,t,t.type,t.pendingProps,n);case 1:return Li(e,t,r=t.type,a=gi(r,t.pendingProps),n);case 3:e:{if(K(t,t.stateNode.containerInfo),null===e)throw Error(o(387));r=t.pendingProps;var s=t.memoizedState;a=s.element,rs(e,t),us(t,r,null,n);var i=t.memoizedState;if(r=i.cache,ba(0,Oa,r),r!==s.cache&&ka(t,[Oa],n,!0),cs(),r=i.element,s.isDehydrated){if(s={element:r,isDehydrated:!1,cache:i.cache},t.updateQueue.baseState=s,t.memoizedState=s,256&t.flags){t=Di(e,t,r,n);break e}if(r!==a){pa(a=Nr(Error(o(424)),t)),t=Di(e,t,r,n);break e}if(9===(e=t.stateNode.containerInfo).nodeType)e=e.body;else e="HTML"===e.nodeName?e.ownerDocument.body:e;for(aa=yd(e.firstChild),ra=t,sa=!0,oa=null,ia=!0,n=ri(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(ha(),r===a){t=Yi(e,t,n);break e}Ei(e,t,r,n)}t=t.child}return t;case 26:return Ri(e,t),null===e?(n=Ed(t.type,null,t.pendingProps,null))?t.memoizedState=n:sa||(n=t.type,e=t.pendingProps,(r=rd(H.current).createElement(n))[Oe]=t,r[Ue]=e,ed(r,n,e),We(r),t.stateNode=r):t.memoizedState=Ed(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return $(t),null===e&&sa&&(r=t.stateNode=xd(t.type,t.pendingProps,H.current),ra=t,ia=!0,a=aa,hd(t.type)?(vd=a,aa=yd(r.firstChild)):aa=a),Ei(e,t,t.pendingProps.children,n),Ri(e,t),null===e&&(t.flags|=4194304),t.child;case 5:return null===e&&sa&&((a=r=aa)&&(null!==(r=function(e,t,n,r){for(;1===e.nodeType;){var a=n;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!r&&("INPUT"!==e.nodeName||"hidden"!==e.type))break}else if(r){if(!e[Fe])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if("stylesheet"===(s=e.getAttribute("rel"))&&e.hasAttribute("data-precedence"))break;if(s!==a.rel||e.getAttribute("href")!==(null==a.href||""===a.href?null:a.href)||e.getAttribute("crossorigin")!==(null==a.crossOrigin?null:a.crossOrigin)||e.getAttribute("title")!==(null==a.title?null:a.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(((s=e.getAttribute("src"))!==(null==a.src?null:a.src)||e.getAttribute("type")!==(null==a.type?null:a.type)||e.getAttribute("crossorigin")!==(null==a.crossOrigin?null:a.crossOrigin))&&s&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else{if("input"!==t||"hidden"!==e.type)return e;var s=null==a.name?null:""+a.name;if("hidden"===a.type&&e.getAttribute("name")===s)return e}if(null===(e=yd(e.nextSibling)))break}return null}(r,t.type,t.pendingProps,ia))?(t.stateNode=r,ra=t,aa=yd(r.firstChild),ia=!1,a=!0):a=!1),a||ca(t)),$(t),a=t.type,s=t.pendingProps,i=null!==e?e.memoizedProps:null,r=s.children,od(a,s)?r=null:null!==i&&od(a,i)&&(t.flags|=32),null!==t.memoizedState&&(a=Ps(e,t,Rs,null,null,n),$d._currentValue=a),Ri(e,t),Ei(e,t,r,n),t.child;case 6:return null===e&&sa&&((e=n=aa)&&(null!==(n=function(e,t,n){if(""===t)return null;for(;3!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!n)return null;if(null===(e=yd(e.nextSibling)))return null}return e}(n,t.pendingProps,ia))?(t.stateNode=n,ra=t,aa=null,e=!0):e=!1),e||ca(t)),null;case 13:return qi(e,t,n);case 4:return K(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=ni(t,null,r,n):Ei(e,t,r,n),t.child;case 11:return Ti(e,t,t.type,t.pendingProps,n);case 7:return Ei(e,t,t.pendingProps,n),t.child;case 8:case 12:return Ei(e,t,t.pendingProps.children,n),t.child;case 10:return r=t.pendingProps,ba(0,t.type,r.value),Ei(e,t,r.children,n),t.child;case 9:return a=t.type._context,r=t.pendingProps.children,ja(t),r=r(a=_a(a)),t.flags|=1,Ei(e,t,r,n),t.child;case 14:return Ai(e,t,t.type,t.pendingProps,n);case 15:return Pi(e,t,t.type,t.pendingProps,n);case 19:return $i(e,t,n);case 31:return r=t.pendingProps,n=t.mode,r={mode:r.mode,children:r.children},null===e?((n=Hi(r,n)).ref=t.ref,t.child=n,n.return=t,t=n):((n=Dr(e.child,r)).ref=t.ref,t.child=n,n.return=t,t=n),t;case 22:return Oi(e,t,n);case 24:return ja(t),r=_a(Oa),null===e?(null===(a=qa())&&(a=rc,s=Ua(),a.pooledCache=s,s.refCount++,null!==s&&(a.pooledCacheLanes|=n),a=s),t.memoizedState={parent:r,cache:a},ns(t),ba(0,Oa,a)):(0!==(e.lanes&n)&&(rs(e,t),us(t,null,null,n),cs()),a=e.memoizedState,s=t.memoizedState,a.parent!==r?(a={parent:r,cache:r},t.memoizedState=a,0===t.lanes&&(t.memoizedState=t.updateQueue.baseState=a),ba(0,Oa,r)):(r=s.cache,ba(0,Oa,r),r!==a.cache&&ka(t,[Oa],n,!0))),Ei(e,t,t.pendingProps.children,n),t.child;case 29:throw t.pendingProps}throw Error(o(156,t.tag))}function Xi(e){e.flags|=4}function Zi(e,t){if("stylesheet"!==t.type||0!==(4&t.state.loading))e.flags&=-16777217;else if(e.flags|=16777216,!zd(t)){if(null!==(t=ai.current)&&((4194048&sc)===sc?null!==si:(62914560&sc)!==sc&&0===(536870912&sc)||t!==si))throw Xa=$a,Ka;e.flags|=8192}}function el(e,t){null!==t&&(e.flags|=4),16384&e.flags&&(t=22!==e.tag?Se():536870912,e.lanes|=t,yc|=t)}function tl(e,t){if(!sa)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function nl(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var a=e.child;null!==a;)n|=a.lanes|a.childLanes,r|=65011712&a.subtreeFlags,r|=65011712&a.flags,a.return=e,a=a.sibling;else for(a=e.child;null!==a;)n|=a.lanes|a.childLanes,r|=a.subtreeFlags,r|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function rl(e,t,n){var r=t.pendingProps;switch(na(t),t.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:case 1:return nl(t),null;case 3:return n=t.stateNode,r=null,null!==e&&(r=e.memoizedState.cache),t.memoizedState.cache!==r&&(t.flags|=2048),xa(Oa),G(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||(fa(t)?Xi(t):null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,ma())),nl(t),null;case 26:return n=t.memoizedState,null===e?(Xi(t),null!==n?(nl(t),Zi(t,n)):(nl(t),t.flags&=-16777217)):n?n!==e.memoizedState?(Xi(t),nl(t),Zi(t,n)):(nl(t),t.flags&=-16777217):(e.memoizedProps!==r&&Xi(t),nl(t),t.flags&=-16777217),null;case 27:Y(t),n=H.current;var a=t.type;if(null!==e&&null!=t.stateNode)e.memoizedProps!==r&&Xi(t);else{if(!r){if(null===t.stateNode)throw Error(o(166));return nl(t),null}e=q.current,fa(t)?ua(t):(e=xd(a,r,n),t.stateNode=e,Xi(t))}return nl(t),null;case 5:if(Y(t),n=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==r&&Xi(t);else{if(!r){if(null===t.stateNode)throw Error(o(166));return nl(t),null}if(e=q.current,fa(t))ua(t);else{switch(a=rd(H.current),e){case 1:e=a.createElementNS("http://www.w3.org/2000/svg",n);break;case 2:e=a.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;default:switch(n){case"svg":e=a.createElementNS("http://www.w3.org/2000/svg",n);break;case"math":e=a.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;case"script":(e=a.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild);break;case"select":e="string"===typeof r.is?a.createElement("select",{is:r.is}):a.createElement("select"),r.multiple?e.multiple=!0:r.size&&(e.size=r.size);break;default:e="string"===typeof r.is?a.createElement(n,{is:r.is}):a.createElement(n)}}e[Oe]=t,e[Ue]=r;e:for(a=t.child;null!==a;){if(5===a.tag||6===a.tag)e.appendChild(a.stateNode);else if(4!==a.tag&&27!==a.tag&&null!==a.child){a.child.return=a,a=a.child;continue}if(a===t)break e;for(;null===a.sibling;){if(null===a.return||a.return===t)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}t.stateNode=e;e:switch(ed(e,n,r),n){case"button":case"input":case"select":case"textarea":e=!!r.autoFocus;break e;case"img":e=!0;break e;default:e=!1}e&&Xi(t)}}return nl(t),t.flags&=-16777217,null;case 6:if(e&&null!=t.stateNode)e.memoizedProps!==r&&Xi(t);else{if("string"!==typeof r&&null===t.stateNode)throw Error(o(166));if(e=H.current,fa(t)){if(e=t.stateNode,n=t.memoizedProps,r=null,null!==(a=ra))switch(a.tag){case 27:case 5:r=a.memoizedProps}e[Oe]=t,(e=!!(e.nodeValue===n||null!==r&&!0===r.suppressHydrationWarning||Qu(e.nodeValue,n)))||ca(t)}else(e=rd(e).createTextNode(r))[Oe]=t,t.stateNode=e}return nl(t),null;case 13:if(r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(a=fa(t),null!==r&&null!==r.dehydrated){if(null===e){if(!a)throw Error(o(318));if(!(a=null!==(a=t.memoizedState)?a.dehydrated:null))throw Error(o(317));a[Oe]=t}else ha(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;nl(t),a=!1}else a=ma(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=a),a=!0;if(!a)return 256&t.flags?(ci(t),t):(ci(t),null)}if(ci(t),0!==(128&t.flags))return t.lanes=n,t;if(n=null!==r,e=null!==e&&null!==e.memoizedState,n){a=null,null!==(r=t.child).alternate&&null!==r.alternate.memoizedState&&null!==r.alternate.memoizedState.cachePool&&(a=r.alternate.memoizedState.cachePool.pool);var s=null;null!==r.memoizedState&&null!==r.memoizedState.cachePool&&(s=r.memoizedState.cachePool.pool),s!==a&&(r.flags|=2048)}return n!==e&&n&&(t.child.flags|=8192),el(t,t.updateQueue),nl(t),null;case 4:return G(),null===e&&Bu(t.stateNode.containerInfo),nl(t),null;case 10:return xa(t.type),nl(t),null;case 19:if(B(ui),null===(a=t.memoizedState))return nl(t),null;if(r=0!==(128&t.flags),null===(s=a.rendering))if(r)tl(a,!1);else{if(0!==fc||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(s=di(e))){for(t.flags|=128,tl(a,!1),e=s.updateQueue,t.updateQueue=e,el(t,e),t.subtreeFlags=0,e=n,n=t.child;null!==n;)Fr(n,e),n=n.sibling;return z(ui,1&ui.current|2),t.child}e=e.sibling}null!==a.tail&&te()>kc&&(t.flags|=128,r=!0,tl(a,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=di(s))){if(t.flags|=128,r=!0,e=e.updateQueue,t.updateQueue=e,el(t,e),tl(a,!0),null===a.tail&&"hidden"===a.tailMode&&!s.alternate&&!sa)return nl(t),null}else 2*te()-a.renderingStartTime>kc&&536870912!==n&&(t.flags|=128,r=!0,tl(a,!1),t.lanes=4194304);a.isBackwards?(s.sibling=t.child,t.child=s):(null!==(e=a.last)?e.sibling=s:t.child=s,a.last=s)}return null!==a.tail?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=te(),t.sibling=null,e=ui.current,z(ui,r?1&e|2:1&e),t):(nl(t),null);case 22:case 23:return ci(t),ys(),r=null!==t.memoizedState,null!==e?null!==e.memoizedState!==r&&(t.flags|=8192):r&&(t.flags|=8192),r?0!==(536870912&n)&&0===(128&t.flags)&&(nl(t),6&t.subtreeFlags&&(t.flags|=8192)):nl(t),null!==(n=t.updateQueue)&&el(t,n.retryQueue),n=null,null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),r=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(r=t.memoizedState.cachePool.pool),r!==n&&(t.flags|=2048),null!==e&&B(za),null;case 24:return n=null,null!==e&&(n=e.memoizedState.cache),t.memoizedState.cache!==n&&(t.flags|=2048),xa(Oa),nl(t),null;case 25:case 30:return null}throw Error(o(156,t.tag))}function al(e,t){switch(na(t),t.tag){case 1:return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return xa(Oa),G(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 26:case 27:case 5:return Y(t),null;case 13:if(ci(t),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(o(340));ha()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return B(ui),null;case 4:return G(),null;case 10:return xa(t.type),null;case 22:case 23:return ci(t),ys(),null!==e&&B(za),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 24:return xa(Oa),null;default:return null}}function sl(e,t){switch(na(t),t.tag){case 3:xa(Oa),G();break;case 26:case 27:case 5:Y(t);break;case 4:G();break;case 13:ci(t);break;case 19:B(ui);break;case 10:xa(t.type);break;case 22:case 23:ci(t),ys(),null!==e&&B(za);break;case 24:xa(Oa)}}function ol(e,t){try{var n=t.updateQueue,r=null!==n?n.lastEffect:null;if(null!==r){var a=r.next;n=a;do{if((n.tag&e)===e){r=void 0;var s=n.create,o=n.inst;r=s(),o.destroy=r}n=n.next}while(n!==a)}}catch(i){uu(t,t.return,i)}}function il(e,t,n){try{var r=t.updateQueue,a=null!==r?r.lastEffect:null;if(null!==a){var s=a.next;r=s;do{if((r.tag&e)===e){var o=r.inst,i=o.destroy;if(void 0!==i){o.destroy=void 0,a=t;var l=n,c=i;try{c()}catch(u){uu(a,l,u)}}}r=r.next}while(r!==s)}}catch(u){uu(t,t.return,u)}}function ll(e){var t=e.updateQueue;if(null!==t){var n=e.stateNode;try{fs(t,n)}catch(r){uu(e,e.return,r)}}}function cl(e,t,n){n.props=gi(e.type,e.memoizedProps),n.state=e.memoizedState;try{n.componentWillUnmount()}catch(r){uu(e,t,r)}}function ul(e,t){try{var n=e.ref;if(null!==n){switch(e.tag){case 26:case 27:case 5:var r=e.stateNode;break;default:r=e.stateNode}"function"===typeof n?e.refCleanup=n(r):n.current=r}}catch(a){uu(e,t,a)}}function dl(e,t){var n=e.ref,r=e.refCleanup;if(null!==n)if("function"===typeof r)try{r()}catch(a){uu(e,t,a)}finally{e.refCleanup=null,null!=(e=e.alternate)&&(e.refCleanup=null)}else if("function"===typeof n)try{n(null)}catch(s){uu(e,t,s)}else n.current=null}function fl(e){var t=e.type,n=e.memoizedProps,r=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":n.autoFocus&&r.focus();break e;case"img":n.src?r.src=n.src:n.srcSet&&(r.srcset=n.srcSet)}}catch(a){uu(e,e.return,a)}}function hl(e,t,n){try{var r=e.stateNode;!function(e,t,n,r){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var a=null,s=null,i=null,l=null,c=null,u=null,d=null;for(m in n){var f=n[m];if(n.hasOwnProperty(m)&&null!=f)switch(m){case"checked":case"value":break;case"defaultValue":c=f;default:r.hasOwnProperty(m)||Xu(e,t,m,null,r,f)}}for(var h in r){var m=r[h];if(f=n[h],r.hasOwnProperty(h)&&(null!=m||null!=f))switch(h){case"type":s=m;break;case"name":a=m;break;case"checked":u=m;break;case"defaultChecked":d=m;break;case"value":i=m;break;case"defaultValue":l=m;break;case"children":case"dangerouslySetInnerHTML":if(null!=m)throw Error(o(137,t));break;default:m!==f&&Xu(e,t,h,m,r,f)}}return void gt(e,i,l,c,u,d,s,a);case"select":for(s in m=i=l=h=null,n)if(c=n[s],n.hasOwnProperty(s)&&null!=c)switch(s){case"value":break;case"multiple":m=c;default:r.hasOwnProperty(s)||Xu(e,t,s,null,r,c)}for(a in r)if(s=r[a],c=n[a],r.hasOwnProperty(a)&&(null!=s||null!=c))switch(a){case"value":h=s;break;case"defaultValue":l=s;break;case"multiple":i=s;default:s!==c&&Xu(e,t,a,s,r,c)}return t=l,n=i,r=m,void(null!=h?bt(e,!!n,h,!1):!!r!==!!n&&(null!=t?bt(e,!!n,t,!0):bt(e,!!n,n?[]:"",!1)));case"textarea":for(l in m=h=null,n)if(a=n[l],n.hasOwnProperty(l)&&null!=a&&!r.hasOwnProperty(l))switch(l){case"value":case"children":break;default:Xu(e,t,l,null,r,a)}for(i in r)if(a=r[i],s=n[i],r.hasOwnProperty(i)&&(null!=a||null!=s))switch(i){case"value":h=a;break;case"defaultValue":m=a;break;case"children":break;case"dangerouslySetInnerHTML":if(null!=a)throw Error(o(91));break;default:a!==s&&Xu(e,t,i,a,r,s)}return void xt(e,h,m);case"option":for(var p in n)if(h=n[p],n.hasOwnProperty(p)&&null!=h&&!r.hasOwnProperty(p))if("selected"===p)e.selected=!1;else Xu(e,t,p,null,r,h);for(c in r)if(h=r[c],m=n[c],r.hasOwnProperty(c)&&h!==m&&(null!=h||null!=m))if("selected"===c)e.selected=h&&"function"!==typeof h&&"symbol"!==typeof h;else Xu(e,t,c,h,r,m);return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var g in n)h=n[g],n.hasOwnProperty(g)&&null!=h&&!r.hasOwnProperty(g)&&Xu(e,t,g,null,r,h);for(u in r)if(h=r[u],m=n[u],r.hasOwnProperty(u)&&h!==m&&(null!=h||null!=m))switch(u){case"children":case"dangerouslySetInnerHTML":if(null!=h)throw Error(o(137,t));break;default:Xu(e,t,u,h,r,m)}return;default:if(_t(t)){for(var y in n)h=n[y],n.hasOwnProperty(y)&&void 0!==h&&!r.hasOwnProperty(y)&&Zu(e,t,y,void 0,r,h);for(d in r)h=r[d],m=n[d],!r.hasOwnProperty(d)||h===m||void 0===h&&void 0===m||Zu(e,t,d,h,r,m);return}}for(var v in n)h=n[v],n.hasOwnProperty(v)&&null!=h&&!r.hasOwnProperty(v)&&Xu(e,t,v,null,r,h);for(f in r)h=r[f],m=n[f],!r.hasOwnProperty(f)||h===m||null==h&&null==m||Xu(e,t,f,h,r,m)}(r,e.type,n,t),r[Ue]=t}catch(a){uu(e,e.return,a)}}function ml(e){return 5===e.tag||3===e.tag||26===e.tag||27===e.tag&&hd(e.type)||4===e.tag}function pl(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||ml(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(27===e.tag&&hd(e.type))continue e;if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function gl(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?(9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).insertBefore(e,t):((t=9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Ju));else if(4!==r&&(27===r&&hd(e.type)&&(n=e.stateNode,t=null),null!==(e=e.child)))for(gl(e,t,n),e=e.sibling;null!==e;)gl(e,t,n),e=e.sibling}function yl(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&(27===r&&hd(e.type)&&(n=e.stateNode),null!==(e=e.child)))for(yl(e,t,n),e=e.sibling;null!==e;)yl(e,t,n),e=e.sibling}function vl(e){var t=e.stateNode,n=e.memoizedProps;try{for(var r=e.type,a=t.attributes;a.length;)t.removeAttributeNode(a[0]);ed(t,r,n),t[Oe]=e,t[Ue]=n}catch(s){uu(e,e.return,s)}}var bl=!1,xl=!1,wl=!1,kl="function"===typeof WeakSet?WeakSet:Set,Sl=null;function Nl(e,t,n){var r=n.flags;switch(n.tag){case 0:case 11:case 15:Ll(e,n),4&r&&ol(5,n);break;case 1:if(Ll(e,n),4&r)if(e=n.stateNode,null===t)try{e.componentDidMount()}catch(o){uu(n,n.return,o)}else{var a=gi(n.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(a,t,e.__reactInternalSnapshotBeforeUpdate)}catch(i){uu(n,n.return,i)}}64&r&&ll(n),512&r&&ul(n,n.return);break;case 3:if(Ll(e,n),64&r&&null!==(e=n.updateQueue)){if(t=null,null!==n.child)switch(n.child.tag){case 27:case 5:case 1:t=n.child.stateNode}try{fs(e,t)}catch(o){uu(n,n.return,o)}}break;case 27:null===t&&4&r&&vl(n);case 26:case 5:Ll(e,n),null===t&&4&r&&fl(n),512&r&&ul(n,n.return);break;case 12:Ll(e,n);break;case 13:Ll(e,n),4&r&&Al(e,n),64&r&&(null!==(e=n.memoizedState)&&(null!==(e=e.dehydrated)&&function(e,t){var n=e.ownerDocument;if("$?"!==e.data||"complete"===n.readyState)t();else{var r=function(){t(),n.removeEventListener("DOMContentLoaded",r)};n.addEventListener("DOMContentLoaded",r),e._reactRetry=r}}(e,n=mu.bind(null,n))));break;case 22:if(!(r=null!==n.memoizedState||bl)){t=null!==t&&null!==t.memoizedState||xl,a=bl;var s=xl;bl=r,(xl=t)&&!s?Fl(e,n,0!==(8772&n.subtreeFlags)):Ll(e,n),bl=a,xl=s}break;case 30:break;default:Ll(e,n)}}function jl(e){var t=e.alternate;null!==t&&(e.alternate=null,jl(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&Be(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var _l=null,Cl=!1;function El(e,t,n){for(n=n.child;null!==n;)Tl(e,t,n),n=n.sibling}function Tl(e,t,n){if(de&&"function"===typeof de.onCommitFiberUnmount)try{de.onCommitFiberUnmount(ue,n)}catch(s){}switch(n.tag){case 26:xl||dl(n,t),El(e,t,n),n.memoizedState?n.memoizedState.count--:n.stateNode&&(n=n.stateNode).parentNode.removeChild(n);break;case 27:xl||dl(n,t);var r=_l,a=Cl;hd(n.type)&&(_l=n.stateNode,Cl=!1),El(e,t,n),wd(n.stateNode),_l=r,Cl=a;break;case 5:xl||dl(n,t);case 6:if(r=_l,a=Cl,_l=null,El(e,t,n),Cl=a,null!==(_l=r))if(Cl)try{(9===_l.nodeType?_l.body:"HTML"===_l.nodeName?_l.ownerDocument.body:_l).removeChild(n.stateNode)}catch(o){uu(n,t,o)}else try{_l.removeChild(n.stateNode)}catch(o){uu(n,t,o)}break;case 18:null!==_l&&(Cl?(md(9===(e=_l).nodeType?e.body:"HTML"===e.nodeName?e.ownerDocument.body:e,n.stateNode),Ef(e)):md(_l,n.stateNode));break;case 4:r=_l,a=Cl,_l=n.stateNode.containerInfo,Cl=!0,El(e,t,n),_l=r,Cl=a;break;case 0:case 11:case 14:case 15:xl||il(2,n,t),xl||il(4,n,t),El(e,t,n);break;case 1:xl||(dl(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount&&cl(n,t,r)),El(e,t,n);break;case 21:El(e,t,n);break;case 22:xl=(r=xl)||null!==n.memoizedState,El(e,t,n),xl=r;break;default:El(e,t,n)}}function Al(e,t){if(null===t.memoizedState&&(null!==(e=t.alternate)&&(null!==(e=e.memoizedState)&&null!==(e=e.dehydrated))))try{Ef(e)}catch(n){uu(t,t.return,n)}}function Pl(e,t){var n=function(e){switch(e.tag){case 13:case 19:var t=e.stateNode;return null===t&&(t=e.stateNode=new kl),t;case 22:return null===(t=(e=e.stateNode)._retryCache)&&(t=e._retryCache=new kl),t;default:throw Error(o(435,e.tag))}}(e);t.forEach(function(t){var r=pu.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))})}function Ol(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var a=n[r],s=e,i=t,l=i;e:for(;null!==l;){switch(l.tag){case 27:if(hd(l.type)){_l=l.stateNode,Cl=!1;break e}break;case 5:_l=l.stateNode,Cl=!1;break e;case 3:case 4:_l=l.stateNode.containerInfo,Cl=!0;break e}l=l.return}if(null===_l)throw Error(o(160));Tl(s,i,a),_l=null,Cl=!1,null!==(s=a.alternate)&&(s.return=null),a.return=null}if(13878&t.subtreeFlags)for(t=t.child;null!==t;)Rl(t,e),t=t.sibling}var Ul=null;function Rl(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:Ol(t,e),Il(e),4&r&&(il(3,e,e.return),ol(3,e),il(5,e,e.return));break;case 1:Ol(t,e),Il(e),512&r&&(xl||null===n||dl(n,n.return)),64&r&&bl&&(null!==(e=e.updateQueue)&&(null!==(r=e.callbacks)&&(n=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=null===n?r:n.concat(r))));break;case 26:var a=Ul;if(Ol(t,e),Il(e),512&r&&(xl||null===n||dl(n,n.return)),4&r){var s=null!==n?n.memoizedState:null;if(r=e.memoizedState,null===n)if(null===r)if(null===e.stateNode){e:{r=e.type,n=e.memoizedProps,a=a.ownerDocument||a;t:switch(r){case"title":(!(s=a.getElementsByTagName("title")[0])||s[Fe]||s[Oe]||"http://www.w3.org/2000/svg"===s.namespaceURI||s.hasAttribute("itemprop"))&&(s=a.createElement(r),a.head.insertBefore(s,a.querySelector("head > title"))),ed(s,r,n),s[Oe]=e,We(s),r=s;break e;case"link":var i=Fd("link","href",a).get(r+(n.href||""));if(i)for(var l=0;l<i.length;l++)if((s=i[l]).getAttribute("href")===(null==n.href||""===n.href?null:n.href)&&s.getAttribute("rel")===(null==n.rel?null:n.rel)&&s.getAttribute("title")===(null==n.title?null:n.title)&&s.getAttribute("crossorigin")===(null==n.crossOrigin?null:n.crossOrigin)){i.splice(l,1);break t}ed(s=a.createElement(r),r,n),a.head.appendChild(s);break;case"meta":if(i=Fd("meta","content",a).get(r+(n.content||"")))for(l=0;l<i.length;l++)if((s=i[l]).getAttribute("content")===(null==n.content?null:""+n.content)&&s.getAttribute("name")===(null==n.name?null:n.name)&&s.getAttribute("property")===(null==n.property?null:n.property)&&s.getAttribute("http-equiv")===(null==n.httpEquiv?null:n.httpEquiv)&&s.getAttribute("charset")===(null==n.charSet?null:n.charSet)){i.splice(l,1);break t}ed(s=a.createElement(r),r,n),a.head.appendChild(s);break;default:throw Error(o(468,r))}s[Oe]=e,We(s),r=s}e.stateNode=r}else Bd(a,e.type,e.stateNode);else e.stateNode=Rd(a,r,e.memoizedProps);else s!==r?(null===s?null!==n.stateNode&&(n=n.stateNode).parentNode.removeChild(n):s.count--,null===r?Bd(a,e.type,e.stateNode):Rd(a,r,e.memoizedProps)):null===r&&null!==e.stateNode&&hl(e,e.memoizedProps,n.memoizedProps)}break;case 27:Ol(t,e),Il(e),512&r&&(xl||null===n||dl(n,n.return)),null!==n&&4&r&&hl(e,e.memoizedProps,n.memoizedProps);break;case 5:if(Ol(t,e),Il(e),512&r&&(xl||null===n||dl(n,n.return)),32&e.flags){a=e.stateNode;try{kt(a,"")}catch(m){uu(e,e.return,m)}}4&r&&null!=e.stateNode&&hl(e,a=e.memoizedProps,null!==n?n.memoizedProps:a),1024&r&&(wl=!0);break;case 6:if(Ol(t,e),Il(e),4&r){if(null===e.stateNode)throw Error(o(162));r=e.memoizedProps,n=e.stateNode;try{n.nodeValue=r}catch(m){uu(e,e.return,m)}}break;case 3:if(Dd=null,a=Ul,Ul=Nd(t.containerInfo),Ol(t,e),Ul=a,Il(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Ef(t.containerInfo)}catch(m){uu(e,e.return,m)}wl&&(wl=!1,Ml(e));break;case 4:r=Ul,Ul=Nd(e.stateNode.containerInfo),Ol(t,e),Il(e),Ul=r;break;case 12:default:Ol(t,e),Il(e);break;case 13:Ol(t,e),Il(e),8192&e.child.flags&&null!==e.memoizedState!==(null!==n&&null!==n.memoizedState)&&(wc=te()),4&r&&(null!==(r=e.updateQueue)&&(e.updateQueue=null,Pl(e,r)));break;case 22:a=null!==e.memoizedState;var c=null!==n&&null!==n.memoizedState,u=bl,d=xl;if(bl=u||a,xl=d||c,Ol(t,e),xl=d,bl=u,Il(e),8192&r)e:for(t=e.stateNode,t._visibility=a?-2&t._visibility:1|t._visibility,a&&(null===n||c||bl||xl||Dl(e)),n=null,t=e;;){if(5===t.tag||26===t.tag){if(null===n){c=n=t;try{if(s=c.stateNode,a)"function"===typeof(i=s.style).setProperty?i.setProperty("display","none","important"):i.display="none";else{l=c.stateNode;var f=c.memoizedProps.style,h=void 0!==f&&null!==f&&f.hasOwnProperty("display")?f.display:null;l.style.display=null==h||"boolean"===typeof h?"":(""+h).trim()}}catch(m){uu(c,c.return,m)}}}else if(6===t.tag){if(null===n){c=t;try{c.stateNode.nodeValue=a?"":c.memoizedProps}catch(m){uu(c,c.return,m)}}}else if((22!==t.tag&&23!==t.tag||null===t.memoizedState||t===e)&&null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;null===t.sibling;){if(null===t.return||t.return===e)break e;n===t&&(n=null),t=t.return}n===t&&(n=null),t.sibling.return=t.return,t=t.sibling}4&r&&(null!==(r=e.updateQueue)&&(null!==(n=r.retryQueue)&&(r.retryQueue=null,Pl(e,n))));break;case 19:Ol(t,e),Il(e),4&r&&(null!==(r=e.updateQueue)&&(e.updateQueue=null,Pl(e,r)));case 30:case 21:}}function Il(e){var t=e.flags;if(2&t){try{for(var n,r=e.return;null!==r;){if(ml(r)){n=r;break}r=r.return}if(null==n)throw Error(o(160));switch(n.tag){case 27:var a=n.stateNode;yl(e,pl(e),a);break;case 5:var s=n.stateNode;32&n.flags&&(kt(s,""),n.flags&=-33),yl(e,pl(e),s);break;case 3:case 4:var i=n.stateNode.containerInfo;gl(e,pl(e),i);break;default:throw Error(o(161))}}catch(l){uu(e,e.return,l)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function Ml(e){if(1024&e.subtreeFlags)for(e=e.child;null!==e;){var t=e;Ml(t),5===t.tag&&1024&t.flags&&t.stateNode.reset(),e=e.sibling}}function Ll(e,t){if(8772&t.subtreeFlags)for(t=t.child;null!==t;)Nl(e,t.alternate,t),t=t.sibling}function Dl(e){for(e=e.child;null!==e;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:il(4,t,t.return),Dl(t);break;case 1:dl(t,t.return);var n=t.stateNode;"function"===typeof n.componentWillUnmount&&cl(t,t.return,n),Dl(t);break;case 27:wd(t.stateNode);case 26:case 5:dl(t,t.return),Dl(t);break;case 22:null===t.memoizedState&&Dl(t);break;default:Dl(t)}e=e.sibling}}function Fl(e,t,n){for(n=n&&0!==(8772&t.subtreeFlags),t=t.child;null!==t;){var r=t.alternate,a=e,s=t,o=s.flags;switch(s.tag){case 0:case 11:case 15:Fl(a,s,n),ol(4,s);break;case 1:if(Fl(a,s,n),"function"===typeof(a=(r=s).stateNode).componentDidMount)try{a.componentDidMount()}catch(c){uu(r,r.return,c)}if(null!==(a=(r=s).updateQueue)){var i=r.stateNode;try{var l=a.shared.hiddenCallbacks;if(null!==l)for(a.shared.hiddenCallbacks=null,a=0;a<l.length;a++)ds(l[a],i)}catch(c){uu(r,r.return,c)}}n&&64&o&&ll(s),ul(s,s.return);break;case 27:vl(s);case 26:case 5:Fl(a,s,n),n&&null===r&&4&o&&fl(s),ul(s,s.return);break;case 12:Fl(a,s,n);break;case 13:Fl(a,s,n),n&&4&o&&Al(a,s);break;case 22:null===s.memoizedState&&Fl(a,s,n),ul(s,s.return);break;case 30:break;default:Fl(a,s,n)}t=t.sibling}}function Bl(e,t){var n=null;null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),e=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(e=t.memoizedState.cachePool.pool),e!==n&&(null!=e&&e.refCount++,null!=n&&Ra(n))}function zl(e,t){e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Ra(e))}function ql(e,t,n,r){if(10256&t.subtreeFlags)for(t=t.child;null!==t;)Vl(e,t,n,r),t=t.sibling}function Vl(e,t,n,r){var a=t.flags;switch(t.tag){case 0:case 11:case 15:ql(e,t,n,r),2048&a&&ol(9,t);break;case 1:case 13:default:ql(e,t,n,r);break;case 3:ql(e,t,n,r),2048&a&&(e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Ra(e)));break;case 12:if(2048&a){ql(e,t,n,r),e=t.stateNode;try{var s=t.memoizedProps,o=s.id,i=s.onPostCommit;"function"===typeof i&&i(o,null===t.alternate?"mount":"update",e.passiveEffectDuration,-0)}catch(l){uu(t,t.return,l)}}else ql(e,t,n,r);break;case 23:break;case 22:s=t.stateNode,o=t.alternate,null!==t.memoizedState?2&s._visibility?ql(e,t,n,r):Wl(e,t):2&s._visibility?ql(e,t,n,r):(s._visibility|=2,Hl(e,t,n,r,0!==(10256&t.subtreeFlags))),2048&a&&Bl(o,t);break;case 24:ql(e,t,n,r),2048&a&&zl(t.alternate,t)}}function Hl(e,t,n,r,a){for(a=a&&0!==(10256&t.subtreeFlags),t=t.child;null!==t;){var s=e,o=t,i=n,l=r,c=o.flags;switch(o.tag){case 0:case 11:case 15:Hl(s,o,i,l,a),ol(8,o);break;case 23:break;case 22:var u=o.stateNode;null!==o.memoizedState?2&u._visibility?Hl(s,o,i,l,a):Wl(s,o):(u._visibility|=2,Hl(s,o,i,l,a)),a&&2048&c&&Bl(o.alternate,o);break;case 24:Hl(s,o,i,l,a),a&&2048&c&&zl(o.alternate,o);break;default:Hl(s,o,i,l,a)}t=t.sibling}}function Wl(e,t){if(10256&t.subtreeFlags)for(t=t.child;null!==t;){var n=e,r=t,a=r.flags;switch(r.tag){case 22:Wl(n,r),2048&a&&Bl(r.alternate,r);break;case 24:Wl(n,r),2048&a&&zl(r.alternate,r);break;default:Wl(n,r)}t=t.sibling}}var Kl=8192;function Gl(e){if(e.subtreeFlags&Kl)for(e=e.child;null!==e;)$l(e),e=e.sibling}function $l(e){switch(e.tag){case 26:Gl(e),e.flags&Kl&&null!==e.memoizedState&&function(e,t,n){if(null===qd)throw Error(o(475));var r=qd;if("stylesheet"===t.type&&("string"!==typeof n.media||!1!==matchMedia(n.media).matches)&&0===(4&t.state.loading)){if(null===t.instance){var a=Td(n.href),s=e.querySelector(Ad(a));if(s)return null!==(e=s._p)&&"object"===typeof e&&"function"===typeof e.then&&(r.count++,r=Hd.bind(r),e.then(r,r)),t.state.loading|=4,t.instance=s,void We(s);s=e.ownerDocument||e,n=Pd(n),(a=kd.get(a))&&Md(n,a),We(s=s.createElement("link"));var i=s;i._p=new Promise(function(e,t){i.onload=e,i.onerror=t}),ed(s,"link",n),t.instance=s}null===r.stylesheets&&(r.stylesheets=new Map),r.stylesheets.set(t,e),(e=t.state.preload)&&0===(3&t.state.loading)&&(r.count++,t=Hd.bind(r),e.addEventListener("load",t),e.addEventListener("error",t))}}(Ul,e.memoizedState,e.memoizedProps);break;case 5:default:Gl(e);break;case 3:case 4:var t=Ul;Ul=Nd(e.stateNode.containerInfo),Gl(e),Ul=t;break;case 22:null===e.memoizedState&&(null!==(t=e.alternate)&&null!==t.memoizedState?(t=Kl,Kl=16777216,Gl(e),Kl=t):Gl(e))}}function Yl(e){var t=e.alternate;if(null!==t&&null!==(e=t.child)){t.child=null;do{t=e.sibling,e.sibling=null,e=t}while(null!==e)}}function Ql(e){var t=e.deletions;if(0!==(16&e.flags)){if(null!==t)for(var n=0;n<t.length;n++){var r=t[n];Sl=r,Zl(r,e)}Yl(e)}if(10256&e.subtreeFlags)for(e=e.child;null!==e;)Jl(e),e=e.sibling}function Jl(e){switch(e.tag){case 0:case 11:case 15:Ql(e),2048&e.flags&&il(9,e,e.return);break;case 3:case 12:default:Ql(e);break;case 22:var t=e.stateNode;null!==e.memoizedState&&2&t._visibility&&(null===e.return||13!==e.return.tag)?(t._visibility&=-3,Xl(e)):Ql(e)}}function Xl(e){var t=e.deletions;if(0!==(16&e.flags)){if(null!==t)for(var n=0;n<t.length;n++){var r=t[n];Sl=r,Zl(r,e)}Yl(e)}for(e=e.child;null!==e;){switch((t=e).tag){case 0:case 11:case 15:il(8,t,t.return),Xl(t);break;case 22:2&(n=t.stateNode)._visibility&&(n._visibility&=-3,Xl(t));break;default:Xl(t)}e=e.sibling}}function Zl(e,t){for(;null!==Sl;){var n=Sl;switch(n.tag){case 0:case 11:case 15:il(8,n,t);break;case 23:case 22:if(null!==n.memoizedState&&null!==n.memoizedState.cachePool){var r=n.memoizedState.cachePool.pool;null!=r&&r.refCount++}break;case 24:Ra(n.memoizedState.cache)}if(null!==(r=n.child))r.return=n,Sl=r;else e:for(n=e;null!==Sl;){var a=(r=Sl).sibling,s=r.return;if(jl(r),r===n){Sl=null;break e}if(null!==a){a.return=s,Sl=a;break e}Sl=s}}}var ec={getCacheForType:function(e){var t=_a(Oa),n=t.data.get(e);return void 0===n&&(n=e(),t.data.set(e,n)),n}},tc="function"===typeof WeakMap?WeakMap:Map,nc=0,rc=null,ac=null,sc=0,oc=0,ic=null,lc=!1,cc=!1,uc=!1,dc=0,fc=0,hc=0,mc=0,pc=0,gc=0,yc=0,vc=null,bc=null,xc=!1,wc=0,kc=1/0,Sc=null,Nc=null,jc=0,_c=null,Cc=null,Ec=0,Tc=0,Ac=null,Pc=null,Oc=0,Uc=null;function Rc(){if(0!==(2&nc)&&0!==sc)return sc&-sc;if(null!==R.T){return 0!==La?La:Tu()}return Ae()}function Ic(){0===gc&&(gc=0===(536870912&sc)||sa?ke():536870912);var e=ai.current;return null!==e&&(e.flags|=32),gc}function Mc(e,t,n){(e!==rc||2!==oc&&9!==oc)&&null===e.cancelPendingCommit||(Vc(e,0),Bc(e,sc,gc,!1)),je(e,n),0!==(2&nc)&&e===rc||(e===rc&&(0===(2&nc)&&(mc|=n),4===fc&&Bc(e,sc,gc,!1)),ku(e))}function Lc(e,t,n){if(0!==(6&nc))throw Error(o(327));for(var r=!n&&0===(124&t)&&0===(t&e.expiredLanes)||xe(e,t),a=r?function(e,t){var n=nc;nc|=2;var r=Wc(),a=Kc();rc!==e||sc!==t?(Sc=null,kc=te()+500,Vc(e,t)):cc=xe(e,t);e:for(;;)try{if(0!==oc&&null!==ac){t=ac;var s=ic;t:switch(oc){case 1:oc=0,ic=null,Zc(e,t,s,1);break;case 2:case 9:if(Ya(s)){oc=0,ic=null,Xc(t);break}t=function(){2!==oc&&9!==oc||rc!==e||(oc=7),ku(e)},s.then(t,t);break e;case 3:oc=7;break e;case 4:oc=5;break e;case 7:Ya(s)?(oc=0,ic=null,Xc(t)):(oc=0,ic=null,Zc(e,t,s,7));break;case 5:var i=null;switch(ac.tag){case 26:i=ac.memoizedState;case 5:case 27:var l=ac;if(!i||zd(i)){oc=0,ic=null;var c=l.sibling;if(null!==c)ac=c;else{var u=l.return;null!==u?(ac=u,eu(u)):ac=null}break t}}oc=0,ic=null,Zc(e,t,s,5);break;case 6:oc=0,ic=null,Zc(e,t,s,6);break;case 8:qc(),fc=6;break e;default:throw Error(o(462))}}Qc();break}catch(d){Hc(e,d)}return va=ya=null,R.H=r,R.A=a,nc=n,null!==ac?0:(rc=null,sc=0,Er(),fc)}(e,t):$c(e,t,!0),s=r;;){if(0===a){cc&&!r&&Bc(e,t,0,!1);break}if(n=e.current.alternate,!s||Fc(n)){if(2===a){if(s=t,e.errorRecoveryDisabledLanes&s)var i=0;else i=0!==(i=-536870913&e.pendingLanes)?i:536870912&i?536870912:0;if(0!==i){t=i;e:{var l=e;a=vc;var c=l.current.memoizedState.isDehydrated;if(c&&(Vc(l,i).flags|=256),2!==(i=$c(l,i,!1))){if(uc&&!c){l.errorRecoveryDisabledLanes|=s,mc|=s,a=4;break e}s=bc,bc=a,null!==s&&(null===bc?bc=s:bc.push.apply(bc,s))}a=i}if(s=!1,2!==a)continue}}if(1===a){Vc(e,0),Bc(e,t,0,!0);break}e:{switch(r=e,s=a){case 0:case 1:throw Error(o(345));case 4:if((4194048&t)!==t)break;case 6:Bc(r,t,gc,!lc);break e;case 2:bc=null;break;case 3:case 5:break;default:throw Error(o(329))}if((62914560&t)===t&&10<(a=wc+300-te())){if(Bc(r,t,gc,!lc),0!==be(r,0,!0))break e;r.timeoutHandle=ld(Dc.bind(null,r,n,bc,Sc,xc,t,gc,mc,yc,lc,s,2,-0,0),a)}else Dc(r,n,bc,Sc,xc,t,gc,mc,yc,lc,s,0,-0,0)}break}a=$c(e,t,!1),s=!1}ku(e)}function Dc(e,t,n,r,a,s,i,l,c,u,d,f,h,m){if(e.timeoutHandle=-1,(8192&(f=t.subtreeFlags)||16785408===(16785408&f))&&(qd={stylesheets:null,count:0,unsuspend:Vd},$l(t),null!==(f=function(){if(null===qd)throw Error(o(475));var e=qd;return e.stylesheets&&0===e.count&&Kd(e,e.stylesheets),0<e.count?function(t){var n=setTimeout(function(){if(e.stylesheets&&Kd(e,e.stylesheets),e.unsuspend){var t=e.unsuspend;e.unsuspend=null,t()}},6e4);return e.unsuspend=t,function(){e.unsuspend=null,clearTimeout(n)}}:null}())))return e.cancelPendingCommit=f(nu.bind(null,e,t,s,n,r,a,i,l,c,d,1,h,m)),void Bc(e,s,i,!u);nu(e,t,s,n,r,a,i,l,c)}function Fc(e){for(var t=e;;){var n=t.tag;if((0===n||11===n||15===n)&&16384&t.flags&&(null!==(n=t.updateQueue)&&null!==(n=n.stores)))for(var r=0;r<n.length;r++){var a=n[r],s=a.getSnapshot;a=a.value;try{if(!Yn(s(),a))return!1}catch(o){return!1}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Bc(e,t,n,r){t&=~pc,t&=~mc,e.suspendedLanes|=t,e.pingedLanes&=~t,r&&(e.warmLanes|=t),r=e.expirationTimes;for(var a=t;0<a;){var s=31-he(a),o=1<<s;r[s]=-1,a&=~o}0!==n&&_e(e,n,t)}function zc(){return 0!==(6&nc)||(Su(0,!1),!1)}function qc(){if(null!==ac){if(0===oc)var e=ac.return;else va=ya=null,Ls(e=ac),Yo=null,Qo=0,e=ac;for(;null!==e;)sl(e.alternate,e),e=e.return;ac=null}}function Vc(e,t){var n=e.timeoutHandle;-1!==n&&(e.timeoutHandle=-1,cd(n)),null!==(n=e.cancelPendingCommit)&&(e.cancelPendingCommit=null,n()),qc(),rc=e,ac=n=Dr(e.current,null),sc=t,oc=0,ic=null,lc=!1,cc=xe(e,t),uc=!1,yc=gc=pc=mc=hc=fc=0,bc=vc=null,xc=!1,0!==(8&t)&&(t|=32&t);var r=e.entangledLanes;if(0!==r)for(e=e.entanglements,r&=t;0<r;){var a=31-he(r),s=1<<a;t|=e[a],r&=~s}return dc=t,Er(),n}function Hc(e,t){bs=null,R.H=Wo,t===Wa||t===Ga?(t=Za(),oc=3):t===Ka?(t=Za(),oc=4):oc=t===_i?8:null!==t&&"object"===typeof t&&"function"===typeof t.then?6:1,ic=t,null===ac&&(fc=1,wi(e,Nr(t,e.current)))}function Wc(){var e=R.H;return R.H=Wo,null===e?Wo:e}function Kc(){var e=R.A;return R.A=ec,e}function Gc(){fc=4,lc||(4194048&sc)!==sc&&null!==ai.current||(cc=!0),0===(134217727&hc)&&0===(134217727&mc)||null===rc||Bc(rc,sc,gc,!1)}function $c(e,t,n){var r=nc;nc|=2;var a=Wc(),s=Kc();rc===e&&sc===t||(Sc=null,Vc(e,t)),t=!1;var o=fc;e:for(;;)try{if(0!==oc&&null!==ac){var i=ac,l=ic;switch(oc){case 8:qc(),o=6;break e;case 3:case 2:case 9:case 6:null===ai.current&&(t=!0);var c=oc;if(oc=0,ic=null,Zc(e,i,l,c),n&&cc){o=0;break e}break;default:c=oc,oc=0,ic=null,Zc(e,i,l,c)}}Yc(),o=fc;break}catch(u){Hc(e,u)}return t&&e.shellSuspendCounter++,va=ya=null,nc=r,R.H=a,R.A=s,null===ac&&(rc=null,sc=0,Er()),o}function Yc(){for(;null!==ac;)Jc(ac)}function Qc(){for(;null!==ac&&!Z();)Jc(ac)}function Jc(e){var t=Ji(e.alternate,e,dc);e.memoizedProps=e.pendingProps,null===t?eu(e):ac=t}function Xc(e){var t=e,n=t.alternate;switch(t.tag){case 15:case 0:t=Mi(n,t,t.pendingProps,t.type,void 0,sc);break;case 11:t=Mi(n,t,t.pendingProps,t.type.render,t.ref,sc);break;case 5:Ls(t);default:sl(n,t),t=Ji(n,t=ac=Fr(t,dc),dc)}e.memoizedProps=e.pendingProps,null===t?eu(e):ac=t}function Zc(e,t,n,r){va=ya=null,Ls(t),Yo=null,Qo=0;var a=t.return;try{if(function(e,t,n,r,a){if(n.flags|=32768,null!==r&&"object"===typeof r&&"function"===typeof r.then){if(null!==(t=n.alternate)&&Sa(t,n,a,!0),null!==(n=ai.current)){switch(n.tag){case 13:return null===si?Gc():null===n.alternate&&0===fc&&(fc=3),n.flags&=-257,n.flags|=65536,n.lanes=a,r===$a?n.flags|=16384:(null===(t=n.updateQueue)?n.updateQueue=new Set([r]):t.add(r),du(e,r,a)),!1;case 22:return n.flags|=65536,r===$a?n.flags|=16384:(null===(t=n.updateQueue)?(t={transitions:null,markerInstances:null,retryQueue:new Set([r])},n.updateQueue=t):null===(n=t.retryQueue)?t.retryQueue=new Set([r]):n.add(r),du(e,r,a)),!1}throw Error(o(435,n.tag))}return du(e,r,a),Gc(),!1}if(sa)return null!==(t=ai.current)?(0===(65536&t.flags)&&(t.flags|=256),t.flags|=65536,t.lanes=a,r!==la&&pa(Nr(e=Error(o(422),{cause:r}),n))):(r!==la&&pa(Nr(t=Error(o(423),{cause:r}),n)),(e=e.current.alternate).flags|=65536,a&=-a,e.lanes|=a,r=Nr(r,n),is(e,a=Si(e.stateNode,r,a)),4!==fc&&(fc=2)),!1;var s=Error(o(520),{cause:r});if(s=Nr(s,n),null===vc?vc=[s]:vc.push(s),4!==fc&&(fc=2),null===t)return!0;r=Nr(r,n),n=t;do{switch(n.tag){case 3:return n.flags|=65536,e=a&-a,n.lanes|=e,is(n,e=Si(n.stateNode,r,e)),!1;case 1:if(t=n.type,s=n.stateNode,0===(128&n.flags)&&("function"===typeof t.getDerivedStateFromError||null!==s&&"function"===typeof s.componentDidCatch&&(null===Nc||!Nc.has(s))))return n.flags|=65536,a&=-a,n.lanes|=a,ji(a=Ni(a),e,n,r),is(n,a),!1}n=n.return}while(null!==n);return!1}(e,a,t,n,sc))return fc=1,wi(e,Nr(n,e.current)),void(ac=null)}catch(s){if(null!==a)throw ac=a,s;return fc=1,wi(e,Nr(n,e.current)),void(ac=null)}32768&t.flags?(sa||1===r?e=!0:cc||0!==(536870912&sc)?e=!1:(lc=e=!0,(2===r||9===r||3===r||6===r)&&(null!==(r=ai.current)&&13===r.tag&&(r.flags|=16384))),tu(t,e)):eu(t)}function eu(e){var t=e;do{if(0!==(32768&t.flags))return void tu(t,lc);e=t.return;var n=rl(t.alternate,t,dc);if(null!==n)return void(ac=n);if(null!==(t=t.sibling))return void(ac=t);ac=t=e}while(null!==t);0===fc&&(fc=5)}function tu(e,t){do{var n=al(e.alternate,e);if(null!==n)return n.flags&=32767,void(ac=n);if(null!==(n=e.return)&&(n.flags|=32768,n.subtreeFlags=0,n.deletions=null),!t&&null!==(e=e.sibling))return void(ac=e);ac=e=n}while(null!==e);fc=6,ac=null}function nu(e,t,n,r,a,s,i,l,c){e.cancelPendingCommit=null;do{iu()}while(0!==jc);if(0!==(6&nc))throw Error(o(327));if(null!==t){if(t===e.current)throw Error(o(177));if(s=t.lanes|t.childLanes,function(e,t,n,r,a,s){var o=e.pendingLanes;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=n,e.entangledLanes&=n,e.errorRecoveryDisabledLanes&=n,e.shellSuspendCounter=0;var i=e.entanglements,l=e.expirationTimes,c=e.hiddenUpdates;for(n=o&~n;0<n;){var u=31-he(n),d=1<<u;i[u]=0,l[u]=-1;var f=c[u];if(null!==f)for(c[u]=null,u=0;u<f.length;u++){var h=f[u];null!==h&&(h.lane&=-536870913)}n&=~d}0!==r&&_e(e,r,0),0!==s&&0===a&&0!==e.tag&&(e.suspendedLanes|=s&~(o&~t))}(e,n,s|=Cr,i,l,c),e===rc&&(ac=rc=null,sc=0),Cc=t,_c=e,Ec=n,Tc=s,Ac=a,Pc=r,0!==(10256&t.subtreeFlags)||0!==(10256&t.flags)?(e.callbackNode=null,e.callbackPriority=0,J(se,function(){return lu(),null})):(e.callbackNode=null,e.callbackPriority=0),r=0!==(13878&t.flags),0!==(13878&t.subtreeFlags)||r){r=R.T,R.T=null,a=I.p,I.p=2,i=nc,nc|=4;try{!function(e,t){if(e=e.containerInfo,td=nf,tr(e=er(e))){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var a=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{n.nodeType,s.nodeType}catch(g){n=null;break e}var i=0,l=-1,c=-1,u=0,d=0,f=e,h=null;t:for(;;){for(var m;f!==n||0!==a&&3!==f.nodeType||(l=i+a),f!==s||0!==r&&3!==f.nodeType||(c=i+r),3===f.nodeType&&(i+=f.nodeValue.length),null!==(m=f.firstChild);)h=f,f=m;for(;;){if(f===e)break t;if(h===n&&++u===a&&(l=i),h===s&&++d===r&&(c=i),null!==(m=f.nextSibling))break;h=(f=h).parentNode}f=m}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(nd={focusedElem:e,selectionRange:n},nf=!1,Sl=t;null!==Sl;)if(e=(t=Sl).child,0!==(1024&t.subtreeFlags)&&null!==e)e.return=t,Sl=e;else for(;null!==Sl;){switch(s=(t=Sl).alternate,e=t.flags,t.tag){case 0:case 11:case 15:case 5:case 26:case 27:case 6:case 4:case 17:break;case 1:if(0!==(1024&e)&&null!==s){e=void 0,n=t,a=s.memoizedProps,s=s.memoizedState,r=n.stateNode;try{var p=gi(n.type,a,(n.elementType,n.type));e=r.getSnapshotBeforeUpdate(p,s),r.__reactInternalSnapshotBeforeUpdate=e}catch(y){uu(n,n.return,y)}}break;case 3:if(0!==(1024&e))if(9===(n=(e=t.stateNode.containerInfo).nodeType))pd(e);else if(1===n)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":pd(e);break;default:e.textContent=""}break;default:if(0!==(1024&e))throw Error(o(163))}if(null!==(e=t.sibling)){e.return=t.return,Sl=e;break}Sl=t.return}}(e,t)}finally{nc=i,I.p=a,R.T=r}}jc=1,ru(),au(),su()}}function ru(){if(1===jc){jc=0;var e=_c,t=Cc,n=0!==(13878&t.flags);if(0!==(13878&t.subtreeFlags)||n){n=R.T,R.T=null;var r=I.p;I.p=2;var a=nc;nc|=4;try{Rl(t,e);var s=nd,o=er(e.containerInfo),i=s.focusedElem,l=s.selectionRange;if(o!==i&&i&&i.ownerDocument&&Zn(i.ownerDocument.documentElement,i)){if(null!==l&&tr(i)){var c=l.start,u=l.end;if(void 0===u&&(u=c),"selectionStart"in i)i.selectionStart=c,i.selectionEnd=Math.min(u,i.value.length);else{var d=i.ownerDocument||document,f=d&&d.defaultView||window;if(f.getSelection){var h=f.getSelection(),m=i.textContent.length,p=Math.min(l.start,m),g=void 0===l.end?p:Math.min(l.end,m);!h.extend&&p>g&&(o=g,g=p,p=o);var y=Xn(i,p),v=Xn(i,g);if(y&&v&&(1!==h.rangeCount||h.anchorNode!==y.node||h.anchorOffset!==y.offset||h.focusNode!==v.node||h.focusOffset!==v.offset)){var b=d.createRange();b.setStart(y.node,y.offset),h.removeAllRanges(),p>g?(h.addRange(b),h.extend(v.node,v.offset)):(b.setEnd(v.node,v.offset),h.addRange(b))}}}}for(d=[],h=i;h=h.parentNode;)1===h.nodeType&&d.push({element:h,left:h.scrollLeft,top:h.scrollTop});for("function"===typeof i.focus&&i.focus(),i=0;i<d.length;i++){var x=d[i];x.element.scrollLeft=x.left,x.element.scrollTop=x.top}}nf=!!td,nd=td=null}finally{nc=a,I.p=r,R.T=n}}e.current=t,jc=2}}function au(){if(2===jc){jc=0;var e=_c,t=Cc,n=0!==(8772&t.flags);if(0!==(8772&t.subtreeFlags)||n){n=R.T,R.T=null;var r=I.p;I.p=2;var a=nc;nc|=4;try{Nl(e,t.alternate,t)}finally{nc=a,I.p=r,R.T=n}}jc=3}}function su(){if(4===jc||3===jc){jc=0,ee();var e=_c,t=Cc,n=Ec,r=Pc;0!==(10256&t.subtreeFlags)||0!==(10256&t.flags)?jc=5:(jc=0,Cc=_c=null,ou(e,e.pendingLanes));var a=e.pendingLanes;if(0===a&&(Nc=null),Te(n),t=t.stateNode,de&&"function"===typeof de.onCommitFiberRoot)try{de.onCommitFiberRoot(ue,t,void 0,128===(128&t.current.flags))}catch(l){}if(null!==r){t=R.T,a=I.p,I.p=2,R.T=null;try{for(var s=e.onRecoverableError,o=0;o<r.length;o++){var i=r[o];s(i.value,{componentStack:i.stack})}}finally{R.T=t,I.p=a}}0!==(3&Ec)&&iu(),ku(e),a=e.pendingLanes,0!==(4194090&n)&&0!==(42&a)?e===Uc?Oc++:(Oc=0,Uc=e):Oc=0,Su(0,!1)}}function ou(e,t){0===(e.pooledCacheLanes&=t)&&(null!=(t=e.pooledCache)&&(e.pooledCache=null,Ra(t)))}function iu(e){return ru(),au(),su(),lu()}function lu(){if(5!==jc)return!1;var e=_c,t=Tc;Tc=0;var n=Te(Ec),r=R.T,a=I.p;try{I.p=32>n?32:n,R.T=null,n=Ac,Ac=null;var s=_c,i=Ec;if(jc=0,Cc=_c=null,Ec=0,0!==(6&nc))throw Error(o(331));var l=nc;if(nc|=4,Jl(s.current),Vl(s,s.current,i,n),nc=l,Su(0,!1),de&&"function"===typeof de.onPostCommitFiberRoot)try{de.onPostCommitFiberRoot(ue,s)}catch(c){}return!0}finally{I.p=a,R.T=r,ou(e,t)}}function cu(e,t,n){t=Nr(n,t),null!==(e=ss(e,t=Si(e.stateNode,t,2),2))&&(je(e,2),ku(e))}function uu(e,t,n){if(3===e.tag)cu(e,e,n);else for(;null!==t;){if(3===t.tag){cu(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Nc||!Nc.has(r))){e=Nr(n,e),null!==(r=ss(t,n=Ni(2),2))&&(ji(n,r,t,e),je(r,2),ku(r));break}}t=t.return}}function du(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new tc;var a=new Set;r.set(t,a)}else void 0===(a=r.get(t))&&(a=new Set,r.set(t,a));a.has(n)||(uc=!0,a.add(n),e=fu.bind(null,e,t,n),t.then(e,e))}function fu(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),e.pingedLanes|=e.suspendedLanes&n,e.warmLanes&=~n,rc===e&&(sc&n)===n&&(4===fc||3===fc&&(62914560&sc)===sc&&300>te()-wc?0===(2&nc)&&Vc(e,0):pc|=n,yc===sc&&(yc=0)),ku(e)}function hu(e,t){0===t&&(t=Se()),null!==(e=Pr(e,t))&&(je(e,t),ku(e))}function mu(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),hu(e,n)}function pu(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,a=e.memoizedState;null!==a&&(n=a.retryLane);break;case 19:r=e.stateNode;break;case 22:r=e.stateNode._retryCache;break;default:throw Error(o(314))}null!==r&&r.delete(t),hu(e,n)}var gu=null,yu=null,vu=!1,bu=!1,xu=!1,wu=0;function ku(e){e!==yu&&null===e.next&&(null===yu?gu=yu=e:yu=yu.next=e),bu=!0,vu||(vu=!0,dd(function(){0!==(6&nc)?J(re,Nu):ju()}))}function Su(e,t){if(!xu&&bu){xu=!0;do{for(var n=!1,r=gu;null!==r;){if(!t)if(0!==e){var a=r.pendingLanes;if(0===a)var s=0;else{var o=r.suspendedLanes,i=r.pingedLanes;s=(1<<31-he(42|e)+1)-1,s=201326741&(s&=a&~(o&~i))?201326741&s|1:s?2|s:0}0!==s&&(n=!0,Eu(r,s))}else s=sc,0===(3&(s=be(r,r===rc?s:0,null!==r.cancelPendingCommit||-1!==r.timeoutHandle)))||xe(r,s)||(n=!0,Eu(r,s));r=r.next}}while(n);xu=!1}}function Nu(){ju()}function ju(){bu=vu=!1;var e=0;0!==wu&&(function(){var e=window.event;if(e&&"popstate"===e.type)return e!==id&&(id=e,!0);return id=null,!1}()&&(e=wu),wu=0);for(var t=te(),n=null,r=gu;null!==r;){var a=r.next,s=_u(r,t);0===s?(r.next=null,null===n?gu=a:n.next=a,null===a&&(yu=n)):(n=r,(0!==e||0!==(3&s))&&(bu=!0)),r=a}Su(e,!1)}function _u(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,a=e.expirationTimes,s=-62914561&e.pendingLanes;0<s;){var o=31-he(s),i=1<<o,l=a[o];-1===l?0!==(i&n)&&0===(i&r)||(a[o]=we(i,t)):l<=t&&(e.expiredLanes|=i),s&=~i}if(n=sc,n=be(e,e===(t=rc)?n:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle),r=e.callbackNode,0===n||e===t&&(2===oc||9===oc)||null!==e.cancelPendingCommit)return null!==r&&null!==r&&X(r),e.callbackNode=null,e.callbackPriority=0;if(0===(3&n)||xe(e,n)){if((t=n&-n)===e.callbackPriority)return t;switch(null!==r&&X(r),Te(n)){case 2:case 8:n=ae;break;case 32:default:n=se;break;case 268435456:n=ie}return r=Cu.bind(null,e),n=J(n,r),e.callbackPriority=t,e.callbackNode=n,t}return null!==r&&null!==r&&X(r),e.callbackPriority=2,e.callbackNode=null,2}function Cu(e,t){if(0!==jc&&5!==jc)return e.callbackNode=null,e.callbackPriority=0,null;var n=e.callbackNode;if(iu()&&e.callbackNode!==n)return null;var r=sc;return 0===(r=be(e,e===rc?r:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle))?null:(Lc(e,r,t),_u(e,te()),null!=e.callbackNode&&e.callbackNode===n?Cu.bind(null,e):null)}function Eu(e,t){if(iu())return null;Lc(e,t,!0)}function Tu(){return 0===wu&&(wu=ke()),wu}function Au(e){return null==e||"symbol"===typeof e||"boolean"===typeof e?null:"function"===typeof e?e:Tt(""+e)}function Pu(e,t){var n=t.ownerDocument.createElement("input");return n.name=t.name,n.value=t.value,e.id&&n.setAttribute("form",e.id),t.parentNode.insertBefore(n,t),e=new FormData(e),n.parentNode.removeChild(n),e}for(var Ou=0;Ou<wr.length;Ou++){var Uu=wr[Ou];kr(Uu.toLowerCase(),"on"+(Uu[0].toUpperCase()+Uu.slice(1)))}kr(hr,"onAnimationEnd"),kr(mr,"onAnimationIteration"),kr(pr,"onAnimationStart"),kr("dblclick","onDoubleClick"),kr("focusin","onFocus"),kr("focusout","onBlur"),kr(gr,"onTransitionRun"),kr(yr,"onTransitionStart"),kr(vr,"onTransitionCancel"),kr(br,"onTransitionEnd"),Ye("onMouseEnter",["mouseout","mouseover"]),Ye("onMouseLeave",["mouseout","mouseover"]),Ye("onPointerEnter",["pointerout","pointerover"]),Ye("onPointerLeave",["pointerout","pointerover"]),$e("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),$e("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),$e("onBeforeInput",["compositionend","keypress","textInput","paste"]),$e("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),$e("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),$e("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ru="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Iu=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Ru));function Mu(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],a=r.event;r=r.listeners;e:{var s=void 0;if(t)for(var o=r.length-1;0<=o;o--){var i=r[o],l=i.instance,c=i.currentTarget;if(i=i.listener,l!==s&&a.isPropagationStopped())break e;s=i,a.currentTarget=c;try{s(a)}catch(u){yi(u)}a.currentTarget=null,s=l}else for(o=0;o<r.length;o++){if(l=(i=r[o]).instance,c=i.currentTarget,i=i.listener,l!==s&&a.isPropagationStopped())break e;s=i,a.currentTarget=c;try{s(a)}catch(u){yi(u)}a.currentTarget=null,s=l}}}}function Lu(e,t){var n=t[Ie];void 0===n&&(n=t[Ie]=new Set);var r=e+"__bubble";n.has(r)||(zu(t,e,2,!1),n.add(r))}function Du(e,t,n){var r=0;t&&(r|=4),zu(n,e,r,t)}var Fu="_reactListening"+Math.random().toString(36).slice(2);function Bu(e){if(!e[Fu]){e[Fu]=!0,Ke.forEach(function(t){"selectionchange"!==t&&(Iu.has(t)||Du(t,!1,e),Du(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Fu]||(t[Fu]=!0,Du("selectionchange",!1,t))}}function zu(e,t,n,r){switch(uf(t)){case 2:var a=rf;break;case 8:a=af;break;default:a=sf}n=a.bind(null,t,n,e),a=void 0,!Ft||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(a=!0),r?void 0!==a?e.addEventListener(t,n,{capture:!0,passive:a}):e.addEventListener(t,n,!0):void 0!==a?e.addEventListener(t,n,{passive:a}):e.addEventListener(t,n,!1)}function qu(e,t,n,r,a){var s=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var o=r.tag;if(3===o||4===o){var i=r.stateNode.containerInfo;if(i===a)break;if(4===o)for(o=r.return;null!==o;){var c=o.tag;if((3===c||4===c)&&o.stateNode.containerInfo===a)return;o=o.return}for(;null!==i;){if(null===(o=ze(i)))return;if(5===(c=o.tag)||6===c||26===c||27===c){r=s=o;continue e}i=i.parentNode}}r=r.return}Mt(function(){var r=s,a=Pt(n),o=[];e:{var i=xr.get(e);if(void 0!==i){var c=Zt,u=e;switch(e){case"keypress":if(0===Wt(n))break e;case"keydown":case"keyup":c=pn;break;case"focusin":u="focus",c=sn;break;case"focusout":u="blur",c=sn;break;case"beforeblur":case"afterblur":c=sn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":c=rn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":c=an;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":c=yn;break;case hr:case mr:case pr:c=on;break;case br:c=vn;break;case"scroll":case"scrollend":c=tn;break;case"wheel":c=bn;break;case"copy":case"cut":case"paste":c=ln;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":c=gn;break;case"toggle":case"beforetoggle":c=xn}var d=0!==(4&t),f=!d&&("scroll"===e||"scrollend"===e),h=d?null!==i?i+"Capture":null:i;d=[];for(var m,p=r;null!==p;){var g=p;if(m=g.stateNode,5!==(g=g.tag)&&26!==g&&27!==g||null===m||null===h||null!=(g=Lt(p,h))&&d.push(Vu(p,g,m)),f)break;p=p.return}0<d.length&&(i=new c(i,u,null,n,a),o.push({event:i,listeners:d}))}}if(0===(7&t)){if(c="mouseout"===e||"pointerout"===e,(!(i="mouseover"===e||"pointerover"===e)||n===At||!(u=n.relatedTarget||n.fromElement)||!ze(u)&&!u[Re])&&(c||i)&&(i=a.window===a?a:(i=a.ownerDocument)?i.defaultView||i.parentWindow:window,c?(c=r,null!==(u=(u=n.relatedTarget||n.toElement)?ze(u):null)&&(f=l(u),d=u.tag,u!==f||5!==d&&27!==d&&6!==d)&&(u=null)):(c=null,u=r),c!==u)){if(d=rn,g="onMouseLeave",h="onMouseEnter",p="mouse","pointerout"!==e&&"pointerover"!==e||(d=gn,g="onPointerLeave",h="onPointerEnter",p="pointer"),f=null==c?i:Ve(c),m=null==u?i:Ve(u),(i=new d(g,p+"leave",c,n,a)).target=f,i.relatedTarget=m,g=null,ze(a)===r&&((d=new d(h,p+"enter",u,n,a)).target=m,d.relatedTarget=f,g=d),f=g,c&&u)e:{for(h=u,p=0,m=d=c;m;m=Wu(m))p++;for(m=0,g=h;g;g=Wu(g))m++;for(;0<p-m;)d=Wu(d),p--;for(;0<m-p;)h=Wu(h),m--;for(;p--;){if(d===h||null!==h&&d===h.alternate)break e;d=Wu(d),h=Wu(h)}d=null}else d=null;null!==c&&Ku(o,i,c,d,!1),null!==u&&null!==f&&Ku(o,f,u,d,!0)}if("select"===(c=(i=r?Ve(r):window).nodeName&&i.nodeName.toLowerCase())||"input"===c&&"file"===i.type)var y=Dn;else if(On(i))if(Fn)y=$n;else{y=Kn;var v=Wn}else!(c=i.nodeName)||"input"!==c.toLowerCase()||"checkbox"!==i.type&&"radio"!==i.type?r&&_t(r.elementType)&&(y=Dn):y=Gn;switch(y&&(y=y(e,r))?Un(o,y,n,a):(v&&v(e,i,r),"focusout"===e&&r&&"number"===i.type&&null!=r.memoizedProps.value&&vt(i,"number",i.value)),v=r?Ve(r):window,e){case"focusin":(On(v)||"true"===v.contentEditable)&&(rr=v,ar=r,sr=null);break;case"focusout":sr=ar=rr=null;break;case"mousedown":or=!0;break;case"contextmenu":case"mouseup":case"dragend":or=!1,ir(o,n,a);break;case"selectionchange":if(nr)break;case"keydown":case"keyup":ir(o,n,a)}var b;if(kn)e:{switch(e){case"compositionstart":var x="onCompositionStart";break e;case"compositionend":x="onCompositionEnd";break e;case"compositionupdate":x="onCompositionUpdate";break e}x=void 0}else An?En(e,n)&&(x="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(x="onCompositionStart");x&&(jn&&"ko"!==n.locale&&(An||"onCompositionStart"!==x?"onCompositionEnd"===x&&An&&(b=Ht()):(qt="value"in(zt=a)?zt.value:zt.textContent,An=!0)),0<(v=Hu(r,x)).length&&(x=new cn(x,e,null,n,a),o.push({event:x,listeners:v}),b?x.data=b:null!==(b=Tn(n))&&(x.data=b))),(b=Nn?function(e,t){switch(e){case"compositionend":return Tn(t);case"keypress":return 32!==t.which?null:(Cn=!0,_n);case"textInput":return(e=t.data)===_n&&Cn?null:e;default:return null}}(e,n):function(e,t){if(An)return"compositionend"===e||!kn&&En(e,t)?(e=Ht(),Vt=qt=zt=null,An=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return jn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(x=Hu(r,"onBeforeInput")).length&&(v=new cn("onBeforeInput","beforeinput",null,n,a),o.push({event:v,listeners:x}),v.data=b)),function(e,t,n,r,a){if("submit"===t&&n&&n.stateNode===a){var s=Au((a[Ue]||null).action),o=r.submitter;o&&null!==(t=(t=o[Ue]||null)?Au(t.formAction):o.getAttribute("formAction"))&&(s=t,o=null);var i=new Zt("action","action",null,r,a);e.push({event:i,listeners:[{instance:null,listener:function(){if(r.defaultPrevented){if(0!==wu){var e=o?Pu(a,o):new FormData(a);Po(n,{pending:!0,data:e,method:a.method,action:s},null,e)}}else"function"===typeof s&&(i.preventDefault(),e=o?Pu(a,o):new FormData(a),Po(n,{pending:!0,data:e,method:a.method,action:s},s,e))},currentTarget:a}]})}}(o,e,r,n,a)}Mu(o,t)})}function Vu(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Hu(e,t){for(var n=t+"Capture",r=[];null!==e;){var a=e,s=a.stateNode;if(5!==(a=a.tag)&&26!==a&&27!==a||null===s||(null!=(a=Lt(e,n))&&r.unshift(Vu(e,a,s)),null!=(a=Lt(e,t))&&r.push(Vu(e,a,s))),3===e.tag)return r;e=e.return}return[]}function Wu(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag&&27!==e.tag);return e||null}function Ku(e,t,n,r,a){for(var s=t._reactName,o=[];null!==n&&n!==r;){var i=n,l=i.alternate,c=i.stateNode;if(i=i.tag,null!==l&&l===r)break;5!==i&&26!==i&&27!==i||null===c||(l=c,a?null!=(c=Lt(n,s))&&o.unshift(Vu(n,c,l)):a||null!=(c=Lt(n,s))&&o.push(Vu(n,c,l))),n=n.return}0!==o.length&&e.push({event:t,listeners:o})}var Gu=/\r\n?/g,$u=/\u0000|\uFFFD/g;function Yu(e){return("string"===typeof e?e:""+e).replace(Gu,"\n").replace($u,"")}function Qu(e,t){return t=Yu(t),Yu(e)===t}function Ju(){}function Xu(e,t,n,r,a,s){switch(n){case"children":"string"===typeof r?"body"===t||"textarea"===t&&""===r||kt(e,r):("number"===typeof r||"bigint"===typeof r)&&"body"!==t&&kt(e,""+r);break;case"className":nt(e,"class",r);break;case"tabIndex":nt(e,"tabindex",r);break;case"dir":case"role":case"viewBox":case"width":case"height":nt(e,n,r);break;case"style":jt(e,r,s);break;case"data":if("object"!==t){nt(e,"data",r);break}case"src":case"href":if(""===r&&("a"!==t||"href"!==n)){e.removeAttribute(n);break}if(null==r||"function"===typeof r||"symbol"===typeof r||"boolean"===typeof r){e.removeAttribute(n);break}r=Tt(""+r),e.setAttribute(n,r);break;case"action":case"formAction":if("function"===typeof r){e.setAttribute(n,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}if("function"===typeof s&&("formAction"===n?("input"!==t&&Xu(e,t,"name",a.name,a,null),Xu(e,t,"formEncType",a.formEncType,a,null),Xu(e,t,"formMethod",a.formMethod,a,null),Xu(e,t,"formTarget",a.formTarget,a,null)):(Xu(e,t,"encType",a.encType,a,null),Xu(e,t,"method",a.method,a,null),Xu(e,t,"target",a.target,a,null))),null==r||"symbol"===typeof r||"boolean"===typeof r){e.removeAttribute(n);break}r=Tt(""+r),e.setAttribute(n,r);break;case"onClick":null!=r&&(e.onclick=Ju);break;case"onScroll":null!=r&&Lu("scroll",e);break;case"onScrollEnd":null!=r&&Lu("scrollend",e);break;case"dangerouslySetInnerHTML":if(null!=r){if("object"!==typeof r||!("__html"in r))throw Error(o(61));if(null!=(n=r.__html)){if(null!=a.children)throw Error(o(60));e.innerHTML=n}}break;case"multiple":e.multiple=r&&"function"!==typeof r&&"symbol"!==typeof r;break;case"muted":e.muted=r&&"function"!==typeof r&&"symbol"!==typeof r;break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":case"autoFocus":break;case"xlinkHref":if(null==r||"function"===typeof r||"boolean"===typeof r||"symbol"===typeof r){e.removeAttribute("xlink:href");break}n=Tt(""+r),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":null!=r&&"function"!==typeof r&&"symbol"!==typeof r?e.setAttribute(n,""+r):e.removeAttribute(n);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":r&&"function"!==typeof r&&"symbol"!==typeof r?e.setAttribute(n,""):e.removeAttribute(n);break;case"capture":case"download":!0===r?e.setAttribute(n,""):!1!==r&&null!=r&&"function"!==typeof r&&"symbol"!==typeof r?e.setAttribute(n,r):e.removeAttribute(n);break;case"cols":case"rows":case"size":case"span":null!=r&&"function"!==typeof r&&"symbol"!==typeof r&&!isNaN(r)&&1<=r?e.setAttribute(n,r):e.removeAttribute(n);break;case"rowSpan":case"start":null==r||"function"===typeof r||"symbol"===typeof r||isNaN(r)?e.removeAttribute(n):e.setAttribute(n,r);break;case"popover":Lu("beforetoggle",e),Lu("toggle",e),tt(e,"popover",r);break;case"xlinkActuate":rt(e,"http://www.w3.org/1999/xlink","xlink:actuate",r);break;case"xlinkArcrole":rt(e,"http://www.w3.org/1999/xlink","xlink:arcrole",r);break;case"xlinkRole":rt(e,"http://www.w3.org/1999/xlink","xlink:role",r);break;case"xlinkShow":rt(e,"http://www.w3.org/1999/xlink","xlink:show",r);break;case"xlinkTitle":rt(e,"http://www.w3.org/1999/xlink","xlink:title",r);break;case"xlinkType":rt(e,"http://www.w3.org/1999/xlink","xlink:type",r);break;case"xmlBase":rt(e,"http://www.w3.org/XML/1998/namespace","xml:base",r);break;case"xmlLang":rt(e,"http://www.w3.org/XML/1998/namespace","xml:lang",r);break;case"xmlSpace":rt(e,"http://www.w3.org/XML/1998/namespace","xml:space",r);break;case"is":tt(e,"is",r);break;case"innerText":case"textContent":break;default:(!(2<n.length)||"o"!==n[0]&&"O"!==n[0]||"n"!==n[1]&&"N"!==n[1])&&tt(e,n=Ct.get(n)||n,r)}}function Zu(e,t,n,r,a,s){switch(n){case"style":jt(e,r,s);break;case"dangerouslySetInnerHTML":if(null!=r){if("object"!==typeof r||!("__html"in r))throw Error(o(61));if(null!=(n=r.__html)){if(null!=a.children)throw Error(o(60));e.innerHTML=n}}break;case"children":"string"===typeof r?kt(e,r):("number"===typeof r||"bigint"===typeof r)&&kt(e,""+r);break;case"onScroll":null!=r&&Lu("scroll",e);break;case"onScrollEnd":null!=r&&Lu("scrollend",e);break;case"onClick":null!=r&&(e.onclick=Ju);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":case"innerText":case"textContent":break;default:Ge.hasOwnProperty(n)||("o"!==n[0]||"n"!==n[1]||(a=n.endsWith("Capture"),t=n.slice(2,a?n.length-7:void 0),"function"===typeof(s=null!=(s=e[Ue]||null)?s[n]:null)&&e.removeEventListener(t,s,a),"function"!==typeof r)?n in e?e[n]=r:!0===r?e.setAttribute(n,""):tt(e,n,r):("function"!==typeof s&&null!==s&&(n in e?e[n]=null:e.hasAttribute(n)&&e.removeAttribute(n)),e.addEventListener(t,r,a)))}}function ed(e,t,n){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Lu("error",e),Lu("load",e);var r,a=!1,s=!1;for(r in n)if(n.hasOwnProperty(r)){var i=n[r];if(null!=i)switch(r){case"src":a=!0;break;case"srcSet":s=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(o(137,t));default:Xu(e,t,r,i,n,null)}}return s&&Xu(e,t,"srcSet",n.srcSet,n,null),void(a&&Xu(e,t,"src",n.src,n,null));case"input":Lu("invalid",e);var l=r=i=s=null,c=null,u=null;for(a in n)if(n.hasOwnProperty(a)){var d=n[a];if(null!=d)switch(a){case"name":s=d;break;case"type":i=d;break;case"checked":c=d;break;case"defaultChecked":u=d;break;case"value":r=d;break;case"defaultValue":l=d;break;case"children":case"dangerouslySetInnerHTML":if(null!=d)throw Error(o(137,t));break;default:Xu(e,t,a,d,n,null)}}return yt(e,r,l,c,u,i,s,!1),void dt(e);case"select":for(s in Lu("invalid",e),a=i=r=null,n)if(n.hasOwnProperty(s)&&null!=(l=n[s]))switch(s){case"value":r=l;break;case"defaultValue":i=l;break;case"multiple":a=l;default:Xu(e,t,s,l,n,null)}return t=r,n=i,e.multiple=!!a,void(null!=t?bt(e,!!a,t,!1):null!=n&&bt(e,!!a,n,!0));case"textarea":for(i in Lu("invalid",e),r=s=a=null,n)if(n.hasOwnProperty(i)&&null!=(l=n[i]))switch(i){case"value":a=l;break;case"defaultValue":s=l;break;case"children":r=l;break;case"dangerouslySetInnerHTML":if(null!=l)throw Error(o(91));break;default:Xu(e,t,i,l,n,null)}return wt(e,a,s,r),void dt(e);case"option":for(c in n)if(n.hasOwnProperty(c)&&null!=(a=n[c]))if("selected"===c)e.selected=a&&"function"!==typeof a&&"symbol"!==typeof a;else Xu(e,t,c,a,n,null);return;case"dialog":Lu("beforetoggle",e),Lu("toggle",e),Lu("cancel",e),Lu("close",e);break;case"iframe":case"object":Lu("load",e);break;case"video":case"audio":for(a=0;a<Ru.length;a++)Lu(Ru[a],e);break;case"image":Lu("error",e),Lu("load",e);break;case"details":Lu("toggle",e);break;case"embed":case"source":case"link":Lu("error",e),Lu("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(u in n)if(n.hasOwnProperty(u)&&null!=(a=n[u]))switch(u){case"children":case"dangerouslySetInnerHTML":throw Error(o(137,t));default:Xu(e,t,u,a,n,null)}return;default:if(_t(t)){for(d in n)n.hasOwnProperty(d)&&(void 0!==(a=n[d])&&Zu(e,t,d,a,n,void 0));return}}for(l in n)n.hasOwnProperty(l)&&(null!=(a=n[l])&&Xu(e,t,l,a,n,null))}var td=null,nd=null;function rd(e){return 9===e.nodeType?e:e.ownerDocument}function ad(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function sd(e,t){if(0===e)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return 1===e&&"foreignObject"===t?0:e}function od(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"bigint"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var id=null;var ld="function"===typeof setTimeout?setTimeout:void 0,cd="function"===typeof clearTimeout?clearTimeout:void 0,ud="function"===typeof Promise?Promise:void 0,dd="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof ud?function(e){return ud.resolve(null).then(e).catch(fd)}:ld;function fd(e){setTimeout(function(){throw e})}function hd(e){return"head"===e}function md(e,t){var n=t,r=0,a=0;do{var s=n.nextSibling;if(e.removeChild(n),s&&8===s.nodeType)if("/$"===(n=s.data)){if(0<r&&8>r){n=r;var o=e.ownerDocument;if(1&n&&wd(o.documentElement),2&n&&wd(o.body),4&n)for(wd(n=o.head),o=n.firstChild;o;){var i=o.nextSibling,l=o.nodeName;o[Fe]||"SCRIPT"===l||"STYLE"===l||"LINK"===l&&"stylesheet"===o.rel.toLowerCase()||n.removeChild(o),o=i}}if(0===a)return e.removeChild(s),void Ef(t);a--}else"$"===n||"$?"===n||"$!"===n?a++:r=n.charCodeAt(0)-48;else r=0;n=s}while(n);Ef(t)}function pd(e){var t=e.firstChild;for(t&&10===t.nodeType&&(t=t.nextSibling);t;){var n=t;switch(t=t.nextSibling,n.nodeName){case"HTML":case"HEAD":case"BODY":pd(n),Be(n);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if("stylesheet"===n.rel.toLowerCase())continue}e.removeChild(n)}}function gd(e){return"$!"===e.data||"$?"===e.data&&"complete"===e.ownerDocument.readyState}function yd(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t||"F!"===t||"F"===t)break;if("/$"===t)return null}}return e}var vd=null;function bd(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}function xd(e,t,n){switch(t=rd(n),e){case"html":if(!(e=t.documentElement))throw Error(o(452));return e;case"head":if(!(e=t.head))throw Error(o(453));return e;case"body":if(!(e=t.body))throw Error(o(454));return e;default:throw Error(o(451))}}function wd(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);Be(e)}var kd=new Map,Sd=new Set;function Nd(e){return"function"===typeof e.getRootNode?e.getRootNode():9===e.nodeType?e:e.ownerDocument}var jd=I.d;I.d={f:function(){var e=jd.f(),t=zc();return e||t},r:function(e){var t=qe(e);null!==t&&5===t.tag&&"form"===t.type?Uo(t):jd.r(e)},D:function(e){jd.D(e),Cd("dns-prefetch",e,null)},C:function(e,t){jd.C(e,t),Cd("preconnect",e,t)},L:function(e,t,n){jd.L(e,t,n);var r=_d;if(r&&e&&t){var a='link[rel="preload"][as="'+pt(t)+'"]';"image"===t&&n&&n.imageSrcSet?(a+='[imagesrcset="'+pt(n.imageSrcSet)+'"]',"string"===typeof n.imageSizes&&(a+='[imagesizes="'+pt(n.imageSizes)+'"]')):a+='[href="'+pt(e)+'"]';var s=a;switch(t){case"style":s=Td(e);break;case"script":s=Od(e)}kd.has(s)||(e=f({rel:"preload",href:"image"===t&&n&&n.imageSrcSet?void 0:e,as:t},n),kd.set(s,e),null!==r.querySelector(a)||"style"===t&&r.querySelector(Ad(s))||"script"===t&&r.querySelector(Ud(s))||(ed(t=r.createElement("link"),"link",e),We(t),r.head.appendChild(t)))}},m:function(e,t){jd.m(e,t);var n=_d;if(n&&e){var r=t&&"string"===typeof t.as?t.as:"script",a='link[rel="modulepreload"][as="'+pt(r)+'"][href="'+pt(e)+'"]',s=a;switch(r){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":s=Od(e)}if(!kd.has(s)&&(e=f({rel:"modulepreload",href:e},t),kd.set(s,e),null===n.querySelector(a))){switch(r){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(n.querySelector(Ud(s)))return}ed(r=n.createElement("link"),"link",e),We(r),n.head.appendChild(r)}}},X:function(e,t){jd.X(e,t);var n=_d;if(n&&e){var r=He(n).hoistableScripts,a=Od(e),s=r.get(a);s||((s=n.querySelector(Ud(a)))||(e=f({src:e,async:!0},t),(t=kd.get(a))&&Ld(e,t),We(s=n.createElement("script")),ed(s,"link",e),n.head.appendChild(s)),s={type:"script",instance:s,count:1,state:null},r.set(a,s))}},S:function(e,t,n){jd.S(e,t,n);var r=_d;if(r&&e){var a=He(r).hoistableStyles,s=Td(e);t=t||"default";var o=a.get(s);if(!o){var i={loading:0,preload:null};if(o=r.querySelector(Ad(s)))i.loading=5;else{e=f({rel:"stylesheet",href:e,"data-precedence":t},n),(n=kd.get(s))&&Md(e,n);var l=o=r.createElement("link");We(l),ed(l,"link",e),l._p=new Promise(function(e,t){l.onload=e,l.onerror=t}),l.addEventListener("load",function(){i.loading|=1}),l.addEventListener("error",function(){i.loading|=2}),i.loading|=4,Id(o,t,r)}o={type:"stylesheet",instance:o,count:1,state:i},a.set(s,o)}}},M:function(e,t){jd.M(e,t);var n=_d;if(n&&e){var r=He(n).hoistableScripts,a=Od(e),s=r.get(a);s||((s=n.querySelector(Ud(a)))||(e=f({src:e,async:!0,type:"module"},t),(t=kd.get(a))&&Ld(e,t),We(s=n.createElement("script")),ed(s,"link",e),n.head.appendChild(s)),s={type:"script",instance:s,count:1,state:null},r.set(a,s))}}};var _d="undefined"===typeof document?null:document;function Cd(e,t,n){var r=_d;if(r&&"string"===typeof t&&t){var a=pt(t);a='link[rel="'+e+'"][href="'+a+'"]',"string"===typeof n&&(a+='[crossorigin="'+n+'"]'),Sd.has(a)||(Sd.add(a),e={rel:e,crossOrigin:n,href:t},null===r.querySelector(a)&&(ed(t=r.createElement("link"),"link",e),We(t),r.head.appendChild(t)))}}function Ed(e,t,n,r){var a,s,i,l,c=(c=H.current)?Nd(c):null;if(!c)throw Error(o(446));switch(e){case"meta":case"title":return null;case"style":return"string"===typeof n.precedence&&"string"===typeof n.href?(t=Td(n.href),(r=(n=He(c).hoistableStyles).get(t))||(r={type:"style",instance:null,count:0,state:null},n.set(t,r)),r):{type:"void",instance:null,count:0,state:null};case"link":if("stylesheet"===n.rel&&"string"===typeof n.href&&"string"===typeof n.precedence){e=Td(n.href);var u=He(c).hoistableStyles,d=u.get(e);if(d||(c=c.ownerDocument||c,d={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},u.set(e,d),(u=c.querySelector(Ad(e)))&&!u._p&&(d.instance=u,d.state.loading=5),kd.has(e)||(n={rel:"preload",as:"style",href:n.href,crossOrigin:n.crossOrigin,integrity:n.integrity,media:n.media,hrefLang:n.hrefLang,referrerPolicy:n.referrerPolicy},kd.set(e,n),u||(a=c,s=e,i=n,l=d.state,a.querySelector('link[rel="preload"][as="style"]['+s+"]")?l.loading=1:(s=a.createElement("link"),l.preload=s,s.addEventListener("load",function(){return l.loading|=1}),s.addEventListener("error",function(){return l.loading|=2}),ed(s,"link",i),We(s),a.head.appendChild(s))))),t&&null===r)throw Error(o(528,""));return d}if(t&&null!==r)throw Error(o(529,""));return null;case"script":return t=n.async,"string"===typeof(n=n.src)&&t&&"function"!==typeof t&&"symbol"!==typeof t?(t=Od(n),(r=(n=He(c).hoistableScripts).get(t))||(r={type:"script",instance:null,count:0,state:null},n.set(t,r)),r):{type:"void",instance:null,count:0,state:null};default:throw Error(o(444,e))}}function Td(e){return'href="'+pt(e)+'"'}function Ad(e){return'link[rel="stylesheet"]['+e+"]"}function Pd(e){return f({},e,{"data-precedence":e.precedence,precedence:null})}function Od(e){return'[src="'+pt(e)+'"]'}function Ud(e){return"script[async]"+e}function Rd(e,t,n){if(t.count++,null===t.instance)switch(t.type){case"style":var r=e.querySelector('style[data-href~="'+pt(n.href)+'"]');if(r)return t.instance=r,We(r),r;var a=f({},n,{"data-href":n.href,"data-precedence":n.precedence,href:null,precedence:null});return We(r=(e.ownerDocument||e).createElement("style")),ed(r,"style",a),Id(r,n.precedence,e),t.instance=r;case"stylesheet":a=Td(n.href);var s=e.querySelector(Ad(a));if(s)return t.state.loading|=4,t.instance=s,We(s),s;r=Pd(n),(a=kd.get(a))&&Md(r,a),We(s=(e.ownerDocument||e).createElement("link"));var i=s;return i._p=new Promise(function(e,t){i.onload=e,i.onerror=t}),ed(s,"link",r),t.state.loading|=4,Id(s,n.precedence,e),t.instance=s;case"script":return s=Od(n.src),(a=e.querySelector(Ud(s)))?(t.instance=a,We(a),a):(r=n,(a=kd.get(s))&&Ld(r=f({},n),a),We(a=(e=e.ownerDocument||e).createElement("script")),ed(a,"link",r),e.head.appendChild(a),t.instance=a);case"void":return null;default:throw Error(o(443,t.type))}else"stylesheet"===t.type&&0===(4&t.state.loading)&&(r=t.instance,t.state.loading|=4,Id(r,n.precedence,e));return t.instance}function Id(e,t,n){for(var r=n.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),a=r.length?r[r.length-1]:null,s=a,o=0;o<r.length;o++){var i=r[o];if(i.dataset.precedence===t)s=i;else if(s!==a)break}s?s.parentNode.insertBefore(e,s.nextSibling):(t=9===n.nodeType?n.head:n).insertBefore(e,t.firstChild)}function Md(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.title&&(e.title=t.title)}function Ld(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.integrity&&(e.integrity=t.integrity)}var Dd=null;function Fd(e,t,n){if(null===Dd){var r=new Map,a=Dd=new Map;a.set(n,r)}else(r=(a=Dd).get(n))||(r=new Map,a.set(n,r));if(r.has(e))return r;for(r.set(e,null),n=n.getElementsByTagName(e),a=0;a<n.length;a++){var s=n[a];if(!(s[Fe]||s[Oe]||"link"===e&&"stylesheet"===s.getAttribute("rel"))&&"http://www.w3.org/2000/svg"!==s.namespaceURI){var o=s.getAttribute(t)||"";o=e+o;var i=r.get(o);i?i.push(s):r.set(o,[s])}}return r}function Bd(e,t,n){(e=e.ownerDocument||e).head.insertBefore(n,"title"===t?e.querySelector("head > title"):null)}function zd(e){return"stylesheet"!==e.type||0!==(3&e.state.loading)}var qd=null;function Vd(){}function Hd(){if(this.count--,0===this.count)if(this.stylesheets)Kd(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}var Wd=null;function Kd(e,t){e.stylesheets=null,null!==e.unsuspend&&(e.count++,Wd=new Map,t.forEach(Gd,e),Wd=null,Hd.call(e))}function Gd(e,t){if(!(4&t.state.loading)){var n=Wd.get(e);if(n)var r=n.get(null);else{n=new Map,Wd.set(e,n);for(var a=e.querySelectorAll("link[data-precedence],style[data-precedence]"),s=0;s<a.length;s++){var o=a[s];"LINK"!==o.nodeName&&"not all"===o.getAttribute("media")||(n.set(o.dataset.precedence,o),r=o)}r&&n.set(null,r)}o=(a=t.instance).getAttribute("data-precedence"),(s=n.get(o)||r)===r&&n.set(null,a),n.set(o,a),this.count++,r=Hd.bind(this),a.addEventListener("load",r),a.addEventListener("error",r),s?s.parentNode.insertBefore(a,s.nextSibling):(e=9===e.nodeType?e.head:e).insertBefore(a,e.firstChild),t.state.loading|=4}}var $d={$$typeof:w,Provider:null,Consumer:null,_currentValue:M,_currentValue2:M,_threadCount:0};function Yd(e,t,n,r,a,s,o,i){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Ne(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ne(0),this.hiddenUpdates=Ne(null),this.identifierPrefix=r,this.onUncaughtError=a,this.onCaughtError=s,this.onRecoverableError=o,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=i,this.incompleteTransitions=new Map}function Qd(e,t,n,r,a,s,o,i,l,c,u,d){return e=new Yd(e,t,n,o,i,l,c,d),t=1,!0===s&&(t|=24),s=Mr(3,null,null,t),e.current=s,s.stateNode=e,(t=Ua()).refCount++,e.pooledCache=t,t.refCount++,s.memoizedState={element:r,isDehydrated:n,cache:t},ns(s),e}function Jd(e){return e?e=Rr:Rr}function Xd(e,t,n,r,a,s){a=Jd(a),null===r.context?r.context=a:r.pendingContext=a,(r=as(t)).payload={element:n},null!==(s=void 0===s?null:s)&&(r.callback=s),null!==(n=ss(e,r,t))&&(Mc(n,0,t),os(n,e,t))}function Zd(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function ef(e,t){Zd(e,t),(e=e.alternate)&&Zd(e,t)}function tf(e){if(13===e.tag){var t=Pr(e,67108864);null!==t&&Mc(t,0,67108864),ef(e,67108864)}}var nf=!0;function rf(e,t,n,r){var a=R.T;R.T=null;var s=I.p;try{I.p=2,sf(e,t,n,r)}finally{I.p=s,R.T=a}}function af(e,t,n,r){var a=R.T;R.T=null;var s=I.p;try{I.p=8,sf(e,t,n,r)}finally{I.p=s,R.T=a}}function sf(e,t,n,r){if(nf){var a=of(r);if(null===a)qu(e,t,r,lf,n),bf(e,r);else if(function(e,t,n,r,a){switch(t){case"focusin":return ff=xf(ff,e,t,n,r,a),!0;case"dragenter":return hf=xf(hf,e,t,n,r,a),!0;case"mouseover":return mf=xf(mf,e,t,n,r,a),!0;case"pointerover":var s=a.pointerId;return pf.set(s,xf(pf.get(s)||null,e,t,n,r,a)),!0;case"gotpointercapture":return s=a.pointerId,gf.set(s,xf(gf.get(s)||null,e,t,n,r,a)),!0}return!1}(a,e,t,n,r))r.stopPropagation();else if(bf(e,r),4&t&&-1<vf.indexOf(e)){for(;null!==a;){var s=qe(a);if(null!==s)switch(s.tag){case 3:if((s=s.stateNode).current.memoizedState.isDehydrated){var o=ve(s.pendingLanes);if(0!==o){var i=s;for(i.pendingLanes|=2,i.entangledLanes|=2;o;){var l=1<<31-he(o);i.entanglements[1]|=l,o&=~l}ku(s),0===(6&nc)&&(kc=te()+500,Su(0,!1))}}break;case 13:null!==(i=Pr(s,2))&&Mc(i,0,2),zc(),ef(s,2)}if(null===(s=of(r))&&qu(e,t,r,lf,n),s===a)break;a=s}null!==a&&r.stopPropagation()}else qu(e,t,r,null,n)}}function of(e){return cf(e=Pt(e))}var lf=null;function cf(e){if(lf=null,null!==(e=ze(e))){var t=l(e);if(null===t)e=null;else{var n=t.tag;if(13===n){if(null!==(e=c(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return lf=e,null}function uf(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ne()){case re:return 2;case ae:return 8;case se:case oe:return 32;case ie:return 268435456;default:return 32}default:return 32}}var df=!1,ff=null,hf=null,mf=null,pf=new Map,gf=new Map,yf=[],vf="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function bf(e,t){switch(e){case"focusin":case"focusout":ff=null;break;case"dragenter":case"dragleave":hf=null;break;case"mouseover":case"mouseout":mf=null;break;case"pointerover":case"pointerout":pf.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":gf.delete(t.pointerId)}}function xf(e,t,n,r,a,s){return null===e||e.nativeEvent!==s?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:s,targetContainers:[a]},null!==t&&(null!==(t=qe(t))&&tf(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==a&&-1===t.indexOf(a)&&t.push(a),e)}function wf(e){var t=ze(e.target);if(null!==t){var n=l(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=c(n)))return e.blockedOn=t,void function(e,t){var n=I.p;try{return I.p=e,t()}finally{I.p=n}}(e.priority,function(){if(13===n.tag){var e=Rc();e=Ee(e);var t=Pr(n,e);null!==t&&Mc(t,0,e),ef(n,e)}})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function kf(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=of(e.nativeEvent);if(null!==n)return null!==(t=qe(n))&&tf(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);At=r,n.target.dispatchEvent(r),At=null,t.shift()}return!0}function Sf(e,t,n){kf(e)&&n.delete(t)}function Nf(){df=!1,null!==ff&&kf(ff)&&(ff=null),null!==hf&&kf(hf)&&(hf=null),null!==mf&&kf(mf)&&(mf=null),pf.forEach(Sf),gf.forEach(Sf)}function jf(e,t){e.blockedOn===t&&(e.blockedOn=null,df||(df=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,Nf)))}var _f=null;function Cf(e){_f!==e&&(_f=e,r.unstable_scheduleCallback(r.unstable_NormalPriority,function(){_f===e&&(_f=null);for(var t=0;t<e.length;t+=3){var n=e[t],r=e[t+1],a=e[t+2];if("function"!==typeof r){if(null===cf(r||n))continue;break}var s=qe(n);null!==s&&(e.splice(t,3),t-=3,Po(s,{pending:!0,data:a,method:n.method,action:r},r,a))}}))}function Ef(e){function t(t){return jf(t,e)}null!==ff&&jf(ff,e),null!==hf&&jf(hf,e),null!==mf&&jf(mf,e),pf.forEach(t),gf.forEach(t);for(var n=0;n<yf.length;n++){var r=yf[n];r.blockedOn===e&&(r.blockedOn=null)}for(;0<yf.length&&null===(n=yf[0]).blockedOn;)wf(n),null===n.blockedOn&&yf.shift();if(null!=(n=(e.ownerDocument||e).$$reactFormReplay))for(r=0;r<n.length;r+=3){var a=n[r],s=n[r+1],o=a[Ue]||null;if("function"===typeof s)o||Cf(n);else if(o){var i=null;if(s&&s.hasAttribute("formAction")){if(a=s,o=s[Ue]||null)i=o.formAction;else if(null!==cf(a))continue}else i=o.action;"function"===typeof i?n[r+1]=i:(n.splice(r,3),r-=3),Cf(n)}}}function Tf(e){this._internalRoot=e}function Af(e){this._internalRoot=e}Af.prototype.render=Tf.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(o(409));Xd(t.current,Rc(),e,t,null,null)},Af.prototype.unmount=Tf.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;Xd(e.current,2,null,e,null,null),zc(),t[Re]=null}},Af.prototype.unstable_scheduleHydration=function(e){if(e){var t=Ae();e={blockedOn:null,target:e,priority:t};for(var n=0;n<yf.length&&0!==t&&t<yf[n].priority;n++);yf.splice(n,0,e),0===n&&wf(e)}};var Pf=a.version;if("19.1.1"!==Pf)throw Error(o(527,Pf,"19.1.1"));I.findDOMNode=function(e){var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(o(188));throw e=Object.keys(e).join(","),Error(o(268,e))}return e=function(e){var t=e.alternate;if(!t){if(null===(t=l(e)))throw Error(o(188));return t!==e?null:e}for(var n=e,r=t;;){var a=n.return;if(null===a)break;var s=a.alternate;if(null===s){if(null!==(r=a.return)){n=r;continue}break}if(a.child===s.child){for(s=a.child;s;){if(s===n)return u(a),e;if(s===r)return u(a),t;s=s.sibling}throw Error(o(188))}if(n.return!==r.return)n=a,r=s;else{for(var i=!1,c=a.child;c;){if(c===n){i=!0,n=a,r=s;break}if(c===r){i=!0,r=a,n=s;break}c=c.sibling}if(!i){for(c=s.child;c;){if(c===n){i=!0,n=s,r=a;break}if(c===r){i=!0,r=s,n=a;break}c=c.sibling}if(!i)throw Error(o(189))}}if(n.alternate!==r)throw Error(o(190))}if(3!==n.tag)throw Error(o(188));return n.stateNode.current===n?e:t}(t),e=null===(e=null!==e?d(e):null)?null:e.stateNode};var Of={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:R,reconcilerVersion:"19.1.1"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var Uf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Uf.isDisabled&&Uf.supportsFiber)try{ue=Uf.inject(Of),de=Uf}catch(If){}}t.createRoot=function(e,t){if(!i(e))throw Error(o(299));var n=!1,r="",a=vi,s=bi,l=xi;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onUncaughtError&&(a=t.onUncaughtError),void 0!==t.onCaughtError&&(s=t.onCaughtError),void 0!==t.onRecoverableError&&(l=t.onRecoverableError),void 0!==t.unstable_transitionCallbacks&&t.unstable_transitionCallbacks),t=Qd(e,1,!1,null,0,n,r,a,s,l,0,null),e[Re]=t.current,Bu(e),new Tf(t)},t.hydrateRoot=function(e,t,n){if(!i(e))throw Error(o(299));var r=!1,a="",s=vi,l=bi,c=xi,u=null;return null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(r=!0),void 0!==n.identifierPrefix&&(a=n.identifierPrefix),void 0!==n.onUncaughtError&&(s=n.onUncaughtError),void 0!==n.onCaughtError&&(l=n.onCaughtError),void 0!==n.onRecoverableError&&(c=n.onRecoverableError),void 0!==n.unstable_transitionCallbacks&&n.unstable_transitionCallbacks,void 0!==n.formState&&(u=n.formState)),(t=Qd(e,1,!0,t,0,r,a,s,l,c,0,u)).context=Jd(null),n=t.current,(a=as(r=Ee(r=Rc()))).callback=null,ss(n,a,r),n=r,t.current.lanes=n,je(t,n),ku(t),e[Re]=t.current,Bu(e),new Af(t)},t.version="19.1.1"},43:(e,t,n)=>{e.exports=n(288)},288:(e,t)=>{var n=Symbol.for("react.transitional.element"),r=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),i=Symbol.for("react.consumer"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),h=Symbol.iterator;var m={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},p=Object.assign,g={};function y(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||m}function v(){}function b(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||m}y.prototype.isReactComponent={},y.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},y.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},v.prototype=y.prototype;var x=b.prototype=new v;x.constructor=b,p(x,y.prototype),x.isPureReactComponent=!0;var w=Array.isArray,k={H:null,A:null,T:null,S:null,V:null},S=Object.prototype.hasOwnProperty;function N(e,t,r,a,s,o){return r=o.ref,{$$typeof:n,type:e,key:t,ref:void 0!==r?r:null,props:o}}function j(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var _=/\/+/g;function C(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function E(){}function T(e,t,a,s,o){var i=typeof e;"undefined"!==i&&"boolean"!==i||(e=null);var l,c,u=!1;if(null===e)u=!0;else switch(i){case"bigint":case"string":case"number":u=!0;break;case"object":switch(e.$$typeof){case n:case r:u=!0;break;case f:return T((u=e._init)(e._payload),t,a,s,o)}}if(u)return o=o(e),u=""===s?"."+C(e,0):s,w(o)?(a="",null!=u&&(a=u.replace(_,"$&/")+"/"),T(o,t,a,"",function(e){return e})):null!=o&&(j(o)&&(l=o,c=a+(null==o.key||e&&e.key===o.key?"":(""+o.key).replace(_,"$&/")+"/")+u,o=N(l.type,c,void 0,0,0,l.props)),t.push(o)),1;u=0;var d,m=""===s?".":s+":";if(w(e))for(var p=0;p<e.length;p++)u+=T(s=e[p],t,a,i=m+C(s,p),o);else if("function"===typeof(p=null===(d=e)||"object"!==typeof d?null:"function"===typeof(d=h&&d[h]||d["@@iterator"])?d:null))for(e=p.call(e),p=0;!(s=e.next()).done;)u+=T(s=s.value,t,a,i=m+C(s,p++),o);else if("object"===i){if("function"===typeof e.then)return T(function(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch("string"===typeof e.status?e.then(E,E):(e.status="pending",e.then(function(t){"pending"===e.status&&(e.status="fulfilled",e.value=t)},function(t){"pending"===e.status&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}(e),t,a,s,o);throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return u}function A(e,t,n){if(null==e)return e;var r=[],a=0;return T(e,r,"","",function(e){return t.call(n,e,a++)}),r}function P(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var O="function"===typeof reportError?reportError:function(e){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof e&&null!==e&&"string"===typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)};function U(){}t.Children={map:A,forEach:function(e,t,n){A(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return A(e,function(){t++}),t},toArray:function(e){return A(e,function(e){return e})||[]},only:function(e){if(!j(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=y,t.Fragment=a,t.Profiler=o,t.PureComponent=b,t.StrictMode=s,t.Suspense=u,t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=k,t.__COMPILER_RUNTIME={__proto__:null,c:function(e){return k.H.useMemoCache(e)}},t.cache=function(e){return function(){return e.apply(null,arguments)}},t.cloneElement=function(e,t,n){if(null===e||void 0===e)throw Error("The argument must be a React element, but you passed "+e+".");var r=p({},e.props),a=e.key;if(null!=t)for(s in void 0!==t.ref&&void 0,void 0!==t.key&&(a=""+t.key),t)!S.call(t,s)||"key"===s||"__self"===s||"__source"===s||"ref"===s&&void 0===t.ref||(r[s]=t[s]);var s=arguments.length-2;if(1===s)r.children=n;else if(1<s){for(var o=Array(s),i=0;i<s;i++)o[i]=arguments[i+2];r.children=o}return N(e.type,a,void 0,0,0,r)},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider=e,e.Consumer={$$typeof:i,_context:e},e},t.createElement=function(e,t,n){var r,a={},s=null;if(null!=t)for(r in void 0!==t.key&&(s=""+t.key),t)S.call(t,r)&&"key"!==r&&"__self"!==r&&"__source"!==r&&(a[r]=t[r]);var o=arguments.length-2;if(1===o)a.children=n;else if(1<o){for(var i=Array(o),l=0;l<o;l++)i[l]=arguments[l+2];a.children=i}if(e&&e.defaultProps)for(r in o=e.defaultProps)void 0===a[r]&&(a[r]=o[r]);return N(e,s,void 0,0,0,a)},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=j,t.lazy=function(e){return{$$typeof:f,_payload:{_status:-1,_result:e},_init:P}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=k.T,n={};k.T=n;try{var r=e(),a=k.S;null!==a&&a(n,r),"object"===typeof r&&null!==r&&"function"===typeof r.then&&r.then(U,O)}catch(s){O(s)}finally{k.T=t}},t.unstable_useCacheRefresh=function(){return k.H.useCacheRefresh()},t.use=function(e){return k.H.use(e)},t.useActionState=function(e,t,n){return k.H.useActionState(e,t,n)},t.useCallback=function(e,t){return k.H.useCallback(e,t)},t.useContext=function(e){return k.H.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e,t){return k.H.useDeferredValue(e,t)},t.useEffect=function(e,t,n){var r=k.H;if("function"===typeof n)throw Error("useEffect CRUD overload is not enabled in this build of React.");return r.useEffect(e,t)},t.useId=function(){return k.H.useId()},t.useImperativeHandle=function(e,t,n){return k.H.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return k.H.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return k.H.useLayoutEffect(e,t)},t.useMemo=function(e,t){return k.H.useMemo(e,t)},t.useOptimistic=function(e,t){return k.H.useOptimistic(e,t)},t.useReducer=function(e,t,n){return k.H.useReducer(e,t,n)},t.useRef=function(e){return k.H.useRef(e)},t.useState=function(e){return k.H.useState(e)},t.useSyncExternalStore=function(e,t,n){return k.H.useSyncExternalStore(e,t,n)},t.useTransition=function(){return k.H.useTransition()},t.version="19.1.1"},391:(e,t,n)=>{!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(4)},447:(e,t,n)=>{n.r(t),n.d(t,{SessionManager:()=>s,default:()=>o});var r=n(555),a=n(957);class s{constructor(){this.accessTokenKey="chatapp_access_token",this.refreshTokenKey="chatapp_refresh_token",this.userKey="chatapp_user",this.currentUserTabKey="chatapp_current_user_tab",this.userSessionsKey="chatapp_user_sessions",this.pendingVerificationKey="chatapp_pending_verification",this.sessionExpiryMinutes=60,this.setupTokenRefresh(),this.setupActivityTracking(),this.startCleanupTimer()}async sendLoginVerificationCode(e){try{const t=await fetch("".concat(a.A.BASE_URL,"/auth/send-login-code"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})}),n=await t.json();if(n.success){const t={email:e,type:"login",timestamp:Date.now(),expiresAt:Date.now()+6e5};return sessionStorage.setItem(this.pendingVerificationKey,JSON.stringify(t)),n}throw new Error(n.message||"Failed to send verification code")}catch(t){throw console.error("Send login verification code error:",t),t}}async verifyLoginCode(e,t){try{const n=await fetch("".concat(a.A.BASE_URL,"/auth/verify-login-code"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,code:t})}),r=await n.json();if(r.success)return sessionStorage.removeItem(this.pendingVerificationKey),this.setSession(r.user,r.accessToken,r.refreshToken),r;throw new Error(r.message||"Invalid verification code")}catch(n){throw console.error("Verify login code error:",n),n}}async sendRegistrationVerificationCode(e){try{const t=await fetch("".concat(a.A.BASE_URL,"/auth/send-registration-code"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),n=await t.json();if(n.success){const t=(0,r.A)((0,r.A)({},e),{},{type:"registration",timestamp:Date.now(),expiresAt:Date.now()+6e5});return sessionStorage.setItem(this.pendingVerificationKey,JSON.stringify(t)),n}throw new Error(n.message||"Failed to send verification code")}catch(t){throw console.error("Send registration verification code error:",t),t}}async verifyRegistrationCode(e,t){try{const n=this.getPendingVerification();if(!n||n.email!==e||"registration"!==n.type)throw new Error("No pending registration found");const r=await fetch("".concat(a.A.BASE_URL,"/auth/verify-registration-code"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,code:t,userData:{name:n.name,email:n.email,phone:n.phone,bio:n.bio,password:n.password}})}),s=await r.json();if(s.success)return sessionStorage.removeItem(this.pendingVerificationKey),this.setSession(s.user,s.accessToken,s.refreshToken),s;throw new Error(s.message||"Registration verification failed")}catch(n){throw console.error("Verify registration code error:",n),n}}async sendPasswordResetCode(e){try{const t=await fetch("".concat(a.A.BASE_URL,"/auth/send-reset-code"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})}),n=await t.json();if(n.success){const t={email:e,type:"password_reset",timestamp:Date.now(),expiresAt:Date.now()+6e5};return sessionStorage.setItem(this.pendingVerificationKey,JSON.stringify(t)),n}throw new Error(n.message||"Failed to send reset code")}catch(t){throw console.error("Send password reset code error:",t),t}}async verifyPasswordResetCode(e,t,n){try{const r=await fetch("".concat(a.A.BASE_URL,"/auth/verify-reset-code"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,code:t,newPassword:n})}),s=await r.json();if(s.success)return sessionStorage.removeItem(this.pendingVerificationKey),s;throw new Error(s.message||"Password reset verification failed")}catch(r){throw console.error("Verify password reset code error:",r),r}}async resendVerificationCode(){try{const e=this.getPendingVerification();if(!e)throw new Error("No pending verification found");let t,n;switch(e.type){case"login":t="/auth/send-login-code",n={email:e.email};break;case"registration":t="/auth/send-registration-code",n={name:e.name,email:e.email,phone:e.phone,bio:e.bio,password:e.password};break;case"password_reset":t="/auth/send-reset-code",n={email:e.email};break;default:throw new Error("Invalid verification type")}const r=await fetch("".concat(a.A.BASE_URL).concat(t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),s=await r.json();if(s.success)return e.timestamp=Date.now(),e.expiresAt=Date.now()+6e5,sessionStorage.setItem(this.pendingVerificationKey,JSON.stringify(e)),s;throw new Error(s.message||"Failed to resend verification code")}catch(e){throw console.error("Resend verification code error:",e),e}}getPendingVerification(){try{const e=sessionStorage.getItem(this.pendingVerificationKey);if(!e)return null;const t=JSON.parse(e);return Date.now()>t.expiresAt?(sessionStorage.removeItem(this.pendingVerificationKey),null):t}catch(e){return console.error("Error parsing pending verification:",e),sessionStorage.removeItem(this.pendingVerificationKey),null}}clearPendingVerification(){sessionStorage.removeItem(this.pendingVerificationKey)}getVerificationTimeRemaining(){const e=this.getPendingVerification();return e?Math.max(0,e.expiresAt-Date.now()):0}async checkUserExists(e){try{const t=await fetch("".concat(a.A.BASE_URL,"/auth/check-user"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})});return(await t.json()).exists||!1}catch(t){return console.error("Check user exists error:",t),!1}}setSession(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.sessionExpiryMinutes;const a=Date.now(),s=this.getOrCreateTabId();sessionStorage.setItem(this.currentUserTabKey,e.id||e._id),sessionStorage.setItem(this.accessTokenKey,t),sessionStorage.setItem(this.userKey,JSON.stringify(e));const o=this.getSessions();o[e.id||e._id]={accessToken:t,refreshToken:n,user:e,expiry:a+60*r*1e3,lastActive:a,tabId:s},localStorage.setItem(this.userSessionsKey,JSON.stringify(o)),localStorage.setItem(this.refreshTokenKey,n)}getCurrentSession(){const e=sessionStorage.getItem(this.currentUserTabKey),t=sessionStorage.getItem(this.accessTokenKey),n=sessionStorage.getItem(this.userKey);if(!e||!t||!n)return this.restoreSessionFromStorage();try{const r=JSON.parse(n);return{userId:e,accessToken:t,refreshToken:localStorage.getItem(this.refreshTokenKey),user:r}}catch(r){return console.error("Error parsing user data:",r),this.clearCurrentSession(),null}}restoreSessionFromStorage(){const e=this.getSessions(),t=Date.now();for(const[n,r]of Object.entries(e))if(t<r.expiry)return sessionStorage.setItem(this.currentUserTabKey,n),sessionStorage.setItem(this.accessTokenKey,r.accessToken),sessionStorage.setItem(this.userKey,JSON.stringify(r.user)),r.lastActive=t,e[n]=r,localStorage.setItem(this.userSessionsKey,JSON.stringify(e)),{userId:n,accessToken:r.accessToken,refreshToken:r.refreshToken,user:r.user};return null}getSessions(){try{return JSON.parse(localStorage.getItem(this.userSessionsKey)||"{}")}catch(e){return console.error("Error parsing sessions:",e),{}}}updateAccessToken(e){const t=sessionStorage.getItem(this.currentUserTabKey);if(!t)return;sessionStorage.setItem(this.accessTokenKey,e);const n=this.getSessions();n[t]&&(n[t].accessToken=e,n[t].lastActive=Date.now(),localStorage.setItem(this.userSessionsKey,JSON.stringify(n)))}async refreshAccessToken(){const e=this.getCurrentSession();if(null===e||void 0===e||!e.refreshToken)throw new Error("No refresh token available");try{const t=await fetch("".concat(a.A.BASE_URL,"/auth/refresh-token"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:e.refreshToken})}),n=await t.json();if(n.success){if(this.updateAccessToken(n.accessToken),n.user){sessionStorage.setItem(this.userKey,JSON.stringify(n.user));const e=this.getSessions(),t=sessionStorage.getItem(this.currentUserTabKey);e[t]&&(e[t].user=n.user,localStorage.setItem(this.userSessionsKey,JSON.stringify(e)))}return n.accessToken}throw new Error(n.message||"Token refresh failed")}catch(t){throw console.error("Token refresh error:",t),this.clearCurrentSession(),t}}async authenticatedRequest(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=this.getCurrentSession();if(null===n||void 0===n||!n.accessToken)throw new Error("No access token available");let s;if(e.startsWith("http"))s=e;else{const t=a.A.BASE_URL.endsWith("/")?a.A.BASE_URL.slice(0,-1):a.A.BASE_URL,n=e.startsWith("/")?e:"/"+e;s="".concat(t).concat(n)}const o=(0,r.A)((0,r.A)({"Content-Type":"application/json"},t.headers),{},{Authorization:"Bearer ".concat(n.accessToken)});console.log("headers",o);const i=(0,r.A)((0,r.A)({method:"GET"},t),{},{headers:o});t.body&&"string"===typeof t.body?i.body=t.body:!t.body||"object"!==typeof t.body||t.body instanceof FormData?t.body instanceof FormData?(delete i.headers["Content-Type"],i.body=t.body):t.body&&(i.body=t.body):i.body=JSON.stringify(t.body);try{const e=await fetch(s,i);if(401===e.status){var l;let t;try{t=await e.json()}catch(c){t={message:"Unauthorized"}}if("TOKEN_EXPIRED"===t.code||null!==(l=t.message)&&void 0!==l&&l.includes("expired"))try{await this.refreshAccessToken();const e=this.getCurrentSession(),t=(0,r.A)((0,r.A)({},i),{},{headers:(0,r.A)((0,r.A)({},i.headers),{},{Authorization:"Bearer ".concat(e.accessToken)})});return await fetch(s,t)}catch(u){throw this.handleAuthFailure(),new Error("Authentication failed")}}return e}catch(d){throw console.error("\u274c Authenticated request error:",d),d}}extendSession(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sessionExpiryMinutes;const t=sessionStorage.getItem(this.currentUserTabKey);if(!t)return;const n=this.getSessions();if(n[t]){const r=Date.now();n[t].expiry=r+60*e*1e3,n[t].lastActive=r,localStorage.setItem(this.userSessionsKey,JSON.stringify(n))}}clearCurrentSession(){sessionStorage.removeItem(this.currentUserTabKey),sessionStorage.removeItem(this.accessTokenKey),sessionStorage.removeItem(this.userKey),sessionStorage.removeItem(this.pendingVerificationKey)}logout(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||sessionStorage.getItem(this.currentUserTabKey);if(e){const t=this.getSessions();delete t[e],localStorage.setItem(this.userSessionsKey,JSON.stringify(t)),e===sessionStorage.getItem(this.currentUserTabKey)&&this.clearCurrentSession()}const t=this.getSessions();0===Object.keys(t).length&&localStorage.removeItem(this.refreshTokenKey)}logoutAll(){localStorage.removeItem(this.userSessionsKey),localStorage.removeItem(this.refreshTokenKey),this.clearCurrentSession()}getOrCreateTabId(){let e=sessionStorage.getItem("tabId");return e||(e=Date.now()+Math.random().toString(36).substr(2,9),sessionStorage.setItem("tabId",e)),e}isSessionValid(){const e=this.getCurrentSession();if(!e)return!1;const t=this.getSessions()[e.userId];return!!t&&Date.now()<t.expiry}getTimeUntilExpiry(){const e=this.getCurrentSession();if(!e)return 0;const t=this.getSessions()[e.userId];return t?Math.max(0,t.expiry-Date.now()):0}setupTokenRefresh(){setInterval(async()=>{const e=this.getTimeUntilExpiry();if(e>0&&e<3e5)try{await this.refreshAccessToken()}catch(t){console.error("Auto token refresh failed:",t)}},6e4)}setupActivityTracking(){let e=0;const t=()=>{const t=Date.now();t-e>3e5&&(this.extendSession(),e=t)};["click","keypress","scroll","mousemove","touchstart"].forEach(e=>{document.addEventListener(e,t,{passive:!0})})}startCleanupTimer(){setInterval(()=>{const e=this.getSessions(),t=Date.now();let n=!1;if(Object.keys(e).forEach(r=>{t>e[r].expiry&&(delete e[r],n=!0)}),n){localStorage.setItem(this.userSessionsKey,JSON.stringify(e));const t=sessionStorage.getItem(this.currentUserTabKey);t&&!e[t]&&(this.clearCurrentSession(),this.handleAuthFailure())}},6e4)}handleAuthFailure(){this.clearCurrentSession(),window.dispatchEvent(new CustomEvent("auth:failure",{detail:{message:"Session expired. Please login again."}})),"/login"!==window.location.pathname&&(window.location.href="/login")}init(){const e=this.getCurrentSession();return e&&this.isSessionValid()?(window.dispatchEvent(new CustomEvent("auth:restored",{detail:{user:e.user}})),e):(this.clearCurrentSession(),null)}getAvailableSessions(){const e=this.getSessions(),t=Date.now(),n={};return Object.entries(e).forEach(e=>{let[r,a]=e;t<a.expiry&&(n[r]={user:a.user,lastActive:a.lastActive,expiry:a.expiry})}),n}switchToUser(e){const t=this.getSessions()[e];if(!t||Date.now()>t.expiry)throw new Error("Session not found or expired");return sessionStorage.setItem(this.currentUserTabKey,e),sessionStorage.setItem(this.accessTokenKey,t.accessToken),sessionStorage.setItem(this.userKey,JSON.stringify(t.user)),window.dispatchEvent(new CustomEvent("auth:switched",{detail:{user:t.user}})),t}}const o=new s},555:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function a(e){var t=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!=r(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==r(t)?t:t+""}function s(e,t,n){return(t=a(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach(function(t){s(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}n.d(t,{A:()=>i})},579:(e,t,n)=>{e.exports=n(799)},672:(e,t,n)=>{var r=n(43);function a(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(){}var o={d:{f:s,r:function(){throw Error(a(522))},D:s,C:s,L:s,m:s,X:s,S:s,M:s},p:0,findDOMNode:null},i=Symbol.for("react.portal");var l=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(e,t){return"font"===e?"":"string"===typeof t?"use-credentials"===t?t:"":void 0}t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=o,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType)throw Error(a(299));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:i,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.flushSync=function(e){var t=l.T,n=o.p;try{if(l.T=null,o.p=2,e)return e()}finally{l.T=t,o.p=n,o.d.f()}},t.preconnect=function(e,t){"string"===typeof e&&(t?t="string"===typeof(t=t.crossOrigin)?"use-credentials"===t?t:"":void 0:t=null,o.d.C(e,t))},t.prefetchDNS=function(e){"string"===typeof e&&o.d.D(e)},t.preinit=function(e,t){if("string"===typeof e&&t&&"string"===typeof t.as){var n=t.as,r=c(n,t.crossOrigin),a="string"===typeof t.integrity?t.integrity:void 0,s="string"===typeof t.fetchPriority?t.fetchPriority:void 0;"style"===n?o.d.S(e,"string"===typeof t.precedence?t.precedence:void 0,{crossOrigin:r,integrity:a,fetchPriority:s}):"script"===n&&o.d.X(e,{crossOrigin:r,integrity:a,fetchPriority:s,nonce:"string"===typeof t.nonce?t.nonce:void 0})}},t.preinitModule=function(e,t){if("string"===typeof e)if("object"===typeof t&&null!==t){if(null==t.as||"script"===t.as){var n=c(t.as,t.crossOrigin);o.d.M(e,{crossOrigin:n,integrity:"string"===typeof t.integrity?t.integrity:void 0,nonce:"string"===typeof t.nonce?t.nonce:void 0})}}else null==t&&o.d.M(e)},t.preload=function(e,t){if("string"===typeof e&&"object"===typeof t&&null!==t&&"string"===typeof t.as){var n=t.as,r=c(n,t.crossOrigin);o.d.L(e,n,{crossOrigin:r,integrity:"string"===typeof t.integrity?t.integrity:void 0,nonce:"string"===typeof t.nonce?t.nonce:void 0,type:"string"===typeof t.type?t.type:void 0,fetchPriority:"string"===typeof t.fetchPriority?t.fetchPriority:void 0,referrerPolicy:"string"===typeof t.referrerPolicy?t.referrerPolicy:void 0,imageSrcSet:"string"===typeof t.imageSrcSet?t.imageSrcSet:void 0,imageSizes:"string"===typeof t.imageSizes?t.imageSizes:void 0,media:"string"===typeof t.media?t.media:void 0})}},t.preloadModule=function(e,t){if("string"===typeof e)if(t){var n=c(t.as,t.crossOrigin);o.d.m(e,{as:"string"===typeof t.as&&"script"!==t.as?t.as:void 0,crossOrigin:n,integrity:"string"===typeof t.integrity?t.integrity:void 0})}else o.d.m(e)},t.requestFormReset=function(e){o.d.r(e)},t.unstable_batchedUpdates=function(e,t){return e(t)},t.useFormState=function(e,t,n){return l.H.useFormState(e,t,n)},t.useFormStatus=function(){return l.H.useHostTransitionStatus()},t.version="19.1.1"},799:(e,t)=>{var n=Symbol.for("react.transitional.element"),r=Symbol.for("react.fragment");function a(e,t,r){var a=null;if(void 0!==r&&(a=""+r),void 0!==t.key&&(a=""+t.key),"key"in t)for(var s in r={},t)"key"!==s&&(r[s]=t[s]);else r=t;return t=r.ref,{$$typeof:n,type:e,key:a,ref:void 0!==t?t:null,props:r}}t.Fragment=r,t.jsx=a,t.jsxs=a},853:(e,t,n)=>{e.exports=n(896)},896:(e,t)=>{function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,a=e[r];if(!(0<s(a,t)))break e;e[r]=t,e[n]=a,n=r}}function r(e){return 0===e.length?null:e[0]}function a(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,a=e.length,o=a>>>1;r<o;){var i=2*(r+1)-1,l=e[i],c=i+1,u=e[c];if(0>s(l,n))c<a&&0>s(u,l)?(e[r]=u,e[c]=n,r=c):(e[r]=l,e[i]=n,r=i);else{if(!(c<a&&0>s(u,n)))break e;e[r]=u,e[c]=n,r=c}}}return t}function s(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if(t.unstable_now=void 0,"object"===typeof performance&&"function"===typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var i=Date,l=i.now();t.unstable_now=function(){return i.now()-l}}var c=[],u=[],d=1,f=null,h=3,m=!1,p=!1,g=!1,y=!1,v="function"===typeof setTimeout?setTimeout:null,b="function"===typeof clearTimeout?clearTimeout:null,x="undefined"!==typeof setImmediate?setImmediate:null;function w(e){for(var t=r(u);null!==t;){if(null===t.callback)a(u);else{if(!(t.startTime<=e))break;a(u),t.sortIndex=t.expirationTime,n(c,t)}t=r(u)}}function k(e){if(g=!1,w(e),!p)if(null!==r(c))p=!0,N||(N=!0,S());else{var t=r(u);null!==t&&O(k,t.startTime-e)}}var S,N=!1,j=-1,_=5,C=-1;function E(){return!!y||!(t.unstable_now()-C<_)}function T(){if(y=!1,N){var e=t.unstable_now();C=e;var n=!0;try{e:{p=!1,g&&(g=!1,b(j),j=-1),m=!0;var s=h;try{t:{for(w(e),f=r(c);null!==f&&!(f.expirationTime>e&&E());){var o=f.callback;if("function"===typeof o){f.callback=null,h=f.priorityLevel;var i=o(f.expirationTime<=e);if(e=t.unstable_now(),"function"===typeof i){f.callback=i,w(e),n=!0;break t}f===r(c)&&a(c),w(e)}else a(c);f=r(c)}if(null!==f)n=!0;else{var l=r(u);null!==l&&O(k,l.startTime-e),n=!1}}break e}finally{f=null,h=s,m=!1}n=void 0}}finally{n?S():N=!1}}}if("function"===typeof x)S=function(){x(T)};else if("undefined"!==typeof MessageChannel){var A=new MessageChannel,P=A.port2;A.port1.onmessage=T,S=function(){P.postMessage(null)}}else S=function(){v(T,0)};function O(e,n){j=v(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):_=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_next=function(e){switch(h){case 1:case 2:case 3:var t=3;break;default:t=h}var n=h;h=t;try{return e()}finally{h=n}},t.unstable_requestPaint=function(){y=!0},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=h;h=e;try{return t()}finally{h=n}},t.unstable_scheduleCallback=function(e,a,s){var o=t.unstable_now();switch("object"===typeof s&&null!==s?s="number"===typeof(s=s.delay)&&0<s?o+s:o:s=o,e){case 1:var i=-1;break;case 2:i=250;break;case 5:i=1073741823;break;case 4:i=1e4;break;default:i=5e3}return e={id:d++,callback:a,priorityLevel:e,startTime:s,expirationTime:i=s+i,sortIndex:-1},s>o?(e.sortIndex=s,n(u,e),null===r(c)&&e===r(u)&&(g?(b(j),j=-1):g=!0,O(k,s-o))):(e.sortIndex=i,n(c,e),p||m||(p=!0,N||(N=!0,S()))),e},t.unstable_shouldYield=E,t.unstable_wrapCallback=function(e){var t=h;return function(){var n=h;h=t;try{return e.apply(this,arguments)}finally{h=n}}}},950:(e,t,n)=>{!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(672)},957:(e,t,n)=>{n.d(t,{A:()=>r});const r={BASE_URL:"http://localhost:5000/api/",TIMEOUT:3e4,ENDPOINTS:{AUTH:{LOGIN:"auth/login",REGISTER:"auth/register",LOGOUT:"auth/logout",LOGOUT_ALL:"auth/logout-all",REFRESH:"auth/refresh",REFRESH_TOKEN:"auth/refresh-token",VERIFY_TOKEN:"auth/verify-token",ME:"auth/me",PROFILE:"auth/profile",CHANGE_PASSWORD:"auth/change-password",FORGOT_PASSWORD:"auth/forgot-password",RESET_PASSWORD:"auth/reset-password",VERIFY_EMAIL:"auth/verify-email",RESEND_VERIFICATION:"auth/resend-verification"},CONVERSATIONS:{LIST:"/conversations",CREATE:"/conversations",GET:e=>"/conversations/".concat(e),UPDATE:e=>"/conversations/".concat(e),DELETE:e=>"/conversations/".concat(e),LEAVE:e=>"/conversations/".concat(e,"/leave"),PARTICIPANTS:e=>"/conversations/".concat(e,"/participants"),ADD_PARTICIPANT:e=>"/conversations/".concat(e,"/participants"),REMOVE_PARTICIPANT:(e,t)=>"/conversations/".concat(e,"/participants/").concat(t),MESSAGES:e=>"/conversations/".concat(e,"/messages")},MESSAGES:{LIST:e=>"/messages/".concat(e,"?page=1&limit=50"),SEND:e=>"/messages/".concat(e),SEND_FILE:e=>"/messages/".concat(e,"/file"),GET:e=>"/messages/".concat(e),EDIT:e=>"/messages/".concat(e),DELETE:e=>"/messages/".concat(e),REACT:e=>"/messages/".concat(e,"/react"),UNREACT:e=>"/messages/".concat(e,"/unreact"),PIN:e=>"/messages/".concat(e,"/pin"),UNPIN:e=>"/messages/".concat(e,"/unpin"),REPORT:e=>"/messages/".concat(e,"/report")},USERS:{LIST:"/users",SEARCH:"/users/search",SEARCH_BY_EMAIL:"/users/search",ONLINE_STATUS:"/users/online",ONLINE_USERS:"/users/online-users",UPDATE_STATUS:"/users/status",CONTACTS:"/users/me/contacts",UPDATE_PROFILE:"/users/me/profile",GET_PROFILE:e=>"/users/".concat(e),CREATE_CONVERSATION:e=>"/users/".concat(e,"/conversation"),MUTUAL_CONVERSATIONS:e=>"/users/".concat(e,"/mutual-conversations"),BLOCK_USER:e=>"/users/".concat(e,"/block"),REPORT_USER:e=>"/users/".concat(e,"/report"),UPLOAD_AVATAR:"/users/me/avatar",PREFERENCES:"/users/me/preferences",SESSIONS:"/users/me/sessions",STATS:"/users/me/stats",ACTIVITY:"/users/me/activity",EXPORT_DATA:"/users/me/export",DELETE_ACCOUNT:"/users/me/delete",BLOCKED_USERS:"/users/me/blocked",CHECK_EMAIL:"/users/check-email",BATCH_UPDATE:"/users/batch"},FILES:{UPLOAD:"/files/upload",DOWNLOAD:e=>"/files/".concat(e,"/download"),DELETE:e=>"/files/".concat(e),METADATA:e=>"/files/".concat(e,"/metadata")},ADMIN:{USERS:"/admin/users",CONVERSATIONS:"/admin/conversations",MESSAGES:"/admin/messages",REPORTS:"/admin/reports",ANALYTICS:"/admin/analytics",SETTINGS:"/admin/settings"},HEALTH:"/health",INFO:""},WEBSOCKET:{URL:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_BASE_URL:"http://localhost:5000/api/",REACT_APP_NODE_ENV:"development"}.REACT_APP_WS_URL||"ws://localhost:5000",RECONNECT_INTERVAL:3e3,MAX_RECONNECT_ATTEMPTS:5},FILES:{MAX_SIZE:52428800,ALLOWED_TYPES:{IMAGES:["image/jpeg","image/png","image/gif","image/webp"],DOCUMENTS:["application/pdf","text/plain","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],AUDIO:["audio/mpeg","audio/wav","audio/ogg","audio/mp4"],VIDEO:["video/mp4","video/webm","video/ogg"]},AVATAR_MAX_SIZE:5242880},SESSION:{DEFAULT_EXPIRY_MINUTES:60,REFRESH_THRESHOLD_MINUTES:5,ACTIVITY_EXTENSION_MINUTES:60,CLEANUP_INTERVAL_MS:6e4,MAX_SESSIONS_PER_USER:5},PAGINATION:{DEFAULT_PAGE_SIZE:20,MAX_PAGE_SIZE:100,MESSAGES_PAGE_SIZE:50,USERS_PAGE_SIZE:20,CONVERSATIONS_PAGE_SIZE:20},RATE_LIMITS:{MESSAGES_PER_MINUTE:30,FILE_UPLOADS_PER_HOUR:20,API_REQUESTS_PER_MINUTE:100,LOGIN_ATTEMPTS_PER_HOUR:10},FEATURES:{FILE_UPLOADS:!0,VIDEO_CALLS:!1,VOICE_MESSAGES:!0,MESSAGE_REACTIONS:!0,MESSAGE_EDITING:!0,MESSAGE_DELETION:!0,TYPING_INDICATORS:!0,READ_RECEIPTS:!0,PUSH_NOTIFICATIONS:!1,DARK_MODE:!0,MULTI_USER_SESSIONS:!0,SESSION_MANAGEMENT:!0,AUTO_TOKEN_REFRESH:!0},UI:{TOAST_DURATION:5e3,TYPING_TIMEOUT:2e3,MESSAGE_MAX_LENGTH:4096,CONVERSATION_NAME_MAX_LENGTH:100,USER_BIO_MAX_LENGTH:500,SEARCH_DEBOUNCE_MS:300},STORAGE_KEYS:{DARK_MODE:"darkMode",USER_PREFERENCES:"userPreferences",CHAT_APP_ACCESS_TOKEN:"chatapp_access_token",CHAT_APP_REFRESH_TOKEN:"chatapp_refresh_token",CHAT_APP_USER:"chatapp_user",CHAT_APP_USER_SESSIONS:"chatapp_user_sessions",CHAT_APP_CURRENT_USER_TAB:"chatapp_current_user_tab"}}}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,n),s.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};n.r(r),n.d(r,{Decoder:()=>Cn,Encoder:()=>jn,PacketType:()=>Nn,protocol:()=>Sn});var a=n(43),s=n(391),o=n(555),i=n(957);const l=new class{constructor(){this.baseURL=i.A.BASE_URL,this.sessionManager=null}setSessionManager(e){this.sessionManager=e}getAuthToken(){if(this.sessionManager){const e=this.sessionManager.getCurrentSession();return null===e||void 0===e?void 0:e.accessToken}return sessionStorage.getItem("chatapp_access_token")}setAuthToken(e){this.sessionManager||sessionStorage.setItem("chatapp_access_token",e)}removeAuthToken(){this.sessionManager||(sessionStorage.removeItem("chatapp_access_token"),localStorage.removeItem("chatapp_refresh_token"))}buildUrl(e){return"".concat(this.baseURL).concat(e)}getHeaders(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=(0,o.A)({"Content-Type":"application/json"},e),n=this.getAuthToken();return n&&(t.Authorization="Bearer ".concat(n)),t}async request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=this.buildUrl(e),r=(0,o.A)((0,o.A)({},t),{},{headers:this.getHeaders(t.headers)});try{const e=await fetch(n,r);if(e.ok){const t=e.headers.get("content-type");return null!==t&&void 0!==t&&t.includes("application/json")?await e.json():null!==t&&void 0!==t&&t.includes("text/")?await e.text():await e.blob()}let c;try{const t=e.headers.get("content-type");c=null!==t&&void 0!==t&&t.includes("application/json")?await e.json():{message:await e.text()}}catch(i){c={message:"HTTP ".concat(e.status,": ").concat(e.statusText)}}if(401===e.status){var a,s;if(!("TOKEN_EXPIRED"===c.code||(null===(a=c.message)||void 0===a?void 0:a.includes("token"))||(null===(s=c.message)||void 0===s?void 0:s.includes("expired")))||!this.sessionManager)throw this.handleAuthFailure(),new Error("Authentication required");try{await this.sessionManager.refreshAccessToken();const e=(0,o.A)((0,o.A)({},r),{},{headers:this.getHeaders(t.headers)}),a=await fetch(n,e);if(a.ok){const e=a.headers.get("content-type");return null!==e&&void 0!==e&&e.includes("application/json")?await a.json():null!==e&&void 0!==e&&e.includes("text/")?await a.text():await a.blob()}}catch(l){throw console.error("Token refresh failed:",l),this.handleAuthFailure(),new Error("Session expired. Please login again.")}}throw new Error(c.message||c.error||"HTTP error! status: ".concat(e.status))}catch(c){if("TypeError"===c.name&&c.message.includes("fetch"))throw new Error("Network error. Please check your connection and try again.");throw console.error("API Request failed:",c),c}}handleAuthFailure(){this.removeAuthToken(),window.dispatchEvent(new CustomEvent("auth:failure",{detail:{message:"Session expired. Please login again."}})),this.sessionManager&&this.sessionManager.logout()}async authenticatedRequest(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.sessionManager)return this.request(e,t);try{const n=await this.sessionManager.authenticatedRequest(e,t),r=n.headers.get("content-type");return null!==r&&void 0!==r&&r.includes("application/json")?await n.json():null!==r&&void 0!==r&&r.includes("text/")?await n.text():await n.blob()}catch(n){throw console.error("Authenticated request failed:",n),n}}async get(e){return this.request(e,{method:"GET"})}async post(e,t){return this.request(e,{method:"POST",body:JSON.stringify(t)})}async put(e,t){return this.request(e,{method:"PUT",body:JSON.stringify(t)})}async patch(e,t){return this.request(e,{method:"PATCH",body:JSON.stringify(t)})}async delete(e){return this.request(e,{method:"DELETE"})}async upload(e,t){const n=this.buildUrl(e),r={},a=this.getAuthToken();a&&(r.Authorization="Bearer ".concat(a));try{const e=await fetch(n,{method:"POST",headers:r,body:t});if(!e.ok){const t=await e.json().catch(()=>({}));throw new Error(t.message||"HTTP error! status: ".concat(e.status))}return e.json()}catch(s){throw console.error("Upload failed:",s),s}}async downloadFile(e,t){try{const n=await fetch(this.buildUrl(e),{headers:{Authorization:"Bearer ".concat(this.getAuthToken())}});if(!n.ok)throw new Error("Download failed: ".concat(n.statusText));const r=await n.blob(),a=window.URL.createObjectURL(r),s=document.createElement("a");return s.href=a,s.download=t||"download",document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(a),r}catch(n){throw console.error("Download failed:",n),n}}async healthCheck(){try{return await this.get("/health")}catch(e){return console.error("Health check failed:",e),{status:"error",message:e.message}}}getBaseURL(){return this.baseURL}setBaseURL(e){this.baseURL=e}};"undefined"!==typeof window&&Promise.resolve().then(n.bind(n,447)).then(e=>{l.setSessionManager(e.default)}).catch(e=>{console.warn("SessionManager not available:",e)});const c=l;const u=new class{constructor(){this.sessionManager=null}setSessionManager(e){this.sessionManager=e}async login(e){try{const t=await c.post(i.A.ENDPOINTS.AUTH.LOGIN,e);return t.success&&t.accessToken&&t.refreshToken&&(this.sessionManager?this.sessionManager.setSession(t.user,t.accessToken,t.refreshToken,60):c.setAuthToken(t.accessToken)),t}catch(t){throw new Error(t.message||"Login failed")}}async register(e){try{const t=await c.post(i.A.ENDPOINTS.AUTH.REGISTER,e);return t.success&&t.accessToken&&t.refreshToken&&(this.sessionManager?this.sessionManager.setSession(t.user,t.accessToken,t.refreshToken,60):c.setAuthToken(t.accessToken)),t}catch(t){throw new Error(t.message||"Registration failed")}}async logout(){try{this.sessionManager?await this.sessionManager.authenticatedRequest(c.buildUrl(i.A.ENDPOINTS.AUTH.LOGOUT),{method:"POST"}):await c.post(i.A.ENDPOINTS.AUTH.LOGOUT)}catch(e){console.error("Logout API call failed:",e)}finally{this.sessionManager?this.sessionManager.logout():c.removeAuthToken()}}async verifyEmail(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{const r=await c.post(i.A.ENDPOINTS.AUTH.VERIFY_EMAIL,{email:e,token:t,code:n});return r.success&&r.accessToken&&r.refreshToken&&(this.sessionManager&&this.sessionManager.setSession(r.user,r.accessToken,r.refreshToken,60),c.setAuthToken(r.accessToken)),r}catch(r){throw new Error(r.message||"Email verification failed")}}async resendVerification(e){try{return await c.post(i.A.ENDPOINTS.AUTH.RESEND_VERIFICATION,{email:e})}catch(t){throw new Error(t.message||"Failed to resend verification")}}async logoutAll(){try{this.sessionManager?await this.sessionManager.authenticatedRequest(c.buildUrl(i.A.ENDPOINTS.AUTH.LOGOUT_ALL),{method:"POST"}):await c.post(i.A.ENDPOINTS.AUTH.LOGOUT_ALL)}catch(e){console.error("Logout all API call failed:",e)}finally{this.sessionManager?this.sessionManager.logoutAll():c.removeAuthToken()}}async verifyToken(){try{if(this.sessionManager){const e=this.sessionManager.getCurrentSession();if(null===e||void 0===e||!e.accessToken)throw new Error("No access token available");const t=await this.sessionManager.authenticatedRequest(c.buildUrl(i.A.ENDPOINTS.AUTH.VERIFY_TOKEN),{method:"POST"});if(t.success)return c.setAuthToken(e.accessToken),t;throw new Error("Token verification failed")}return await c.post(i.A.ENDPOINTS.AUTH.VERIFY_TOKEN)}catch(e){throw this.sessionManager?this.sessionManager.logout():c.removeAuthToken(),e}}async getCurrentUser(){try{if(this.sessionManager){return await this.sessionManager.authenticatedRequest(c.buildUrl(i.A.ENDPOINTS.AUTH.ME))}return await c.get(i.A.ENDPOINTS.AUTH.ME)}catch(e){throw console.error("Get current user failed:",e),e}}async refreshToken(){try{if(this.sessionManager)return await this.sessionManager.refreshAccessToken();{const e=localStorage.getItem("refreshToken");if(!e)throw new Error("No refresh token available");const t=await c.post(i.A.ENDPOINTS.AUTH.REFRESH_TOKEN,{refreshToken:e});if(t.success&&t.accessToken)return c.setAuthToken(t.accessToken),t.accessToken;throw new Error("Token refresh failed")}}catch(e){throw console.error("Token refresh failed:",e),this.sessionManager?this.sessionManager.logout():c.removeAuthToken(),e}}isAuthenticated(){return this.sessionManager?this.sessionManager.isSessionValid():!!c.getAuthToken()}getCurrentSession(){if(this.sessionManager)return this.sessionManager.getCurrentSession();{const e=c.getAuthToken();return e?{accessToken:e}:null}}getTimeUntilExpiry(){return this.sessionManager?this.sessionManager.getTimeUntilExpiry():0}extendSession(){if(this.sessionManager)return this.sessionManager.extendSession()}getAvailableSessions(){return this.sessionManager?this.sessionManager.getAvailableSessions():{}}switchToUser(e){if(this.sessionManager){const t=this.sessionManager.switchToUser(e);return t&&c.setAuthToken(t.accessToken),t}throw new Error("Multi-user sessions not supported in legacy mode")}async changePassword(e,t){try{let n;return n=this.sessionManager?await this.sessionManager.authenticatedRequest(c.buildUrl(i.A.ENDPOINTS.AUTH.CHANGE_PASSWORD),{method:"POST",body:JSON.stringify({currentPassword:e,newPassword:t})}):await c.post(i.A.ENDPOINTS.AUTH.CHANGE_PASSWORD,{currentPassword:e,newPassword:t}),n.success&&(this.sessionManager?this.sessionManager.logout():c.removeAuthToken()),n}catch(n){throw console.error("Change password failed:",n),n}}async forgotPassword(e){try{return await c.post(i.A.ENDPOINTS.AUTH.FORGOT_PASSWORD,{email:e})}catch(t){throw new Error(t.message||"Forgot password request failed")}}async resetPassword(e,t){try{return await c.post(i.A.ENDPOINTS.AUTH.RESET_PASSWORD,{token:e,newPassword:t})}catch(n){throw new Error(n.message||"Password reset failed")}}async updateProfile(e){try{let t;if(t=this.sessionManager?await this.sessionManager.authenticatedRequest(c.buildUrl(i.A.ENDPOINTS.AUTH.PROFILE),{method:"PUT",body:JSON.stringify(e)}):await c.put(i.A.ENDPOINTS.AUTH.PROFILE,e),t.success&&t.user&&this.sessionManager){const e=this.sessionManager.getCurrentSession();e&&this.sessionManager.setSession(t.user,e.accessToken,e.refreshToken,60)}return t}catch(t){throw console.error("Profile update failed:",t),t}}init(){if(this.sessionManager)return this.sessionManager.init();{const e=c.getAuthToken();return e?{accessToken:e}:null}}onAuthFailure(e){return window.addEventListener("auth:failure",e),()=>window.removeEventListener("auth:failure",e)}onAuthRestored(e){return window.addEventListener("auth:restored",e),()=>window.removeEventListener("auth:restored",e)}onAuthSwitched(e){return window.addEventListener("auth:switched",e),()=>window.removeEventListener("auth:switched",e)}};"undefined"!==typeof window&&Promise.resolve().then(n.bind(n,447)).then(e=>{u.setSessionManager(e.default)}).catch(e=>{console.warn("SessionManager not available, using legacy auth mode:",e)});var d=n(447),f=n(579);const h=(0,a.createContext)(null),m=()=>{const e=(0,a.useContext)(h);if(!e)throw new Error("useUser must be used within a UserProvider");return e},p=e=>{let{children:t}=e;const[n,r]=(0,a.useState)(null),[s,i]=(0,a.useState)(!0),[l,c]=(0,a.useState)(""),[m,p]=(0,a.useState)(!1),[g,y]=(0,a.useState)({show:!1,message:""}),[v,b]=(0,a.useState)([]),[x,w]=(0,a.useState)(null),[k,S]=(0,a.useState)(new Set),[N,j]=(0,a.useState)({isValid:!1,timeUntilExpiry:0,availableSessions:{}}),[_,C]=(0,a.useState)(()=>{const e=localStorage.getItem("darkMode");return!!e&&JSON.parse(e)});(0,a.useEffect)(()=>{E()},[]),(0,a.useEffect)(()=>{const e=()=>{j({isValid:u.isAuthenticated(),timeUntilExpiry:u.getTimeUntilExpiry(),availableSessions:u.getAvailableSessions()})};e();const t=setInterval(e,3e4);return()=>clearInterval(t)},[n]),(0,a.useEffect)(()=>{const e=u.onAuthFailure(e=>{console.error("Auth failure detected:",e.detail),r(null),b([]),w(null),S(new Set),c(e.detail.message||"Session expired. Please login again.")}),t=u.onAuthRestored(e=>{c("")}),n=u.onAuthSwitched(e=>{c(""),b([]),w(null),S(new Set)});return()=>{e(),t(),n()}},[]),(0,a.useEffect)(()=>{localStorage.setItem("darkMode",JSON.stringify(_))},[_]);const E=async()=>{try{i(!0);const t=u.init();if(t){console.log("Session found, setting basic user..."),r(t.user),console.log("Fetching complete profile after session restore...");const e=await P();e&&(console.log("Complete profile loaded on session restore:",e.blockedUsers),r(e)),c("")}else try{console.log("No session found, verifying token...");const e=await u.verifyToken();if(e.success&&e.user){r(e.user),console.log("Fetching complete profile after token verification...");const t=await P();t&&(console.log("Complete profile loaded on token verification:",t.blockedUsers),r(t)),c("")}}catch(e){console.error("Token verification failed:",e.message)}}catch(l){console.error("Auth initialization error:",l),c("Failed to initialize authentication")}finally{i(!1)}},T=(0,a.useCallback)(e=>{r(t=>{if(!t)return t;if(t._id===e._id||t.id===e.id){return(0,o.A)((0,o.A)((0,o.A)({},t),e),{},{_id:t._id||e._id,id:t.id||e.id})}return t}),b(t=>t.map(t=>{var n;let r=!1;const a=t.participants.map(t=>(t.user._id||t.user.id)===(e._id||e.id)?(r=!0,(0,o.A)((0,o.A)({},t),{},{user:(0,o.A)((0,o.A)((0,o.A)({},t.user),e),{},{_id:t.user._id||e._id,id:t.user.id||e.id})})):t);let s=t.lastMessage;if(null!==(n=t.lastMessage)&&void 0!==n&&n.sender){(t.lastMessage.sender._id||t.lastMessage.sender.id)===(e._id||e.id)&&(r=!0,s=(0,o.A)((0,o.A)({},t.lastMessage),{},{sender:(0,o.A)((0,o.A)((0,o.A)({},t.lastMessage.sender),e),{},{_id:t.lastMessage.sender._id||e._id,id:t.lastMessage.sender.id||e.id})}))}return r?(0,o.A)((0,o.A)({},t),{},{participants:a,lastMessage:s}):t}))},[]),A=(0,a.useCallback)(async e=>{try{i(!0),c("");const t=await u.register(e);if(t.success)return t.user&&t.accessToken?(r(t.user),t):(y({show:!0,message:"Verification email sent! Check your inbox and click the verification link."}),setTimeout(()=>{y({show:!1,message:""})},8e3),{success:!0,message:t.message||"Please check your email for verification instructions",emailVerificationRequired:!0,email:e.email});throw new Error(t.message||"Registration failed")}catch(l){throw console.error("Registration error:",l),c(l.message||"Registration failed"),l}finally{i(!1)}},[]),P=(0,a.useCallback)(async()=>{try{console.log("Fetching complete user profile...");const e=await d.default.authenticatedRequest("/users/me/profile");if(e.ok){const t=await e.json();if(t.success&&t.user){const e=(0,o.A)((0,o.A)({},t.user),{},{blockedUsers:t.user.blockedUsers||[]});return r(t=>{if(!t)return e;return JSON.stringify(t.blockedUsers||[])!==JSON.stringify(e.blockedUsers)||!t.blockedUsers?(console.log("User profile updated with blocked users:",e.blockedUsers),e):t}),e}}return null}catch(l){return console.error("Error fetching user profile:",l),null}},[]),O=(0,a.useCallback)(async e=>{try{i(!0),c("");const t=await u.login(e);if(t.success&&t.user){console.log("Login successful, setting basic user..."),r(t.user),console.log("Fetching complete profile after login...");const e=await P();return e&&(console.log("Complete profile loaded after login:",e.blockedUsers),r(e)),t}throw new Error(t.message||"Login failed")}catch(l){throw console.error("Login error:",l),c(l.message||"Login failed"),l}finally{i(!1)}},[P]),U=(0,a.useCallback)(async e=>{try{i(!0),c("");const t=await u.forgotPassword(e);if(t.success)return y({show:!0,message:"Password reset instructions sent! Check your inbox for the reset link."}),setTimeout(()=>{y({show:!1,message:""})},8e3),{success:!0,message:t.message||"Password reset instructions sent to your email"};throw new Error(t.message||"Failed to send reset instructions")}catch(l){throw console.error("Password reset request error:",l),c(l.message||"Failed to send reset instructions"),l}finally{i(!1)}},[]),R=(0,a.useCallback)(async(e,t)=>{try{i(!0),c("");const n=await u.resetPassword(e,t);if(n.success)return window.history.replaceState({},"","/"),y({show:!0,message:"Password reset successful! You can now sign in with your new password."}),setTimeout(()=>{y({show:!1,message:""})},1e4),{success:!0,message:n.message||"Password reset successfully"};throw new Error(n.message||"Password reset failed")}catch(l){throw console.error("Password reset error:",l),c(l.message||"Password reset failed"),l}finally{i(!1)}},[]),I=(0,a.useCallback)(async()=>{try{await u.logout()}catch(l){console.error("Logout error:",l)}finally{r(null),b([]),w(null),S(new Set),c("")}},[]),M=(0,a.useCallback)(async()=>{try{await u.logoutAll()}catch(l){console.error("Logout all error:",l)}finally{r(null),b([]),w(null),S(new Set),c("")}},[]),L=(0,a.useCallback)(async e=>{try{const t=u.switchToUser(e);if(t){r(t.user),console.log("Fetching complete profile for switched user...");const e=await P();return e&&(console.log("Complete profile loaded for switched user:",e.blockedUsers),r(e)),b([]),w(null),S(new Set),c(""),t}throw new Error("Failed to switch user session")}catch(l){throw console.error("Switch user error:",l),c(l.message||"Failed to switch user"),l}},[P]),D=(0,a.useCallback)(e=>{b(e)},[]),F=(0,a.useCallback)(e=>{b(t=>{const n=t.findIndex(t=>t._id===e._id);if(n>=0){const r=[...t];return r[n]=e,r}return[e,...t]})},[]),B=(0,a.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{i(!0),c("");const a=await u.verifyEmail(e,t,n);if(a.success)return a.user&&a.accessToken?(r(a.user),a):{success:!0,message:a.message||"Email verified successfully"};throw new Error(a.message||"Email verification failed")}catch(l){throw console.error("Email verification error:",l),c(l.message||"Email verification failed"),l}finally{i(!1)}},[]),z=(0,a.useCallback)(async e=>{try{i(!0),c("");const t=await u.resendVerification(e);if(t.success)return{success:!0,message:t.message||"Verification email sent"};throw new Error(t.message||"Failed to resend verification")}catch(l){throw console.error("Resend verification error:",l),c(l.message||"Failed to resend verification"),l}finally{i(!1)}},[]),q=(0,a.useCallback)(e=>{b(t=>t.filter(t=>t._id!==e)),w(t=>(null===t||void 0===t?void 0:t._id)===e?null:t)},[]),V=(0,a.useCallback)(e=>{S(new Set(e))},[]),H=(0,a.useCallback)((e,t)=>{S(n=>{const r=new Set(n);return t?r.add(e):r.delete(e),r})},[]),W=(0,a.useCallback)(e=>{w(e)},[]),K=(0,a.useCallback)(()=>{C(e=>!e)},[]),G=(0,a.useCallback)(()=>{c(""),p(!1)},[]),$=(0,a.useCallback)(()=>{j({isValid:u.isAuthenticated(),timeUntilExpiry:u.getTimeUntilExpiry(),availableSessions:u.getAvailableSessions()})},[]),Y=(0,a.useCallback)(e=>{let{user:t,accessToken:n,refreshToken:a}=e;j({isValid:u.isAuthenticated(),timeUntilExpiry:u.getTimeUntilExpiry(),availableSessions:u.getAvailableSessions()}),r(t),c("")},[]),Q=(0,a.useCallback)(()=>{u.extendSession(),$()},[$]),J={currentUser:n,setCurrentUser:r,isLoading:s,setIsLoading:i,isError:m,error:l,setError:c,setIsError:p,clearError:G,completeLogin:Y,sessionInfo:N,refreshSessionInfo:$,extendSession:Q,conversations:v,activeChat:x,onlineUsers:k,isDark:_,setIsDark:C,updateUserProfile:T,loginUser:O,registerUser:A,requestPasswordReset:U,resetPassword:R,logoutUser:I,logoutAllDevices:M,switchUser:L,fetchCompleteUserProfile:P,popupAlert:g,setPopupAlert:y,updateConversations:D,updateConversation:F,removeConversation:q,setActiveChat:W,updateOnlineUsers:V,updateUserOnlineStatus:H,verifyEmail:B,resendVerification:z,toggleDarkMode:K,isAuthenticated:()=>u.isAuthenticated(),getTimeUntilExpiry:()=>u.getTimeUntilExpiry(),getAvailableSessions:()=>u.getAvailableSessions()};return(0,f.jsx)(h.Provider,{value:J,children:t})};function g(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}const y=e=>{const t=(e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,n)=>n?n.toUpperCase():t.toLowerCase()))(e);return t.charAt(0).toUpperCase()+t.slice(1)},v=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter((e,t,n)=>Boolean(e)&&""!==e.trim()&&n.indexOf(e)===t).join(" ").trim()};var b={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const x=["color","size","strokeWidth","absoluteStrokeWidth","className","children","iconNode"],w=(0,a.forwardRef)((e,t)=>{let{color:n="currentColor",size:r=24,strokeWidth:s=2,absoluteStrokeWidth:i,className:l="",children:c,iconNode:u}=e,d=g(e,x);return(0,a.createElement)("svg",(0,o.A)((0,o.A)((0,o.A)({ref:t},b),{},{width:r,height:r,stroke:n,strokeWidth:i?24*Number(s)/Number(r):s,className:v("lucide",l)},!c&&!(e=>{for(const t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(d)&&{"aria-hidden":"true"}),d),[...u.map(e=>{let[t,n]=e;return(0,a.createElement)(t,n)}),...Array.isArray(c)?c:[c]])}),k=["className"],S=(e,t)=>{const n=(0,a.forwardRef)((n,r)=>{let{className:s}=n,i=g(n,k);return(0,a.createElement)(w,(0,o.A)({ref:r,iconNode:t,className:v("lucide-".concat((l=y(e),l.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase())),"lucide-".concat(e),s)},i));var l});return n.displayName=y(e),n},N=S("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]),j=S("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]]),_=S("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),C=S("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),E=S("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),T=S("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),A=S("phone",[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]]),P=S("sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]),O=S("moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]),U=S("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),R=S("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),I=["confirmPassword"],M=e=>{let{onLogin:t,isDark:n,setIsDark:r,showVerificationAlert:s}=e;const{registerUser:i,sessionInfo:l,requestPasswordReset:c,resetPassword:u,completeLogin:h,verifyEmail:p,resendVerification:y}=m(),[v,b]=(0,a.useState)(!0),[x,w]=(0,a.useState)(!1),[k,S]=(0,a.useState)(!1),[M,L]=(0,a.useState)(!1),[D,F]=(0,a.useState)(""),[B,z]=(0,a.useState)(""),[q,V]=(0,a.useState)("login"),[H,W]=(0,a.useState)({email:"",token:""}),[K,G]=(0,a.useState)({email:""}),[$,Y]=(0,a.useState)({token:"",newPassword:"",confirmPassword:""}),[Q,J]=(0,a.useState)({email:"",password:""}),[X,Z]=(0,a.useState)({name:"",email:"",password:"",confirmPassword:"",phone:"",bio:""}),ee=()=>{const e=new URL(window.location);e.search="",window.history.replaceState({},"",e)};(0,a.useEffect)(()=>{const e=new URLSearchParams(window.location.search),t=e.get("resetToken"),n=e.get("verifyToken"),r=e.get("email"),a=e.get("token");t||a&&window.location.pathname.includes("reset")?(console.log("\ud83d\udd04 Detected password reset flow"),V("resetPassword"),Y(e=>(0,o.A)((0,o.A)({},e),{},{token:t||a})),r&&G(e=>(0,o.A)((0,o.A)({},e),{},{email:r}))):n||a&&window.location.pathname.includes("verify")?(console.log("\u2709\ufe0f Detected email verification flow"),V("emailVerification"),W(e=>(0,o.A)((0,o.A)({},e),{},{token:n||a,email:r||""}))):a&&(window.location.search.includes("reset")||window.location.hash.includes("reset")?(V("resetPassword"),Y(e=>(0,o.A)((0,o.A)({},e),{},{token:a}))):(V("emailVerification"),W(e=>(0,o.A)((0,o.A)({},e),{},{token:a,email:r||""}))))},[]);const te=l.availableSessions||{},ne=Object.keys(te).length>0,re=e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),ae=e=>{const t=e.length>=8,n=/[A-Z]/.test(e),r=/[a-z]/.test(e),a=/\d/.test(e);return{isValid:t&&n&&r&&a,minLength:t,hasUpperCase:n,hasLowerCase:r,hasNumbers:a}},se=()=>{J({email:"",password:""}),Z({name:"",email:"",password:"",confirmPassword:"",phone:"",bio:""}),W({email:"",token:""}),G({email:""}),Y({token:"",newPassword:"",confirmPassword:""}),F(""),z(""),w(!1),S(!1)};return(0,f.jsx)("div",{className:"min-h-screen flex items-center justify-center p-4 ".concat(n?"bg-gray-900":"bg-gray-50"),children:(0,f.jsxs)("div",{className:"w-full max-w-md p-8 rounded-2xl shadow-2xl transition-all duration-300 ".concat(n?"bg-gray-800 text-white":"bg-white"),children:[(0,f.jsx)("h1",{className:"text-2xl font-bold mb-2 text-center",children:"login"===q?"Welcome Back!":"signup"===q?"Join ChatApp":"forgotPassword"===q?"Forgot Password":"resetPassword"===q?"Reset Password":"emailVerification"===q?"Verify Your Email":"ChatApp"}),(0,f.jsx)("p",{className:"text-gray-500",children:"login"===q?"Sign in to continue messaging":"signup"===q?"Create your account to get started":"forgotPassword"===q?"Enter your email to receive reset instructions":"resetPassword"===q?"Enter your new password":"emailVerification"===q?"Click the link in your email to verify your account":""}),ne&&"login"===q&&(0,f.jsxs)("div",{className:"mb-6",children:[(0,f.jsxs)("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-3 flex items-center",children:[(0,f.jsx)(N,{className:"w-4 h-4 mr-2"}),"Continue as existing user"]}),(0,f.jsx)("div",{className:"space-y-2",children:Object.entries(te).map(e=>{var r;let[a,s]=e;return(0,f.jsxs)("button",{onClick:()=>(async e=>{try{L(!0),F("");const n=d.default.switchToUser(e);n&&(ee(),await t({success:!0,user:n.user,accessToken:n.accessToken,refreshToken:n.refreshToken}))}catch(D){F(D.message||"Failed to switch session")}finally{L(!1)}})(a),disabled:M,className:"w-full p-3 rounded-lg border transition-all flex items-center space-x-3 ".concat(n?"border-gray-600 hover:border-gray-500 hover:bg-gray-700":"border-gray-300 hover:border-gray-400 hover:bg-gray-50"," disabled:opacity-50 disabled:cursor-not-allowed"),children:[(0,f.jsx)("div",{className:"w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center",children:(0,f.jsx)("span",{className:"text-white text-sm font-semibold",children:s.user.avatar||(null===(r=s.user.name)||void 0===r?void 0:r.charAt(0))||"?"})}),(0,f.jsxs)("div",{className:"flex-1 text-left",children:[(0,f.jsx)("div",{className:"font-medium",children:s.user.name}),(0,f.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Last active:"," ",new Date(s.lastActive).toLocaleString()]})]})]},a)})}),(0,f.jsxs)("div",{className:"my-4 flex items-center",children:[(0,f.jsx)("div",{className:"flex-1 border-t border-gray-300 dark:border-gray-600"}),(0,f.jsx)("span",{className:"px-3 text-sm text-gray-500 dark:text-gray-400",children:"or"}),(0,f.jsx)("div",{className:"flex-1 border-t border-gray-300 dark:border-gray-600"})]})]}),D&&(0,f.jsx)("div",{className:"mb-4 p-3 rounded-lg bg-red-100 border border-red-300 text-red-700 text-sm",children:D}),B&&(0,f.jsx)("div",{className:"mb-4 p-3 rounded-lg bg-green-100 border border-green-300 text-green-700 text-sm",children:B}),"login"===q&&(0,f.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),L(!0),F(""),Q.email.trim()?Q.password.trim()?re(Q.email)||(F("Please enter a valid email address"),0):(F("Password is required"),0):(F("Email is required"),0))try{ee(),console.log("Im submitting for a login"),await t(Q)}catch(n){F(n.message||"Login failed")}finally{L(!1)}else L(!1)},className:"space-y-4",children:[(0,f.jsxs)("div",{className:"relative",children:[(0,f.jsx)(j,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,f.jsx)("input",{type:"email",placeholder:"Email address",value:Q.email,onChange:e=>J(t=>(0,o.A)((0,o.A)({},t),{},{email:e.target.value})),className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all ".concat(n?"bg-gray-700 border-gray-600 text-white placeholder-gray-400":"bg-gray-50 border-gray-300"),required:!0,disabled:M})]}),(0,f.jsxs)("div",{className:"relative",children:[(0,f.jsx)(_,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,f.jsx)("input",{type:x?"text":"password",placeholder:"Password",value:Q.password,onChange:e=>J(t=>(0,o.A)((0,o.A)({},t),{},{password:e.target.value})),className:"w-full pl-10 pr-10 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all ".concat(n?"bg-gray-700 border-gray-600 text-white placeholder-gray-400":"bg-gray-50 border-gray-300"),required:!0,disabled:M}),(0,f.jsx)("button",{type:"button",onClick:()=>w(!x),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",disabled:M,children:x?(0,f.jsx)(C,{className:"w-5 h-5"}):(0,f.jsx)(E,{className:"w-5 h-5"})})]}),(0,f.jsx)("button",{type:"button",onClick:()=>V("forgotPassword"),className:"text-sm text-blue-500 hover:text-blue-600",disabled:M,children:"Forgot your password?"}),(0,f.jsx)("button",{type:"submit",disabled:M,className:"w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-blue-600 hover:to-purple-700 transition-all transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",children:M?"Signing In...":"Sign In"})]}),"signup"===q&&(0,f.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),L(!0),F(""),z(""),X.name.trim()?X.email.trim()?X.password.trim()?X.confirmPassword.trim()?re(X.email)?(e=>{if(!e.trim())return!0;const t=e.replace(/\D/g,"");return t.length>=7&&t.length<=15})(X.phone)?ae(X.password).isValid?X.password===X.confirmPassword||(F("Passwords do not match"),0):(F("Password must be at least 6 characters long"),0):(F("Please enter a valid phone number"),0):(F("Please enter a valid email address"),0):(F("Password confirmation is required"),0):(F("Password is required"),0):(F("Email is required"),0):(F("Full name is required"),0))try{const{confirmPassword:e}=X,t=g(X,I),n=await i(t);if(console.log("Showing signup"),n.emailVerificationRequired)return z("Account created! Please check your email for verification instructions."),s(!0),console.log("Showing popup"),V("emailVerification"),W(e=>(0,o.A)((0,o.A)({},e),{},{email:t.email})),n;ee(),z("Account created successfully! You are now signed in.")}catch(t){F(t.message||"Registration failed")}finally{L(!1)}else L(!1)},className:"space-y-4",children:[(0,f.jsxs)("div",{className:"relative",children:[(0,f.jsx)(T,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,f.jsx)("input",{type:"text",placeholder:"Full name",value:X.name,onChange:e=>Z(t=>(0,o.A)((0,o.A)({},t),{},{name:e.target.value})),className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all ".concat(n?"bg-gray-700 border-gray-600 text-white placeholder-gray-400":"bg-gray-50 border-gray-300"),required:!0,disabled:M})]}),(0,f.jsxs)("div",{className:"relative",children:[(0,f.jsx)(j,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,f.jsx)("input",{type:"text",placeholder:"Email",value:X.email,onChange:e=>Z(t=>(0,o.A)((0,o.A)({},t),{},{email:e.target.value})),className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all ".concat(n?"bg-gray-700 border-gray-600 text-white placeholder-gray-400":"bg-gray-50 border-gray-300"),required:!0,disabled:M})]}),(0,f.jsxs)("div",{className:"relative",children:[(0,f.jsx)(A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,f.jsx)("input",{type:"tel",placeholder:"Phone number (optional)",value:X.phone,onChange:e=>Z(t=>(0,o.A)((0,o.A)({},t),{},{phone:e.target.value})),className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all ".concat(n?"bg-gray-700 border-gray-600 text-white placeholder-gray-400":"bg-gray-50 border-gray-300"),disabled:M})]}),(0,f.jsxs)("div",{className:"relative",children:[(0,f.jsx)(_,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,f.jsx)("input",{type:x?"text":"password",placeholder:"Password",value:X.password,onChange:e=>Z(t=>(0,o.A)((0,o.A)({},t),{},{password:e.target.value})),className:"w-full pl-10 pr-10 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all ".concat(n?"bg-gray-700 border-gray-600 text-white placeholder-gray-400":"bg-gray-50 border-gray-300"),required:!0,disabled:M}),(0,f.jsx)("button",{type:"button",onClick:()=>w(!x),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",disabled:M,children:x?(0,f.jsx)(C,{className:"w-5 h-5"}):(0,f.jsx)(E,{className:"w-5 h-5"})})]}),(0,f.jsxs)("div",{className:"relative",children:[(0,f.jsx)(_,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,f.jsx)("input",{type:k?"text":"password",placeholder:"Confirm password",value:X.confirmPassword,onChange:e=>Z(t=>(0,o.A)((0,o.A)({},t),{},{confirmPassword:e.target.value})),className:"w-full pl-10 pr-10 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all ".concat(n?"bg-gray-700 border-gray-600 text-white placeholder-gray-400":"bg-gray-50 border-gray-300"),required:!0,disabled:M}),(0,f.jsx)("button",{type:"button",onClick:()=>S(!k),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",disabled:M,children:k?(0,f.jsx)(C,{className:"w-5 h-5"}):(0,f.jsx)(E,{className:"w-5 h-5"})})]}),(0,f.jsx)("textarea",{placeholder:"Bio (optional)",value:X.bio,onChange:e=>Z(t=>(0,o.A)((0,o.A)({},t),{},{bio:e.target.value})),rows:3,className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all resize-none ".concat(n?"bg-gray-700 border-gray-600 text-white placeholder-gray-400":"bg-gray-50 border-gray-300"),disabled:M}),(0,f.jsx)("button",{type:"submit",disabled:M,className:"w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-blue-600 hover:to-purple-700 transition-all transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",children:M?"Creating Account...":"Create Account"})]}),"emailVerification"===q&&(0,f.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),L(!0),F(""),z(""),H.email.trim()?re(H.email)||(F("Please enter a valid email address"),0):(F("Email is required"),0))try{const e=await p(H.email,H.token,null);e.success&&(ee(),e.user&&e.accessToken?(z("Email verified successfully! You are now logged in."),await h({success:!0,user:e.user,accessToken:e.accessToken,refreshToken:e.refreshToken})):(z("Email verified successfully! You can now sign in."),V("login"),se()))}catch(t){F(t.message||"Verification failed. Please try again.")}finally{L(!1)}else L(!1)},className:"space-y-4",children:[(0,f.jsxs)("div",{className:"relative",children:[(0,f.jsx)(j,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,f.jsx)("input",{type:"email",placeholder:"Enter your email address",value:H.email,onChange:e=>W(t=>(0,o.A)((0,o.A)({},t),{},{email:e.target.value})),className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all ".concat(n?"bg-gray-700 border-gray-600 text-white placeholder-gray-400":"bg-gray-50 border-gray-300"),required:!0,disabled:M})]}),(0,f.jsx)("button",{type:"submit",disabled:M,className:"w-full bg-gradient-to-r from-green-500 to-blue-600 text-white py-3 rounded-lg font-semibold hover:from-green-600 hover:to-blue-700 transition-all transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",children:M?"Verifying...":"Verify Email"}),(0,f.jsx)("div",{className:"text-center",children:(0,f.jsx)("button",{type:"button",onClick:async()=>{if(H.email.trim()){L(!0);try{await y(H.email),z("Verification email sent! Please check your inbox.")}catch(e){F(e.message||"Failed to resend verification email. Please try again.")}finally{L(!1)}}else F("Email is required to resend verification")},disabled:M,className:"text-sm text-blue-500 hover:text-blue-600 font-medium",children:M?"Sending...":"Resend verification email"})}),H.token&&(0,f.jsx)("div",{className:"mt-4 p-3 rounded-lg bg-blue-50 border border-blue-200 text-blue-700 text-sm",children:(0,f.jsx)("p",{className:"text-center",children:'Verification link detected! Click "Verify Email" to complete the process.'})})]}),"forgotPassword"===q&&(0,f.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),L(!0),F(""),z(""),K.email.trim()?re(K.email)||(F("Please enter a valid email address"),0):(F("Email is required"),0))try{await c(K.email),z("Reset instructions sent to your email. Please check your inbox."),V("resetPassword")}catch(t){F(t.message||"Failed to send reset instructions. Please try again.")}finally{L(!1)}else L(!1)},className:"space-y-4",children:[(0,f.jsxs)("div",{className:"relative",children:[(0,f.jsx)(j,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,f.jsx)("input",{type:"email",placeholder:"Enter your email address",value:K.email,onChange:e=>G(t=>(0,o.A)((0,o.A)({},t),{},{email:e.target.value})),className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all ".concat(n?"bg-gray-700 border-gray-600 text-white placeholder-gray-400":"bg-gray-50 border-gray-300"),required:!0,disabled:M})]}),(0,f.jsxs)("button",{type:"submit",disabled:M,className:"w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-blue-600 hover:to-purple-700 transition-all transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center justify-center space-x-2",children:[(0,f.jsx)(U,{className:"w-4 h-4"}),(0,f.jsx)("span",{children:M?"Sending...":"Send Reset Instructions"})]})]}),"resetPassword"===q&&(0,f.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),L(!0),F(""),z(""),$.newPassword.trim()?ae($.newPassword).isValid?$.newPassword===$.confirmPassword||(F("Passwords do not match"),0):(F("Password must be at least 8 characters with uppercase, lowercase, and numbers"),0):(F("New password is required"),0))try{await u($.token,$.newPassword),ee(),z("Password reset successfully! Please sign in with your new password."),V("login"),se()}catch(t){F(t.message||"Failed to reset password. Please try again or request a new reset link.")}finally{L(!1)}else L(!1)},className:"space-y-4",children:[(0,f.jsxs)("div",{className:"relative",children:[(0,f.jsx)(_,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,f.jsx)("input",{type:x?"text":"password",placeholder:"New password",value:$.newPassword,onChange:e=>Y(t=>(0,o.A)((0,o.A)({},t),{},{newPassword:e.target.value})),className:"w-full pl-10 pr-10 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all ".concat(n?"bg-gray-700 border-gray-600 text-white placeholder-gray-400":"bg-gray-50 border-gray-300"),required:!0,disabled:M}),(0,f.jsx)("button",{type:"button",onClick:()=>w(!x),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",disabled:M,children:x?(0,f.jsx)(C,{className:"w-5 h-5"}):(0,f.jsx)(E,{className:"w-5 h-5"})})]}),(0,f.jsxs)("div",{className:"relative",children:[(0,f.jsx)(_,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,f.jsx)("input",{type:k?"text":"password",placeholder:"Confirm new password",value:$.confirmPassword,onChange:e=>Y(t=>(0,o.A)((0,o.A)({},t),{},{confirmPassword:e.target.value})),className:"w-full pl-10 pr-10 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all ".concat(n?"bg-gray-700 border-gray-600 text-white placeholder-gray-400":"bg-gray-50 border-gray-300"),required:!0,disabled:M}),(0,f.jsx)("button",{type:"button",onClick:()=>S(!k),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",disabled:M,children:k?(0,f.jsx)(C,{className:"w-5 h-5"}):(0,f.jsx)(E,{className:"w-5 h-5"})})]}),$.token&&(0,f.jsx)("div",{className:"mt-4 p-3 rounded-lg bg-green-50 border border-green-200 text-green-700 text-sm",children:(0,f.jsx)("p",{className:"text-center",children:"\u2705 Reset link verified! Enter your new password above."})}),(0,f.jsx)("button",{type:"submit",disabled:M,className:"w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-blue-600 hover:to-purple-700 transition-all transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",children:M?"Resetting Password...":"Reset Password"})]}),(0,f.jsx)("div",{className:"mt-6 text-center",children:"login"===q?(0,f.jsxs)("p",{className:"text-gray-500 text-sm",children:["Don't have an account?"," ",(0,f.jsx)("button",{onClick:()=>V("signup"),className:"text-blue-500 hover:text-blue-600 font-semibold",disabled:M,children:"Sign up"})]}):"signup"===q?(0,f.jsxs)("p",{className:"text-gray-500 text-sm",children:["Already have an account?"," ",(0,f.jsx)("button",{onClick:()=>V("login"),className:"text-blue-500 hover:text-blue-600 font-semibold",disabled:M,children:"Sign in"})]}):(0,f.jsxs)("button",{onClick:()=>V("login"),className:"flex items-center space-x-2 text-blue-500 hover:text-blue-600 font-semibold mx-auto",disabled:M,children:[(0,f.jsx)(R,{className:"w-4 h-4"}),(0,f.jsx)("span",{children:"Back to Sign In"})]})}),ne&&"login"===q&&(0,f.jsxs)("div",{className:"mt-4 text-center text-xs text-gray-500 dark:text-gray-400",children:[Object.keys(te).length," saved session",1!==Object.keys(te).length?"s":""," available"]}),(0,f.jsx)("button",{onClick:()=>r(!n),className:"absolute top-4 right-4 p-2 rounded-lg transition-colors ".concat(n?"bg-gray-700 text-yellow-400 hover:bg-gray-600":"bg-gray-100 text-gray-600 hover:bg-gray-200"),disabled:M,children:n?(0,f.jsx)(P,{className:"w-5 h-5"}):(0,f.jsx)(O,{className:"w-5 h-5"})})]})})},L=S("menu",[["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 18h16",key:"19g7jn"}],["path",{d:"M4 6h16",key:"1o0s65"}]]),D=S("message-square",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]),F=S("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),B=S("radio",[["path",{d:"M16.247 7.761a6 6 0 0 1 0 8.478",key:"1fwjs5"}],["path",{d:"M19.075 4.933a10 10 0 0 1 0 14.134",key:"ehdyv1"}],["path",{d:"M4.925 19.067a10 10 0 0 1 0-14.134",key:"1q22gi"}],["path",{d:"M7.753 16.239a6 6 0 0 1 0-8.478",key:"r2q7qm"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),z=S("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),q=S("user-plus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),V=S("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]]),H=S("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]),W=S("funnel",[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]]),K=S("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),G=S("user-x",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]),$=S("crown",[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]]),Y=S("trash-2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),Q=e=>{if(!e)return"";const t=new Date(e),n=new Date,r=n-t;if(r<6e4)return"now";if(r<36e5){const e=Math.floor(r/6e4);return"".concat(e,"m ago")}if(t.toDateString()===n.toDateString())return t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1});const a=new Date(n);return a.setDate(a.getDate()-1),t.toDateString()===a.toDateString()?"Yesterday":r<6048e5?t.toLocaleDateString([],{weekday:"short"}):t.toLocaleDateString([],{month:"short",day:"numeric"})},J=e=>{if(!e)return!1;return["image","video","audio","file","document","pdf","xlsx","txt"].includes(e.messageType)||Boolean(e.fileInfo||e.file)},X=e=>{if(!e)return"Unknown File";const t=e.fileInfo||e.file||{};return t.displayName||t.originalName||t.name||Z(e.content)||"Unknown File"},Z=e=>{if(!e||"string"!==typeof e)return null;try{const t=e.split("/"),n=t[t.length-1].split("?")[0];if(n.includes(".")&&n.length>3)return decodeURIComponent(n)}catch(t){console.error("Error extracting filename from URL:",t)}return null},ee=e=>{const t=X(e).split(".");return t.length>1?t[t.length-1].toLowerCase():""},te=e=>{if(!e)return!1;const t=e.fileInfo||e.file||{},n=ee(e),r=t.type||t.mimeType||"";return"gif"===n||"image/gif"===r},ne=function(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const a=r?null===(t=r.split(".").pop())||void 0===t?void 0:t.toLowerCase():"";return"image"===e?"gif"===a?"\ud83c\udf9e\ufe0f":"\ud83d\uddbc\ufe0f":"video"===e?"\ud83c\udfa5":"audio"===e?"\ud83c\udfb5":"pdf"===e||n.includes("pdf")||"pdf"===a?"\ud83d\udcc4":n.includes("document")||n.includes("word")||["doc","docx"].includes(a)?"\ud83d\udcdd":n.includes("spreadsheet")||n.includes("excel")||["xls","xlsx"].includes(a)?"\ud83d\udcca":n.includes("zip")||["zip","rar","7z"].includes(a)?"\ud83d\udddc\ufe0f":"\ud83d\udcce"},re=e=>{if(!e)return{content:"",displayText:"Message",isFile:!1,originalMessage:e};if(J(e)){var t;const n=X(e),r=ne(e.messageType,null===(t=e.fileInfo)||void 0===t?void 0:t.type,n);return{content:e.content,displayText:"".concat(r," ").concat(n),fileName:n,isFile:!0,messageType:e.messageType,fileInfo:e.fileInfo||e.file,originalMessage:e}}return{content:e.content||"",displayText:e.content||"Message",isFile:!1,messageType:"text",originalMessage:e}},ae=e=>{var t;if(!e)return"No messages yet";if("system"===e.messageType)return e.content||"System message";if(!e.messageType||"text"===e.messageType)return e.content||"Message";const n=(null===(t=e.fileInfo)||void 0===t?void 0:t.displayName)||e.content||"Unknown File";if(n.startsWith("\ud83d\udcce")||n.startsWith("\ud83d\uddbc\ufe0f")||n.startsWith("\ud83c\udfa5")||n.startsWith("\ud83c\udfb5")||n.startsWith("\ud83d\udcc4")||n.startsWith("\ud83c\udf9e\ufe0f")||n.startsWith("\ud83d\udcdd")||n.startsWith("\ud83d\udcca")||n.startsWith("\ud83d\udddc\ufe0f"))return n;let r="\ud83d\udcce";switch(e.messageType){case"image":r=n.toLowerCase().endsWith(".gif")?"\ud83c\udf9e\ufe0f":"\ud83d\uddbc\ufe0f";break;case"video":r="\ud83c\udfa5";break;case"audio":r="\ud83c\udfb5";break;case"pdf":case"txt":r="\ud83d\udcc4";break;case"document":r="\ud83d\udcdd";break;case"xlsx":r="\ud83d\udcca";break;default:r="\ud83d\udcce"}return"".concat(r," ").concat(n)},se=e=>{var t;if(!e)return"file";const n=e.type||"",r=(null===(t=(e.name||"").split(".").pop())||void 0===t?void 0:t.toLowerCase())||"";return n.startsWith("image/")?"image":n.startsWith("video/")?"video":n.startsWith("audio/")?"audio":n.includes("pdf")||"pdf"===r?"pdf":n.includes("document")||n.includes("word")||["doc","docx"].includes(r)?"document":n.includes("spreadsheet")||n.includes("excel")||["xls","xlsx"].includes(r)?"xlsx":"text/plain"===n||"txt"===r?"txt":"file"},oe=e=>{if(!e||0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(1))+" "+["B","KB","MB","GB"][t]},ie=(e,t)=>({originalName:e.name,displayName:e.name,url:t.url,size:e.size,type:e.type,fileSize:oe(e.size),cloudData:{publicId:t.publicId||t.public_id,deleteUrl:t.deleteUrl,thumbUrl:t.thumbUrl||t.thumbnail_url,width:t.width,height:t.height,duration:t.duration,format:t.format,resourceType:t.resourceType||t.resource_type}}),le=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:52428800;if(!e)return{valid:!1,error:"No file selected"};if(e.size>t)return{valid:!1,error:"File size too large. Maximum size is ".concat(oe(t))};return["image/","video/","audio/","application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/plain","application/zip","application/x-rar-compressed"].some(t=>e.type.startsWith(t))?{valid:!0}:{valid:!1,error:"File type not supported"}},ce=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;if(!e)return"Message";if(J(e)){var n;const r=X(e),a=ne(e.messageType,null===(n=e.fileInfo)||void 0===n?void 0:n.type,r),s="".concat(a," ").concat(r);return s.length>t?s.substring(0,t)+"...":s}const r=e.content||"";return r.length>t?r.substring(0,t)+"...":r},ue=S("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),de=e=>{let{isDark:t,onConfirm:n,onCancel:r,messagePreview:a,type:s="message",conversationName:o,conversationType:i}=e;const l="conversation"===s,c="group"===i;return(0,f.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,f.jsxs)("div",{className:"w-full max-w-md rounded-2xl shadow-2xl ".concat(t?"bg-gray-800 text-white":"bg-white"),children:[(0,f.jsx)("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:(0,f.jsxs)("div",{className:"flex items-center justify-between",children:[(0,f.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,f.jsx)("div",{className:"w-10 h-10 bg-red-100 dark:bg-red-900 rounded-full flex items-center justify-center",children:(0,f.jsx)(ue,{className:"w-5 h-5 text-red-600 dark:text-red-400"})}),(0,f.jsx)("h2",{className:"text-xl font-bold",children:l?c?"Delete Group":"Delete Conversation":"Delete Message"})]}),(0,f.jsx)("button",{onClick:r,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:(0,f.jsx)(z,{className:"w-5 h-5"})})]})}),(0,f.jsxs)("div",{className:"p-6",children:[(0,f.jsx)("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:l?c?'Are you sure you want to delete the group "'.concat(o,'"? This action cannot be undone and will delete all messages.'):"Are you sure you want to delete the conversation with ".concat(o,"? This action cannot be undone and will delete all messages."):"Are you sure you want to delete this message? This action cannot be undone."}),(0,f.jsxs)("div",{className:"p-3 rounded-lg border-l-4 border-red-400 ".concat(t?"bg-gray-700":"bg-gray-50"),children:[(0,f.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:l?c?"Group to delete:":"Conversation to delete:":"Message to delete:"}),(0,f.jsx)("p",{className:"text-sm truncate",children:l?o||"Unknown":a||"No content"})]})]}),(0,f.jsxs)("div",{className:"p-6 border-t border-gray-200 dark:border-gray-700 flex space-x-3",children:[(0,f.jsx)("button",{onClick:r,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:"Cancel"}),(0,f.jsx)("button",{onClick:n,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:l?c?"Delete Group":"Delete Conversation":"Delete Message"})]})]})})},fe=e=>{var t;let{onProfileClick:n,onStartConversation:r,onConversationViewed:s,onDeleteConversation:o,messages:i,onConversationSelect:l}=e;const{currentUser:c,conversations:u,activeChat:h,setActiveChat:p,onlineUsers:g,isDark:y,toggleDarkMode:v,logoutUser:b}=m(),[x,w]=(0,a.useState)(""),[k,S]=(0,a.useState)(!1),[j,_]=(0,a.useState)(null),[C,E]=(0,a.useState)(!1),[T,A]=(0,a.useState)([]),[U,R]=(0,a.useState)("all"),[I,M]=(0,a.useState)(!1),[L,J]=(0,a.useState)(!1),[X,Z]=(0,a.useState)([]),ee=(0,a.useRef)(null);(0,a.useEffect)(()=>{const e=localStorage.getItem("chat_search_history");if(e)try{Z(JSON.parse(e))}catch(t){console.error("Failed to load search history:",t)}},[]);const te=(e,t)=>{var n,r,a;if("direct"!==e.type)return{isBlocked:!1};const s=null===(n=e.participants)||void 0===n||null===(r=n.find(e=>e.user._id!==t._id))||void 0===r?void 0:r.user;if(!s)return{isBlocked:!1};const o=(null===(a=t.blockedUsers)||void 0===a?void 0:a.includes(s._id))||!0===s.isBlockedByCurrentUser,i=!0===s.hasBlockedCurrentUser;return{isBlocked:o||i,blockedByCurrentUser:o,blockedByOtherUser:i}},ne=(e,t)=>{var n;if(!e||!t)return!1;if(("string"===typeof e.admin?e.admin:null===(n=e.admin)||void 0===n?void 0:n._id)===t)return"main";if(e.admins&&Array.isArray(e.admins)){if(e.admins.some(e=>("string"===typeof e?e:null===e||void 0===e?void 0:e._id)===t))return"admin"}return!1},re=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all";if(!e.trim())return void A([]);M(!0);const n=[];try{if("all"===t||"users"===t){u.filter(t=>{var n,r;const a=e.toLowerCase();return!(null===(n=t.name)||void 0===n||!n.toLowerCase().includes(a))||(null===(r=t.participants)||void 0===r?void 0:r.some(e=>{var t,n,r,s;return e.user._id!==c._id&&((null===(t=e.user)||void 0===t||null===(n=t.name)||void 0===n?void 0:n.toLowerCase().includes(a))||(null===(r=e.user)||void 0===r||null===(s=r.email)||void 0===s?void 0:s.toLowerCase().includes(a)))}))}).forEach(t=>{const r=((e,t)=>{if("group"===e.type||"broadcast"===e.type){const n=e.participants.find(e=>{var n,r;return e.user._id!==c._id&&((null===(n=e.user.name)||void 0===n?void 0:n.toLowerCase().includes(t.toLowerCase()))||(null===(r=e.user.email)||void 0===r?void 0:r.toLowerCase().includes(t.toLowerCase())))});return(null===n||void 0===n?void 0:n.user)||null}{const t=e.participants.find(e=>e.user._id!==c._id);return(null===t||void 0===t?void 0:t.user)||null}})(t,e);n.push({type:"user",conversation:t,user:r,matchType:"name",preview:le(t),isOnline:!!r&&[...g].includes(r._id)})})}if("all"===t||"messages"===t){const t=u.map(async t=>{try{const a=i[t._id]||[];if(a.filter(t=>{var n,r,a,s,o;const i=e.toLowerCase();return!(null===(n=t.content)||void 0===n||!n.toLowerCase().includes(i))||(!(null===(r=t.fileInfo)||void 0===r||null===(a=r.displayName)||void 0===a||!a.toLowerCase().includes(i))||!(null===(s=t.fileInfo)||void 0===s||null===(o=s.originalName)||void 0===o||!o.toLowerCase().includes(i)))}).forEach(r=>{n.push({type:"message",conversation:t,message:r,matchType:"content",preview:se(r,e),user:r.sender})}),e.length>=3)try{const r=await d.default.authenticatedRequest("/messages/search?q=".concat(encodeURIComponent(e),"&conversationId=").concat(t._id,"&limit=3"));if(r.ok){const a=await r.json();a.success&&a.messages&&a.messages.forEach(r=>{n.some(e=>"message"===e.type&&e.message._id===r._id)||n.push({type:"message",conversation:t,message:r,matchType:"server",preview:r.highlightedContent||se(r,e),user:r.sender})})}}catch(r){console.error("Server message search failed:",r)}}catch(r){console.error("Failed to search messages in conversation ".concat(t._id,":"),r)}});await Promise.all(t)}n.sort((t,n)=>{var r,a,s,o,i,l,c,u,d,f;const h="user"===t.type?(null===(r=t.user)||void 0===r||null===(a=r.name)||void 0===a?void 0:a.toLowerCase())===e.toLowerCase()||(null===(s=t.conversation)||void 0===s||null===(o=s.name)||void 0===o?void 0:o.toLowerCase())===e.toLowerCase():(null===(i=t.message.content)||void 0===i?void 0:i.toLowerCase())===e.toLowerCase(),m="user"===n.type?(null===(l=n.user)||void 0===l||null===(c=l.name)||void 0===c?void 0:c.toLowerCase())===e.toLowerCase()||(null===(u=n.conversation)||void 0===u||null===(d=u.name)||void 0===d?void 0:d.toLowerCase())===e.toLowerCase():(null===(f=n.message.content)||void 0===f?void 0:f.toLowerCase())===e.toLowerCase();if(h&&!m)return-1;if(!h&&m)return 1;if(t.type!==n.type)return"user"===t.type?-1:1;const p="user"===t.type?new Date(t.conversation.updatedAt||t.conversation.createdAt||0):new Date(t.message.createdAt||0);return("user"===n.type?new Date(n.conversation.updatedAt||n.conversation.createdAt||0):new Date(n.message.createdAt||0))-p});const r=[],a=new Set,s=new Set;n.forEach(e=>{if("user"===e.type)a.has(e.conversation._id)||(a.add(e.conversation._id),r.push(e));else{const t="".concat(e.message._id,"-").concat(e.conversation._id);s.has(t)||(s.add(t),r.push(e))}}),A(r.slice(0,15)),(e=>{if(!e.trim()||e.length<2)return;const t=[e,...X.filter(t=>t!==e)].slice(0,10);Z(t),localStorage.setItem("chat_search_history",JSON.stringify(t))})(e)}catch(r){console.error("Search failed:",r),A([])}finally{M(!1)}};(0,a.useEffect)(()=>(ee.current&&clearTimeout(ee.current),x.trim()?ee.current=setTimeout(()=>{re(x,U)},300):A([]),()=>{ee.current&&clearTimeout(ee.current)}),[x,U,u,i]);const se=(e,t)=>{let n=e.content||"";if(e.fileInfo){const t=e.fileInfo.displayName||e.fileInfo.originalName||"File";n="\ud83d\udcce ".concat(t)}if(t&&n.toLowerCase().includes(t.toLowerCase())){const e=new RegExp("(".concat(t,")"),"gi");return n.replace(e,"**$1**")}return n.length>60?n.substring(0,60)+"...":n},oe=e=>{if("group"===e.type)return{name:e.name||"Group Chat",avatar:e.avatar||"\ud83d\udc65",status:e.userLeft?"You left this group":"".concat(e.participants.length," members"),isGroup:!0,isBroadcast:!1,isOnline:!1};if("broadcast"===e.type)return{name:e.name||"Broadcast Channel",avatar:e.avatar||"\ud83d\udce2",status:"".concat(e.participants.length," subscribers"),isGroup:!1,isBroadcast:!0,isOnline:!1};{var t;const n=(e=>{if("direct"!==e.type)return null;const t=e.participants.find(e=>e.user._id!==(null===c||void 0===c?void 0:c._id));return t?t.user:null})(e);if(!n)return{name:"Unknown User",avatar:"\ud83d\udc64",status:"Offline",isGroup:!1,isBroadcast:!1,isOnline:!1};const r=[...g].includes(n._id),a=te(e,c);return{name:n.name,avatar:n.avatar||(null===(t=n.name)||void 0===t?void 0:t.charAt(0).toUpperCase())||"\ud83d\udc64",status:e.userLeft?"You left this group":a.isBlocked?a.blockedByCurrentUser?"Blocked":"Blocked you":r?"Online":n.lastSeen?"Last seen ".concat(Q(n.lastSeen)):"Offline",isGroup:!1,isBroadcast:!1,isOnline:!a.isBlocked&&r}}},ie=e=>{if(!e.lastMessage||!e.lastMessage.sender)return null;if("system"===e.lastMessage.messageType)return null;if("group"===e.type||"broadcast"===e.type){const t=e.participants.find(t=>t.user._id===e.lastMessage.sender._id||t.user._id===e.lastMessage.sender);return t?t.user:"object"===typeof e.lastMessage.sender?e.lastMessage.sender:null}return"object"===typeof e.lastMessage.sender?e.lastMessage.sender:null},le=e=>{if(!e.lastMessage)return"No messages yet";const t=e.lastMessage;if("system"===t.messageType)return t.content||"System message";const n=ae(t);if("group"===e.type||"broadcast"===e.type){const a=ie(e);if(a&&((e,t)=>"system"!==(null===e||void 0===e?void 0:e.messageType)&&("group"===t||"broadcast"===t))(t,e.type)){var r;const e=a._id===(null===c||void 0===c?void 0:c._id)?"You":(null===(r=a.name)||void 0===r?void 0:r.split(" ")[0])||"Someone";return"".concat(e,": ").concat(n)}}return n},ce=[...x.trim()&&T.length>0?[]:u].sort((e,t)=>{const n=new Date(e.updatedAt||e.createdAt||0);return new Date(t.updatedAt||t.createdAt||0)-n}),ue=e=>{p(e),"function"===typeof l&&l(e),"function"===typeof s&&s(e._id)},fe=e=>{if("group"===e.type||"broadcast"===e.type){const t=ne(e,null===c||void 0===c?void 0:c._id);return"main"===t||"admin"===t}return!0},he=u.reduce((e,t)=>te(t,c).isBlocked?e:e+(t.unreadCount||0),0),me=e=>{E(!1),r(e)};return(0,a.useEffect)(()=>{const e=e=>{C&&!e.target.closest(".new-chat-menu")&&E(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[C]),(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)("div",{className:"w-full md:w-80 h-full flex flex-col ".concat(y?"bg-gradient-to-b from-gray-900 to-gray-800":"bg-white"," border-r ").concat(y?"border-gray-800":"border-gray-200"),children:[(0,f.jsxs)("div",{className:"p-4 border-b ".concat(y?"border-gray-800":"border-gray-200"),children:[(0,f.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,f.jsxs)("div",{className:"flex items-center space-x-3 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700/30 p-2 rounded-lg transition-all duration-200",onClick:()=>n(c),children:[(0,f.jsxs)("div",{className:"relative",children:[(0,f.jsx)("div",{className:"w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center",children:(0,f.jsx)("span",{className:"text-white text-lg font-semibold",children:(null===c||void 0===c?void 0:c.avatar)||(null===c||void 0===c||null===(t=c.name)||void 0===t?void 0:t.charAt(0).toUpperCase())||"\ud83d\udc64"})}),he>0&&(0,f.jsx)("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center",children:(0,f.jsx)("span",{className:"text-white text-xs font-bold",children:he>99?"99+":he})})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("h2",{className:"font-semibold ".concat(y?"text-white":"text-gray-900"),children:(null===c||void 0===c?void 0:c.name)||"User"}),(0,f.jsx)("p",{className:"text-sm capitalize ".concat(y?"text-gray-400":"text-gray-500"),children:(null===c||void 0===c?void 0:c.status)||"Online"})]})]}),(0,f.jsxs)("div",{className:"flex space-x-2",children:[(0,f.jsx)("button",{onClick:v,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700/30 ".concat(y?"text-yellow-400":"text-gray-600"),title:y?"Switch to light mode":"Switch to dark mode",children:y?(0,f.jsx)(P,{className:"w-5 h-5"}):(0,f.jsx)(O,{className:"w-5 h-5"})}),(0,f.jsxs)("div",{className:"relative new-chat-menu",children:[(0,f.jsx)("button",{onClick:()=>{E(!C)},className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700/30 transition-colors group",title:"Start new conversation",children:(0,f.jsx)(F,{className:"w-5 h-5 transition-all ".concat(C?"rotate-45":""," group-hover:text-blue-500")})}),C&&(0,f.jsx)("div",{className:"absolute right-0 top-full mt-2 w-52 rounded-lg shadow-lg border z-50 ".concat(y?"bg-gray-700 border-gray-800":"bg-white border-gray-200"),children:(0,f.jsxs)("div",{className:"py-2",children:[(0,f.jsxs)("button",{onClick:()=>me("direct"),className:"w-full px-4 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-700/40 transition-colors flex items-center space-x-3 ".concat(y?"text-white":"text-gray-700"),children:[(0,f.jsx)(q,{className:"w-4 h-4"}),(0,f.jsx)("span",{children:"Direct Message"})]}),(0,f.jsxs)("button",{onClick:()=>me("group"),className:"w-full px-4 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-700/40 transition-colors flex items-center space-x-3 ".concat(y?"text-white":"text-gray-700"),children:[(0,f.jsx)(N,{className:"w-4 h-4"}),(0,f.jsx)("span",{children:"Create Group"})]}),(0,f.jsxs)("button",{onClick:()=>me("broadcast"),className:"w-full px-4 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-700/40 transition-colors flex items-center space-x-3 ".concat(y?"text-white":"text-gray-700"),children:[(0,f.jsx)(B,{className:"w-4 h-4"}),(0,f.jsx)("span",{children:"Broadcast Channel"})]})]})})]}),(0,f.jsx)("button",{onClick:async()=>{try{await b()}catch(e){console.error("Logout failed:",e)}},className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700/30 text-gray-600 dark:text-gray-400",title:"Logout",children:(0,f.jsx)(V,{className:"w-5 h-5"})})]})]}),(0,f.jsxs)("div",{className:"space-y-2",children:[(0,f.jsxs)("div",{className:"relative",children:[(0,f.jsx)(H,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400 dark:text-gray-400"}),(0,f.jsx)("input",{type:"text",placeholder:"Search messages and users...",value:x,onChange:e=>w(e.target.value),className:"w-full pl-10 pr-10 py-2 rounded-lg border focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all ".concat(y?"bg-gray-800/50 border-gray-800 text-white placeholder-gray-400 backdrop-blur-sm":"bg-gray-50 border-gray-300")}),x&&(0,f.jsx)("button",{onClick:()=>{w(""),A([]),J(!1)},className:"absolute right-3 top-1/2 transform -translate-y-1/2 p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-700/40 transition-all duration-200",children:(0,f.jsx)(z,{className:"w-3 h-3"})}),(x||T.length>0)&&(0,f.jsx)("button",{onClick:()=>J(!L),className:"absolute right-8 top-1/2 transform -translate-y-1/2 p-1 rounded transition-colors ".concat(L?"text-blue-500":"text-gray-400 hover:text-gray-600 dark:text-gray-400 dark:hover:text-gray-300"),children:(0,f.jsx)(W,{className:"w-3 h-3"})})]}),L&&(0,f.jsx)("div",{className:"p-3 rounded-lg border ".concat(y?"bg-gray-700/50 border-gray-800 backdrop-blur-sm":"bg-gray-50 border-gray-200"),children:(0,f.jsx)("div",{className:"flex space-x-2 text-xs",children:[{key:"all",label:"All"},{key:"users",label:"Conversations"},{key:"messages",label:"Messages"}].map(e=>(0,f.jsx)("button",{onClick:()=>R(e.key),className:"px-2 py-1 rounded transition-colors ".concat(U===e.key?"bg-blue-500 text-white":y?"bg-gray-600 text-gray-300 hover:bg-gray-500":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:e.label},e.key))})}),!x&&X.length>0&&(0,f.jsxs)("div",{className:"text-xs ".concat(y?"text-gray-400":"text-gray-500"),children:["Recent: ",X.slice(0,3).map((e,t)=>(0,f.jsx)("button",{onClick:()=>w(e),className:"ml-1 px-1 rounded hover:bg-gray-200 dark:hover:bg-gray-700/40",children:e},t))]})]})]}),(0,f.jsxs)("div",{className:"flex-1 overflow-y-auto border-r ".concat(y?"border-gray-800":"border-gray-200"),children:[I&&(0,f.jsxs)("div",{className:"p-4 text-center",children:[(0,f.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500 mx-auto mb-2"}),(0,f.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Searching..."})]}),x&&0===T.length&&!I&&(0,f.jsxs)("div",{className:"p-4 text-center text-gray-500 dark:text-gray-400",children:[(0,f.jsx)(H,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),(0,f.jsx)("p",{children:"No results found"}),(0,f.jsx)("p",{className:"text-xs mt-1",children:"Try different keywords"})]}),x&&T.length>0&&(0,f.jsxs)("div",{className:"p-2",children:[(0,f.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400 px-2 py-1 mb-2",children:[T.length," result",1!==T.length?"s":""," found"]}),T.map((e,t)=>{var n,r,a,o,i,l,c;return(0,f.jsx)("div",{onClick:()=>(e=>{"user"===e.type?ue(e.conversation):"message"===e.type&&(p(e.conversation),w(""),A([]),"function"===typeof s&&s(e.conversation._id),setTimeout(()=>{window.dispatchEvent(new CustomEvent("scrollToMessage",{detail:{messageId:e.message._id}}))},100))})(e),className:"p-3 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700/40 rounded-lg mb-1 transition-colors ".concat((null===h||void 0===h?void 0:h._id)===e.conversation._id?"bg-blue-50 dark:bg-gray-700/50":""),children:(0,f.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,f.jsx)("div",{className:"relative flex-shrink-0",children:"user"===e.type?(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center ".concat("broadcast"===e.conversation.type?"bg-gradient-to-r from-purple-500 to-pink-600":"group"===e.conversation.type?"bg-gradient-to-r from-green-500 to-teal-600":"bg-gradient-to-r from-blue-500 to-purple-600"),children:(0,f.jsx)("span",{className:"text-white text-sm font-semibold",children:e.conversation.avatar||(null===(n=e.conversation.name)||void 0===n?void 0:n.charAt(0).toUpperCase())||(null===(r=e.user)||void 0===r?void 0:r.avatar)||(null===(a=e.user)||void 0===a||null===(o=a.name)||void 0===o?void 0:o.charAt(0).toUpperCase())||"\ud83d\udc64"})}),e.isOnline&&"direct"===e.conversation.type&&(0,f.jsx)("div",{className:"absolute -bottom-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-white dark:border-gray-800"})]}):(0,f.jsx)("div",{className:"w-8 h-8 bg-green-100 dark:bg-green-900 rounded-full flex items-center justify-center mt-1",children:(0,f.jsx)(D,{className:"w-4 h-4 text-green-600 dark:text-green-400"})})}),(0,f.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,f.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,f.jsx)("span",{className:"text-xs font-medium px-2 py-1 rounded-full ".concat("user"===e.type?"broadcast"===e.conversation.type?"bg-purple-100 dark:bg-purple-900 text-purple-600 dark:text-purple-400":"group"===e.conversation.type?"bg-green-100 dark:bg-green-900 text-green-600 dark:text-green-400":"bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-400":"bg-green-100 dark:bg-green-900 text-green-600 dark:text-green-400"),children:"user"===e.type?"broadcast"===e.conversation.type?"Channel":"group"===e.conversation.type?"Group":"User":"Message"}),"user"===e.type&&e.isOnline&&"direct"===e.conversation.type&&(0,f.jsx)("span",{className:"text-xs text-green-500 font-medium",children:"Online"})]}),"user"===e.type?(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("h4",{className:"font-medium text-sm ".concat(y?"text-white":"text-gray-900"," truncate"),title:e.conversation.name||(null===(i=e.user)||void 0===i?void 0:i.name)||"Unknown",children:(t=>{const n=e.conversation.name||(null===(t=e.user)||void 0===t?void 0:t.name)||"Unknown";return n.length>20?"".concat(n.substring(0,20),"..."):n})()}),"direct"===e.conversation.type&&(null===(l=e.user)||void 0===l?void 0:l.email)&&(0,f.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:e.user.email}),(0,f.jsxs)("p",{className:"text-xs text-gray-600 dark:text-gray-300 mt-1",children:["Latest: ",e.preview]})]}):(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,f.jsx)("h4",{className:"font-medium text-sm ".concat(y?"text-white":"text-gray-900"," truncate"),title:(null===(c=e.user)||void 0===c?void 0:c.name)||"Unknown User",children:(t=>{const n=(null===(t=e.user)||void 0===t?void 0:t.name)||"Unknown User";return n.length>20?"".concat(n.substring(0,20),"..."):n})()}),(0,f.jsx)("span",{className:"text-xs text-gray-400 dark:text-gray-400",children:"in"}),(0,f.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",title:oe(e.conversation).name,children:(()=>{const t=oe(e.conversation).name;return t.length>20?"".concat(t.substring(0,20),"..."):t})()})]}),(0,f.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:[(0,f.jsx)(K,{className:"w-3 h-3 inline mr-1"}),Q(e.message.createdAt)]}),(0,f.jsx)("p",{className:"text-sm text-gray-700 dark:text-gray-200",children:e.preview.split("**").map((e,t)=>t%2===1?(0,f.jsx)("mark",{className:"bg-yellow-200 dark:bg-yellow-600 px-1 rounded",children:e},t):e)})]})]})]})},"".concat(e.type,"-").concat(t))})]}),!x&&0===ce.length&&(0,f.jsxs)("div",{className:"p-4 text-center text-gray-500 dark:text-gray-400",children:[(0,f.jsx)(D,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),(0,f.jsx)("p",{children:"No conversations yet"}),(0,f.jsx)("p",{className:"text-sm mt-1",children:"Start a new conversation to get started!"})]}),!x&&ce.map(e=>{var t;const n=oe(e),r=(ie(e),e.unreadCount||0),a=(null===h||void 0===h?void 0:h._id)===e._id,s=le(e),o=te(e,c);return(0,f.jsx)("div",{onClick:()=>ue(e),className:"p-4 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700/20 border-b ".concat(y?"border-gray-800/50":"border-gray-100"," transition-all duration-200 group ").concat(a?"bg-blue-50 dark:bg-blue-900/20 border-r-4 border-r-blue-500":""),children:(0,f.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,f.jsxs)("div",{className:"relative",children:[(0,f.jsx)("div",{className:"w-12 h-12 rounded-full flex items-center justify-center ".concat(n.isBroadcast?"bg-gradient-to-r from-purple-500 to-pink-600":n.isGroup?"bg-gradient-to-r from-green-500 to-teal-600":"bg-gradient-to-r from-blue-500 to-purple-600"),children:(0,f.jsx)("span",{className:"text-white text-lg font-semibold",children:n.avatar})}),"direct"===e.type&&o.isBlocked?(0,f.jsx)("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 bg-red-500 rounded-full border-2 border-white dark:border-gray-800 flex items-center justify-center",children:(0,f.jsx)(G,{className:"w-2.5 h-2.5 text-white"})}):"direct"===e.type&&n.isOnline?(0,f.jsx)("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 rounded-full border-2 border-white dark:border-gray-800"}):null,r>0&&!o.isBlocked&&(0,f.jsx)("div",{className:"absolute -top-2 -right-2 min-w-5 h-5 bg-red-500 rounded-full flex items-center justify-center px-1",children:(0,f.jsx)("span",{className:"text-white text-xs font-bold",children:r>99?"99+":r})})]}),(0,f.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,f.jsxs)("div",{className:"flex items-start justify-between",children:[(0,f.jsxs)("h3",{className:"font-semibold flex items-center space-x-1 flex-1 min-w-0 ".concat(y?"text-white":"text-gray-900"),children:[(0,f.jsx)("span",{className:"".concat(y?"text-white":"text-gray-900"," truncate min-w-0"),title:n.name,children:n.name&&n.name.length>20?"".concat(n.name.substring(0,20),"..."):n.name}),("group"===e.type||"broadcast"===e.type)&&(()=>{const t=ne(e,null===c||void 0===c?void 0:c._id);return"main"===t?(0,f.jsx)($,{className:"w-3 h-3 text-yellow-500 fill-current flex-shrink-0",title:"You are the main administrator"}):"admin"===t?(0,f.jsx)($,{className:"w-3 h-3 text-yellow-400 flex-shrink-0",title:"You are an administrator",fill:"none",stroke:"currentColor"}):null})()]}),(null===(t=e.lastMessage)||void 0===t?void 0:t.timestamp)&&(0,f.jsx)("span",{className:"text-xs flex-shrink-0 ml-2 ".concat(r>0&&!o.isBlocked?"text-blue-500 dark:text-blue-400 font-medium":"text-gray-500 dark:text-gray-400"),children:Q(e.lastMessage.timestamp)}),fe(e)&&(0,f.jsx)("button",{onClick:t=>((e,t)=>{e.stopPropagation(),_(t),S(!0)})(t,e),className:"opacity-0 group-hover:opacity-100 p-1 rounded hover:bg-red-100 dark:hover:bg-red-900/50 text-red-500 hover:text-red-700 transition-all duration-200 flex-shrink-0 ml-1",title:"Delete ".concat(n.isBroadcast?"channel":n.isGroup?"group":"conversation"),children:(0,f.jsx)(Y,{className:"w-3 h-3"})})]}),(0,f.jsx)("div",{className:"flex items-center justify-between",children:(0,f.jsx)("p",{className:"text-sm truncate ".concat(r>0&&!o.isBlocked?"text-gray-700 dark:text-gray-200 font-medium":"text-gray-500 dark:text-gray-400"),children:e.lastMessage?(0,f.jsx)(f.Fragment,{children:(0,f.jsx)("span",{className:"ml-1",title:s,children:s})}):(0,f.jsx)("span",{className:"italic",children:n.isBroadcast?"No announcements yet":"No messages yet"})})}),(0,f.jsx)("div",{className:"flex items-center justify-between mt-1",children:(0,f.jsx)("p",{className:"text-xs text-gray-400 dark:text-gray-400",children:n.status})})]})]})},e._id)})]}),he>0&&(0,f.jsx)("div",{className:"p-3 border-t ".concat(y?"border-gray-800/50":"border-gray-200"," border-r ").concat(y?"bg-gray-800/50 backdrop-blur-sm border-gray-800":"bg-gray-50 border-gray-200"),children:(0,f.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,f.jsx)("div",{className:"w-2 h-2 bg-red-500 rounded-full animate-pulse"}),(0,f.jsxs)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[he," unread message",he>1?"s":""]})]})})]}),k&&j&&(0,f.jsx)(de,{isDark:y,onConfirm:async()=>{if(j)try{await o(j._id),S(!1),_(null)}catch(e){console.error("Failed to delete conversation:",e),alert("Failed to delete conversation. Please try again.")}},onCancel:()=>{S(!1),_(null)},type:"conversation",conversationName:oe(j).name,conversationType:j.type})]})},he=S("pen-line",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]),me=S("user-round",[["circle",{cx:"12",cy:"8",r:"5",key:"1hypcn"}],["path",{d:"M20 21a8 8 0 0 0-16 0",key:"rfgkzh"}]]),pe=S("user-minus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),ge=S("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]),ye=S("settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),ve=S("eraser",[["path",{d:"M21 21H8a2 2 0 0 1-1.42-.587l-3.994-3.999a2 2 0 0 1 0-2.828l10-10a2 2 0 0 1 2.829 0l5.999 6a2 2 0 0 1 0 2.828L12.834 21",key:"g5wo59"}],["path",{d:"m5.082 11.09 8.828 8.828",key:"1wx5vj"}]]),be={async searchByEmail(e){const t=await d.default.authenticatedRequest("".concat(i.A.ENDPOINTS.USERS.SEARCH,"?email=").concat(encodeURIComponent(e)));return await t.json()},async getAllUsers(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const r=new URLSearchParams((0,o.A)({page:e.toString(),limit:t.toString()},n&&{search:n})),a=await d.default.authenticatedRequest("".concat(i.A.ENDPOINTS.USERS.LIST,"?").concat(r));return await a.json()},async getUserProfile(e){const t=await d.default.authenticatedRequest(i.A.ENDPOINTS.USERS.GET_PROFILE(e));return await t.json()},async getMyProfile(){const e=await d.default.authenticatedRequest(i.A.ENDPOINTS.USERS.GET_PROFILE("me"));return await e.json()},async updateProfile(e){try{const t=await d.default.authenticatedRequest(i.A.ENDPOINTS.USERS.UPDATE_PROFILE,{method:"PUT",body:JSON.stringify(e)});return await t.json()}catch(a){var t;if(400===(null===(t=a.response)||void 0===t?void 0:t.status)){var n,r;const e=(null===(n=a.response.data)||void 0===n?void 0:n.message)||"Invalid profile data",t=(null===(r=a.response.data)||void 0===r?void 0:r.errors)||[];throw new Error(t.length>0?t.map(e=>e.msg).join(", "):e)}throw a}},async updateProfileFields(e){const t=Object.entries(e).reduce((e,t)=>{let[n,r]=t;return void 0!==r&&null!==r&&""!==r&&(e[n]=r),e},{});return this.updateProfile(t)},async updateAvatar(e){const t=await d.default.authenticatedRequest(i.A.ENDPOINTS.USERS.UPDATE_AVATAR||"".concat(i.A.ENDPOINTS.USERS.UPDATE_PROFILE,"/avatar"),{method:"PUT",body:JSON.stringify(e)});return await t.json()},async getOnlineUsers(){const e=await d.default.authenticatedRequest(i.A.ENDPOINTS.USERS.ONLINE_STATUS||"/users/online");return await e.json()},async updateStatus(e){try{const t=await d.default.authenticatedRequest(i.A.ENDPOINTS.USERS.UPDATE_STATUS,{method:"PUT",body:JSON.stringify({status:e})});return await t.json()}catch(r){var t,n;if(400===(null===(t=r.response)||void 0===t?void 0:t.status))throw new Error((null===(n=r.response.data)||void 0===n?void 0:n.message)||"Invalid status value");throw r}},async createConversation(e){try{const t=await d.default.authenticatedRequest(i.A.ENDPOINTS.USERS.CREATE_CONVERSATION(e),{method:"POST"});return await t.json()}catch(a){var t,n,r;if(404===(null===(t=a.response)||void 0===t?void 0:t.status))throw new Error("User not found");if(400===(null===(n=a.response)||void 0===n?void 0:n.status))throw new Error((null===(r=a.response.data)||void 0===r?void 0:r.message)||"Cannot create conversation");throw a}},async getMutualConversations(e){const t=await d.default.authenticatedRequest(i.A.ENDPOINTS.USERS.MUTUAL_CONVERSATIONS(e));return await t.json()},async getContacts(){const e=await d.default.authenticatedRequest(i.A.ENDPOINTS.USERS.CONTACTS);return await e.json()},async blockUser(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];try{const n=await d.default.authenticatedRequest(i.A.ENDPOINTS.USERS.BLOCK_USER(e),{method:"PUT",body:JSON.stringify({blocked:t})});return await n.json()}catch(s){var n,r,a;if(404===(null===(n=s.response)||void 0===n?void 0:n.status))throw new Error("User not found");if(400===(null===(r=s.response)||void 0===r?void 0:r.status))throw new Error((null===(a=s.response.data)||void 0===a?void 0:a.message)||"Cannot block/unblock user");throw s}},async unblockUser(e){return this.blockUser(e,!1)},async searchUsers(e){const t=new URLSearchParams({q:e,limit:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:10).toString()}),n=await d.default.authenticatedRequest("".concat(i.A.ENDPOINTS.USERS.SEARCH,"?").concat(t));return await n.json()},async advancedSearch(e){const{query:t,status:n,page:r=1,limit:a=20}=e,s=new URLSearchParams((0,o.A)((0,o.A)({page:r.toString(),limit:a.toString()},t&&{search:t}),n&&{status:n})),l=await d.default.authenticatedRequest("".concat(i.A.ENDPOINTS.USERS.LIST,"?").concat(s));return await l.json()},async getBlockedUsers(){const e=await d.default.authenticatedRequest(i.A.ENDPOINTS.USERS.BLOCKED_USERS||"".concat(i.A.ENDPOINTS.USERS.CONTACTS,"/blocked"));return await e.json()},validateProfileData(e){const t=[];if(void 0!==e.name&&(e.name&&0!==e.name.trim().length?e.name.length>50&&t.push("Name must not exceed 50 characters"):t.push("Name is required")),void 0!==e.email){const n=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;e.email&&n.test(e.email)||t.push("Please enter a valid email address")}if(void 0!==e.bio&&e.bio.length>500&&t.push("Bio must not exceed 500 characters"),void 0!==e.phone&&e.phone){/^[\+]?[1-9][\d]{0,15}$/.test(e.phone)||t.push("Please enter a valid phone number")}if(void 0!==e.status){["online","away","offline","busy"].includes(e.status)||t.push("Status must be online, away, offline, or busy")}return{isValid:0===t.length,errors:t}},async updateProfileWithValidation(e){const t=this.validateProfileData(e);if(!t.isValid)throw new Error(t.errors.join(", "));return this.updateProfile(e)},async refreshUserData(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"me";return this.getUserProfile(e)},async checkEmailAvailability(e){try{const t=await d.default.authenticatedRequest("".concat(i.A.ENDPOINTS.USERS.CHECK_EMAIL||"".concat(i.A.ENDPOINTS.USERS.LIST,"/check-email"),"?email=").concat(encodeURIComponent(e)));return await t.json()}catch(n){var t;if(409===(null===(t=n.response)||void 0===t?void 0:t.status))return{available:!1,message:"Email is already in use"};throw n}},async uploadProfilePicture(e){try{const t=new FormData;t.append("avatar",e);const n=d.default.getCurrentSession(),r=await fetch("".concat(i.A.ENDPOINTS.USERS.UPLOAD_AVATAR||"/users/me/avatar"),{method:"POST",headers:{Authorization:"Bearer ".concat(n.accessToken)},body:t});if(!r.ok)throw new Error("Upload failed");return await r.json()}catch(t){throw console.error("Profile picture upload failed:",t),t}},async getUserStats(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"me";const t=await d.default.authenticatedRequest("".concat(i.A.ENDPOINTS.USERS.STATS||"/users/".concat(e,"/stats")));return await t.json()},async getUserActivity(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"me",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30;const n=await d.default.authenticatedRequest("".concat(i.A.ENDPOINTS.USERS.ACTIVITY||"/users/".concat(e,"/activity"),"?days=").concat(t));return await n.json()},async reportUser(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";try{const r=await d.default.authenticatedRequest(i.A.ENDPOINTS.USERS.REPORT_USER(e),{method:"POST",body:JSON.stringify({reason:t,description:n})});return await r.json()}catch(r){throw console.error("Report user failed:",r),r}},async getUserPreferences(){const e=await d.default.authenticatedRequest(i.A.ENDPOINTS.USERS.PREFERENCES||"/users/me/preferences");return await e.json()},async updateUserPreferences(e){try{const t=await d.default.authenticatedRequest(i.A.ENDPOINTS.USERS.PREFERENCES||"/users/me/preferences",{method:"PUT",body:JSON.stringify(e)});return await t.json()}catch(t){throw console.error("Update preferences failed:",t),t}},async deleteAccount(e){try{const t=await d.default.authenticatedRequest(i.A.ENDPOINTS.USERS.DELETE_ACCOUNT||"/users/me/delete",{method:"DELETE",body:JSON.stringify({password:e})}),n=await t.json();return n.success&&d.default.logoutAll(),n}catch(t){throw console.error("Delete account failed:",t),t}},async getUserSessions(){const e=await d.default.authenticatedRequest(i.A.ENDPOINTS.USERS.SESSIONS||"/users/me/sessions");return await e.json()},async revokeSession(e){try{const t=await d.default.authenticatedRequest("".concat(i.A.ENDPOINTS.USERS.SESSIONS||"/users/me/sessions","/").concat(e),{method:"DELETE"});return await t.json()}catch(t){throw console.error("Revoke session failed:",t),t}},async batchUpdateUsers(e){try{const t=await d.default.authenticatedRequest(i.A.ENDPOINTS.USERS.BATCH_UPDATE||"/users/batch",{method:"PUT",body:JSON.stringify({updates:e})});return await t.json()}catch(t){throw console.error("Batch update failed:",t),t}},async exportUserData(){try{const e=await d.default.authenticatedRequest(i.A.ENDPOINTS.USERS.EXPORT_DATA||"/users/me/export");if(e.ok){const t=await e.blob(),n=window.URL.createObjectURL(t),r=document.createElement("a");return r.href=n,r.download="user-data.json",document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(n),{success:!0,message:"Data exported successfully"}}throw new Error("Export failed")}catch(e){throw console.error("Export user data failed:",e),e}}},xe=e=>{let{isOpen:t,onConfirm:n,onCancel:r,title:a,message:s,confirmText:o="Confirm",cancelText:i="Cancel",type:l="default",isDark:c}=e;if(!t)return null;const u=(()=>{switch(l){case"danger":return{iconBg:"bg-red-100 dark:bg-red-900/50",iconColor:"text-red-600 dark:text-red-400",confirmButton:"bg-red-600 hover:bg-red-700 text-white"};case"warning":return{iconBg:"bg-yellow-100 dark:bg-yellow-900/50",iconColor:"text-yellow-600 dark:text-yellow-400",confirmButton:"bg-yellow-600 hover:bg-yellow-700 text-white"};default:return{iconBg:"bg-blue-100 dark:bg-blue-900/50",iconColor:"text-blue-600 dark:text-blue-400",confirmButton:"bg-blue-600 hover:bg-blue-700 text-white"}}})();return(0,f.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[60] p-4",onClick:r,children:(0,f.jsx)("div",{className:"max-w-md w-full rounded-lg shadow-xl backdrop-blur-md ".concat(c?"bg-gray-800/90 text-white":"bg-white"),onClick:e=>e.stopPropagation(),children:(0,f.jsxs)("div",{className:"p-6",children:[(0,f.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,f.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center ".concat(u.iconBg),children:(0,f.jsx)(ue,{className:"w-5 h-5 ".concat(u.iconColor)})}),(0,f.jsx)("h3",{className:"text-lg font-semibold",children:a})]}),(0,f.jsx)("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:s}),(0,f.jsxs)("div",{className:"flex space-x-3 justify-end",children:[(0,f.jsx)("button",{onClick:r,className:"px-4 py-2 rounded-lg border transition-colors ".concat(c?"border-gray-600 hover:bg-gray-700/30 backdrop-blur-sm text-gray-300":"border-gray-300 hover:bg-gray-50 text-gray-700"),children:i}),(0,f.jsx)("button",{onClick:n,className:"px-4 py-2 rounded-lg transition-colors ".concat(u.confirmButton),children:o})]})]})})})},we=e=>{var t,n;let{conversation:r,currentUser:s,isAdmin:i,isDark:l,onClose:c,onUpdateConversation:u,onDeleteConversation:d,onAddParticipant:h,onRemoveParticipant:m,onAddAdmin:p,onRemoveAdmin:g,onClearChat:y,onHideChat:v,onDeleteChat:b}=e;const[x,w]=(0,a.useState)("info"),[k,S]=(0,a.useState)(!1),[j,_]=(0,a.useState)({name:r.name||"",description:r.description||"",avatar:r.avatar||""}),[C,E]=(0,a.useState)({isOpen:!1,title:"",message:"",onConfirm:()=>{},type:"default",confirmText:"Confirm",cancelText:"Cancel"}),[T,A]=(0,a.useState)(!1),[P,O]=(0,a.useState)(""),[U,R]=(0,a.useState)([]),[I,M]=(0,a.useState)(!1);(0,a.useEffect)(()=>{var e;console.log("\ud83d\udd0d Conversation data format check:",{admin:r.admin,adminType:typeof r.admin,admins:r.admins,adminsTypes:null===(e=r.admins)||void 0===e?void 0:e.map(e=>({admin:e,type:typeof e,hasId:null!==e&&void 0!==e&&e._id?"yes":"no"}))})},[r.admin,r.admins]);const L=r.admin===s._id||r.admin.id===s._id,D="broadcast"===r.type,V=e=>{E((0,o.A)({isOpen:!0},e))},W=()=>{E({isOpen:!1,title:"",message:"",onConfirm:()=>{},type:"default",confirmText:"Confirm",cancelText:"Cancel"})},G=e=>{var t;if(!e||!r)return!1;if(("string"===typeof r.admin?r.admin:null===(t=r.admin)||void 0===t?void 0:t._id)===e)return"main";if(r.admins&&Array.isArray(r.admins)){if(r.admins.some(t=>("string"===typeof t?t:null===t||void 0===t?void 0:t._id)===e))return"admin"}return!1},J=async e=>{var t;const n=null===(t=r.participants)||void 0===t?void 0:t.find(t=>{var n;return(null===(n=t.user)||void 0===n?void 0:n._id)===e});if(!n)return;const a=G(e);L?"admin"===a?V({title:"Remove Admin Privileges",message:"Are you sure you want to remove admin privileges from ".concat(n.user.name,"? They will become a regular ").concat(D?"subscriber":"member","."),confirmText:"Remove Admin",cancelText:"Cancel",type:"warning",onConfirm:async()=>{try{await g(r._id,e)}catch(t){console.error("Failed to remove admin:",t)}W()}}):!1===a&&V({title:"Promote to Administrator",message:"Are you sure you want to promote ".concat(n.user.name," to administrator? They will be able to manage ").concat(D?"subscribers":"members"," and ").concat(D?"channel":"group"," settings."),confirmText:"Make Admin",cancelText:"Cancel",type:"default",onConfirm:async()=>{try{await p(r._id,e)}catch(t){console.error("Failed to add admin:",t)}W()}}):V({title:"Permission Denied",message:"Only the main administrator can manage admin privileges.",confirmText:"OK",type:"warning",onConfirm:W})};(0,a.useEffect)(()=>{const e=setTimeout(()=>{T&&(async e=>{if(!e.trim()||e.length<2)R([]);else{M(!0);try{const t=await be.searchByEmail(e);if(t.success&&t.users){const e=t.users.filter(e=>!r.participants.some(t=>t.user._id===e._id));R(e)}else R([])}catch(t){console.error("Search error:",t),R([])}finally{M(!1)}}})(P)},300);return()=>clearTimeout(e)},[P,T]),(0,a.useEffect)(()=>{_({name:r.name||"",description:r.description||"",avatar:r.avatar||""})},[r]);const X=e=>{const t=G(e.user._id);return"main"==t?"Main Admin":"admin"==t?"Admin":D?"Subscriber":"Member"},Z=e=>{const t=G(e.user._id);return"main"===t?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200":"admin"===t?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":"bg-gray-100 text-gray-800 dark:bg-gray-700/50 backdrop-blur-sm dark:text-gray-200"},ee=[...r.participants].sort((e,t)=>{var n,r;const a=G(null===(n=e.user)||void 0===n?void 0:n._id),s=G(null===(r=t.user)||void 0===r?void 0:r._id);return"main"===a?-1:"main"===s?1:"admin"===a&&!1===s?-1:"admin"===s&&!1===a?1:e.user.name.localeCompare(t.user.name)});return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:(0,f.jsxs)("div",{className:"w-full max-w-2xl max-h-[90vh] overflow-hidden rounded-2xl shadow-2xl backdrop-blur-md ".concat(l?"bg-gray-800/90 text-white":"bg-white"),children:[console.log("ChatInfo",r),console.log("parts",r.participants),(0,f.jsxs)("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:[(0,f.jsxs)("div",{className:"flex items-center justify-between",children:[(0,f.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,f.jsx)("div",{className:"w-16 h-16 rounded-full flex items-center justify-center text-2xl ".concat(D?"bg-gradient-to-r from-purple-500 to-pink-600":"bg-gradient-to-r from-green-500 to-teal-600"),children:j.avatar||r.avatar}),(0,f.jsxs)("div",{children:[k?(0,f.jsx)("input",{type:"text",value:j.name,onChange:e=>_((0,o.A)((0,o.A)({},j),{},{name:e.target.value})),className:"text-xl font-bold bg-transparent border-b-2 border-blue-500 focus:outline-none ".concat(l?"text-white":"text-gray-900"),placeholder:"Enter name"}):(0,f.jsxs)("h2",{className:"text-xl font-bold flex items-center space-x-2",children:[(0,f.jsx)("span",{children:r.name}),D?(0,f.jsx)(B,{className:"w-5 h-5 text-purple-500"}):(0,f.jsx)(N,{className:"w-5 h-5 text-green-500"}),i&&(0,f.jsx)($,{className:"w-4 h-4 text-yellow-500",title:L?"Main Admin":"Admin"})]}),(0,f.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[r.participants.length," ",D?"subscribers":"members",r.admins&&r.admins.length>0&&(0,f.jsxs)("span",{className:"ml-2",children:["\u2022 ",1+r.admins.length," admin",r.admins.length>0?"s":""]})]})]})]}),(0,f.jsxs)("div",{className:"flex items-center space-x-2",children:[i&&(0,f.jsx)("button",{onClick:()=>S(!k),className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700/30 backdrop-blur-sm transition-colors",title:"Edit conversation",children:(0,f.jsx)(he,{className:"w-5 h-5"})}),(0,f.jsx)("button",{onClick:c,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700/50 backdrop-blur-sm transition-colors",children:(0,f.jsx)(z,{className:"w-5 h-5"})})]})]}),k&&(0,f.jsxs)("div",{className:"mt-4 space-y-3",children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Description"}),(0,f.jsx)("textarea",{value:j.description,onChange:e=>_((0,o.A)((0,o.A)({},j),{},{description:e.target.value})),className:"w-full p-2 rounded-lg border resize-none ".concat(l?"bg-gray-700/50 backdrop-blur-sm border-gray-600 text-white":"bg-gray-50 border-gray-300"),rows:2,placeholder:"Enter description"})]}),(0,f.jsxs)("div",{className:"flex space-x-2",children:[(0,f.jsx)("button",{onClick:async()=>{try{await u(r._id,j),S(!1)}catch(e){console.error("Failed to update conversation:",e)}},className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:"Save Changes"}),(0,f.jsx)("button",{onClick:()=>{S(!1),_({name:r.name||"",description:r.description||"",avatar:r.avatar||""})},className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors",children:"Cancel"})]})]})]}),(0,f.jsxs)("div",{className:"flex border-b border-gray-200 dark:border-gray-700",children:[(0,f.jsx)("button",{onClick:()=>w("info"),className:"flex-1 px-4 py-3 text-sm font-medium transition-colors ".concat("info"===x?"border-b-2 border-blue-500 text-blue-500":"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"),children:"Info"}),(0,f.jsxs)("button",{onClick:()=>w("members"),className:"flex-1 px-4 py-3 text-sm font-medium transition-colors ".concat("members"===x?"border-b-2 border-blue-500 text-blue-500":"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"),children:[D?"Subscribers":"Members"," (",r.participants.length,")"]}),i&&(0,f.jsx)("button",{onClick:()=>w("settings"),className:"flex-1 px-4 py-3 text-sm font-medium transition-colors ".concat("settings"===x?"border-b-2 border-blue-500 text-blue-500":"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"),children:"Admin Panel"})]}),(0,f.jsxs)("div",{className:"p-6 max-h-96 overflow-y-auto",children:["info"===x&&(0,f.jsxs)("div",{className:"space-y-4",children:[r.description&&(0,f.jsxs)("div",{children:[(0,f.jsx)("h3",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Description"}),(0,f.jsx)("p",{className:"text-gray-600 dark:text-gray-300",children:r.description})]}),(0,f.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,f.jsxs)("div",{className:"p-3 rounded-lg ".concat(l?"bg-gray-700/50 backdrop-blur-sm":"bg-gray-50"),children:[(0,f.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,f.jsx)(K,{className:"w-4 h-4 text-gray-500 dark:text-gray-400"}),(0,f.jsx)("span",{className:"text-sm font-medium",children:"Created"})]}),(0,f.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:Q(r.createdAt)})]}),(0,f.jsxs)("div",{className:"p-3 rounded-lg ".concat(l?"bg-gray-700/50 backdrop-blur-sm":"bg-gray-50"),children:[(0,f.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,f.jsx)(me,{className:"w-4 h-4 text-gray-500 dark:text-gray-400"}),(0,f.jsx)("span",{className:"text-sm font-medium",children:"Type"})]}),(0,f.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:r.type})]})]})]}),"members"===x&&(0,f.jsxs)("div",{className:"space-y-3",children:[ee.map(e=>{var t;const n=e.user._id===s._id,a=G(e.user._id),o="main"===a,l="admin"===a;return(0,f.jsxs)("div",{className:"flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700/30 backdrop-blur-sm transition-colors",children:[(0,f.jsxs)("div",{className:"w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-semibold relative",children:[e.user.avatar||(null===(t=e.user.name)||void 0===t?void 0:t.charAt(0).toUpperCase())||"?",i&&(0,f.jsx)("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 bg-yellow-500 rounded-full flex items-center justify-center border border-white",children:(0,f.jsx)($,{className:"w-2 h-2 text-white"})})]}),(0,f.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,f.jsxs)("p",{className:"font-medium truncate",children:[e.user.name," ",n&&"(You)"]}),(0,f.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,f.jsx)("span",{className:"text-xs px-2 py-1 rounded-full ".concat(Z(e)),children:X(e)}),o&&(0,f.jsx)($,{className:"w-3 h-3 text-yellow-500"}),l&&!o&&(0,f.jsx)($,{className:"w-3 h-3 text-blue-500"})]})]}),i&&!n&&(0,f.jsxs)("div",{className:"flex items-center space-x-1",children:[!o&&(0,f.jsx)("button",{onClick:()=>J(e.user._id),className:"p-2 rounded-lg transition-colors ".concat(l?"text-yellow-500 hover:bg-yellow-100 dark:hover:bg-yellow-900":"text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700/30 backdrop-blur-sm"),title:l?"Remove admin privileges":"Make admin",children:(0,f.jsx)($,{className:"w-4 h-4"})}),!o&&(0,f.jsx)("button",{onClick:()=>(async e=>{var t;const n=null===(t=r.participants)||void 0===t?void 0:t.find(t=>{var n;return(null===(n=t.user)||void 0===n?void 0:n._id)===e});if(!n)return;const a=G(e);V("main"!==a?"admin"!==a?{title:"Remove Participant",message:"Are you sure you want to remove ".concat(n.user.name," from the ").concat(D?"channel":"group","?"),confirmText:"Remove",cancelText:"Cancel",type:"danger",onConfirm:async()=>{try{await m(r._id,e)}catch(t){console.error("Failed to remove participant:",t)}W()}}:{title:"Remove Administrator",message:"".concat(n.user.name," is an administrator. They must be demoted to a regular member before removal. Do you want to demote them first?"),confirmText:"Demote First",cancelText:"Cancel",type:"warning",onConfirm:async()=>{try{await g(r._id,e),W(),setTimeout(()=>{V({title:"Remove Participant",message:"Admin privileges have been removed from ".concat(n.user.name,". Do you want to remove them from the ").concat(D?"channel":"group","?"),confirmText:"Remove",cancelText:"Keep as Member",type:"danger",onConfirm:async()=>{try{await m(r._id,e)}catch(t){console.error("Failed to remove participant:",t)}W()}})},500)}catch(t){console.error("Failed to demote admin:",t),W()}}}:{title:"Cannot Remove Main Administrator",message:"The main administrator cannot be removed from the group.",confirmText:"OK",type:"warning",onConfirm:W})})(e.user._id),className:"p-2 rounded-lg text-red-500 hover:bg-red-100 dark:hover:bg-red-900 transition-colors",title:"Remove from ".concat(D?"channel":"group"),children:(0,f.jsx)(pe,{className:"w-4 h-4"})})]})]},e.user._id)}),i&&(0,f.jsx)("div",{className:"border-t pt-3 mt-3",children:T?(0,f.jsxs)("div",{className:"space-y-3",children:[(0,f.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,f.jsxs)("div",{className:"relative flex-1",children:[(0,f.jsx)(H,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400 dark:text-gray-500"}),(0,f.jsx)("input",{type:"email",placeholder:"Search by email...",value:P,onChange:e=>O(e.target.value),className:"w-full pl-10 pr-4 py-2 rounded-lg border ".concat(l?"bg-gray-700/50 backdrop-blur-sm border-gray-600 text-white placeholder-gray-400":"bg-gray-50 border-gray-300")}),I&&(0,f.jsx)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:(0,f.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500"})})]}),(0,f.jsx)("button",{onClick:()=>{A(!1),O(""),R([])},className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700/30 backdrop-blur-sm transition-colors",children:(0,f.jsx)(z,{className:"w-4 h-4"})})]}),U.length>0&&(0,f.jsx)("div",{className:"max-h-32 overflow-y-auto space-y-2 border rounded-lg p-2",children:U.map(e=>{var t;return(0,f.jsxs)("div",{onClick:()=>(async e=>{V({title:"Add ".concat(D?"Subscriber":"Member"),message:"Are you sure you want to add ".concat(e.name," to the ").concat(D?"channel":"group","?"),confirmText:"Add",cancelText:"Cancel",type:"default",onConfirm:async()=>{try{await h(r._id,e._id),O(""),R([]),A(!1)}catch(t){console.error("Failed to add participant:",t)}W()}})})(e),className:"flex items-center space-x-3 p-2 rounded-lg cursor-pointer transition-all hover:bg-gray-100 dark:hover:bg-gray-700/40",children:[(0,f.jsx)("div",{className:"w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white text-sm font-semibold",children:e.avatar||(null===(t=e.name)||void 0===t?void 0:t.charAt(0).toUpperCase())||"?"}),(0,f.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,f.jsx)("p",{className:"font-medium text-sm truncate",children:e.name}),(0,f.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:e.email})]}),(0,f.jsx)(F,{className:"w-4 h-4 text-green-500"})]},e._id)})})]}):(0,f.jsxs)("button",{onClick:()=>A(!0),className:"w-full p-3 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg hover:border-blue-500 dark:hover:border-blue-400 transition-colors flex items-center justify-center space-x-2 text-gray-500 dark:text-gray-400 hover:text-blue-500",children:[(0,f.jsx)(q,{className:"w-4 h-4"}),(0,f.jsxs)("span",{children:["Add ",D?"Subscriber":"Member"]})]})})]}),"settings"===x&&i&&(0,f.jsxs)("div",{className:"space-y-6",children:[(0,f.jsxs)("div",{className:"p-4 rounded-lg border ".concat(D?"border-purple-200 bg-purple-50 dark:border-purple-700 dark:bg-purple-900/20":"border-blue-200 bg-blue-50 dark:border-blue-700 dark:bg-blue-900/20"),children:[(0,f.jsxs)("h3",{className:"font-medium mb-3 flex items-center space-x-2",children:[(0,f.jsx)($,{className:"w-5 h-5 text-yellow-500"}),(0,f.jsx)("span",{children:"Admin Panel"})]}),(0,f.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[(0,f.jsxs)("div",{className:"text-center",children:[(0,f.jsx)("div",{className:"text-2xl font-bold text-yellow-600",children:1+((null===(t=r.admins)||void 0===t?void 0:t.length)||0)}),(0,f.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Total Admins"})]}),(0,f.jsxs)("div",{className:"text-center",children:[(0,f.jsx)("div",{className:"text-2xl font-bold text-green-600",children:r.participants.length-1-((null===(n=r.admins)||void 0===n?void 0:n.length)||0)}),(0,f.jsxs)("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:["Regular ",D?"Subscribers":"Members"]})]})]}),(0,f.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:D?"As an admin, you can send messages, manage subscribers, and control channel settings.":"As an admin, you can manage members, add other admins, and control group settings."}),L&&(0,f.jsxs)("div",{className:"mt-3 p-3 bg-yellow-100 dark:bg-yellow-900/30 rounded-lg",children:[(0,f.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-yellow-800 dark:text-yellow-200",children:[(0,f.jsx)($,{className:"w-4 h-4"}),(0,f.jsx)("span",{className:"font-medium",children:"You are the main administrator"})]}),(0,f.jsxs)("p",{className:"text-xs text-yellow-700 dark:text-yellow-300 mt-1",children:["You can promote/demote other admins and have full control over this ",D?"channel":"group","."]})]})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("h4",{className:"font-medium mb-3",children:"Quick Actions"}),(0,f.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,f.jsxs)("button",{onClick:()=>{w("members"),A(!0)},className:"p-3 rounded-lg border border-green-200 hover:bg-green-50 dark:border-green-700 dark:hover:bg-green-900/20 transition-colors flex items-center space-x-2",children:[(0,f.jsx)(q,{className:"w-4 h-4 text-green-600"}),(0,f.jsxs)("span",{className:"text-sm",children:["Add ",D?"Subscriber":"Member"]})]}),L&&(0,f.jsxs)("button",{onClick:()=>w("members"),className:"p-3 rounded-lg border border-blue-200 hover:bg-blue-50 dark:border-blue-700 dark:hover:bg-blue-900/20 transition-colors flex items-center space-x-2",children:[(0,f.jsx)($,{className:"w-4 h-4 text-blue-600"}),(0,f.jsx)("span",{className:"text-sm",children:"Manage Admins"})]})]})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("h4",{className:"font-medium mb-3",children:"Current Administrators"}),(0,f.jsxs)("div",{className:"space-y-2",children:[r.admin&&(e=>{const t=r.participants.find(e=>e.user._id===r.admin);return t?(0,f.jsxs)("div",{className:"flex items-center space-x-3 p-3 rounded-lg bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-700",children:[(0,f.jsxs)("div",{className:"w-8 h-8 bg-gradient-to-r from-yellow-500 to-orange-500 rounded-full flex items-center justify-center text-white text-sm font-semibold relative",children:[t.user.avatar||(null===(e=t.user.name)||void 0===e?void 0:e.charAt(0).toUpperCase())||"?",(0,f.jsx)("div",{className:"absolute -bottom-1 -right-1 w-3 h-3 bg-yellow-500 rounded-full flex items-center justify-center",children:(0,f.jsx)($,{className:"w-1.5 h-1.5 text-white"})})]}),(0,f.jsxs)("div",{className:"flex-1",children:[(0,f.jsxs)("p",{className:"font-medium text-sm",children:[t.user.name," ",t.user._id===s._id&&"(You)"]}),(0,f.jsx)("p",{className:"text-xs text-yellow-700 dark:text-yellow-300",children:"Main Administrator"})]}),(0,f.jsx)($,{className:"w-4 h-4 text-yellow-500"})]},t.user._id):null})(),r.admins&&r.admins.map(e=>{var t;const n=r.participants.find(t=>t.user._id===e);return n?(0,f.jsxs)("div",{className:"flex items-center space-x-3 p-3 rounded-lg bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700",children:[(0,f.jsxs)("div",{className:"w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white text-sm font-semibold relative",children:[n.user.avatar||(null===(t=n.user.name)||void 0===t?void 0:t.charAt(0).toUpperCase())||"?",(0,f.jsx)("div",{className:"absolute -bottom-1 -right-1 w-3 h-3 bg-blue-500 rounded-full flex items-center justify-center",children:(0,f.jsx)(ge,{className:"w-1.5 h-1.5 text-white"})})]}),(0,f.jsxs)("div",{className:"flex-1",children:[(0,f.jsxs)("p",{className:"font-medium text-sm",children:[n.user.name," ",n.user._id===s._id&&"(You)"]}),(0,f.jsx)("p",{className:"text-xs text-blue-700 dark:text-blue-300",children:"Administrator"})]}),L&&n.user._id!==s._id&&(0,f.jsx)("button",{onClick:()=>J(n.user._id),className:"p-1 rounded text-red-500 hover:bg-red-100 dark:hover:bg-red-900 transition-colors",title:"Remove admin privileges",children:(0,f.jsx)(pe,{className:"w-4 h-4"})})]},n.user._id):null})]})]}),(0,f.jsxs)("div",{className:"p-4 rounded-lg border border-gray-200 bg-gray-50 dark:border-gray-700 dark:bg-gray-900/20",children:[(0,f.jsxs)("h3",{className:"font-medium text-gray-800 dark:text-gray-200 mb-3 flex items-center space-x-2",children:[(0,f.jsx)(ye,{className:"w-4 h-4"}),(0,f.jsx)("span",{children:"Chat Actions"})]}),(0,f.jsxs)("div",{className:"space-y-2",children:[(0,f.jsxs)("button",{onClick:async()=>{V({title:"Clear Chat",message:"Are you sure you want to clear all messages in this chat? This will only clear the chat for you - other participants will still see all messages.",confirmText:"Clear Chat",cancelText:"Cancel",type:"warning",onConfirm:async()=>{try{await y(r._id)}catch(e){console.error("Failed to clear chat:",e)}W()}})},className:"w-full flex items-center space-x-2 px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors",children:[(0,f.jsx)(ve,{className:"w-4 h-4"}),(0,f.jsx)("span",{children:"Clear Chat"})]}),(0,f.jsxs)("button",{onClick:async()=>{V({title:"Hide Chat",message:"Are you sure you want to hide this conversation? It will disappear from your sidebar but will reappear when someone sends a new message.",confirmText:"Hide Chat",cancelText:"Cancel",type:"warning",onConfirm:async()=>{try{await v(r._id),c()}catch(e){console.error("Failed to hide chat:",e)}W()}})},className:"w-full flex items-center space-x-2 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700/40 backdrop-blur-sm transition-colors",children:[(0,f.jsx)(pe,{className:"w-4 h-4"}),(0,f.jsx)("span",{children:"Hide Chat"})]}),(0,f.jsxs)("button",{onClick:async()=>{V({title:"Delete Chat",message:"Are you sure you want to delete this conversation? This will clear all messages and hide the chat for you. It will reappear when someone sends a new message, starting fresh from that message.",confirmText:"Delete Chat",cancelText:"Cancel",type:"danger",onConfirm:async()=>{try{await b(r._id),c()}catch(e){console.error("Failed to delete chat:",e)}W()}})},className:"w-full flex items-center space-x-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:[(0,f.jsx)(Y,{className:"w-4 h-4"}),(0,f.jsx)("span",{children:"Delete Chat"})]})]})]}),(0,f.jsxs)("div",{className:"p-4 rounded-lg border border-red-200 bg-red-50 dark:border-red-700 dark:bg-red-900/20",children:[(0,f.jsxs)("h3",{className:"font-medium text-red-800 dark:text-red-200 mb-2 flex items-center space-x-2",children:[(0,f.jsx)(Y,{className:"w-4 h-4"}),(0,f.jsx)("span",{children:"Danger Zone"})]}),(0,f.jsx)("p",{className:"text-sm text-red-600 dark:text-red-300 mb-3",children:"This action cannot be undone. All messages and member data will be permanently deleted."}),(0,f.jsxs)("button",{onClick:async()=>{V({title:"Delete ".concat(D?"Channel":"Group"),message:"Are you sure you want to delete this ".concat(D?"channel":"group","? This action cannot be undone and all messages will be permanently deleted."),confirmText:"Delete",cancelText:"Cancel",type:"danger",onConfirm:async()=>{try{await d(r._id),c()}catch(e){console.error("Failed to delete conversation:",e)}W()}})},className:"flex items-center space-x-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:[(0,f.jsx)(Y,{className:"w-4 h-4"}),(0,f.jsxs)("span",{children:["Delete ",D?"Channel":"Group"]})]})]})]})]})]})}),(0,f.jsx)(xe,{isOpen:C.isOpen,onConfirm:C.onConfirm,onCancel:W,title:C.title,message:C.message,confirmText:C.confirmText,cancelText:C.cancelText,type:C.type,isDark:l})]})},ke=S("ellipsis-vertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]),Se=S("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),Ne=S("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),je=e=>{var t;let{isDark:n,currentUser:r,activeChat:s,onlineUsers:o,onProfileClick:i,onUpdateConversation:l,onDeleteConversation:c,onAddParticipant:u,onRemoveParticipant:d,onAddAdmin:h,onRemoveAdmin:m,onClearChat:p,onBlockUser:g,onLeaveConversation:y,onShowDeleteConfirmation:v}=e;const[b,x]=(0,a.useState)(!1),[w,k]=(0,a.useState)(!1),[S,N]=(0,a.useState)(null);(0,a.useEffect)(()=>{const e=e=>{w&&!e.target.closest(".options-menu-container")&&k(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[w]),(0,a.useEffect)(()=>{if("direct"===(null===s||void 0===s?void 0:s.type)){const e=j(s,r);N(e)}},[s,null===r||void 0===r?void 0:r.blockedUsers,null===s||void 0===s?void 0:s.participants]);const j=(e,t)=>{var n,r,a;if("direct"!==(null===e||void 0===e?void 0:e.type))return{isBlocked:!1,blockedByCurrentUser:!1,blockedByOtherUser:!1,otherUser:null};const s=null===(n=e.participants)||void 0===n||null===(r=n.find(e=>e.user._id!==(null===t||void 0===t?void 0:t._id)))||void 0===r?void 0:r.user;if(!s)return{isBlocked:!1,blockedByCurrentUser:!1,blockedByOtherUser:!1,otherUser:null};const o=(null===t||void 0===t||null===(a=t.blockedUsers)||void 0===a?void 0:a.includes(s._id))||!0===s.isBlockedByCurrentUser,i=!0===s.hasBlockedCurrentUser;return{isBlocked:o||i,blockedByCurrentUser:o,blockedByOtherUser:i,otherUser:s}},_=(e=>{if(!e)return{name:"Unknown",avatar:"\u2753",status:"Unknown",isGroup:!1,isBroadcast:!1,type:"unknown",isOnline:!1};var t,n;if("group"===e.type)return{name:e.name||"Group Chat",avatar:e.avatar||"\ud83d\udc65",status:"".concat((null===(t=e.participants)||void 0===t?void 0:t.length)||0," members"),isGroup:!0,isBroadcast:!1,type:"group",isOnline:!1};if("broadcast"===e.type)return{name:e.name||"Broadcast Channel",avatar:e.avatar||"\ud83d\udce2",status:"".concat((null===(n=e.participants)||void 0===n?void 0:n.length)||0," subscribers"),isGroup:!1,isBroadcast:!0,type:"broadcast",isOnline:!1};{var a;const t=(e=>{var t;if("direct"!==(null===e||void 0===e?void 0:e.type))return null;const n=null===(t=e.participants)||void 0===t?void 0:t.find(e=>e.user._id!==(null===r||void 0===r?void 0:r._id));return n?n.user:null})(e),n=j(e,r);if(!t)return{name:"Unknown User",avatar:"\ud83d\udc64",status:"Offline",isGroup:!1,isBroadcast:!1,type:"direct",isOnline:!1,user:null};let s,i=!1;return o&&!n.isBlocked&&(o.has&&"function"===typeof o.has?i=o.has(t._id):Array.isArray(o)?i=o.includes(t._id):void 0!==o.size&&(i=Array.from(o).includes(t._id))),s=n.isBlocked?n.blockedByCurrentUser?"You blocked this user":n.blockedByOtherUser?"This user blocked you":"Blocked":i?"Online":t.lastSeen?"Last seen ".concat((e=>{if(!e)return"Never";const t=new Date(e),n=new Date-t;if(n<3e5)return"just now";if(n<36e5){const e=Math.floor(n/6e4);return"".concat(e," min ago")}if(n<864e5){const e=Math.floor(n/36e5);return"".concat(e," hour").concat(e>1?"s":""," ago")}return Q(e)})(t.lastSeen)):"Offline",{name:t.name||"Unknown User",avatar:t.avatar||(null===(a=t.name)||void 0===a?void 0:a.charAt(0).toUpperCase())||"\ud83d\udc64",status:s,isGroup:!1,isBroadcast:!1,type:"direct",user:t,isOnline:!n.isBlocked&&i,blockedStatus:n}}})(s),C=(e=>{var t;if(!e||"direct"===e.type)return!1;return("string"===typeof e.admin?e.admin:null===(t=e.admin)||void 0===t?void 0:t._id)===(null===r||void 0===r?void 0:r._id)||!(!e.admins||!Array.isArray(e.admins))&&e.admins.some(e=>("string"===typeof e?e:null===e||void 0===e?void 0:e._id)===(null===r||void 0===r?void 0:r._id))})(s),E=j(s,r),T=e=>{console.log("ChatHeader: Block action requested for user:",e),k(!1),g(e)};return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)("div",{className:"p-4 border-b flex items-center justify-between ".concat(n?"bg-gradient-to-r from-gray-800 to-gray-700 border-gray-800":"bg-white border-gray-200"),children:[(0,f.jsxs)("div",{className:"flex items-center space-x-3 p-2 rounded-lg transition-all duration-200 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700/30 flex-1 ".concat(E.isBlocked?"opacity-75":""),onClick:()=>{"direct"===_.type&&_.user?i(_.user):"group"!==_.type&&"broadcast"!==_.type||x(!0)},children:[(0,f.jsxs)("div",{className:"relative",children:[(0,f.jsx)("div",{className:"w-10 h-10 ".concat("broadcast"===_.type?"bg-gradient-to-r from-purple-500 to-pink-600":"group"===_.type?"bg-gradient-to-r from-green-500 to-teal-600":E.isBlocked?"bg-gradient-to-r from-red-500 to-red-600":"bg-gradient-to-r from-blue-500 to-purple-600"," rounded-full flex items-center justify-center text-white font-semibold relative"),children:(0,f.jsx)("span",{children:_.avatar})}),"direct"===_.type&&_.isOnline&&!E.isBlocked&&(0,f.jsx)("div",{className:"absolute -bottom-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-white dark:border-gray-800"}),"direct"===_.type&&E.isBlocked&&(0,f.jsx)("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 bg-red-500 rounded-full border-2 border-white dark:border-gray-800 flex items-center justify-center",children:(0,f.jsx)(G,{className:"w-2.5 h-2.5 text-white"})})]}),(0,f.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,f.jsx)("h3",{className:"font-semibold flex items-center space-x-1",children:(0,f.jsx)("span",{className:"truncate ".concat(E.isBlocked?"text-gray-600 dark:text-gray-400":n?"text-white":"text-gray-900"),children:_.name})}),(0,f.jsx)("p",{className:"text-sm truncate ".concat(E.isBlocked?"text-red-500 dark:text-red-400":"text-gray-500 dark:text-gray-400"),children:_.status})]})]}),(0,f.jsxs)("div",{className:"relative options-menu-container",children:[(0,f.jsx)("button",{onClick:e=>{e.stopPropagation(),k(!w)},className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700/30 transition-all duration-200 ".concat(w?"bg-gray-100 dark:bg-gray-700/40":""),title:"More options",children:(0,f.jsx)(ke,{className:"w-5 h-5"})}),w&&(0,f.jsx)("div",{className:"absolute right-0 top-full mt-2 w-52 rounded-lg shadow-xl border z-50 backdrop-blur-sm ".concat(n?"bg-gray-800/90 border-gray-800 backdrop-blur-md":"bg-white border-gray-200"),children:(0,f.jsxs)("div",{className:"py-2",children:["direct"===_.type&&(0,f.jsxs)(f.Fragment,{children:[E.blockedByCurrentUser?(0,f.jsxs)("button",{onClick:()=>T(E.otherUser._id),className:"w-full px-4 py-2 text-left transition-colors flex items-center space-x-3 hover:bg-green-100 dark:hover:bg-green-900 text-green-600 dark:text-green-400",children:[(0,f.jsx)(Se,{className:"w-4 h-4"}),(0,f.jsx)("span",{children:"Unblock User"})]}):E.blockedByOtherUser?(0,f.jsxs)("div",{className:"px-4 py-2 flex items-center space-x-3 text-red-500 opacity-75 cursor-not-allowed",children:[(0,f.jsx)(ue,{className:"w-4 h-4"}),(0,f.jsx)("span",{children:"You are blocked"})]}):(0,f.jsxs)("button",{onClick:()=>T(E.otherUser._id),className:"w-full px-4 py-2 text-left transition-colors flex items-center space-x-3 hover:bg-red-100 dark:hover:bg-red-900 text-red-600 dark:text-red-400",children:[(0,f.jsx)(G,{className:"w-4 h-4"}),(0,f.jsx)("span",{children:"Block User"})]}),(0,f.jsx)("div",{className:"my-1 border-t ".concat(n?"border-gray-800":"border-gray-200")}),(0,f.jsxs)("button",{onClick:()=>{E.blockedByOtherUser||(p(s._id),k(!1))},disabled:E.blockedByOtherUser,className:"w-full px-4 py-2 text-left transition-colors flex items-center space-x-3 ".concat(E.blockedByOtherUser?"opacity-50 cursor-not-allowed text-gray-400":"hover:bg-yellow-100 dark:hover:bg-yellow-900 text-yellow-600 dark:text-yellow-400"),title:E.blockedByOtherUser?"Cannot clear chat - you are blocked":"Clear chat history for you",children:[(0,f.jsx)(ve,{className:"w-4 h-4"}),(0,f.jsx)("span",{children:"Clear Chat"})]}),(0,f.jsxs)("button",{onClick:()=>{v(),k(!1)},className:"w-full px-4 py-2 text-left hover:bg-red-100 dark:hover:bg-red-900 transition-colors flex items-center space-x-3 text-red-600 dark:text-red-400",children:[(0,f.jsx)(Y,{className:"w-4 h-4"}),(0,f.jsx)("span",{children:"Delete Chat"})]})]}),("group"===_.type||"broadcast"===_.type)&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)("button",{onClick:()=>{x(!0),k(!1)},className:"w-full px-4 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-700/40 transition-colors flex items-center space-x-3 ".concat(n?"text-white":"text-gray-700"),children:[(0,f.jsx)(Ne,{className:"w-4 h-4"}),(0,f.jsx)("span",{children:"broadcast"===_.type?"Channel Info":"Group Info"})]}),(0,f.jsxs)("button",{onClick:()=>{p(s._id),k(!1)},className:"w-full px-4 py-2 text-left hover:bg-yellow-100 dark:hover:bg-yellow-900 transition-colors flex items-center space-x-3 text-yellow-600 dark:text-yellow-400",children:[(0,f.jsx)(ve,{className:"w-4 h-4"}),(0,f.jsx)("span",{children:"Clear Chat"})]}),(!C||C&&(null===(t=s.participants)||void 0===t?void 0:t.length)>1)&&(0,f.jsxs)("button",{onClick:()=>{y(s._id),k(!1)},className:"w-full px-4 py-2 text-left hover:bg-orange-100 dark:hover:bg-orange-900 transition-colors flex items-center space-x-3 text-orange-600 dark:text-orange-400",children:[(0,f.jsx)(V,{className:"w-4 h-4"}),(0,f.jsxs)("span",{children:["Leave ","broadcast"===_.type?"Channel":"Group"]})]}),C&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{className:"my-1 border-t ".concat(n?"border-gray-800":"border-gray-200")}),(0,f.jsxs)("button",{onClick:()=>{x(!0),k(!1)},className:"w-full px-4 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors flex items-center space-x-3 ".concat(n?"text-white":"text-gray-700"),children:[(0,f.jsx)(ye,{className:"w-4 h-4"}),(0,f.jsxs)("span",{children:["Manage ","broadcast"===_.type?"Channel":"Group"]})]}),(0,f.jsxs)("button",{onClick:()=>{v(),k(!1)},className:"w-full px-4 py-2 text-left hover:bg-red-100 dark:hover:bg-red-900 transition-colors flex items-center space-x-3 text-red-600 dark:text-red-400",children:[(0,f.jsx)(Y,{className:"w-4 h-4"}),(0,f.jsxs)("span",{children:["Delete ","broadcast"===_.type?"Channel":"Group"]})]})]})]})]})})]})]}),b&&("group"===_.type||"broadcast"===_.type)&&(0,f.jsx)(we,{conversation:s,currentUser:r,isAdmin:C,isDark:n,onClose:()=>x(!1),onUpdateConversation:l,onDeleteConversation:c,onAddParticipant:u,onRemoveParticipant:d,onAddAdmin:h,onRemoveAdmin:m}),w&&(0,f.jsx)("div",{className:"fixed inset-0 z-40",onClick:()=>k(!1)})]})},_e=S("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),Ce=S("reply",[["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}],["path",{d:"m9 17-5-5 5-5",key:"nvlc11"}]]),Ee=S("smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]),Te=S("forward",[["path",{d:"m15 17 5-5-5-5",key:"nf172w"}],["path",{d:"M4 18v-2a4 4 0 0 1 4-4h12",key:"jmiej9"}]]),Ae=e=>{let{isDark:t,onReactionSelect:n,position:r="top",isOwn:a}=e;return(0,f.jsx)("div",{className:"absolute ".concat("top"===r?"bottom-8":"top-8"," ").concat(a?"right-0":"left-0"," p-2 rounded-lg shadow-lg border z-50 ").concat(t?"bg-gray-800 border-gray-600":"bg-white border-gray-200"),style:{maxWidth:"280px"},children:(0,f.jsx)("div",{className:"grid grid-cols-4 gap-1",children:[{emoji:"\ud83d\udc4d",name:"thumbs_up"},{emoji:"\ud83d\udc4e",name:"thumbs_down"},{emoji:"\u2764\ufe0f",name:"heart"},{emoji:"\ud83d\ude02",name:"laugh"},{emoji:"\ud83d\ude22",name:"sad"},{emoji:"\ud83c\udf89",name:"celebration"},{emoji:"\ud83d\ude2e",name:"surprised"},{emoji:"\ud83d\udd25",name:"fire"}].map(e=>(0,f.jsx)("button",{onClick:()=>n(e.emoji),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-lg transition-transform hover:scale-110 flex items-center justify-center",title:e.name.replace("_"," "),children:e.emoji},e.name))})})},Pe=S("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),Oe=S("video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]),Ue=S("music",[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]]),Re=S("file-text",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),Ie=S("file",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]),Me=S("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]),Le=e=>{let{messageType:t,mimeType:n,filename:r,size:a=24}=e;return(()=>{var e;const s=r?null===(e=r.split(".").pop())||void 0===e?void 0:e.toLowerCase():"";if("image"===t)return"gif"===s?(0,f.jsx)("span",{className:"text-2xl",children:"\ud83c\udf9e\ufe0f"}):(0,f.jsx)(Pe,{className:"w-".concat(a/4," h-").concat(a/4)});if("video"===t)return(0,f.jsx)(Oe,{className:"w-".concat(a/4," h-").concat(a/4)});if("audio"===t)return(0,f.jsx)(Ue,{className:"w-".concat(a/4," h-").concat(a/4)});if(n){if(n.includes("pdf"))return(0,f.jsx)(Re,{className:"w-".concat(a/4," h-").concat(a/4," text-red-500")});if(n.includes("document")||n.includes("word"))return(0,f.jsx)(Re,{className:"w-".concat(a/4," h-").concat(a/4," text-blue-500")});if(n.includes("spreadsheet")||n.includes("excel"))return(0,f.jsx)(Re,{className:"w-".concat(a/4," h-").concat(a/4," text-green-500")});if(n.includes("zip")||n.includes("rar"))return(0,f.jsx)(Ie,{className:"w-".concat(a/4," h-").concat(a/4," text-yellow-500")})}return(0,f.jsx)(Ie,{className:"w-".concat(a/4," h-").concat(a/4)})})()},De=e=>{var t;let{message:n,onImageClick:r,isDark:s,showFileName:o=!0}=e;const[i,l]=(0,a.useState)(!1),[c,u]=(0,a.useState)(!0),d=n.fileInfo||n.file||{},h=d.url||n.content,m=X(n),p=d.fileSize||(d.size?"".concat((d.size/1024).toFixed(1)," KB"):""),g=d.type||d.mimeType||"",y=te(n),v=()=>{l(!0),u(!1)},b=()=>{u(!1)},x=e=>{e.stopPropagation(),h&&window.open(h,"_blank","noopener,noreferrer")},w=()=>{r&&r(h)};return"image"===n.messageType?(0,f.jsx)("div",{className:"mb-2 max-w-sm",children:(0,f.jsxs)("div",{className:"relative group",children:[c&&(0,f.jsx)("div",{className:"absolute inset-0 flex items-center justify-center rounded-lg ".concat(s?"bg-gray-700":"bg-gray-100"),children:(0,f.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}),i?(0,f.jsxs)("div",{className:"w-full h-48 rounded-lg flex flex-col items-center justify-center cursor-pointer hover:opacity-80 transition-opacity ".concat(s?"bg-gray-700":"bg-gray-100"),onClick:w,children:[y?(0,f.jsx)("span",{className:"text-4xl mb-2",children:"\ud83c\udf9e\ufe0f"}):(0,f.jsx)(Pe,{className:"w-12 h-12 text-gray-400 mb-2"}),(0,f.jsx)("span",{className:"text-sm text-gray-500 text-center px-2 font-medium",children:m}),(0,f.jsx)("span",{className:"text-xs text-gray-400 mt-1",children:y?"GIF \u2022 Failed to load":"Image \u2022 Failed to load"})]}):(0,f.jsx)("img",{src:h,alt:m,className:"w-full h-auto rounded-lg cursor-pointer hover:opacity-90 transition-opacity shadow-md ".concat(c?"opacity-0":"opacity-100"),onClick:w,onError:v,onLoad:b,loading:"lazy",style:{maxHeight:"300px",objectFit:"cover"}}),(0,f.jsx)("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,f.jsx)("div",{className:"flex space-x-1",children:(0,f.jsx)("button",{onClick:x,className:"p-2 bg-black bg-opacity-50 rounded-full text-white hover:bg-opacity-70 transition-colors",title:"Open in new tab",children:(0,f.jsx)(Me,{className:"w-4 h-4"})})})}),o&&m&&!i&&(0,f.jsx)("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent rounded-b-lg p-3",children:(0,f.jsxs)("div",{className:"flex items-center justify-between",children:[(0,f.jsxs)("p",{className:"text-black text-sm font-medium truncate flex-1",title:m,children:[y&&(0,f.jsx)("span",{className:"mr-1",children:"\ud83c\udf9e\ufe0f"}),m]}),p&&(0,f.jsx)("span",{className:"text-white/80 text-xs ml-2",children:p})]})}),y&&!i&&(0,f.jsx)("div",{className:"absolute top-2 left-2 bg-purple-500 text-white text-xs px-2 py-1 rounded-full font-medium",children:"GIF"})]})}):"video"===n.messageType?(0,f.jsx)("div",{className:"mb-2 max-w-sm",children:(0,f.jsxs)("div",{className:"relative group",children:[(0,f.jsx)("video",{src:h,className:"w-full h-auto rounded-lg shadow-md",controls:!0,preload:"metadata",style:{maxHeight:"300px"},poster:d.thumbUrl,children:"Your browser does not support the video tag."}),(0,f.jsx)("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,f.jsx)("button",{onClick:x,className:"p-2 bg-black bg-opacity-50 rounded-full text-white hover:bg-opacity-70 transition-colors",title:"Open video in new tab",children:(0,f.jsx)(Me,{className:"w-4 h-4"})})}),o&&m&&(0,f.jsx)("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent rounded-b-lg p-3",children:(0,f.jsxs)("div",{className:"flex items-center justify-between text-white text-sm",children:[(0,f.jsxs)("span",{className:"truncate flex-1 font-medium",title:m,children:["\ud83c\udfa5 ",m]}),p&&(0,f.jsx)("span",{className:"ml-2 text-white/80 text-xs",children:p})]})})]})}):"audio"===n.messageType?(0,f.jsx)("div",{className:"mb-2 max-w-sm",children:(0,f.jsxs)("div",{className:"p-4 rounded-lg border ".concat(s?"bg-gray-700 border-gray-600":"bg-gray-50 border-gray-200"),children:[(0,f.jsxs)("div",{className:"flex items-center space-x-3 mb-3",children:[(0,f.jsx)("div",{className:"w-12 h-12 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center",children:(0,f.jsx)(Ue,{className:"w-6 h-6 text-white"})}),(0,f.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,f.jsxs)("p",{className:"text-sm font-medium truncate",title:m,children:["\ud83c\udfb5 ",m]}),p&&(0,f.jsx)("p",{className:"text-xs text-gray-500",children:p})]}),(0,f.jsx)("button",{onClick:x,className:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",title:"Open audio in new tab",children:(0,f.jsx)(Me,{className:"w-4 h-4"})})]}),(0,f.jsx)("audio",{src:h,controls:!0,className:"w-full",preload:"metadata",children:"Your browser does not support the audio tag."})]})}):(0,f.jsx)("div",{className:"mb-2 max-w-sm",children:(0,f.jsxs)("div",{className:"p-4 rounded-lg border cursor-pointer hover:shadow-md transition-all ".concat(s?"bg-gray-700 border-gray-600 hover:bg-gray-650":"bg-gray-50 border-gray-200 hover:bg-gray-100"),onClick:x,children:[(0,f.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,f.jsx)("div",{className:"w-12 h-12 rounded-lg flex items-center justify-center ".concat(g.includes("pdf")?"bg-red-100 dark:bg-red-900":g.includes("document")||g.includes("word")?"bg-blue-100 dark:bg-blue-900":g.includes("spreadsheet")||g.includes("excel")?"bg-green-100 dark:bg-green-900":"bg-gray-200 dark:bg-gray-600"),children:(0,f.jsx)(Le,{messageType:n.messageType,mimeType:g,filename:m,size:24})}),(0,f.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,f.jsxs)("p",{className:"text-sm text-black font-medium truncate",title:m,children:[ne(n.messageType,g,m)," ",m]}),(0,f.jsxs)("div",{className:"flex items-center justify-between mt-1",children:[p&&(0,f.jsx)("p",{className:"text-xs text-gray-500",children:p}),(0,f.jsxs)("div",{className:"flex items-center space-x-1 text-xs text-gray-500",children:[(0,f.jsx)(Me,{className:"w-3 h-3"}),(0,f.jsx)("span",{children:"Open"})]})]})]})]}),(0,f.jsx)("div",{className:"mt-3",children:(0,f.jsx)("span",{className:"inline-block px-2 py-1 text-xs rounded-full font-medium ".concat(g.includes("pdf")?"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200":g.includes("document")||g.includes("word")?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":g.includes("spreadsheet")||g.includes("excel")?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200"),children:g.includes("pdf")?"PDF Document":g.includes("document")||g.includes("word")?"Word Document":g.includes("spreadsheet")||g.includes("excel")?"Excel Spreadsheet":(null===(t=g.split("/")[1])||void 0===t?void 0:t.toUpperCase())||"File"})})]})})},Fe=S("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),Be=function(e){switch(e){case"sending":return(0,f.jsx)(Fe,{className:"w-3 h-3 text-gray-400 animate-pulse",strokeWidth:2});case"sent":return(0,f.jsx)(Se,{className:"w-3 h-3 text-gray-400",strokeWidth:2.5});case"delivered":return(0,f.jsxs)("div",{className:"relative flex items-center",children:[(0,f.jsx)(Se,{className:"w-3 h-3 text-gray-400",strokeWidth:2.5}),(0,f.jsx)(Se,{className:"w-3 h-3 text-gray-400 -ml-1.5",strokeWidth:2.5})]});case"read":case"seen":return(0,f.jsxs)("div",{className:"relative flex items-center",children:[(0,f.jsx)(Se,{className:"w-3 h-3 text-blue-500",strokeWidth:2.5}),(0,f.jsx)(Se,{className:"w-3 h-3 text-blue-500 -ml-1.5",strokeWidth:2.5})]});default:return(0,f.jsx)("span",{className:"text-gray-400 text-xs",children:"?"})}};Math.pow(10,8),Symbol.for("constructDateFrom");function ze(e){return function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n=t.width?String(t.width):e.defaultWidth;return e.formats[n]||e.formats[e.defaultWidth]}}ze({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),ze({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),ze({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"});function qe(e){return(t,n)=>{let r;if("formatting"===(null!==n&&void 0!==n&&n.context?String(n.context):"standalone")&&e.formattingValues){const t=e.defaultFormattingWidth||e.defaultWidth,a=null!==n&&void 0!==n&&n.width?String(n.width):t;r=e.formattingValues[a]||e.formattingValues[t]}else{const t=e.defaultWidth,a=null!==n&&void 0!==n&&n.width?String(n.width):e.defaultWidth;r=e.values[a]||e.values[t]}return r[e.argumentCallback?e.argumentCallback(t):t]}}qe({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),qe({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:e=>e-1}),qe({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),qe({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),qe({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"});function Ve(e){return function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=n.width,a=r&&e.matchPatterns[r]||e.matchPatterns[e.defaultMatchWidth],s=t.match(a);if(!s)return null;const o=s[0],i=r&&e.parsePatterns[r]||e.parsePatterns[e.defaultParseWidth],l=Array.isArray(i)?function(e,t){for(let n=0;n<e.length;n++)if(t(e[n]))return n;return}(i,e=>e.test(o)):function(e,t){for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&t(e[n]))return n;return}(i,e=>e.test(o));let c;c=e.valueCallback?e.valueCallback(l):l,c=n.valueCallback?n.valueCallback(c):c;return{value:c,rest:t.slice(o.length)}}}He={matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:e=>parseInt(e,10)},Ve({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),Ve({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:e=>e+1}),Ve({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),Ve({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),Ve({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"});var He;const We=e=>{let{message:t,isDark:n}=e;return(0,f.jsx)("div",{className:"flex justify-center my-4",children:(0,f.jsx)("div",{className:"\n          max-w-md px-4 py-2 rounded-full text-sm flex items-center space-x-2 shadow-sm\n          ".concat(n?"bg-gray-700/50 text-gray-300 border border-gray-600/50":"bg-gray-100 text-gray-600 border border-gray-200","\n        "),children:(0,f.jsx)("span",{className:"font-medium text-center flex-1",children:t.content})})})},Ke=e=>{var t,n,r,s,o,i,l,c,u;let{message:d,isOwn:h,currentUser:m,activeChat:p,messages:g,isDark:y,onImageClick:v,onForward:b,onDeleteMessage:x,onEditMessage:w,onReply:k,onReactToMessage:S}=e;const[N,j]=(0,a.useState)(!1),[_,C]=(0,a.useState)(!1),[E,T]=(0,a.useState)(d.content||""),[A,P]=(0,a.useState)(!1),O=e=>"string"===typeof e?e:(null===e||void 0===e?void 0:e._id)||(null===e||void 0===e?void 0:e.id),U=O(d.sender)===O(m);(0,a.useEffect)(()=>{var e;U!==h&&console.warn("\u26a0\ufe0f Ownership mismatch detected:",{messageId:d._id,calculated:U,fromProp:h,messageSender:null===(e=d.sender)||void 0===e?void 0:e.name,currentUser:null===m||void 0===m?void 0:m.name})},[U,h,d._id]);const R=async e=>{try{var t;const n=O(m),r=null===(t=d.reactions)||void 0===t?void 0:t.find(e=>O(e.user)===n);r&&(r.emoji||r.type)===e?await S(d._id,null):await S(d._id,e),j(!1)}catch(n){console.error("Failed to add reaction:",n)}},I=(M=d.replyTo,p&&M&&g?g.find(e=>e._id===M):null);var M;const L=d.sender,D=d.reactions?(()=>{const e={};return d.reactions.forEach(t=>{var n;const r=t.emoji||t.type,a=O(t.user),s=(null===(n=t.user)||void 0===n?void 0:n.name)||"Unknown";e[r]||(e[r]={users:[],userNames:[]}),e[r].users.includes(a)||(e[r].users.push(a),e[r].userNames.push(s))}),Object.entries(e).filter(e=>{let[t,n]=e;return n.users.length>0})})():[],F=J(d);return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{className:"flex ".concat(U?"justify-end":"justify-start"," group mb-4"),children:(0,f.jsxs)("div",{className:"max-w-xs lg:max-w-md ".concat(U?"order-2":"order-1"),children:["group"===p.type&&!U&&L&&(0,f.jsx)("p",{className:"text-xs text-gray-500 mb-1 ml-3",children:L.name||"Unknown User"}),(0,f.jsxs)("div",{className:"px-4 py-2 rounded-2xl relative ".concat(U?"bg-gradient-to-r from-blue-500 to-purple-600 text-white":y?"bg-gray-700 text-white":"bg-gray-200 text-gray-900"),children:[(I||d.replyTo)&&(0,f.jsx)("div",{className:"mb-2 p-2 rounded-lg border-l-4 cursor-pointer transition-colors hover:bg-opacity-80 ".concat(U?"bg-blue-600 border-blue-300":"bg-gray-300 dark:bg-gray-600 border-gray-400"),children:(0,f.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,f.jsx)(Ce,{className:"w-3 h-3 mt-0.5 opacity-75"}),(0,f.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,f.jsxs)("p",{className:"text-xs opacity-75 font-medium",children:["Replying to ",(null===I||void 0===I||null===(t=I.sender)||void 0===t?void 0:t.name)||(null===(n=d.replyTo)||void 0===n||null===(r=n.sender)||void 0===r?void 0:r.name)||"Someone"]}),(0,f.jsx)("p",{className:"text-sm opacity-90 truncate",children:I?ce(I,40):null!==(s=d.replyTo)&&void 0!==s&&s.content?ce(d.replyTo,40):ce({content:null===(o=d.replyTo)||void 0===o?void 0:o.content,messageType:null===(i=d.replyTo)||void 0===i?void 0:i.messageType,fileInfo:null===(l=d.replyTo)||void 0===l?void 0:l.fileInfo},40)||"Message"})]})]})}),F&&(0,f.jsx)(De,{message:d,onImageClick:v,isDark:y,showFileName:!0}),("text"===d.messageType||F&&d.content&&d.content!==((null===(c=d.fileInfo)||void 0===c?void 0:c.url)||(null===(u=d.file)||void 0===u?void 0:u.url)))&&(_?(0,f.jsxs)("div",{className:"mb-2 relative",children:[(0,f.jsx)("textarea",{value:E,onChange:e=>T(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey?"Escape"===e.key&&(e.preventDefault(),C(!1),T(d.content||"")):(e.preventDefault(),(async()=>{if(!E.trim()||E===d.content)return C(!1),void T(d.content||"");try{await w(d._id,E.trim()),C(!1)}catch(e){console.error("Failed to edit message:",e),T(d.content||""),C(!1)}})())},className:"w-full p-1 rounded border-none focus:outline-none resize-none transition-all ".concat(y?"bg-gray-600 bg-opacity-30 text-white placeholder-gray-400 focus:bg-opacity-50":"bg-gray-100 bg-opacity-50 text-gray-900 placeholder-gray-500 focus:bg-opacity-80"," focus:ring-1 focus:ring-blue-300 focus:ring-opacity-30"),rows:Math.min(E.split("\n").length+1,5),autoFocus:!0,placeholder:"Edit your message...",style:{minHeight:"1.2rem",fontSize:"inherit",lineHeight:"inherit"}}),(0,f.jsx)("div",{className:"text-xs opacity-60 mt-1 italic",children:"Press Enter to save \u2022 Esc to cancel"})]}):"text"===d.messageType&&(0,f.jsxs)("div",{className:"break-words whitespace-pre-wrap",children:[d.content||"No content",(d.isEdited||d.editedAt)&&(0,f.jsxs)("span",{className:"text-xs opacity-75 ml-2",children:["(edited",d.editedAt?" ".concat(Q(d.editedAt)):"",")"]})]})),(0,f.jsxs)("div",{className:"flex items-center justify-between mt-1 text-xs ".concat(U?"text-blue-100":"text-gray-500"),children:[(0,f.jsx)("span",{children:Q(d.createdAt||d.timestamp)}),U&&d.status&&(0,f.jsx)("div",{className:"ml-2",children:Be(d.status)})]}),N&&(0,f.jsx)(Ae,{isDark:y,onReactionSelect:R,onClose:()=>j(!1),position:U?"top":"bottom",isOwn:U})]}),D.length>0&&(0,f.jsx)("div",{className:"flex flex-wrap gap-1 mt-1 ".concat(U?"justify-end":"justify-start"),children:D.map(e=>{let[t,n]=e;const r=n.users.includes(O(m));return(0,f.jsxs)("div",{onClick:()=>R(t),className:"inline-flex items-center px-2 py-1 rounded-full text-xs cursor-pointer transition-all hover:scale-105 ".concat(r?y?"bg-blue-600 hover:bg-blue-500 text-white":"bg-blue-100 hover:bg-blue-200 text-blue-800":y?"bg-gray-600 hover:bg-gray-500":"bg-gray-100 hover:bg-gray-200"),title:"".concat(n.userNames.join(", ")," ").concat((n.users.length,"reacted")," with ").concat(t),children:[(0,f.jsx)("span",{className:"mr-1",children:t}),(0,f.jsx)("span",{children:n.users.length})]},t)})}),(0,f.jsxs)("div",{className:"flex items-center space-x-2 mt-1 opacity-0 group-hover:opacity-100 transition-opacity ".concat(U?"justify-end":"justify-start"),children:[(0,f.jsx)("button",{onClick:()=>k(d),className:"p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors",title:"Reply",children:(0,f.jsx)(Ce,{className:"w-3 h-3"})}),(0,f.jsx)("button",{onClick:()=>j(!N),className:"p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors",title:"Add Reaction",children:(0,f.jsx)(Ee,{className:"w-3 h-3"})}),(0,f.jsx)("button",{onClick:()=>{const e=re(d);b(e)},className:"p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors",title:"Forward",children:(0,f.jsx)(Te,{className:"w-3 h-3"})}),U&&(0,f.jsxs)(f.Fragment,{children:["text"===d.messageType&&new Date-new Date(d.createdAt)<9e5&&(0,f.jsx)("button",{onClick:()=>C(!0),className:"p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors",title:"Edit",children:(0,f.jsx)(he,{className:"w-3 h-3"})}),(0,f.jsx)("button",{onClick:()=>{P(!0)},className:"p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-red-500 transition-colors",title:"Delete",children:(0,f.jsx)(Y,{className:"w-3 h-3"})})]})]})]})}),A&&(0,f.jsx)(de,{isDark:y,onConfirm:async()=>{try{await x(d._id),P(!1)}catch(e){console.error("Failed to delete message:",e)}},onCancel:()=>{P(!1)},messagePreview:J(d)?X(d):d.content||"No content"})]})},Ge=e=>"system"===e.message.messageType?(0,f.jsx)(We,{message:e.message,isDark:e.isDark}):(0,f.jsx)(Ke,(0,o.A)({},e)),$e=e=>{let{isDark:t,currentUser:n,activeChat:r,messages:s,typingUsers:o,onImageClick:i,onForward:l,onReply:c,onEditMessage:u,onDeleteMessage:d,onReactToMessage:h,onLoadMoreMessages:m}=e;const p=(0,a.useRef)(null),g=(0,a.useRef)(null),y=(0,a.useRef)(new Map),[v,b]=(0,a.useState)(!1),[x,w]=(0,a.useState)(!1),[k,S]=(0,a.useState)(1),[N,j]=(0,a.useState)(!0),[_,C]=(0,a.useState)(null),E=e=>"string"===typeof e?e:(null===e||void 0===e?void 0:e._id)||(null===e||void 0===e?void 0:e.id);(0,a.useEffect)(()=>{const e=e=>{const{messageId:t}=e.detail;T(t)};return window.addEventListener("scrollToMessage",e),()=>{window.removeEventListener("scrollToMessage",e)}},[s]);const T=async e=>{C(e);let t=y.current.get(e);if(t)return t.scrollIntoView({behavior:"smooth",block:"center"}),void setTimeout(()=>C(null),3e3);if(s.some(t=>t._id===e)){let n=0;const r=10,a=()=>{n++,t=y.current.get(e),t?(t.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>C(null),3e3)):n<r?setTimeout(a,200):C(null)};return void setTimeout(a,100)}let n=0;(async()=>{for(;n<5;){if(0===await A()){C(null);break}n++,await new Promise(e=>setTimeout(e,800));if(s.some(t=>t._id===e))return void setTimeout(()=>{const t=y.current.get(e);t?(t.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>C(null),3e3)):C(null)},500)}C(null)})()};(0,a.useEffect)(()=>{if(g.current&&!_){const e=g.current;(e.scrollHeight-e.clientHeight<=e.scrollTop+50||s.length<=1)&&setTimeout(()=>{var e;null===(e=p.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},100)}},[s,_]),(0,a.useEffect)(()=>{y.current.clear(),C(null);const e=setTimeout(()=>{var e;null===(e=p.current)||void 0===e||e.scrollIntoView({behavior:"auto"})},100);return()=>clearTimeout(e)},[r]),(0,a.useEffect)(()=>{if(s.length>0&&!_){const e=setTimeout(()=>{var e;null===(e=p.current)||void 0===e||e.scrollIntoView({behavior:"auto"})},200);return()=>clearTimeout(e)}},[s.length,_]),(0,a.useEffect)(()=>{S(1),j(!0)},[r]),(0,a.useEffect)(()=>{s&&0!==s.length||(console.log("Messages cleared - resetting pagination"),S(1),j(!0),w(!1),y.current.clear(),C(null))},[null===s||void 0===s?void 0:s.length]);const A=async()=>{if(!m||x||!N)return 0;w(!0);try{const e=0===s.length?1:k+1;console.log("MessageList: Loading page ".concat(e,", current page: ").concat(k,", messages count: ").concat(s.length));const t=await m(r._id,e);return 0===t?(j(!1),console.log("No more messages to load")):(S(e),console.log("Loaded ".concat(t," messages, updated page to ").concat(e))),t}catch(e){return console.error("Failed to load more messages:",e),0}finally{w(!1)}},P=e=>{T(e)};(0,a.useEffect)(()=>("function"===typeof m&&(window.scrollToMessage=P),()=>{window.scrollToMessage&&delete window.scrollToMessage}),[]);const O=(e=>{const t=[];let n=null,r=null;return e.forEach(e=>{const a=new Date(e.createdAt||e.timestamp).toDateString();a!==n?(r&&t.push(r),n=a,r={date:a,messages:[e]}):r.messages.push(e)}),r&&t.push(r),t})(s||[]);return(0,f.jsxs)("div",{className:"flex-1 flex flex-col relative h-full",children:[(0,f.jsx)("style",{jsx:"true",children:"\n        .custom-scrollbar {\n          scrollbar-width: thin;\n          scrollbar-color: ".concat(t?"#4B5563 #1F2937":"#D1D5DB #F9FAFB",";\n        }\n        \n        .custom-scrollbar::-webkit-scrollbar {\n          width: 8px;\n        }\n        \n        .custom-scrollbar::-webkit-scrollbar-track {\n          background: ").concat(t?"#1F2937":"#F9FAFB",";\n          border-radius: 4px;\n        }\n        \n        .custom-scrollbar::-webkit-scrollbar-thumb {\n          background: ").concat(t?"#4B5563":"#D1D5DB",";\n          border-radius: 4px;\n        }\n        \n        .custom-scrollbar::-webkit-scrollbar-thumb:hover {\n          background: ").concat(t?"#6B7280":"#9CA3AF",';\n        }\n\n        /* Target message bubbles directly for gold color change only */\n        .highlighted-message div[class*="bg-gradient-to-r"],\n        .highlighted-message div[class*="bg-gray-700"],\n        .highlighted-message div[class*="bg-gray-200"] {\n          background: linear-gradient(135deg, #42a5f5ff, #64b5f6ff, #90caf9ff) !important;\n          color: white !important;\n          transition: background 0.3s ease !important;\n        }\n      ')}),(0,f.jsxs)("div",{ref:g,className:"flex-1 overflow-y-auto p-4 custom-scrollbar",onScroll:()=>{if(!g.current)return;const e=g.current,t=e.scrollHeight-e.clientHeight<=e.scrollTop+100;b(!t),0===e.scrollTop&&N&&!x&&A()},children:[x&&(0,f.jsxs)("div",{className:"text-center py-4",children:[(0,f.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500 mx-auto"}),(0,f.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"Loading more messages..."})]}),!N&&s&&s.length>0&&(0,f.jsx)("div",{className:"text-center py-4",children:(0,f.jsx)("p",{className:"text-sm text-gray-500",children:"No more messages"})}),(!s||0===s.length)&&!x&&(0,f.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,f.jsxs)("div",{className:"text-center text-gray-500",children:[(0,f.jsx)("p",{className:"text-lg mb-2",children:"No messages yet"}),(0,f.jsx)("p",{className:"text-sm",children:"Start the conversation!"})]})}),O.map((e,a)=>(0,f.jsxs)("div",{children:[(0,f.jsx)("div",{className:"flex items-center justify-center my-4",children:(0,f.jsx)("div",{className:"px-3 py-1 rounded-full text-xs ".concat(t?"bg-gray-700 text-gray-300":"bg-gray-200 text-gray-600"),children:new Date(e.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})}),e.messages.map((e,a)=>{const o=E(e.sender)===E(n),m=_===e._id;return(0,f.jsx)("div",{ref:t=>{return n=e._id,void((r=t)?y.current.set(n,r):y.current.delete(n));var n,r},className:m?"highlighted-message":"",id:"message-".concat(e._id),children:(0,f.jsx)(Ge,{message:e,isOwn:o,currentUser:n,activeChat:r,messages:s,isDark:t,onImageClick:i,onForward:l,onDeleteMessage:d,onEditMessage:u,onReply:c,onReactToMessage:h})},"".concat(e._id||e.id||"temp","-").concat(a))})]},e.date)),o&&o.size>0&&(0,f.jsx)("div",{className:"flex justify-start mb-4",children:(0,f.jsx)("div",{className:"px-4 py-2 rounded-2xl ".concat(t?"bg-gray-700":"bg-gray-200"),children:(0,f.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,f.jsxs)("div",{className:"flex space-x-1",children:[(0,f.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),(0,f.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,f.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]}),(0,f.jsx)("span",{className:"text-xs text-gray-500 ml-2",children:(()=>{if(!o||0===o.size)return"";const e=Array.from(o);return 1===e.length?"".concat(e[0]," is typing..."):2===e.length?"".concat(e[0]," and ").concat(e[1]," are typing..."):"".concat(e[0]," and ").concat(e.length-1," others are typing...")})()})]})})}),(0,f.jsx)("div",{ref:p})]}),v&&(0,f.jsx)("button",{onClick:()=>{p.current&&p.current.scrollIntoView({behavior:"smooth"})},className:"absolute bottom-6 right-6 p-3 rounded-full shadow-lg transition-all duration-300 hover:scale-110 z-10 ".concat(t?"bg-gray-700 hover:bg-gray-600 text-white":"bg-white hover:bg-gray-50 text-gray-700"," border border-gray-200 dark:border-gray-600"),title:"Scroll to bottom",children:(0,f.jsx)(_e,{className:"w-5 h-5 transform rotate-180"})})]})},Ye=S("paperclip",[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]]),Qe={"Frequently Used":["\ud83d\ude00","\ud83d\ude02","\u2764\ufe0f","\ud83d\ude0d","\ud83d\ude0a","\ud83d\udc4d","\ud83d\udc4f","\ud83d\udd25","\ud83d\udcaf","\ud83d\ude0e","\ud83e\udd14","\ud83d\ude05","\ud83d\ude4c","\ud83d\udc4c","\ud83d\ude80"],Smileys:["\ud83d\ude00","\ud83d\ude03","\ud83d\ude04","\ud83d\ude01","\ud83d\ude06","\ud83d\ude05","\ud83e\udd23","\ud83d\ude02","\ud83d\ude42","\ud83d\ude43","\ud83d\ude09","\ud83d\ude0a","\ud83d\ude07","\ud83e\udd70","\ud83d\ude0d","\ud83e\udd29","\ud83d\ude18","\ud83d\ude17","\ud83d\ude1a","\ud83d\ude19","\ud83d\ude0b","\ud83d\ude1b","\ud83d\ude1c","\ud83e\udd2a","\ud83d\ude1d","\ud83e\udd11","\ud83e\udd17","\ud83e\udd2d","\ud83e\udd2b","\ud83e\udd14"],Gestures:["\ud83d\udc4d","\ud83d\udc4e","\ud83d\udc4c","\u270c\ufe0f","\ud83e\udd1e","\ud83e\udd1f","\ud83e\udd18","\ud83e\udd19","\ud83d\udc48","\ud83d\udc49","\ud83d\udc46","\ud83d\udc47","\u261d\ufe0f","\u270b","\ud83e\udd1a","\ud83d\udd90","\ud83d\udd96","\ud83d\udc4b","\ud83e\udd0f","\ud83d\udcaa","\ud83e\uddbe","\ud83d\udd95","\u270d\ufe0f","\ud83d\ude4f","\ud83e\uddb6","\ud83e\uddb5","\ud83e\uddbf","\ud83d\udc84","\ud83d\udc8b","\ud83d\udc44","\ud83e\uddb7","\ud83d\udc45","\ud83d\udc42","\ud83e\uddbb","\ud83d\udc43","\ud83d\udc63","\ud83d\udc41","\ud83d\udc40","\ud83e\udde0","\ud83d\udde3","\ud83d\udc64","\ud83d\udc65"],Objects:["\ud83d\udcf1","\ud83d\udcbb","\ud83d\udda5","\u2328\ufe0f","\ud83d\uddb1","\ud83d\udcbd","\ud83d\udcbe","\ud83d\udcbf","\ud83d\udcc0","\ud83c\udfa5","\ud83d\udcf7","\ud83d\udcf8","\ud83d\udcf9","\ud83d\udcfc","\ud83d\udd0d","\ud83d\udd0e","\ud83d\udca1","\ud83d\udd26","\ud83c\udfee","\ud83d\udcd4","\ud83d\udcd5","\ud83d\udcd6","\ud83d\udcd7","\ud83d\udcd8","\ud83d\udcd9","\ud83d\udcda","\ud83d\udcd3","\ud83d\udcd2","\ud83d\udcc3","\ud83d\udcdc","\ud83d\udcc4","\ud83d\udcf0","\ud83d\uddde","\ud83d\udcd1","\ud83d\udd16","\ud83c\udff7","\ud83d\udcb0","\ud83d\udcb4","\ud83d\udcb5","\ud83d\udcb6","\ud83d\udcb7","\ud83d\udcb8","\ud83d\udcb3","\ud83e\uddfe","\ud83d\udcb9"]},Je=e=>{let{isDark:t,onEmojiSelect:n,onClose:r}=e;const s=(0,a.useRef)(null);return(0,a.useEffect)(()=>{const e=e=>{s.current&&!s.current.contains(e.target)&&r()};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[r]),(0,f.jsx)("div",{ref:s,className:"absolute bottom-12 left-0 w-72 sm:w-80 h-72 sm:h-80 max-w-[calc(100vw-2rem)] ".concat(t?"bg-gray-700":"bg-white"," rounded-lg shadow-xl border z-50"),children:(0,f.jsxs)("div",{className:"p-4 h-full flex flex-col",children:[(0,f.jsx)("h3",{className:"font-semibold mb-3",children:"Emojis"}),(0,f.jsx)("div",{className:"flex-1 overflow-y-auto",children:Object.entries(Qe).map(e=>{let[t,r]=e;return(0,f.jsxs)("div",{className:"mb-4",children:[(0,f.jsx)("h4",{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-2",children:t}),(0,f.jsx)("div",{className:"grid grid-cols-8 gap-2",children:r.map(e=>(0,f.jsx)("button",{onClick:()=>n(e),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-600 rounded text-lg",children:e},e))})]},t)})})]})})},Xe=S("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),Ze="AIzaSyAuITNIxi7_fxssgpsmgOWGJ8RVigPZGFc",et=e=>{let{isDark:t,onGifSelect:n,onClose:r}=e;const[s,o]=(0,a.useState)(""),[i,l]=(0,a.useState)([]),[c,u]=(0,a.useState)(!1),[d,h]=(0,a.useState)(!0),m=async()=>{u(!0),h(!0);try{const e=await fetch("https://tenor.googleapis.com/v2/featured?key=".concat(Ze,"&limit=20")),t=await e.json();l(t.results.map(e=>{var t;return{id:e.id,url:e.media_formats.gif.url,previewUrl:(null===(t=e.media_formats.tinygif)||void 0===t?void 0:t.url)||e.media_formats.gif.url,title:e.content_description||"GIF"}}))}catch(e){console.error("Error fetching trending GIFs:",e)}finally{u(!1)}};(0,a.useEffect)(()=>{const e=setTimeout(()=>{(async e=>{if(e.trim()){u(!0),h(!1);try{const t=await fetch("https://tenor.googleapis.com/v2/search?q=".concat(encodeURIComponent(e),"&key=").concat(Ze,"&limit=20")),n=await t.json();l(n.results.map(e=>{var t;return{id:e.id,url:e.media_formats.gif.url,previewUrl:(null===(t=e.media_formats.tinygif)||void 0===t?void 0:t.url)||e.media_formats.gif.url,title:e.content_description||"GIF"}}))}catch(t){console.error("Error searching GIFs:",t)}finally{u(!1)}}else m()})(s)},300);return()=>clearTimeout(e)},[s]),(0,a.useEffect)(()=>{m()},[]);return(0,f.jsxs)("div",{className:"fixed bottom-24 left-1/2 transform -translate-x-1/2 w-72 sm:w-80 h-80 sm:h-96 max-w-[calc(100vw-2rem)] rounded-lg shadow-lg border z-20 ".concat(t?"bg-gray-800 border-gray-600":"bg-white border-gray-200"),children:[(0,f.jsxs)("div",{className:"p-3 border-b border-gray-200 dark:border-gray-700",children:[(0,f.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,f.jsx)("h3",{className:"font-semibold text-sm",children:"GIFs"}),(0,f.jsx)("button",{onClick:r,className:"p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700",children:(0,f.jsx)(z,{className:"w-4 h-4"})})]}),(0,f.jsxs)("div",{className:"relative",children:[(0,f.jsx)(H,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),(0,f.jsx)("input",{type:"text",placeholder:"Search GIFs...",value:s,onChange:e=>o(e.target.value),className:"w-full pl-10 pr-4 py-2 rounded-lg border text-sm ".concat(t?"bg-gray-700 border-gray-600 text-white placeholder-gray-400":"bg-gray-50 border-gray-300 placeholder-gray-500"," focus:ring-2 focus:ring-blue-500 focus:border-transparent")})]})]}),(0,f.jsxs)("div",{className:"p-2 h-64 sm:h-80 overflow-y-auto",children:[(0,f.jsxs)("div",{className:"flex items-center space-x-2 mb-2 px-1",children:[(0,f.jsx)(Xe,{className:"w-4 h-4 text-yellow-500"}),(0,f.jsx)("span",{className:"text-sm font-medium",children:d?"Trending":'Results for "'.concat(s,'"')})]}),c&&(0,f.jsx)("div",{className:"flex items-center justify-center h-32",children:(0,f.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}),!c&&!d&&0===i.length&&s&&(0,f.jsxs)("div",{className:"flex flex-col items-center justify-center h-32 text-gray-500",children:[(0,f.jsx)(H,{className:"w-8 h-8 mb-2"}),(0,f.jsx)("p",{className:"text-sm",children:"No GIFs found"}),(0,f.jsx)("p",{className:"text-xs",children:"Try a different search term"})]}),!c&&i.length>0&&(0,f.jsx)("div",{className:"grid grid-cols-2 gap-2",children:i.map(e=>(0,f.jsxs)("div",{onClick:()=>(e=>{n({url:e.url,title:e.title||"animated-gif",content:e.url})})(e),className:"relative cursor-pointer rounded-lg overflow-hidden hover:opacity-80 transition-opacity group",children:[(0,f.jsx)("img",{src:e.previewUrl,alt:e.title,className:"w-full h-24 object-cover",loading:"lazy",onError:t=>{t.target.src=e.url}}),(0,f.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all"}),(0,f.jsx)("div",{className:"absolute bottom-1 left-1 right-1",children:(0,f.jsx)("p",{className:"text-xs text-white bg-black bg-opacity-50 rounded px-1 py-0.5 truncate opacity-0 group-hover:opacity-100 transition-opacity",children:e.title})})]},e.id))})]}),(0,f.jsx)("div",{className:"p-2 border-t border-gray-200 dark:border-gray-700",children:(0,f.jsx)("p",{className:"text-xs text-gray-500 text-center",children:"Powered by Tenor"})})]})},tt=e=>{var t,n,r;let{isDark:s,currentUser:o,activeChat:i,onSendMessage:l,replyingTo:c,setReplyingTo:u,onTypingStart:d,onTypingStop:h,onBlockUser:m}=e;const[p,g]=(0,a.useState)(""),[y,v]=(0,a.useState)(!1),[b,x]=(0,a.useState)(!1),[w,k]=(0,a.useState)(!1),[S,N]=(0,a.useState)(!1),j=(0,a.useRef)(null),C=(0,a.useRef)(null),E=(0,a.useRef)(0),T=()=>{if(!i||!o)return!1;if(i.userLeft)return!1;if("direct"===i.type||"group"===i.type)return!0;if("broadcast"===i.type){var e;return("string"===typeof i.admin?i.admin:null===(e=i.admin)||void 0===e?void 0:e._id)===o._id||!(!i.admins||!Array.isArray(i.admins))&&i.admins.some(e=>("string"===typeof e?e:null===e||void 0===e?void 0:e._id)===o._id)}return!0},A=async()=>{if(p.trim()&&i&&!S&&T()){N(!0);try{let e=null;c&&(e=c._id),await l(p.trim(),null,e),g(""),u(null),y&&(v(!1),null===h||void 0===h||h(i._id))}catch(e){console.error("Failed to send message:",e)}finally{N(!1)}}},P=e=>{if(g(e),!T())return;const t=Date.now(),n=t-E.current;e.trim()&&!y&&n>1e3&&(v(!0),null===d||void 0===d||d(i._id),E.current=t),clearTimeout(C.current),C.current=setTimeout(()=>{y&&(v(!1),null===h||void 0===h||h(i._id))},2e3),!e.trim()&&y&&(v(!1),null===h||void 0===h||h(i._id),clearTimeout(C.current))};(0,a.useEffect)(()=>()=>{C.current&&clearTimeout(C.current),y&&(null===h||void 0===h||h(null===i||void 0===i?void 0:i._id))},[i]),(0,a.useEffect)(()=>()=>{C.current&&clearTimeout(C.current)},[]);const O=(0,a.useMemo)(()=>{if(!i||!o)return{isBlocked:!1,reason:null};if("direct"===i.type){const t=i.participants.find(e=>e.user._id!==o._id);if(t){var e;const n=(null===(e=o.blockedUsers)||void 0===e?void 0:e.includes(t.user._id))||!0===t.user.isBlockedByCurrentUser,r=!0===t.user.hasBlockedCurrentUser;if(console.log("Blocking check:",{currentUserBlockedOther:n,otherUserBlockedCurrent:r,otherUserId:t.user._id,blockedUsersList:o.blockedUsers}),n)return{isBlocked:!0,reason:"You have blocked ".concat(t.user.name),type:"you_blocked_them",otherUserId:t.user._id,otherUserName:t.user.name};if(r)return{isBlocked:!0,reason:"".concat(t.user.name," has blocked you"),type:"they_blocked_you",otherUserId:t.user._id,otherUserName:t.user.name}}}if("broadcast"===i.type){var t;console.log("ChatInfo",i.admin,o._id);const e=("string"===typeof i.admin?i.admin:null===(t=i.admin)||void 0===t?void 0:t._id)===o._id,n=i.admins&&Array.isArray(i.admins)&&i.admins.some(e=>("string"===typeof e?e:null===e||void 0===e?void 0:e._id)===o._id);if(!(e||n))return{isBlocked:!0,reason:"Only administrators can send messages in broadcast channels",type:"no_broadcast_permission"}}return{isBlocked:!1,reason:null}},[null===i||void 0===i?void 0:i._id,null===i||void 0===i?void 0:i.type,null===i||void 0===i?void 0:i.participants,null===i||void 0===i||null===(t=i.admin)||void 0===t?void 0:t._id,null===i||void 0===i?void 0:i.admins,null===o||void 0===o?void 0:o._id,null===o||void 0===o?void 0:o.blockedUsers,null===i||void 0===i||null===(n=i.participants)||void 0===n?void 0:n.map(e=>"".concat(e.user._id,"-").concat(e.user.isBlockedByCurrentUser,"-").concat(e.user.hasBlockedCurrentUser)).join(",")]);return T()?(0,f.jsxs)(f.Fragment,{children:[c&&(0,f.jsx)("div",{className:"px-4 py-2 border-t ".concat(s?"bg-gray-800 border-gray-800":"bg-gray-50 border-gray-200"),children:(0,f.jsxs)("div",{className:"flex items-center justify-between",children:[(0,f.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,f.jsx)(Ce,{className:"w-4 h-4 text-blue-500"}),(0,f.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,f.jsxs)("p",{className:"text-xs text-gray-500",children:["Replying to ",(null===(r=c.sender)||void 0===r?void 0:r.name)||"message"]}),(0,f.jsx)("p",{className:"text-sm truncate",children:J(c)?ce(c,30):c.content||"Message"})]})]}),(0,f.jsx)("button",{onClick:()=>u(null),className:"p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors",title:"Cancel reply",children:(0,f.jsx)(z,{className:"w-4 h-4"})})]})}),(0,f.jsxs)("div",{className:"p-3 md:p-4 border-t relative ".concat(s?"bg-gray-800 border-gray-800":"bg-white border-gray-200"),children:[(0,f.jsxs)("div",{className:"flex items-end space-x-2 md:space-x-3",children:[(0,f.jsxs)("div",{className:"flex space-x-1 md:space-x-2 flex-shrink-0",children:[(0,f.jsx)("input",{type:"file",ref:j,onChange:async e=>{const t=e.target.files[0];if(t&&i&&!S&&T()){N(!0);try{await l(null,t),u(null),y&&(v(!1),null===h||void 0===h||h(i._id))}catch(n){console.error("Failed to send file:",n)}finally{N(!1)}j.current&&(j.current.value="")}},className:"hidden",accept:"image/*,.gif,.pdf,.doc,.docx,.txt,.zip,.rar",disabled:S||O.isBlocked}),(0,f.jsx)("button",{onClick:()=>{var e;return!O.isBlocked&&(null===(e=j.current)||void 0===e?void 0:e.click())},disabled:S||O.isBlocked,className:"p-1.5 md:p-2 rounded-lg transition-colors ".concat(S||O.isBlocked?"opacity-50 cursor-not-allowed text-gray-400":"hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-400"),title:O.isBlocked?O.reason:"Attach file",children:(0,f.jsx)(Ye,{className:"w-4 h-4 md:w-5 md:h-5"})}),(0,f.jsxs)("div",{className:"relative",children:[(0,f.jsx)("button",{onClick:()=>!O.isBlocked&&void(T()&&(x(!b),k(!1))),disabled:S||O.isBlocked,className:"p-1.5 md:p-2 rounded-lg transition-colors ".concat(S||O.isBlocked?"opacity-50 cursor-not-allowed text-gray-400":"hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-400 ".concat(b?"bg-gray-100 dark:bg-gray-700":"")),title:O.isBlocked?O.reason:"Add emoji",children:(0,f.jsx)(Ee,{className:"w-4 h-4 md:w-5 md:h-5"})}),b&&!O.isBlocked&&(0,f.jsx)(Je,{isDark:s,onEmojiSelect:e=>{if(!T())return;const t=p+e;g(t),x(!1),P(t)},onClose:()=>x(!1)})]}),(0,f.jsxs)("div",{className:"relative",children:[(0,f.jsx)("button",{onClick:()=>!O.isBlocked&&void(T()&&(k(!w),x(!1))),disabled:S||O.isBlocked,className:"p-1.5 md:p-2 rounded-lg transition-colors ".concat(S||O.isBlocked?"opacity-50 cursor-not-allowed text-gray-400":"hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-400 ".concat(w?"bg-gray-100 dark:bg-gray-700":"")),title:O.isBlocked?O.reason:"Send GIF",children:(0,f.jsx)(Pe,{className:"w-4 h-4 md:w-5 md:h-5"})}),w&&!O.isBlocked&&(0,f.jsx)(et,{isDark:s,onGifSelect:e=>{T()&&((async e=>{if(i&&!S&&T()){N(!0);try{const t=await fetch(e.url),n=await t.blob(),r=e.title?"".concat(e.title.replace(/[^a-zA-Z0-9]/g,"_"),".gif"):"animated-gif.gif",a=new File([n],r,{type:"image/gif"});await l(null,a),u(null),k(!1),y&&(v(!1),null===h||void 0===h||h(i._id))}catch(t){console.error("Failed to send GIF message:",t)}finally{N(!1)}}})(e),k(!1))},onClose:()=>k(!1)})]})]}),(0,f.jsxs)("div",{className:"flex-1 relative min-w-0",children:[(0,f.jsx)("textarea",{value:O.isBlocked?"":p,onChange:e=>{var t;O.isBlocked||(P(e.target.value),(t=e.target).style.height="auto",t.style.height=Math.min(t.scrollHeight,120)+"px")},onKeyPress:e=>{O.isBlocked||(e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),A())})(e)},onFocus:O.isBlocked?void 0:()=>{p.trim()&&T()&&P(p)},onBlur:O.isBlocked?void 0:()=>{y&&(v(!1),null===h||void 0===h||h(i._id),clearTimeout(C.current))},placeholder:O.isBlocked?O.reason:S?"Sending...":"broadcast"===(null===i||void 0===i?void 0:i.type)?"Broadcast a message...":"Type a message...",disabled:S||O.isBlocked,rows:1,className:"w-full px-3 md:px-4 py-2 md:py-3 rounded-lg border focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none transition-all ".concat(S||O.isBlocked?"opacity-50 cursor-not-allowed":""," ").concat(s?"bg-gray-700 border-gray-800 text-white placeholder-gray-400":"bg-gray-50 border-gray-300 placeholder-gray-500"),style:{minHeight:"40px",maxHeight:"120px"}},"textarea-".concat(O.isBlocked)),y&&!O.isBlocked&&(0,f.jsx)("div",{className:"absolute -top-6 left-0 text-xs text-blue-500 animate-pulse",children:"You are typing..."})]}),(0,f.jsx)("button",{onClick:()=>!O.isBlocked&&A(),disabled:!p.trim()||S||O.isBlocked,className:"p-2 md:p-3 rounded-lg font-semibold transition-all transform flex-shrink-0 ".concat(O.isBlocked?"bg-gray-400 text-gray-600 cursor-not-allowed":"broadcast"===(null===i||void 0===i?void 0:i.type)?"bg-gradient-to-r from-purple-500 to-pink-600 hover:from-purple-600 hover:to-pink-700 text-white":"bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white"," ").concat(!p.trim()||S||O.isBlocked?"opacity-50 cursor-not-allowed":"hover:scale-105"),title:O.isBlocked?O.reason:S?"Sending...":"Send message",children:(0,f.jsx)(U,{className:"w-4 h-4 md:w-5 md:h-5 ".concat(S?"animate-pulse":"")})})]}),p.length>950&&!O.isBlocked&&(0,f.jsx)("div",{className:"mt-2 text-xs text-right",children:(0,f.jsxs)("span",{className:p.length>1e3?"text-red-500":"text-yellow-500",children:[p.length,"/1000"]})})]},"input-".concat(O.isBlocked,"-").concat(O.type||"none"))]}):(0,f.jsx)("div",{className:"p-4 border-t ".concat(s?"bg-gray-800 border-gray-800":"bg-white border-gray-200"),children:(0,f.jsxs)("div",{className:"flex items-center justify-center space-x-3 p-4 rounded-lg ".concat(s?"bg-gray-700":"bg-gray-100"),children:[(0,f.jsx)(_,{className:"w-5 h-5 text-gray-500"}),(0,f.jsx)("span",{className:"text-gray-500 text-sm",children:null!==i&&void 0!==i&&i.userLeft?"You have left this conversation":"Only administrators can send messages in this ".concat("broadcast"===(null===i||void 0===i?void 0:i.type)?"channel":"conversation")})]})})},nt=e=>{let{isOpen:t,onClose:n,onConfirm:r,title:a,message:s,confirmText:o="Confirm",cancelText:i="Cancel",type:l="default",isDark:c=!1,icon:u=null,details:d=null}=e;if(!t)return null;const h=(()=>{switch(l){case"danger":return{iconBg:"bg-red-100 dark:bg-red-900",iconColor:"text-red-600 dark:text-red-400",confirmButton:"bg-red-600 hover:bg-red-700 text-white",defaultIcon:ue};case"warning":return{iconBg:"bg-yellow-100 dark:bg-yellow-900",iconColor:"text-yellow-600 dark:text-yellow-400",confirmButton:"bg-yellow-600 hover:bg-yellow-700 text-white",defaultIcon:ue};case"info":return{iconBg:"bg-blue-100 dark:bg-blue-900",iconColor:"text-blue-600 dark:text-blue-400",confirmButton:"bg-blue-600 hover:bg-blue-700 text-white",defaultIcon:D};default:return{iconBg:"bg-gray-100 dark:bg-gray-700",iconColor:"text-gray-600 dark:text-gray-400",confirmButton:"bg-blue-600 hover:bg-blue-700 text-white",defaultIcon:D}}})(),m=u||h.defaultIcon;return(0,f.jsxs)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[(0,f.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm transition-opacity",onClick:e=>{e.target===e.currentTarget&&n()}}),(0,f.jsx)("div",{className:"flex min-h-full items-center justify-center p-4",children:(0,f.jsxs)("div",{className:"\n            relative w-full max-w-md transform overflow-hidden rounded-2xl shadow-2xl transition-all\n            ".concat(c?"bg-gray-800 text-white":"bg-white text-gray-900","\n          "),onClick:e=>e.stopPropagation(),children:[(0,f.jsx)("button",{onClick:n,className:"\n              absolute right-4 top-4 p-1 rounded-lg transition-colors\n              ".concat(c?"hover:bg-gray-700 text-gray-400 hover:text-white":"hover:bg-gray-100 text-gray-500 hover:text-gray-700","\n            "),children:(0,f.jsx)(z,{className:"w-5 h-5"})}),(0,f.jsxs)("div",{className:"p-6",children:[(0,f.jsx)("div",{className:"flex items-center justify-center mb-4",children:(0,f.jsx)("div",{className:"w-16 h-16 rounded-full flex items-center justify-center ".concat(h.iconBg),children:(0,f.jsx)(m,{className:"w-8 h-8 ".concat(h.iconColor)})})}),(0,f.jsxs)("div",{className:"text-center",children:[(0,f.jsx)("h3",{className:"text-lg font-semibold mb-2",children:a}),(0,f.jsx)("p",{className:"text-sm mb-4 ".concat(c?"text-gray-300":"text-gray-600"),children:s}),d&&(0,f.jsx)("div",{className:"\n                  text-xs p-3 rounded-lg mb-4 \n                  ".concat(c?"bg-gray-700 text-gray-300":"bg-gray-100 text-gray-600","\n                "),children:d})]}),(0,f.jsxs)("div",{className:"flex space-x-3 mt-6",children:[(0,f.jsx)("button",{onClick:n,className:"\n                  flex-1 px-4 py-2 rounded-lg border transition-colors font-medium\n                  ".concat(c?"border-gray-600 text-gray-300 hover:bg-gray-700":"border-gray-300 text-gray-700 hover:bg-gray-50","\n                "),children:i}),(0,f.jsx)("button",{onClick:r,className:"\n                  flex-1 px-4 py-2 rounded-lg transition-colors font-medium transform hover:scale-105\n                  ".concat(h.confirmButton,"\n                "),children:o})]})]})]})})]})},rt=e=>{let{messages:t,typingUsers:n,onProfileClick:r,onImageClick:s,onForward:i,onSendMessage:l,onEditMessage:c,onDeleteMessage:u,onReactToMessage:d,onLoadMoreMessages:h,onTypingStart:p,onTypingStop:g,onUpdateConversation:y,onDeleteConversation:v,onAddParticipant:b,onRemoveParticipant:x,onAddAdmin:w,onRemoveAdmin:k,onConversationViewed:S,onClearChat:N,onBlockUser:j,onLeaveConversation:_}=e;const{currentUser:C,activeChat:E,onlineUsers:T,isDark:A,conversations:P}=m(),[O,U]=(0,a.useState)(null),[R,I]=(0,a.useState)({isOpen:!1,type:"default",title:"",message:"",confirmText:"Confirm",cancelText:"Cancel",onConfirm:()=>{},icon:null,details:null}),M=e=>{I({isOpen:!0,type:e.type||"default",title:e.title,message:e.message,confirmText:e.confirmText||"Confirm",cancelText:e.cancelText||"Cancel",onConfirm:e.onConfirm,icon:e.icon||null,details:e.details||null})},L=()=>{I(e=>(0,o.A)((0,o.A)({},e),{},{isOpen:!1}))},D=async e=>{console.log("ChatArea: Block user confirmation requested for:",e);const{otherUser:t,isCurrentlyBlocked:n}=(e=>{var t,n,r;const a=P.find(t=>"direct"===t.type&&t.participants.some(t=>t.user._id===e));return{otherUser:null===a||void 0===a||null===(t=a.participants)||void 0===t||null===(n=t.find(t=>t.user._id===e))||void 0===n?void 0:n.user,isCurrentlyBlocked:null===C||void 0===C||null===(r=C.blockedUsers)||void 0===r?void 0:r.includes(e),conversation:a}})(e);t?(console.log("Block status check:",{userId:e,otherUserName:t.name,isCurrentlyBlocked:n,currentUserBlockedUsers:null===C||void 0===C?void 0:C.blockedUsers}),M({type:n?"info":"danger",title:n?"Unblock User":"Block User",message:n?"Unblock ".concat(t.name,"?"):"Block ".concat(t.name,"?"),details:n?"They will be able to send you messages and see when you're online.":"They won't be able to send you messages or see when you're online. You can unblock them anytime.",confirmText:n?"Unblock":"Block User",cancelText:"Cancel",icon:G,onConfirm:async()=>{try{console.log("Confirmation accepted, calling onBlockUser with:",e),await j(e),L()}catch(t){console.error("Failed to block/unblock user:",t),L()}}})):console.error("User not found")};return(0,a.useEffect)(()=>{if(E&&S){const e=setTimeout(()=>{S(E._id)},500);return()=>clearTimeout(e)}},[null===E||void 0===E?void 0:E._id,S]),E?(0,f.jsxs)("div",{className:"flex flex-col h-full",children:[(0,f.jsx)(je,{isDark:A,currentUser:C,activeChat:E,onlineUsers:T,onProfileClick:r,onUpdateConversation:y,onDeleteConversation:v,onAddParticipant:b,onRemoveParticipant:x,onAddAdmin:w,onRemoveAdmin:k,onClearChat:async e=>{var t,n,r;const a=P.find(t=>t._id===e),s=(null===a||void 0===a?void 0:a.name)||(null===a||void 0===a||null===(t=a.participants)||void 0===t||null===(n=t.find(e=>e.user._id!==C._id))||void 0===n||null===(r=n.user)||void 0===r?void 0:r.name)||"this chat";M({type:"warning",title:"Clear Chat",message:'Clear all messages in "'.concat(s,'"?'),details:"This action cannot be undone. All messages, files, and media will be permanently deleted from this chat.",confirmText:"Clear Chat",cancelText:"Keep Messages",icon:ve,onConfirm:async()=>{try{await N(e),L()}catch(t){console.error("Failed to clear chat:",t),L()}}})},onBlockUser:D,onLeaveConversation:async e=>{var t,n;const r=P.find(t=>t._id===e),a=(null===r||void 0===r?void 0:r.name)||"this conversation",s="broadcast"===(null===r||void 0===r?void 0:r.type)?"channel":"group";let o="You won't be able to see new messages unless someone adds you back.";1===(null===r||void 0===r||null===(t=r.admins)||void 0===t?void 0:t.length)&&r.admins[0]._id===C._id&&(null===(n=r.participants)||void 0===n?void 0:n.length)>1&&(o="You are the only administrator. Leaving will make this ".concat(s," without any admin. Consider promoting someone else first.")),M({type:"warning",title:"Leave ".concat("channel"===s?"Channel":"Group"),message:'Leave "'.concat(a,'"?'),details:o,confirmText:"Leave ".concat("channel"===s?"Channel":"Group"),cancelText:"Stay",icon:V,onConfirm:async()=>{try{await _(e),L()}catch(t){console.error("Failed to leave ".concat(s,":"),t),L()}}})},onShowDeleteConfirmation:()=>{if("direct"===(null===E||void 0===E?void 0:E.type)){var e,t;const n=null===(e=E.participants)||void 0===e||null===(t=e.find(e=>e.user._id!==C._id))||void 0===t?void 0:t.user,r=(null===n||void 0===n?void 0:n.name)||"Unknown User";M({type:"danger",title:"Delete Chat",message:"Delete chat with ".concat(r,"?"),details:"This will permanently delete this conversation and all its messages. The other person will also lose access to this chat history.",confirmText:"Delete Chat",cancelText:"Keep Chat",icon:Y,onConfirm:async()=>{try{await v(E._id),L()}catch(e){console.error("Failed to delete conversation"),L()}}})}else{const e="broadcast"===(null===E||void 0===E?void 0:E.type)?"channel":"group",t=(null===E||void 0===E?void 0:E.name)||"this ".concat(e);M({type:"danger",title:"Delete ".concat("channel"===e?"Channel":"Group"),message:'Delete "'.concat(t,'"?'),details:"This will permanently delete the ".concat(e," and all its messages for everyone. This action cannot be undone."),confirmText:"Delete ".concat("channel"===e?"Channel":"Group"),cancelText:"Keep",icon:Y,onConfirm:async()=>{try{await v(E._id),L()}catch(e){console.error("Failed to delete conversation:",e),L()}}})}}}),(0,f.jsx)("div",{className:"flex-1 flex flex-col min-h-0",children:(0,f.jsx)($e,{isDark:A,currentUser:C,activeChat:E,messages:t||[],typingUsers:n,onImageClick:s,onForward:i,onReply:e=>{U(e)},onEditMessage:c,onDeleteMessage:u,onReactToMessage:d,onLoadMoreMessages:h})}),(0,f.jsx)(tt,{isDark:A,currentUser:C,activeChat:E,onSendMessage:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{if(!E)return void console.error("No active chat selected");await l(E._id,e,t,n),n&&U(null)}catch(r){console.error("Failed to send message:",r)}},replyingTo:O,setReplyingTo:U,onTypingStart:()=>p(E._id),onTypingStop:()=>g(E._id),onBlockUser:D}),R.isOpen&&(0,f.jsx)(nt,{isOpen:R.isOpen,onClose:L,onConfirm:R.onConfirm,title:R.title,message:R.message,confirmText:R.confirmText,cancelText:R.cancelText,type:R.type,icon:R.icon,details:R.details,isDark:A})]}):(0,f.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,f.jsx)("div",{className:"text-center text-gray-500",children:(0,f.jsx)("p",{children:"No chat selected"})})})},at=S("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),st=S("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]),ot=S("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),it=["\ud83d\udc64","\ud83d\udc68","\ud83d\udc69","\ud83e\uddd1","\ud83d\udc68\u200d\ud83d\udcbc","\ud83d\udc69\u200d\ud83d\udcbc","\ud83d\udc68\u200d\ud83c\udf93","\ud83d\udc69\u200d\ud83c\udf93","\ud83d\udc68\u200d\ud83d\udd2c","\ud83d\udc69\u200d\ud83d\udd2c","\ud83d\udc68\u200d\ud83d\udcbb","\ud83d\udc69\u200d\ud83d\udcbb","\ud83d\udc68\u200d\ud83c\udfa8","\ud83d\udc69\u200d\ud83c\udfa8","\ud83d\udc68\u200d\ud83d\ude80","\ud83d\udc69\u200d\ud83d\ude80","\ud83e\udd34","\ud83d\udc78","\ud83e\uddb8","\ud83e\uddb8\u200d\u2640\ufe0f","\ud83e\uddd9","\ud83e\uddd9\u200d\u2640\ufe0f","\ud83e\uddda","\ud83e\uddda\u200d\u2640\ufe0f","\ud83c\udfad","\ud83c\udfaa","\ud83c\udfa8","\ud83c\udfb5","\ud83c\udfb8","\ud83c\udfb9","\ud83c\udfba","\ud83c\udfbb","\u26bd","\ud83c\udfc0","\ud83c\udfc8","\u26be","\ud83c\udfbe","\ud83c\udfd0","\ud83c\udfc9","\ud83c\udfb1","\ud83c\udf0d","\ud83c\udf0e","\ud83c\udf0f","\ud83c\udf19","\u2b50","\ud83c\udf1f","\ud83d\udcab","\u2728","\ud83d\udd25","\ud83d\udc8e","\ud83c\udfaf","\ud83c\udfb2","\ud83c\udfae","\ud83d\udd79\ufe0f","\ud83c\udf8a","\ud83c\udf89"],lt=e=>{var t;let{user:n,onClose:r}=e;const{currentUser:s,updateUserProfile:i,isDark:l}=m(),[c,u]=(0,a.useState)(!1),[d,h]=(0,a.useState)(!1),[p,g]=(0,a.useState)(""),[y,v]=(0,a.useState)(!1),[b,x]=(0,a.useState)(n),[w,k]=(0,a.useState)({name:n.name||"",email:n.email||"",bio:n.bio||"",phone:n.phone||"",status:n.status||"online",avatar:n.avatar||""});(0,a.useEffect)(()=>{x(n),k({name:n.name||"",email:n.email||"",bio:n.bio||"",phone:n.phone||"",status:n.status||"online",avatar:n.avatar||""})},[n]);const S=(e,t)=>{k(n=>(0,o.A)((0,o.A)({},n),{},{[e]:t})),p&&g("")},N=e=>{k(t=>(0,o.A)((0,o.A)({},t),{},{avatar:e})),v(!1),p&&g("")},j=b._id===(null===s||void 0===s?void 0:s._id)||b.id===(null===s||void 0===s?void 0:s.id);return(0,f.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:(0,f.jsxs)("div",{className:"w-full max-w-md mx-4 ".concat(l?"bg-gray-800":"bg-white"," rounded-lg shadow-xl max-h-96 overflow-y-auto"),children:[(0,f.jsx)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:(0,f.jsxs)("div",{className:"flex items-center justify-between",children:[(0,f.jsx)("button",{onClick:r,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700",disabled:d,children:(0,f.jsx)(R,{className:"w-5 h-5"})}),(0,f.jsx)("h2",{className:"text-lg font-semibold",children:"Profile"}),j&&(0,f.jsx)("div",{className:"flex space-x-2",children:c?(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("button",{onClick:()=>{k({name:b.name||"",email:b.email||"",bio:b.bio||"",phone:b.phone||"",status:b.status||"online",avatar:b.avatar||""}),g(""),u(!1),v(!1)},className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-500",disabled:d,children:(0,f.jsx)(z,{className:"w-5 h-5"})}),(0,f.jsx)("button",{onClick:async()=>{h(!0),g("");try{const e={};if(w.name!==b.name&&(e.name=w.name),w.email!==b.email&&(e.email=w.email),w.bio!==b.bio&&(e.bio=w.bio),w.phone!==b.phone&&(e.phone=w.phone),w.status!==b.status&&(e.status=w.status),w.avatar!==b.avatar&&(e.avatar=w.avatar),Object.keys(e).length>0){const t=await be.updateProfile(e);t.success&&(x(t.user),i(t.user),u(!1))}else u(!1)}catch(p){console.error("Failed to update profile:",p),g(p.message||"Failed to update profile. Please try again.")}finally{h(!1)}},className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-green-600",disabled:d,children:d?(0,f.jsx)(at,{className:"w-5 h-5 animate-spin"}):(0,f.jsx)(st,{className:"w-5 h-5"})})]}):(0,f.jsx)("button",{onClick:()=>u(!0),className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700",children:(0,f.jsx)(ot,{className:"w-5 h-5"})})})]})}),p&&(0,f.jsx)("div",{className:"mx-4 mt-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded-lg",children:p}),(0,f.jsxs)("div",{className:"p-6",children:[(0,f.jsxs)("div",{className:"text-center mb-6",children:[(0,f.jsxs)("div",{className:"relative inline-block",children:[(0,f.jsx)("div",{className:"w-24 h-24 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-3xl",children:(c?w.avatar:b.avatar)||(null===(t=b.name)||void 0===t?void 0:t.charAt(0).toUpperCase())||"\ud83d\udc64"}),j&&c&&(0,f.jsx)("button",{onClick:()=>v(!y),className:"absolute -bottom-2 -right-2 p-2 bg-blue-500 text-white rounded-full hover:bg-blue-600 transition-colors",children:(0,f.jsx)(ot,{className:"w-4 h-4"})})]}),(0,f.jsx)("div",{className:"mt-4",children:c?(0,f.jsx)("input",{type:"text",value:w.name,onChange:e=>S("name",e.target.value),className:"text-xl font-semibold text-center w-full px-3 py-2 rounded-lg border ".concat(l?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"," focus:ring-2 focus:ring-blue-500 focus:border-transparent"),disabled:d,maxLength:50,placeholder:"Enter your name"}):(0,f.jsx)("h3",{className:"text-xl font-semibold",children:b.name||"No name set"})}),(0,f.jsx)("div",{className:"mt-2",children:c?(0,f.jsx)("input",{type:"email",value:w.email,onChange:e=>S("email",e.target.value),className:"text-center w-full px-3 py-1 rounded-lg border ".concat(l?"bg-gray-700 border-gray-600 text-gray-400":"bg-white border-gray-300 text-gray-500"," focus:ring-2 focus:ring-blue-500 focus:border-transparent"),disabled:d,placeholder:"Enter your email"}):(0,f.jsx)("p",{className:"text-gray-500",children:b.email||"No email set"})}),(0,f.jsx)("div",{className:"mt-2",children:(0,f.jsx)("div",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm ".concat("online"===b.status?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":"away"===b.status?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"),children:b.status||"online"})})]}),(0,f.jsxs)("div",{className:"mb-6",children:[(0,f.jsx)("h4",{className:"font-semibold mb-2",children:"About"}),c?(0,f.jsx)("textarea",{value:w.bio,onChange:e=>S("bio",e.target.value),rows:3,className:"w-full px-3 py-2 rounded-lg border ".concat(l?"bg-gray-700 border-gray-600 text-gray-300":"bg-white border-gray-300 text-gray-600"," focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"),placeholder:"Tell us about yourself...",disabled:d,maxLength:500}):(0,f.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:b.bio||"No bio added yet."})]}),(0,f.jsx)("div",{className:"space-y-4",children:(0,f.jsxs)("div",{children:[(0,f.jsx)("h4",{className:"font-semibold mb-2",children:"Contact Info"}),(0,f.jsxs)("div",{className:"space-y-3",children:[(0,f.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,f.jsx)(A,{className:"w-5 h-5 text-gray-400 flex-shrink-0"}),c?(0,f.jsx)("input",{type:"tel",value:w.phone,onChange:e=>S("phone",e.target.value),className:"flex-1 px-3 py-1 rounded-lg border ".concat(l?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"," focus:ring-2 focus:ring-blue-500 focus:border-transparent"),disabled:d,placeholder:"Enter phone number"}):(0,f.jsx)("span",{children:b.phone||"No phone number"})]}),(0,f.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,f.jsx)(D,{className:"w-5 h-5 text-gray-400 flex-shrink-0"}),(0,f.jsx)("span",{children:c?w.email:b.email||"No email set"})]})]})]})}),!j&&(0,f.jsx)("div",{className:"mt-6 space-y-3",children:(0,f.jsx)("button",{onClick:r,className:"w-full py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:"Send Message"})})]}),y&&(0,f.jsx)("div",{className:"fixed inset-0 z-60 flex items-center justify-center bg-black bg-opacity-50",children:(0,f.jsxs)("div",{className:"w-full max-w-md mx-4 ".concat(l?"bg-gray-800":"bg-white"," rounded-lg shadow-xl"),children:[(0,f.jsx)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:(0,f.jsxs)("div",{className:"flex items-center justify-between",children:[(0,f.jsx)("h3",{className:"text-lg font-semibold",children:"Choose Avatar"}),(0,f.jsx)("button",{onClick:()=>v(!1),className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700",children:(0,f.jsx)(z,{className:"w-5 h-5"})})]})}),(0,f.jsxs)("div",{className:"p-6",children:[(0,f.jsx)("div",{className:"grid grid-cols-8 gap-3 max-h-64 overflow-y-auto",children:it.map((e,t)=>(0,f.jsxs)("button",{onClick:()=>N(e),className:"w-12 h-12 rounded-full flex items-center justify-center text-2xl hover:scale-110 transition-all ".concat(w.avatar===e?"ring-2 ring-blue-500 bg-blue-50 dark:bg-blue-900":"hover:bg-gray-100 dark:hover:bg-gray-700"),children:[e,w.avatar===e&&(0,f.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,f.jsx)(Se,{className:"w-4 h-4 text-blue-500"})})]},t))}),(0,f.jsx)("div",{className:"mt-4 text-center",children:(0,f.jsx)("button",{onClick:()=>N(""),className:"px-4 py-2 rounded-lg text-sm ".concat(""===w.avatar?"bg-blue-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600"),children:"Use Initial Letter"})})]})]})})]})})},ct=e=>{var t,n;let{message:r,conversations:s,activeChat:o,isDark:i,currentUser:l,onForward:c,onClose:u}=e;const[d,h]=(0,a.useState)([]),[m,p]=(0,a.useState)(""),[g,y]=(0,a.useState)(!1),v=e=>{if("group"===e.type||"broadcast"===e.type)return null;const t=e.participants.find(e=>e.user._id!==(null===l||void 0===l?void 0:l._id));return t?t.user:null},b=e=>{if("group"===e.type||"broadcast"===e.type)return e.name||("broadcast"===e.type?"Broadcast":"Group Chat");{const t=v(e);return(null===t||void 0===t?void 0:t.name)||"Unknown User"}},x=s.filter(e=>e._id!==(null===o||void 0===o?void 0:o._id)&&(""===m||b(e).toLowerCase().includes(m.toLowerCase()))),w=()=>{if(J(r)){const e=X(r);return r.displayText||e}return r.content||r.displayText||"Message"},k=()=>{var e,t,n;if(!J(r))return null;const a=r.messageType||(null===(e=r.originalMessage)||void 0===e?void 0:e.messageType),s=r.fileInfo||(null===(t=r.originalMessage)||void 0===t?void 0:t.fileInfo),o=X(r.originalMessage||r).toLowerCase().endsWith(".gif")||"image/gif"===(null===s||void 0===s?void 0:s.type)||(null===s||void 0===s||null===(n=s.originalName)||void 0===n?void 0:n.toLowerCase().endsWith(".gif"));switch(a){case"image":return o?"\ud83c\udf9e\ufe0f GIF":"\ud83d\uddbc\ufe0f Image";case"video":return"\ud83c\udfa5 Video";case"audio":return"\ud83c\udfb5 Audio";case"pdf":return"\ud83d\udcc4 PDF";case"document":return"\ud83d\udcdd Document";case"xlsx":return"\ud83d\udcca Spreadsheet";default:return"\ud83d\udcce File"}},S=e=>{if("group"===e.type)return e.avatar||"\ud83d\udc65";if("broadcast"===e.type)return e.avatar||"\ud83d\udce2";{var t;const n=v(e);return(null===n||void 0===n?void 0:n.avatar)||(null===n||void 0===n||null===(t=n.name)||void 0===t?void 0:t.charAt(0).toUpperCase())||"\ud83d\udc64"}},N=e=>"group"===e.type?"bg-gradient-to-r from-green-500 to-teal-600":"broadcast"===e.type?"bg-gradient-to-r from-purple-500 to-pink-600":"bg-gradient-to-r from-blue-500 to-purple-600",j=e=>{if("group"===e.type)return"".concat(e.participants.length," members");if("broadcast"===e.type)return"".concat(e.participants.length," subscribers");{const t=v(e);return(null===t||void 0===t?void 0:t.email)||"Direct message"}};return(0,f.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,f.jsxs)("div",{className:"w-full max-w-md rounded-2xl shadow-2xl ".concat(i?"bg-gray-800 text-white":"bg-white"),children:[(0,f.jsx)("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:(0,f.jsxs)("div",{className:"flex items-center justify-between",children:[(0,f.jsx)("h2",{className:"text-xl font-bold",children:"Forward Message"}),(0,f.jsx)("button",{onClick:u,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",disabled:g,children:(0,f.jsx)(z,{className:"w-5 h-5"})})]})}),(0,f.jsxs)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:[(0,f.jsx)("div",{className:"text-sm text-gray-500 mb-2",children:"Message to forward:"}),(0,f.jsx)("div",{className:"p-3 rounded-lg ".concat(i?"bg-gray-700":"bg-gray-100"),children:(0,f.jsx)("div",{className:"text-sm",children:J(r)?(0,f.jsx)("div",{className:"flex items-center space-x-2",children:(0,f.jsx)("div",{className:"flex-1 min-w-0",children:(0,f.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,f.jsx)("span",{className:"text-lg",children:null===(t=k())||void 0===t?void 0:t.split(" ")[0]}),(0,f.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,f.jsx)("div",{className:"font-medium truncate",title:X(r.originalMessage||r),children:X(r.originalMessage||r)}),(0,f.jsx)("div",{className:"text-xs text-gray-500",children:null===(n=k())||void 0===n?void 0:n.split(" ").slice(1).join(" ")})]})]})})}):(0,f.jsx)("div",{className:"break-words",children:(0,f.jsx)("span",{className:"truncate max-w-[200px] inline-block",title:w(),children:w()})})})})]}),(0,f.jsx)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:(0,f.jsxs)("div",{className:"relative",children:[(0,f.jsx)(H,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),(0,f.jsx)("input",{type:"text",placeholder:"Search conversations...",value:m,onChange:e=>p(e.target.value),className:"w-full pl-10 pr-4 py-2 rounded-lg border focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all ".concat(i?"bg-gray-700 border-gray-600 text-white placeholder-gray-400":"bg-gray-50 border-gray-300"),disabled:g})]})}),(0,f.jsx)("div",{className:"max-h-64 overflow-y-auto",children:0===x.length?(0,f.jsx)("div",{className:"p-4 text-center text-gray-500",children:m?"No conversations found":"No other conversations available"}):x.map(e=>{const t=d.some(t=>t._id===e._id),n=b(e);return(0,f.jsx)("div",{onClick:()=>!g&&(e=>{h(t=>t.some(t=>t._id===e._id)?t.filter(t=>t._id!==e._id):[...t,e])})(e),className:"p-4 cursor-pointer transition-colors border-b border-gray-100 dark:border-gray-700 ".concat(t?i?"bg-blue-600 hover:bg-blue-700":"bg-blue-50 hover:bg-blue-100":i?"hover:bg-gray-700":"hover:bg-gray-50"," ").concat(g?"opacity-50 cursor-not-allowed":""),children:(0,f.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,f.jsxs)("div",{className:"relative",children:[(0,f.jsx)("div",{className:"w-10 h-10 ".concat(N(e)," rounded-full flex items-center justify-center"),children:(0,f.jsx)("span",{className:"text-white font-semibold",children:S(e)})}),t&&(0,f.jsx)("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-green-500 rounded-full flex items-center justify-center",children:(0,f.jsx)(Se,{className:"w-3 h-3 text-white"})})]}),(0,f.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,f.jsx)("h3",{className:"font-medium truncate ".concat(t?i?"text-white":"text-blue-900":""),children:n}),(0,f.jsx)("p",{className:"text-sm truncate ".concat(t?i?"text-blue-100":"text-blue-600":"text-gray-500"),children:j(e)})]})]})},e._id)})}),(0,f.jsx)("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700",children:(0,f.jsxs)("div",{className:"flex items-center justify-between",children:[(0,f.jsx)("div",{className:"text-sm text-gray-500",children:d.length>0&&"".concat(d.length," conversation").concat(d.length>1?"s":""," selected")}),(0,f.jsxs)("div",{className:"flex space-x-2",children:[(0,f.jsx)("button",{onClick:u,disabled:g,className:"px-4 py-2 rounded-lg border transition-colors ".concat(i?"border-gray-600 hover:bg-gray-700 disabled:opacity-50":"border-gray-300 hover:bg-gray-50 disabled:opacity-50"," disabled:cursor-not-allowed"),children:"Cancel"}),(0,f.jsx)("button",{onClick:async()=>{if(0!==d.length){y(!0);try{await c(d,r),u()}catch(e){console.error("Forward failed:",e)}finally{y(!1)}}},disabled:0===d.length||g,className:"px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center space-x-2",children:g?(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),(0,f.jsx)("span",{children:"Forwarding..."})]}):(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(U,{className:"w-4 h-4"}),(0,f.jsx)("span",{children:"Forward"})]})})]})]})})]})})},ut=e=>{let{isOpen:t,onClose:n,onCreateConversation:r,onCreateDirectConversation:s,isDark:o,mode:i="select"}=e;const{currentUser:l,conversations:c}=m(),[u,d]=(0,a.useState)(i),[h,p]=(0,a.useState)(1),[g,y]=(0,a.useState)(""),[v,b]=(0,a.useState)(""),[x,w]=(0,a.useState)("\ud83d\udc65"),[k,S]=(0,a.useState)(""),[j,_]=(0,a.useState)([]),[C,E]=(0,a.useState)([]),[T,A]=(0,a.useState)(!1),[P,O]=(0,a.useState)(!1),[U,R]=(0,a.useState)(""),[I,M]=(0,a.useState)([]),[L,V]=(0,a.useState)(!1),W=["\ud83d\udc65","\ud83c\udf89","\ud83d\udcbc","\ud83c\udfae","\ud83d\udcda","\u26bd","\ud83c\udfb5","\ud83c\udf55","\u2708\ufe0f","\ud83c\udf1f"],K=["\ud83d\udce2","\ud83d\udcfa","\ud83d\udcfb","\ud83d\udd0a","\ud83d\udce1","\ud83c\udfaf","\ud83d\udea8","\ud83d\udcf0","\ud83d\udce3","\ud83c\udfaa"];(0,a.useEffect)(()=>{t&&(d(i),p("select"===i?1:"direct"===i?2:1),y(""),b(""),w("broadcast"===i?"\ud83d\udce2":"\ud83d\udc65"),S(""),_([]),E([]),M([]),V("broadcast"===i),R(""))},[t,i]);(0,a.useEffect)(()=>{const e=setTimeout(()=>{(async e=>{if(!e.trim()||e.length<2)_([]);else{A(!0),R("");try{const t=await be.searchByEmail(e);if(t.success&&t.users){const e=t.users.filter(e=>e._id!==l._id&&!C.some(t=>t._id===e._id));_(e)}else _([])}catch(U){console.error("Search error:",U),R("Failed to search users"),_([])}finally{A(!1)}}})(k)},300);return()=>clearTimeout(e)},[k]);const G=async()=>{if(1===C.length){O(!0),R("");try{const e=C[0];if(c.find(t=>"direct"===t.type&&t.participants.some(t=>t.user._id===e._id)))return void n();await s(e._id),n()}catch(U){console.error("Failed to create direct conversation:",U),R("Failed to create conversation. Please try again.")}finally{O(!1)}}else R("Please select exactly one person for direct message")};return t?(0,f.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,f.jsxs)("div",{className:"w-full max-w-lg max-h-[90vh] flex flex-col rounded-2xl shadow-2xl ".concat(o?"bg-gray-800 text-white":"bg-white"),children:[(0,f.jsx)("div",{className:"flex-shrink-0 p-6 border-b border-gray-200 dark:border-gray-700",children:(0,f.jsxs)("div",{className:"flex items-center justify-between",children:[(0,f.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,f.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center ".concat("broadcast"===u?"bg-gradient-to-r from-purple-500 to-pink-600":"group"===u?"bg-gradient-to-r from-green-500 to-teal-600":"bg-gradient-to-r from-blue-500 to-purple-600"),children:"broadcast"===u?(0,f.jsx)(B,{className:"w-5 h-5 text-white"}):"group"===u?(0,f.jsx)(N,{className:"w-5 h-5 text-white"}):(0,f.jsx)(D,{className:"w-5 h-5 text-white"})}),(0,f.jsxs)("div",{children:[(0,f.jsx)("h2",{className:"text-xl font-bold",children:(()=>{if("select"===u)return"New Conversation";if("direct"===u)return"Direct Message";if("broadcast"===u){if(1===h)return"Create Broadcast Channel";if(2===h)return"Add Subscribers";if(3===h)return"Admin Settings"}else{if(1===h)return"Create Group";if(2===h)return"Add Participants";if(3===h)return"Admin Settings"}return"New Conversation"})()}),(0,f.jsx)("p",{className:"text-sm text-gray-500",children:(()=>{if("select"===u)return"Choose conversation type";if("direct"===u)return"Find someone to chat with";if("broadcast"===u){if(1===h)return"Set up your broadcast channel";if(2===h)return"".concat(C.length," subscribers selected");if(3===h)return"Manage channel administrators"}else{if(1===h)return"Set up your group details";if(2===h)return"".concat(C.length," participants selected");if(3===h)return"Choose group administrators"}return""})()})]})]}),(0,f.jsx)("button",{onClick:n,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:(0,f.jsx)(z,{className:"w-5 h-5"})})]})}),(0,f.jsx)("div",{className:"flex-1 overflow-y-auto min-h-0",children:(0,f.jsxs)("div",{className:"p-6",children:[1===h&&"select"===u&&(0,f.jsxs)("div",{className:"space-y-4",children:[(0,f.jsx)("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"What type of conversation would you like to create?"}),(0,f.jsx)("button",{onClick:()=>d("direct"),className:"w-full p-4 rounded-lg border-2 border-dashed transition-all hover:shadow-md ".concat(o?"border-gray-600 hover:border-blue-500 hover:bg-gray-700":"border-gray-300 hover:border-blue-500 hover:bg-blue-50"),children:(0,f.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,f.jsx)("div",{className:"w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center",children:(0,f.jsx)(q,{className:"w-6 h-6 text-white"})}),(0,f.jsxs)("div",{className:"text-left",children:[(0,f.jsx)("h3",{className:"font-semibold",children:"Direct Message"}),(0,f.jsx)("p",{className:"text-sm text-gray-500",children:"Private conversation with one person"})]})]})}),(0,f.jsx)("button",{onClick:()=>d("group"),className:"w-full p-4 rounded-lg border-2 border-dashed transition-all hover:shadow-md ".concat(o?"border-gray-600 hover:border-green-500 hover:bg-gray-700":"border-gray-300 hover:border-green-500 hover:bg-green-50"),children:(0,f.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,f.jsx)("div",{className:"w-12 h-12 bg-gradient-to-r from-green-500 to-teal-600 rounded-full flex items-center justify-center",children:(0,f.jsx)(N,{className:"w-6 h-6 text-white"})}),(0,f.jsxs)("div",{className:"text-left",children:[(0,f.jsx)("h3",{className:"font-semibold",children:"Group Chat"}),(0,f.jsx)("p",{className:"text-sm text-gray-500",children:"Group conversation with multiple people"})]})]})}),(0,f.jsx)("button",{onClick:()=>d("broadcast"),className:"w-full p-4 rounded-lg border-2 border-dashed transition-all hover:shadow-md ".concat(o?"border-gray-600 hover:border-purple-500 hover:bg-gray-700":"border-gray-300 hover:border-purple-500 hover:bg-purple-50"),children:(0,f.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,f.jsx)("div",{className:"w-12 h-12 bg-gradient-to-r from-purple-500 to-pink-600 rounded-full flex items-center justify-center",children:(0,f.jsx)(B,{className:"w-6 h-6 text-white"})}),(0,f.jsxs)("div",{className:"text-left",children:[(0,f.jsx)("h3",{className:"font-semibold",children:"Broadcast Channel"}),(0,f.jsx)("p",{className:"text-sm text-gray-500",children:"One-way communication channel (read-only for subscribers)"})]})]})})]}),1===h&&("group"===u||"broadcast"===u)&&(0,f.jsxs)("div",{className:"space-y-6",children:[(0,f.jsxs)("div",{children:[(0,f.jsxs)("label",{className:"block text-sm font-medium mb-3",children:["broadcast"===u?"Channel":"Group"," Avatar"]}),(0,f.jsx)("div",{className:"flex flex-wrap gap-2",children:("broadcast"===u?K:W).map(e=>(0,f.jsx)("button",{onClick:()=>w(e),className:"w-12 h-12 rounded-full flex items-center justify-center text-xl transition-all ".concat(x===e?"broadcast"===u?"bg-gradient-to-r from-purple-500 to-pink-600 text-white scale-110":"bg-gradient-to-r from-green-500 to-teal-600 text-white scale-110":o?"bg-gray-700 hover:bg-gray-600":"bg-gray-100 hover:bg-gray-200"),children:e},e))})]}),(0,f.jsxs)("div",{children:[(0,f.jsxs)("label",{className:"block text-sm font-medium mb-2",children:["broadcast"===u?"Channel":"Group"," Name *"]}),(0,f.jsx)("input",{type:"text",placeholder:"Enter ".concat("broadcast"===u?"channel":"group"," name"),value:g,onChange:e=>y(e.target.value),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 ".concat("broadcast"===u?"focus:ring-purple-500":"focus:ring-green-500"," focus:border-transparent transition-all ").concat(o?"bg-gray-700 border-gray-600 text-white placeholder-gray-400":"bg-gray-50 border-gray-300"),maxLength:50}),(0,f.jsxs)("div",{className:"flex justify-between mt-1",children:[(0,f.jsx)("span",{}),(0,f.jsxs)("span",{className:"text-xs text-gray-500",children:[g.length,"/50"]})]})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Description (Optional)"}),(0,f.jsx)("textarea",{placeholder:"What's this ".concat("broadcast"===u?"channel":"group"," about?"),value:v,onChange:e=>b(e.target.value),rows:3,className:"w-full px-4 py-3 rounded-lg border focus:ring-2 ".concat("broadcast"===u?"focus:ring-purple-500":"focus:ring-green-500"," focus:border-transparent transition-all resize-none ").concat(o?"bg-gray-700 border-gray-600 text-white placeholder-gray-400":"bg-gray-50 border-gray-300"),maxLength:200}),(0,f.jsxs)("div",{className:"flex justify-between mt-1",children:[(0,f.jsx)("span",{}),(0,f.jsxs)("span",{className:"text-xs text-gray-500",children:[v.length,"/200"]})]})]}),"broadcast"===u&&(0,f.jsx)("div",{className:"p-4 rounded-lg border ".concat(o?"bg-purple-900/20 border-purple-700":"bg-purple-50 border-purple-200"),children:(0,f.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,f.jsx)(B,{className:"w-5 h-5 text-purple-500 mt-0.5"}),(0,f.jsxs)("div",{children:[(0,f.jsx)("h4",{className:"font-medium text-purple-700 dark:text-purple-300",children:"Broadcast Channel"}),(0,f.jsx)("p",{className:"text-sm text-purple-600 dark:text-purple-400 mt-1",children:"Only admins can send messages. Subscribers can only read messages."})]})]})})]}),2===h&&(0,f.jsxs)("div",{className:"space-y-4",children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("label",{className:"block text-sm font-medium mb-2",children:"direct"===u?"Search by email":"broadcast"===u?"Search subscribers by email":"Search participants by email"}),(0,f.jsxs)("div",{className:"relative",children:[(0,f.jsx)(H,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,f.jsx)("input",{type:"email",placeholder:"Enter email address",value:k,onChange:e=>S(e.target.value),className:"w-full pl-10 pr-4 py-3 rounded-lg border focus:ring-2 ".concat("broadcast"===u?"focus:ring-purple-500":"group"===u?"focus:ring-green-500":"focus:ring-blue-500"," focus:border-transparent transition-all ").concat(o?"bg-gray-700 border-gray-600 text-white placeholder-gray-400":"bg-gray-50 border-gray-300")}),T&&(0,f.jsx)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:(0,f.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 ".concat("broadcast"===u?"border-purple-500":"group"===u?"border-green-500":"border-blue-500")})})]})]}),j.length>0&&(0,f.jsxs)("div",{className:"space-y-2",children:[(0,f.jsx)("h3",{className:"text-sm font-medium text-gray-500",children:"Search Results"}),(0,f.jsx)("div",{className:"max-h-32 overflow-y-auto space-y-2 border rounded-lg p-2",children:j.map(e=>{var t;return(0,f.jsx)("div",{onClick:()=>(e=>{C.some(t=>t._id===e._id)||(E([...C,e]),S(""),_([]))})(e),className:"p-3 rounded-lg cursor-pointer transition-all hover:shadow-sm ".concat(o?"bg-gray-700 hover:bg-gray-600":"bg-gray-50 hover:bg-gray-100"),children:(0,f.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,f.jsx)("div",{className:"w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center",children:(0,f.jsx)("span",{className:"text-white text-sm font-semibold",children:e.avatar||(null===(t=e.name)||void 0===t?void 0:t.charAt(0).toUpperCase())||"?"})}),(0,f.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,f.jsx)("p",{className:"font-medium text-sm truncate",children:e.name}),(0,f.jsx)("p",{className:"text-xs text-gray-500 truncate",children:e.email})]}),(0,f.jsx)(F,{className:"w-4 h-4 ".concat("broadcast"===u?"text-purple-500":"group"===u?"text-green-500":"text-blue-500")})]})},e._id)})})]}),C.length>0&&(0,f.jsxs)("div",{className:"space-y-2",children:[(0,f.jsxs)("h3",{className:"text-sm font-medium text-gray-500",children:["Selected ","broadcast"===u?"Subscribers":"Participants"," (",C.length,")"]}),(0,f.jsx)("div",{className:"max-h-40 overflow-y-auto space-y-2 border rounded-lg p-2",children:C.map(e=>{var t;return(0,f.jsx)("div",{className:"p-3 rounded-lg ".concat(o?"bg-gray-700":"broadcast"===u?"bg-purple-50":"group"===u?"bg-green-50":"bg-blue-50"),children:(0,f.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,f.jsx)("div",{className:"w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center",children:(0,f.jsx)("span",{className:"text-white text-sm font-semibold",children:e.avatar||(null===(t=e.name)||void 0===t?void 0:t.charAt(0).toUpperCase())||"?"})}),(0,f.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,f.jsx)("p",{className:"font-medium text-sm truncate",children:e.name}),(0,f.jsx)("p",{className:"text-xs text-gray-500 truncate",children:e.email})]}),(0,f.jsx)("button",{onClick:()=>{return t=e._id,E(C.filter(e=>e._id!==t)),void M(I.filter(e=>e!==t));var t},className:"p-1 rounded-full hover:bg-red-100 dark:hover:bg-red-900 text-red-500 transition-colors",children:(0,f.jsx)(z,{className:"w-4 h-4"})})]})},e._id)})})]})]}),3===h&&(0,f.jsxs)("div",{className:"space-y-4",children:[(0,f.jsx)("div",{className:"p-4 rounded-lg border ".concat(o?"bg-gray-700 border-gray-600":"broadcast"===u?"bg-purple-50 border-purple-200":"bg-green-50 border-green-200"),children:(0,f.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,f.jsx)("div",{className:"w-12 h-12 rounded-full flex items-center justify-center ".concat("broadcast"===u?"bg-gradient-to-r from-purple-500 to-pink-600":"bg-gradient-to-r from-green-500 to-teal-600"),children:(0,f.jsx)("span",{className:"text-white text-xl",children:x})}),(0,f.jsxs)("div",{children:[(0,f.jsx)("p",{className:"font-semibold",children:g}),(0,f.jsxs)("p",{className:"text-sm text-gray-500",children:[C.length+1," ","broadcast"===u?"subscribers":"members"," (including you)"]})]}),(0,f.jsx)($,{className:"w-5 h-5 text-yellow-500 ml-auto",title:"You'll be the admin"})]})}),(0,f.jsxs)("div",{children:[(0,f.jsxs)("h3",{className:"text-sm font-medium text-gray-500 mb-3",children:["Choose Additional Administrators","broadcast"===u&&(0,f.jsx)("span",{className:"block text-xs text-purple-600 dark:text-purple-400 mt-1",children:"Only admins can send messages in broadcast channels"})]}),(0,f.jsx)("div",{className:"max-h-48 overflow-y-auto space-y-2 border rounded-lg p-2",children:C.map(e=>{var t;return(0,f.jsx)("div",{className:"p-3 rounded-lg transition-all cursor-pointer ".concat(I.includes(e._id)?o?"bg-yellow-900/20 border border-yellow-700":"bg-yellow-50 border border-yellow-200":o?"bg-gray-700 hover:bg-gray-600":"bg-gray-50 hover:bg-gray-100"),onClick:()=>{return t=e._id,void(I.includes(t)?M(I.filter(e=>e!==t)):M([...I,t]));var t},children:(0,f.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,f.jsx)("div",{className:"w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center",children:(0,f.jsx)("span",{className:"text-white text-sm font-semibold",children:e.avatar||(null===(t=e.name)||void 0===t?void 0:t.charAt(0).toUpperCase())||"?"})}),(0,f.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,f.jsx)("p",{className:"font-medium text-sm truncate",children:e.name}),(0,f.jsx)("p",{className:"text-xs text-gray-500 truncate",children:e.email})]}),(0,f.jsxs)("div",{className:"flex items-center space-x-2",children:[I.includes(e._id)&&(0,f.jsx)($,{className:"w-4 h-4 text-yellow-500"}),(0,f.jsx)("div",{className:"w-4 h-4 rounded border-2 flex items-center justify-center ".concat(I.includes(e._id)?"bg-yellow-500 border-yellow-500":"border-gray-300 dark:border-gray-600"),children:I.includes(e._id)&&(0,f.jsx)(Se,{className:"w-3 h-3 text-white"})})]})]})},e._id)})})]}),I.length>0&&(0,f.jsx)("div",{className:"p-3 rounded-lg border ".concat(o?"bg-yellow-900/20 border-yellow-700":"bg-yellow-50 border-yellow-200"),children:(0,f.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,f.jsx)(ge,{className:"w-4 h-4 text-yellow-600"}),(0,f.jsxs)("span",{className:"text-sm text-yellow-700 dark:text-yellow-300",children:[I.length+1," administrator",I.length>0?"s":""," selected (including you)"]})]})})]}),U&&(0,f.jsx)("div",{className:"mt-4 p-3 rounded-lg bg-red-100 border border-red-300 text-red-700 text-sm",children:U})]})}),(0,f.jsx)("div",{className:"flex-shrink-0 p-6 border-t border-gray-200 dark:border-gray-700",children:(0,f.jsxs)("div",{className:"flex justify-between space-x-3",children:[(h>1||1===h&&"select"!==u)&&(0,f.jsx)("button",{onClick:()=>{3===h?p(2):2===h?"direct"===u?(d("select"),p(1)):p(1):1===h&&"select"!==u&&d("select"),R("")},className:"px-4 py-2 rounded-lg font-medium transition-colors ".concat(o?"bg-gray-700 hover:bg-gray-600 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"),children:"Back"}),(0,f.jsxs)("div",{className:"flex space-x-3 ml-auto",children:[(0,f.jsx)("button",{onClick:n,className:"px-4 py-2 rounded-lg font-medium transition-colors ".concat(o?"text-gray-400 hover:text-white":"text-gray-600 hover:text-gray-800"),children:"Cancel"}),"select"===u?null:h<("direct"===u?2:3)?(0,f.jsx)("button",{onClick:()=>{if(1===h&&"direct"!==u){if(!g.trim())return void R("".concat("broadcast"===u?"Channel":"Group"," name is required"));R(""),p(2)}else if(2===h)if("direct"===u)G();else{if(0===C.length)return void R("Please add at least one participant");R(""),p(3)}},disabled:1===h&&!g.trim()&&"direct"!==u||2===h&&"direct"===u&&1!==C.length||2===h&&"direct"!==u&&0===C.length,className:"px-6 py-2 text-white rounded-lg font-semibold transition-all transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none ".concat("broadcast"===u?"bg-gradient-to-r from-purple-500 to-pink-600 hover:from-purple-600 hover:to-pink-700":"group"===u?"bg-gradient-to-r from-green-500 to-teal-600 hover:from-green-600 hover:to-teal-700":"bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700"),children:2===h&&"direct"===u?"Create Chat":"Next"}):(0,f.jsx)("button",{onClick:"direct"===u?G:async()=>{if(0!==C.length){O(!0),R("");try{const e=C.map(e=>e._id),t="broadcast"===u?"broadcast":"group",a=[l._id,...I];await r(e,g.trim(),t,{description:v.trim(),avatar:x,admins:a,isBroadcast:"broadcast"===u}),n()}catch(U){console.error("Failed to create conversation:",U),R("Failed to create ".concat("broadcast"===u?"channel":"group",". Please try again."))}finally{O(!1)}}else R("Please add at least one participant")},disabled:P||"direct"!==u&&0===C.length,className:"px-6 py-2 text-white rounded-lg font-semibold transition-all transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center space-x-2 ".concat("broadcast"===u?"bg-gradient-to-r from-purple-500 to-pink-600 hover:from-purple-600 hover:to-pink-700":"group"===u?"bg-gradient-to-r from-green-500 to-teal-600 hover:from-green-600 hover:to-teal-700":"bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700"),children:P?(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),(0,f.jsx)("span",{children:"Creating..."})]}):(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(Se,{className:"w-4 h-4"}),(0,f.jsxs)("span",{children:["Create ","broadcast"===u?"Channel":"group"===u?"Group":"Chat"]})]})})]})]})})]})}):null},dt=e=>{let{messages:t,setMessages:n,typingUsers:r,onCreateDirectConversation:s,onCreateConversation:i,onSendMessage:l,onEditMessage:c,onDeleteMessage:u,onReactToMessage:d,onSendFile:h,onLoadMoreMessages:p,onTypingStart:g,onTypingStop:y,onDeleteConversation:v,onAddAdmin:b,onRemoveAdmin:x,onAddParticipant:w,onRemoveParticipant:k,onUpdateConversation:S,onClearChat:N,onBlockUser:j,onLeaveConversation:_,onConversationViewed:C}=e;const{currentUser:E,conversations:T,updateConversations:A,activeChat:P,setActiveChat:O,onlineUsers:U,isDark:R}=m(),[I,M]=(0,a.useState)(!1),[q,V]=(0,a.useState)(null),[H,W]=(0,a.useState)(!1),[K,G]=(0,a.useState)(null),[$,Y]=(0,a.useState)(!1),[Q,X]=(0,a.useState)(null),[Z,ee]=(0,a.useState)(!1),[te,ne]=(0,a.useState)("select"),[ae,se]=(0,a.useState)(null),[oe,ie]=(0,a.useState)(!1),[le,ce]=(0,a.useState)(!0),[ue,de]=(0,a.useState)(!1);(0,a.useEffect)(()=>{const e=()=>{const e=window.innerWidth<768;ie(e),e?(ce(!0),de(!1)):(ce(!0),de(!0))};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const he=function(e){se({message:e,type:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success"}),setTimeout(()=>se(null),3e3)},me=e=>{V(e),M(!0)},pe=function(){ne(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"select"),ee(!0)};return(0,f.jsxs)("div",{className:"h-screen ".concat(oe?"flex flex-col":"flex"," ").concat(R?"bg-gray-900 text-white":"bg-gray-50"),children:[ae&&(0,f.jsx)("div",{className:"fixed top-4 left-1/2 transform -translate-x-1/2 z-50 px-4 py-2 rounded-lg shadow-lg transition-all ".concat("success"===ae.type?"bg-green-100 border border-green-300 text-green-700":"bg-red-100 border border-red-300 text-red-700"),children:(0,f.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,f.jsx)("span",{children:ae.message}),(0,f.jsx)("button",{onClick:()=>se(null),className:"ml-2 text-current hover:opacity-70",children:"\xd7"})]})}),oe&&ue&&(0,f.jsxs)("div",{className:"fixed top-0 left-0 right-0 z-40 h-12 flex items-center px-4 border-b ".concat(R?"bg-gray-800 border-gray-700":"bg-white border-gray-200"),children:[(0,f.jsx)("button",{onClick:()=>{oe&&(ce(!0),de(!1))},className:"p-2 rounded-lg transition-colors ".concat(R?"text-gray-300 hover:bg-gray-700":"text-gray-600 hover:bg-gray-100"),children:(0,f.jsx)(L,{className:"w-5 h-5"})}),(0,f.jsx)("span",{className:"ml-3 font-semibold",children:(null===P||void 0===P?void 0:P.name)||"Chat"})]}),(0,f.jsx)("div",{className:"".concat(oe?le?"block":"hidden":"block"," ").concat(oe?"w-full h-full flex-1":""),children:(0,f.jsx)(fe,{onStartConversation:pe,onProfileClick:me,messages:t,onDeleteConversation:v,onConversationSelect:e=>{oe&&(ce(!1),de(!0))}})}),(0,f.jsx)("div",{className:"".concat(oe?ue?"block":"hidden":"block"," ").concat(oe?"w-full h-full":"flex-1"," flex flex-col ").concat(oe?"pt-12":""),children:P?(0,f.jsx)(rt,{isDark:R,currentUser:E,activeChat:P,messages:t[P._id]||[],setMessages:n,onlineUsers:U,typingUsers:r,onProfileClick:me,onImageClick:e=>{X(e),Y(!0)},onForward:e=>{const t=re(e);G(t),W(!0)},onSendMessage:l,onEditMessage:c,onDeleteMessage:u,onReactToMessage:d,onSendFile:h,onLoadMoreMessages:p,onTypingStart:g,onTypingStop:y,onDeleteConversation:v,onAddAdmin:b,onRemoveAdmin:x,onAddParticipant:w,onRemoveParticipant:k,onUpdateConversation:S,onClearChat:N,onBlockUser:j,onLeaveConversation:_,onConversationViewed:C}):(0,f.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,f.jsxs)("div",{className:"text-center",children:[(0,f.jsx)("div",{className:"w-24 h-24 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,f.jsx)(D,{className:"w-12 h-12 text-white"})}),(0,f.jsx)("h2",{className:"text-2xl font-bold mb-2",children:"Welcome to ChatApp"}),(0,f.jsx)("p",{className:"text-gray-500 mb-6",children:"Select a conversation to start messaging"}),(0,f.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 max-w-3xl mx-auto",children:[(0,f.jsxs)("div",{onClick:()=>pe("direct"),className:"p-6 rounded-xl border-2 border-dashed cursor-pointer transition-all hover:shadow-lg hover:scale-105 ".concat(R?"border-gray-600 hover:border-blue-500 hover:bg-gray-800":"border-gray-300 hover:border-blue-500 hover:bg-blue-50"),children:[(0,f.jsx)("div",{className:"w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-3",children:(0,f.jsx)(D,{className:"w-6 h-6 text-white"})}),(0,f.jsx)("h3",{className:"font-semibold mb-2",children:"Direct Message"}),(0,f.jsx)("p",{className:"text-sm text-gray-500",children:"Private one-on-one conversation"})]}),(0,f.jsxs)("div",{onClick:()=>pe("group"),className:"p-6 rounded-xl border-2 border-dashed cursor-pointer transition-all hover:shadow-lg hover:scale-105 ".concat(R?"border-gray-600 hover:border-green-500 hover:bg-gray-800":"border-gray-300 hover:border-green-500 hover:bg-green-50"),children:[(0,f.jsx)("div",{className:"w-12 h-12 bg-gradient-to-r from-green-500 to-teal-600 rounded-full flex items-center justify-center mx-auto mb-3",children:(0,f.jsx)(F,{className:"w-6 h-6 text-white"})}),(0,f.jsx)("h3",{className:"font-semibold mb-2",children:"Group Chat"}),(0,f.jsx)("p",{className:"text-sm text-gray-500",children:"Collaborate with multiple people"})]}),(0,f.jsxs)("div",{onClick:()=>pe("broadcast"),className:"p-6 rounded-xl border-2 border-dashed cursor-pointer transition-all hover:shadow-lg hover:scale-105 ".concat(R?"border-gray-600 hover:border-purple-500 hover:bg-gray-800":"border-gray-300 hover:border-purple-500 hover:bg-purple-50"),children:[(0,f.jsx)("div",{className:"w-12 h-12 bg-gradient-to-r from-purple-500 to-pink-600 rounded-full flex items-center justify-center mx-auto mb-3",children:(0,f.jsx)(B,{className:"w-6 h-6 text-white"})}),(0,f.jsx)("h3",{className:"font-semibold mb-2",children:"Broadcast Channel"}),(0,f.jsx)("p",{className:"text-sm text-gray-500",children:"One-way announcements to subscribers"})]})]}),(0,f.jsx)("button",{onClick:()=>pe("select"),className:"mt-6 bg-gradient-to-r from-blue-500 to-purple-600 text-white px-6 py-3 rounded-lg font-semibold hover:from-blue-600 hover:to-purple-700 transition-all transform hover:scale-105",children:"Start New Conversation"})]})})}),(0,f.jsx)(ut,{isOpen:Z,mode:te,onClose:()=>{ee(!1),ne("select")},onCreateConversation:async function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};try{await i(e,t,n,r);he("".concat("broadcast"===n?"Channel":"group"===n?"Group":"Conversation",' "').concat(t,'" created successfully!'),"success")}catch(a){console.error("Failed to create conversation:",a);he("Failed to create ".concat("broadcast"===n?"channel":"group"===n?"group":"conversation",". Please try again."),"error")}},onCreateDirectConversation:async e=>{try{const t=T.find(t=>"direct"===t.type&&t.participants.some(t=>t.user._id===e));if(t)return void O(t);await s(e),he("Direct conversation created successfully!","success")}catch(t){console.error("Failed to create direct conversation:",t),he("Failed to create conversation. Please try again.","error")}},isDark:R}),$&&Q&&(0,f.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 p-4",onClick:()=>Y(!1),children:(0,f.jsxs)("div",{className:"relative max-w-4xl max-h-full",children:[(0,f.jsx)("img",{src:Q,alt:"Full size view",className:"max-w-full max-h-full object-contain rounded-lg",onClick:e=>e.stopPropagation()}),(0,f.jsx)("button",{onClick:()=>Y(!1),className:"absolute top-4 right-4 p-2 bg-black bg-opacity-50 rounded-full text-white hover:bg-opacity-70 transition-colors",children:(0,f.jsx)(z,{className:"w-6 h-6"})})]})}),I&&q&&(0,f.jsx)(lt,{user:q,onClose:()=>M(!1)}),H&&K&&(0,f.jsx)(ct,{message:K,conversations:T,activeChat:P,isDark:R,currentUser:E,onForward:async(e,t)=>{try{let s=0,i=e.length;const c=new Map;for(const o of e)try{let e="",a="text";if(t.isFile&&t.originalMessage){const i=t.originalMessage;if(J(i)){var n;const c=i.content||(null===(n=i.fileInfo)||void 0===n?void 0:n.url);if(!c)throw new Error("File URL not found");try{const n=await fetch(c);if(!n.ok)throw new Error("Failed to fetch file: ".concat(n.status));const r=await n.blob(),l=i.fileInfo||i.file||{},u=l.displayName||l.originalName||"forwarded_file",d=l.type||r.type||"application/octet-stream",f=new File([r],u,{type:d});await h(o._id,f),e=t.displayText||"\ud83d\udcce ".concat(u),a=i.messageType,s++}catch(r){console.error("Failed to fetch/forward file:",r);const n="\ud83d\udcce ".concat(t.fileName||"File"," (Original file could not be forwarded)");await l(o._id,n),e=n,s++}}else e=t.content||t.displayText||"Message",await l(o._id,e),s++}else e=t.content||t.displayText||"Message",await l(o._id,e),s++;c.set(o._id,{content:e,sender:E,timestamp:(new Date).toISOString(),messageType:a}),await new Promise(e=>setTimeout(e,100))}catch(a){console.error("Failed to forward to conversation ".concat(o._id,":"),a)}c.size>0&&A(T.map(e=>{const t=c.get(e._id);return t?(0,o.A)((0,o.A)({},e),{},{lastMessage:t,updatedAt:(new Date).toISOString()}):e})),0===s?he("Failed to forward message to any conversations","error"):he(s<i?"Message forwarded to ".concat(s,"/").concat(i," conversations"):"Message forwarded to ".concat(s," conversation").concat(s>1?"s":""),"success")}catch(a){console.error("Forward operation failed:",a),he("Failed to forward message. Please try again.","error")}},onClose:()=>W(!1)})]})},ft=Object.create(null);ft.open="0",ft.close="1",ft.ping="2",ft.pong="3",ft.message="4",ft.upgrade="5",ft.noop="6";const ht=Object.create(null);Object.keys(ft).forEach(e=>{ht[ft[e]]=e});const mt={type:"error",data:"parser error"},pt="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),gt="function"===typeof ArrayBuffer,yt=e=>"function"===typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,vt=(e,t,n)=>{let{type:r,data:a}=e;return pt&&a instanceof Blob?t?n(a):bt(a,n):gt&&(a instanceof ArrayBuffer||yt(a))?t?n(a):bt(new Blob([a]),n):n(ft[r]+(a||""))},bt=(e,t)=>{const n=new FileReader;return n.onload=function(){const e=n.result.split(",")[1];t("b"+(e||""))},n.readAsDataURL(e)};function xt(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let wt;const kt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",St="undefined"===typeof Uint8Array?[]:new Uint8Array(256);for(let Wn=0;Wn<64;Wn++)St[kt.charCodeAt(Wn)]=Wn;const Nt="function"===typeof ArrayBuffer,jt=(e,t)=>{if("string"!==typeof e)return{type:"message",data:Ct(e,t)};const n=e.charAt(0);if("b"===n)return{type:"message",data:_t(e.substring(1),t)};return ht[n]?e.length>1?{type:ht[n],data:e.substring(1)}:{type:ht[n]}:mt},_t=(e,t)=>{if(Nt){const n=(e=>{let t,n,r,a,s,o=.75*e.length,i=e.length,l=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);const c=new ArrayBuffer(o),u=new Uint8Array(c);for(t=0;t<i;t+=4)n=St[e.charCodeAt(t)],r=St[e.charCodeAt(t+1)],a=St[e.charCodeAt(t+2)],s=St[e.charCodeAt(t+3)],u[l++]=n<<2|r>>4,u[l++]=(15&r)<<4|a>>2,u[l++]=(3&a)<<6|63&s;return c})(e);return Ct(n,t)}return{base64:!0,data:e}},Ct=(e,t)=>"blob"===t?e instanceof Blob?e:new Blob([e]):e instanceof ArrayBuffer?e:e.buffer,Et=String.fromCharCode(30);function Tt(){return new TransformStream({transform(e,t){!function(e,t){pt&&e.data instanceof Blob?e.data.arrayBuffer().then(xt).then(t):gt&&(e.data instanceof ArrayBuffer||yt(e.data))?t(xt(e.data)):vt(e,!1,e=>{wt||(wt=new TextEncoder),t(wt.encode(e))})}(e,n=>{const r=n.length;let a;if(r<126)a=new Uint8Array(1),new DataView(a.buffer).setUint8(0,r);else if(r<65536){a=new Uint8Array(3);const e=new DataView(a.buffer);e.setUint8(0,126),e.setUint16(1,r)}else{a=new Uint8Array(9);const e=new DataView(a.buffer);e.setUint8(0,127),e.setBigUint64(1,BigInt(r))}e.data&&"string"!==typeof e.data&&(a[0]|=128),t.enqueue(a),t.enqueue(n)})}})}let At;function Pt(e){return e.reduce((e,t)=>e+t.length,0)}function Ot(e,t){if(e[0].length===t)return e.shift();const n=new Uint8Array(t);let r=0;for(let a=0;a<t;a++)n[a]=e[0][r++],r===e[0].length&&(e.shift(),r=0);return e.length&&r<e[0].length&&(e[0]=e[0].slice(r)),n}function Ut(e){if(e)return function(e){for(var t in Ut.prototype)e[t]=Ut.prototype[t];return e}(e)}Ut.prototype.on=Ut.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},Ut.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},Ut.prototype.off=Ut.prototype.removeListener=Ut.prototype.removeAllListeners=Ut.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var a=0;a<r.length;a++)if((n=r[a])===t||n.fn===t){r.splice(a,1);break}return 0===r.length&&delete this._callbacks["$"+e],this},Ut.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(n){r=0;for(var a=(n=n.slice(0)).length;r<a;++r)n[r].apply(this,t)}return this},Ut.prototype.emitReserved=Ut.prototype.emit,Ut.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},Ut.prototype.hasListeners=function(e){return!!this.listeners(e).length};const Rt="function"===typeof Promise&&"function"===typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),It="undefined"!==typeof self?self:"undefined"!==typeof window?window:Function("return this")();function Mt(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.reduce((t,n)=>(e.hasOwnProperty(n)&&(t[n]=e[n]),t),{})}const Lt=It.setTimeout,Dt=It.clearTimeout;function Ft(e,t){t.useNativeTimers?(e.setTimeoutFn=Lt.bind(It),e.clearTimeoutFn=Dt.bind(It)):(e.setTimeoutFn=It.setTimeout.bind(It),e.clearTimeoutFn=It.clearTimeout.bind(It))}function Bt(e){return"string"===typeof e?function(e){let t=0,n=0;for(let r=0,a=e.length;r<a;r++)t=e.charCodeAt(r),t<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(r++,n+=4);return n}(e):Math.ceil(1.33*(e.byteLength||e.size))}function zt(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}class qt extends Error{constructor(e,t,n){super(e),this.description=t,this.context=n,this.type="TransportError"}}class Vt extends Ut{constructor(e){super(),this.writable=!1,Ft(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,n){return super.emitReserved("error",new qt(e,t,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=jt(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return-1===e.indexOf(":")?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}_query(e){const t=function(e){let t="";for(let n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t}(e);return t.length?"?"+t:""}}class Ht extends Vt{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let e=0;this._polling&&(e++,this.once("pollComplete",function(){--e||t()})),this.writable||(e++,this.once("drain",function(){--e||t()}))}else t()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){((e,t)=>{const n=e.split(Et),r=[];for(let a=0;a<n.length;a++){const e=jt(n[a],t);if(r.push(e),"error"===e.type)break}return r})(e,this.socket.binaryType).forEach(e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)}),"closed"!==this.readyState&&(this._polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};"open"===this.readyState?e():this.once("open",e)}write(e){this.writable=!1,((e,t)=>{const n=e.length,r=new Array(n);let a=0;e.forEach((e,s)=>{vt(e,!1,e=>{r[s]=e,++a===n&&t(r.join(Et))})})})(e,e=>{this.doWrite(e,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=zt()),this.supportsBinary||t.sid||(t.b64=1),this.createUri(e,t)}}let Wt=!1;try{Wt="undefined"!==typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(Hn){}const Kt=Wt;function Gt(){}class $t extends Ht{constructor(e){if(super(e),"undefined"!==typeof location){const t="https:"===location.protocol;let n=location.port;n||(n=t?"443":"80"),this.xd="undefined"!==typeof location&&e.hostname!==location.hostname||n!==e.port}}doWrite(e,t){const n=this.request({method:"POST",data:e});n.on("success",t),n.on("error",(e,t)=>{this.onError("xhr post error",e,t)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(e,t)=>{this.onError("xhr poll error",e,t)}),this.pollXhr=e}}class Yt extends Ut{constructor(e,t,n){super(),this.createRequest=e,Ft(this,n),this._opts=n,this._method=n.method||"GET",this._uri=t,this._data=void 0!==n.data?n.data:null,this._create()}_create(){var e;const t=Mt(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this._opts.xd;const n=this._xhr=this.createRequest(t);try{n.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let e in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(e)&&n.setRequestHeader(e,this._opts.extraHeaders[e])}}catch(r){}if("POST"===this._method)try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(r){}try{n.setRequestHeader("Accept","*/*")}catch(r){}null===(e=this._opts.cookieJar)||void 0===e||e.addCookies(n),"withCredentials"in n&&(n.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(n.timeout=this._opts.requestTimeout),n.onreadystatechange=()=>{var e;3===n.readyState&&(null===(e=this._opts.cookieJar)||void 0===e||e.parseCookies(n.getResponseHeader("set-cookie"))),4===n.readyState&&(200===n.status||1223===n.status?this._onLoad():this.setTimeoutFn(()=>{this._onError("number"===typeof n.status?n.status:0)},0))},n.send(this._data)}catch(r){return void this.setTimeoutFn(()=>{this._onError(r)},0)}"undefined"!==typeof document&&(this._index=Yt.requestsCount++,Yt.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if("undefined"!==typeof this._xhr&&null!==this._xhr){if(this._xhr.onreadystatechange=Gt,e)try{this._xhr.abort()}catch(t){}"undefined"!==typeof document&&delete Yt.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}if(Yt.requestsCount=0,Yt.requests={},"undefined"!==typeof document)if("function"===typeof attachEvent)attachEvent("onunload",Qt);else if("function"===typeof addEventListener){addEventListener("onpagehide"in It?"pagehide":"unload",Qt,!1)}function Qt(){for(let e in Yt.requests)Yt.requests.hasOwnProperty(e)&&Yt.requests[e].abort()}const Jt=function(){const e=Xt({xdomain:!1});return e&&null!==e.responseType}();function Xt(e){const t=e.xdomain;try{if("undefined"!==typeof XMLHttpRequest&&(!t||Kt))return new XMLHttpRequest}catch(n){}if(!t)try{return new(It[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(n){}}const Zt="undefined"!==typeof navigator&&"string"===typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();class en extends Vt{get name(){return"websocket"}doOpen(){const e=this.uri(),t=this.opts.protocols,n=Zt?{}:Mt(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,n)}catch(Hn){return this.emitReserved("error",Hn)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],r=t===e.length-1;vt(n,this.supportsBinary,e=>{try{this.doWrite(n,e)}catch(t){}r&&Rt(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){"undefined"!==typeof this.ws&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=zt()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}}const tn=It.WebSocket||It.MozWebSocket;const nn={websocket:class extends en{createSocket(e,t,n){return Zt?new tn(e,t,n):t?new tn(e,t):new tn(e)}doWrite(e,t){this.ws.send(t)}},webtransport:class extends Vt{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(Hn){return this.emitReserved("error",Hn)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const t=function(e,t){At||(At=new TextDecoder);const n=[];let r=0,a=-1,s=!1;return new TransformStream({transform(o,i){for(n.push(o);;){if(0===r){if(Pt(n)<1)break;const e=Ot(n,1);s=128===(128&e[0]),a=127&e[0],r=a<126?3:126===a?1:2}else if(1===r){if(Pt(n)<2)break;const e=Ot(n,2);a=new DataView(e.buffer,e.byteOffset,e.length).getUint16(0),r=3}else if(2===r){if(Pt(n)<8)break;const e=Ot(n,8),t=new DataView(e.buffer,e.byteOffset,e.length),s=t.getUint32(0);if(s>Math.pow(2,21)-1){i.enqueue(mt);break}a=s*Math.pow(2,32)+t.getUint32(4),r=3}else{if(Pt(n)<a)break;const e=Ot(n,a);i.enqueue(jt(s?e:At.decode(e),t)),r=0}if(0===a||a>e){i.enqueue(mt);break}}}})}(Number.MAX_SAFE_INTEGER,this.socket.binaryType),n=e.readable.pipeThrough(t).getReader(),r=Tt();r.readable.pipeTo(e.writable),this._writer=r.writable.getWriter();const a=()=>{n.read().then(e=>{let{done:t,value:n}=e;t||(this.onPacket(n),a())}).catch(e=>{})};a();const s={type:"open"};this.query.sid&&(s.data='{"sid":"'.concat(this.query.sid,'"}')),this._writer.write(s).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],r=t===e.length-1;this._writer.write(n).then(()=>{r&&Rt(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;null===(e=this._transport)||void 0===e||e.close()}},polling:class extends $t{constructor(e){super(e);const t=e&&e.forceBase64;this.supportsBinary=Jt&&!t}request(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign(e,{xd:this.xd},this.opts),new Yt(Xt,this.uri(),e)}}},rn=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,an=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function sn(e){if(e.length>8e3)throw"URI too long";const t=e,n=e.indexOf("["),r=e.indexOf("]");-1!=n&&-1!=r&&(e=e.substring(0,n)+e.substring(n,r).replace(/:/g,";")+e.substring(r,e.length));let a=rn.exec(e||""),s={},o=14;for(;o--;)s[an[o]]=a[o]||"";return-1!=n&&-1!=r&&(s.source=t,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=function(e,t){const n=/\/{2,9}/g,r=t.replace(n,"/").split("/");"/"!=t.slice(0,1)&&0!==t.length||r.splice(0,1);"/"==t.slice(-1)&&r.splice(r.length-1,1);return r}(0,s.path),s.queryKey=function(e,t){const n={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(e,t,r){t&&(n[t]=r)}),n}(0,s.query),s}const on="function"===typeof addEventListener&&"function"===typeof removeEventListener,ln=[];on&&addEventListener("offline",()=>{ln.forEach(e=>e())},!1);class cn extends Ut{constructor(e,t){if(super(),this.binaryType="arraybuffer",this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&"object"===typeof e&&(t=e,e=null),e){const n=sn(e);t.hostname=n.host,t.secure="https"===n.protocol||"wss"===n.protocol,t.port=n.port,n.query&&(t.query=n.query)}else t.host&&(t.hostname=sn(t.host).host);Ft(this,t),this.secure=null!=t.secure?t.secure:"undefined"!==typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!==typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!==typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach(e=>{const t=e.prototype.name;this.transports.push(t),this._transportsByName[t]=e}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"===typeof this.opts.query&&(this.opts.query=function(e){let t={},n=e.split("&");for(let r=0,a=n.length;r<a;r++){let e=n[r].split("=");t[decodeURIComponent(e[0])]=decodeURIComponent(e[1])}return t}(this.opts.query)),on&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},ln.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);const n=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](n)}_open(){if(0===this.transports.length)return void this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);const e=this.opts.rememberUpgrade&&cn.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket")?"websocket":this.transports[0];this.readyState="opening";const t=this.createTransport(e);t.open(),this.setTransport(t)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",e=>this._onClose("transport close",e))}onOpen(){this.readyState="open",cn.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush()}_onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const t=new Error("server error");t.code=e.data,this._onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let t=0;t<this.writeBuffer.length;t++){const n=this.writeBuffer[t].data;if(n&&(e+=Bt(n)),t>0&&e>this._maxPayload)return this.writeBuffer.slice(0,t);e+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,Rt(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,t,n){return this._sendPacket("message",e,t,n),this}send(e,t,n){return this._sendPacket("message",e,t,n),this}_sendPacket(e,t,n,r){if("function"===typeof t&&(r=t,t=void 0),"function"===typeof n&&(r=n,n=null),"closing"===this.readyState||"closed"===this.readyState)return;(n=n||{}).compress=!1!==n.compress;const a={type:e,data:t,options:n};this.emitReserved("packetCreate",a),this.writeBuffer.push(a),r&&this.once("flush",r),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},n=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?n():e()}):this.upgrading?n():e()),this}_onError(e){if(cn.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&"opening"===this.readyState)return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),on&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const e=ln.indexOf(this._offlineEventListener);-1!==e&&ln.splice(e,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this._prevBufferLen=0}}}cn.protocol=4;class un extends cn{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),"open"===this.readyState&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let t=this.createTransport(e),n=!1;cn.priorWebsocketSuccess=!1;const r=()=>{n||(t.send([{type:"ping",data:"probe"}]),t.once("packet",e=>{if(!n)if("pong"===e.type&&"probe"===e.data){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;cn.priorWebsocketSuccess="websocket"===t.name,this.transport.pause(()=>{n||"closed"!==this.readyState&&(c(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const e=new Error("probe error");e.transport=t.name,this.emitReserved("upgradeError",e)}}))};function a(){n||(n=!0,c(),t.close(),t=null)}const s=e=>{const n=new Error("probe error: "+e);n.transport=t.name,a(),this.emitReserved("upgradeError",n)};function o(){s("transport closed")}function i(){s("socket closed")}function l(e){t&&e.name!==t.name&&a()}const c=()=>{t.removeListener("open",r),t.removeListener("error",s),t.removeListener("close",o),this.off("close",i),this.off("upgrading",l)};t.once("open",r),t.once("error",s),t.once("close",o),this.once("close",i),this.once("upgrading",l),-1!==this._upgrades.indexOf("webtransport")&&"webtransport"!==e?this.setTimeoutFn(()=>{n||t.open()},200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const t=[];for(let n=0;n<e.length;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}}class dn extends un{constructor(e){const t="object"===typeof e?e:arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(!t.transports||t.transports&&"string"===typeof t.transports[0])&&(t.transports=(t.transports||["polling","websocket","webtransport"]).map(e=>nn[e]).filter(e=>!!e)),super(e,t)}}const fn="function"===typeof ArrayBuffer,hn=Object.prototype.toString,mn="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===hn.call(Blob),pn="function"===typeof File||"undefined"!==typeof File&&"[object FileConstructor]"===hn.call(File);function gn(e){return fn&&(e instanceof ArrayBuffer||(e=>"function"===typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer)(e))||mn&&e instanceof Blob||pn&&e instanceof File}function yn(e,t){if(!e||"object"!==typeof e)return!1;if(Array.isArray(e)){for(let t=0,n=e.length;t<n;t++)if(yn(e[t]))return!0;return!1}if(gn(e))return!0;if(e.toJSON&&"function"===typeof e.toJSON&&1===arguments.length)return yn(e.toJSON(),!0);for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&yn(e[n]))return!0;return!1}function vn(e){const t=[],n=e.data,r=e;return r.data=bn(n,t),r.attachments=t.length,{packet:r,buffers:t}}function bn(e,t){if(!e)return e;if(gn(e)){const n={_placeholder:!0,num:t.length};return t.push(e),n}if(Array.isArray(e)){const n=new Array(e.length);for(let r=0;r<e.length;r++)n[r]=bn(e[r],t);return n}if("object"===typeof e&&!(e instanceof Date)){const n={};for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=bn(e[r],t));return n}return e}function xn(e,t){return e.data=wn(e.data,t),delete e.attachments,e}function wn(e,t){if(!e)return e;if(e&&!0===e._placeholder){if("number"===typeof e.num&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}if(Array.isArray(e))for(let n=0;n<e.length;n++)e[n]=wn(e[n],t);else if("object"===typeof e)for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(e[n]=wn(e[n],t));return e}const kn=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Sn=5;var Nn;!function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(Nn||(Nn={}));class jn{constructor(e){this.replacer=e}encode(e){return e.type!==Nn.EVENT&&e.type!==Nn.ACK||!yn(e)?[this.encodeAsString(e)]:this.encodeAsBinary({type:e.type===Nn.EVENT?Nn.BINARY_EVENT:Nn.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id})}encodeAsString(e){let t=""+e.type;return e.type!==Nn.BINARY_EVENT&&e.type!==Nn.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=vn(e),n=this.encodeAsString(t.packet),r=t.buffers;return r.unshift(n),r}}function _n(e){return"[object Object]"===Object.prototype.toString.call(e)}class Cn extends Ut{constructor(e){super(),this.reviver=e}add(e){let t;if("string"===typeof e){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const n=t.type===Nn.BINARY_EVENT;n||t.type===Nn.BINARY_ACK?(t.type=n?Nn.EVENT:Nn.ACK,this.reconstructor=new En(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else{if(!gn(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(e){let t=0;const n={type:Number(e.charAt(0))};if(void 0===Nn[n.type])throw new Error("unknown packet type "+n.type);if(n.type===Nn.BINARY_EVENT||n.type===Nn.BINARY_ACK){const r=t+1;for(;"-"!==e.charAt(++t)&&t!=e.length;);const a=e.substring(r,t);if(a!=Number(a)||"-"!==e.charAt(t))throw new Error("Illegal attachments");n.attachments=Number(a)}if("/"===e.charAt(t+1)){const r=t+1;for(;++t;){if(","===e.charAt(t))break;if(t===e.length)break}n.nsp=e.substring(r,t)}else n.nsp="/";const r=e.charAt(t+1);if(""!==r&&Number(r)==r){const r=t+1;for(;++t;){const n=e.charAt(t);if(null==n||Number(n)!=n){--t;break}if(t===e.length)break}n.id=Number(e.substring(r,t+1))}if(e.charAt(++t)){const r=this.tryParse(e.substr(t));if(!Cn.isPayloadValid(n.type,r))throw new Error("invalid payload");n.data=r}return n}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(t){return!1}}static isPayloadValid(e,t){switch(e){case Nn.CONNECT:return _n(t);case Nn.DISCONNECT:return void 0===t;case Nn.CONNECT_ERROR:return"string"===typeof t||_n(t);case Nn.EVENT:case Nn.BINARY_EVENT:return Array.isArray(t)&&("number"===typeof t[0]||"string"===typeof t[0]&&-1===kn.indexOf(t[0]));case Nn.ACK:case Nn.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class En{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const e=xn(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function Tn(e,t,n){return e.on(t,n),function(){e.off(t,n)}}const An=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Pn extends Ut{constructor(e,t,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Tn(e,"open",this.onopen.bind(this)),Tn(e,"packet",this.onpacket.bind(this)),Tn(e,"error",this.onerror.bind(this)),Tn(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.unshift("message"),this.emit.apply(this,t),this}emit(e){var t,n,r;if(An.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');for(var a=arguments.length,s=new Array(a>1?a-1:0),o=1;o<a;o++)s[o-1]=arguments[o];if(s.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(s),this;const i={type:Nn.EVENT,data:s,options:{}};if(i.options.compress=!1!==this.flags.compress,"function"===typeof s[s.length-1]){const e=this.ids++,t=s.pop();this._registerAckCallback(e,t),i.id=e}const l=null===(n=null===(t=this.io.engine)||void 0===t?void 0:t.transport)||void 0===n?void 0:n.writable,c=this.connected&&!(null===(r=this.io.engine)||void 0===r?void 0:r._hasPingExpired());return this.flags.volatile&&!l||(c?(this.notifyOutgoingListeners(i),this.packet(i)):this.sendBuffer.push(i)),this.flags={},this}_registerAckCallback(e,t){var n,r=this;const a=null!==(n=this.flags.timeout)&&void 0!==n?n:this._opts.ackTimeout;if(void 0===a)return void(this.acks[e]=t);const s=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let t=0;t<this.sendBuffer.length;t++)this.sendBuffer[t].id===e&&this.sendBuffer.splice(t,1);t.call(this,new Error("operation has timed out"))},a),o=function(){r.io.clearTimeoutFn(s);for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];t.apply(r,n)};o.withError=!0,this.acks[e]=o}emitWithAck(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return new Promise((t,r)=>{const a=(e,n)=>e?r(e):t(n);a.withError=!0,n.push(a),this.emit(e,...n)})}_addToQueue(e){var t=this;let n;"function"===typeof e[e.length-1]&&(n=e.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push(function(e){if(r!==t._queue[0])return;if(null!==e)r.tryCount>t._opts.retries&&(t._queue.shift(),n&&n(e));else if(t._queue.shift(),n){for(var a=arguments.length,s=new Array(a>1?a-1:0),o=1;o<a;o++)s[o-1]=arguments[o];n(null,...s)}return r.pending=!1,t._drainQueue()}),this._queue.push(r),this._drainQueue()}_drainQueue(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.connected||0===this._queue.length)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){"function"==typeof this.auth?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:Nn.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(t=>String(t.id)===e)){const t=this.acks[e];delete this.acks[e],t.withError&&t.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case Nn.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Nn.EVENT:case Nn.BINARY_EVENT:this.onevent(e);break;case Nn.ACK:case Nn.BINARY_ACK:this.onack(e);break;case Nn.DISCONNECT:this.ondisconnect();break;case Nn.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}onevent(e){const t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const n of t)n.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&"string"===typeof e[e.length-1]&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let n=!1;return function(){if(!n){n=!0;for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];t.packet({type:Nn.ACK,id:e,data:a})}}}onack(e){const t=this.acks[e.id];"function"===typeof t&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Nn.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const n of t)n.apply(this,e.data)}}}function On(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}On.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},On.prototype.reset=function(){this.attempts=0},On.prototype.setMin=function(e){this.ms=e},On.prototype.setMax=function(e){this.max=e},On.prototype.setJitter=function(e){this.jitter=e};class Un extends Ut{constructor(e,t){var n;super(),this.nsps={},this.subs=[],e&&"object"===typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.opts=t,Ft(this,t),this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(n=t.randomizationFactor)&&void 0!==n?n:.5),this.backoff=new On({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this._readyState="closed",this.uri=e;const a=t.parser||r;this.encoder=new a.Encoder,this.decoder=new a.Decoder,this._autoConnect=!1!==t.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new dn(this.uri,this.opts);const t=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const r=Tn(t,"open",function(){n.onopen(),e&&e()}),a=t=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",t),e?e(t):this.maybeReconnectOnOpen()},s=Tn(t,"error",a);if(!1!==this._timeout){const e=this._timeout,n=this.setTimeoutFn(()=>{r(),a(new Error("timeout")),t.close()},e);this.opts.autoUnref&&n.unref(),this.subs.push(()=>{this.clearTimeoutFn(n)})}return this.subs.push(r),this.subs.push(s),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Tn(e,"ping",this.onping.bind(this)),Tn(e,"data",this.ondata.bind(this)),Tn(e,"error",this.onerror.bind(this)),Tn(e,"close",this.onclose.bind(this)),Tn(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){Rt(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new Pn(this,e,t),this.nsps[e]=n),n}_destroy(e){const t=Object.keys(this.nsps);for(const n of t){if(this.nsps[n].active)return}this._close()}_packet(e){const t=this.encoder.encode(e);for(let n=0;n<t.length;n++)this.engine.write(t[n],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var n;this.cleanup(),null===(n=this.engine)||void 0===n||n.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),e.skipReconnect||e.open(t=>{t?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",t)):e.onreconnect()}))},t);this.opts.autoUnref&&n.unref(),this.subs.push(()=>{this.clearTimeoutFn(n)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const Rn={};function In(e,t){"object"===typeof e&&(t=e,e=void 0);const n=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,r=e;n=n||"undefined"!==typeof location&&location,null==e&&(e=n.protocol+"//"+n.host),"string"===typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?n.protocol+e:n.host+e),/^(https?|wss?):\/\//.test(e)||(e="undefined"!==typeof n?n.protocol+"//"+e:"https://"+e),r=sn(e)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const a=-1!==r.host.indexOf(":")?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+a+":"+r.port+t,r.href=r.protocol+"://"+a+(n&&n.port===r.port?"":":"+r.port),r}(e,(t=t||{}).path||"/socket.io"),r=n.source,a=n.id,s=n.path,o=Rn[a]&&s in Rn[a].nsps;let i;return t.forceNew||t["force new connection"]||!1===t.multiplex||o?i=new Un(r,t):(Rn[a]||(Rn[a]=new Un(r,t)),i=Rn[a]),n.query&&!t.query&&(t.query=n.queryKey),i.socket(n.path,t)}Object.assign(In,{Manager:Un,Socket:Pn,io:In,connect:In});const Mn=new class{constructor(){this.socket=null,this.isConnected=!1,this.reconnectAttempts=0,this.maxReconnectAttempts=5}connect(e){var t;if(null!==(t=this.socket)&&void 0!==t&&t.connected)return this.socket;const n={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_BASE_URL:"http://localhost:5000/api/",REACT_APP_NODE_ENV:"development"}.REACT_APP_SERVER_URL||"http://localhost:5000";return this.socket=In(n,{auth:{token:e},transports:["websocket","polling"],reconnection:!0,reconnectionDelay:1e3,reconnectionAttempts:this.maxReconnectAttempts,timeout:2e4}),this.setupEventListeners(),this.socket}setupEventListeners(){this.socket&&(this.socket.on("connect",()=>{console.log("Socket connected:",this.socket.id),this.isConnected=!0,this.reconnectAttempts=0}),this.socket.on("disconnect",e=>{console.log("Socket disconnected:",e),this.isConnected=!1}),this.socket.on("connect_error",e=>{console.error("Socket connection error:",e),this.reconnectAttempts++,this.reconnectAttempts>=this.maxReconnectAttempts&&console.error("Max reconnection attempts reached")}),this.socket.on("error",e=>{console.error("Socket error:",e)}))}disconnect(){this.socket&&(this.socket.disconnect(),this.socket=null,this.isConnected=!1,this.reconnectAttempts=0,console.log("Disconnecting socket"))}joinUserRoom(e){this.socket&&e&&this.socket.emit("join_user_room",e)}joinConversation(e){this.socket&&e&&(this.socket.emit("join_conversation",e),console.log("Joining convo",e))}leaveConversation(e){this.socket&&e&&(this.socket.emit("leave_conversation",e),console.log("Leaving room",e))}viewConversation(e){this.socket&&e&&this.socket.emit("conversation_viewed",{conversationId:e})}sendMessage(e,t){this.socket&&e&&t&&(console.log("\ud83d\udd0d Sending message:",{conversationId:e,content:t.content,messageType:t.messageType}),this.socket.emit("send_message",(0,o.A)({conversationId:e},t)),console.log("Sending message",t))}markMessageDelivered(e){this.socket&&e&&(this.socket.emit("message_delivered",{messageId:e}),console.log("Message delivered",e))}markMessageSeen(e){this.socket&&e&&(this.socket.emit("message_seen",{messageId:e}),console.log("Message seen",e))}markConversationRead(e){this.socket&&e&&this.socket.emit("mark_conversation_read",{conversationId:e})}editMessage(e,t){this.socket&&e&&t&&(this.socket.emit("edit_message",{messageId:e,content:t}),console.log("edit message",t))}deleteMessage(e){this.socket&&e&&(this.socket.emit("delete_message",{messageId:e}),console.log("delete message",e))}reactToMessage(e,t){this.socket&&e&&t&&(this.socket.emit("react_to_message",{messageId:e,emoji:t}),console.log("react",t))}startTyping(e){this.socket&&e&&this.socket.emit("typing_start",{conversationId:e})}stopTyping(e){this.socket&&e&&this.socket.emit("typing_stop",{conversationId:e})}updateUserStatus(e){this.socket&&e&&(this.socket.emit("update_status",{status:e}),console.log("update status",e))}sendNotificationToUser(e,t,n){this.socket&&e&&t&&(this.socket.emit("send_notification_to_user",{userId:e,eventName:t,data:n}),console.log("Sending notification to user ".concat(e,":"),t,n))}sendNotificationToConversation(e,t,n){this.socket&&e&&t&&(this.socket.emit("send_notification_to_conversation",{conversationId:e,eventName:t,data:n}),console.log("Sending notification to conversation ".concat(e,":"),t,n))}onNewMessage(e){this.socket&&this.socket.on("new_message",e)}onMessageStatusUpdate(e){this.socket&&this.socket.on("message_status_update",t=>{e(t)})}onMessagesSeenBulk(e){this.socket&&this.socket.on("messages_seen_bulk",t=>{e(t)})}onMessageEdited(e){this.socket&&this.socket.on("message_edited",e)}onMessageDeleted(e){this.socket&&this.socket.on("message_deleted",e)}onConversationCreated(e){this.socket&&this.socket.on("conversation_created",e)}onConnect(e){this.socket&&this.socket.on("connect",e)}onConversationDeleted(e){this.socket&&this.socket.on("conversation_deleted",e)}onMessageReaction(e){this.socket&&this.socket.on("message_reaction",e)}onTypingStart(e){this.socket&&this.socket.on("typing_start",e)}onTypingStop(e){this.socket&&this.socket.on("typing_stop",e)}onUserStatusUpdate(e){this.socket&&this.socket.on("user_status_update",e)}onUserOnline(e){this.socket&&this.socket.on("user_online",e)}onUserOffline(e){this.socket&&this.socket.on("user_offline",e)}onUserProfileUpdate(e){this.socket&&this.socket.on("user_profile_updated",e)}onConversationUpdate(e){this.socket&&this.socket.on("conversation_updated",e)}onUserBlocked(e){this.socket&&this.socket.on("user_blocked",e)}onUserUnblocked(e){this.socket&&this.socket.on("user_unblocked",e)}onUserBlockedYou(e){this.socket&&this.socket.on("user_blocked_you",e)}onUserUnblockedYou(e){this.socket&&this.socket.on("user_unblocked_you",e)}onConversationLeft(e){this.socket&&this.socket.on("conversation_left",e)}onAdminTransferred(e){this.socket&&this.socket.on("admin_transferred",e)}onPromotedToAdmin(e){this.socket&&this.socket.on("promoted_to_admin",e)}onConversationCleared(e){this.socket&&this.socket.on("conversation_cleared",e)}onConversationHidden(e){this.socket&&this.socket.on("conversation_hidden",e)}onConversationReappeared(e){this.socket&&this.socket.on("conversation_reappeared",t=>{console.log("\ud83d\udd14 SOCKET: Received conversation_reappeared event:",t),e(t)})}onConversationDeleted(e){this.socket&&this.socket.on("conversation_deleted",e)}onAdminRemoved(e){this.socket&&this.socket.on("admin_removed",e)}on(e,t){this.socket&&e&&t&&this.socket.on(e,t)}off(e,t){this.socket&&(t?this.socket.off(e,t):this.socket.removeAllListeners(e))}isSocketConnected(){var e;return(null===(e=this.socket)||void 0===e?void 0:e.connected)||!1}};const Ln=new class{constructor(){const e={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_BASE_URL:"http://localhost:5000/api/",REACT_APP_NODE_ENV:"development"}.REACT_APP_CLOUDINARY_CLOUD_NAME||"dygmwu7qd",t={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_BASE_URL:"http://localhost:5000/api/",REACT_APP_NODE_ENV:"development"}.REACT_APP_CLOUDINARY_UPLOAD_PRESET||"ChatApp";this.cloudinaryUploadUrl="https://api.cloudinary.com/v1_1/".concat(e,"/upload"),this.cloudinaryRawUploadUrl="https://api.cloudinary.com/v1_1/".concat(e,"/raw/upload"),this.cloudinaryUploadPreset=t}getCloudinaryResourceType(e){const t=e.type.toLowerCase();return t.startsWith("image/")?{resourceType:"image",endpoint:this.cloudinaryUploadUrl}:t.startsWith("video/")||t.startsWith("audio/")?{resourceType:"video",endpoint:this.cloudinaryUploadUrl}:{resourceType:"raw",endpoint:this.cloudinaryRawUploadUrl}}async uploadToCloudinary(e){try{const{resourceType:t,endpoint:n}=this.getCloudinaryResourceType(e),r=new FormData;if(r.append("file",e),r.append("upload_preset",this.cloudinaryUploadPreset),r.append("resource_type",t),"raw"===t){const t=Date.now(),n=e.name.replace(/[^a-zA-Z0-9.-]/g,"_"),a="".concat(t,"_").concat(n);r.append("public_id",a)}const a=await fetch(n,{method:"POST",body:r});if(!a.ok){const e=await a.text();throw console.error("Cloudinary response error:",e),new Error("Upload failed: ".concat(a.statusText))}const s=await a.json();return{success:!0,url:s.secure_url,publicId:s.public_id,originalName:e.name,size:s.bytes,format:s.format,resourceType:s.resource_type,width:s.width,height:s.height,pages:s.pages,duration:s.duration}}catch(t){throw console.error("Cloudinary upload error:",t),t}}async uploadFile(e){if(e.size>52428800)throw new Error("File too large. Maximum size is 50MB.");try{if(this.cloudinaryUploadPreset&&"YOUR_UPLOAD_PRESET"!==this.cloudinaryUploadPreset)return await this.uploadToCloudinary(e)}catch(t){throw console.error("All upload methods failed:",t),new Error("Failed to upload file. Please try again.")}}getFileType(e){const t=e.type.toLowerCase(),n=e.name.toLowerCase().split(".").pop();return t.startsWith("image/")||["jpg","jpeg","png","gif","webp","svg"].includes(n)?"image":t.startsWith("video/")||["mp4","avi","mov","wmv","flv","webm","mkv"].includes(n)?"video":t.startsWith("audio/")||["mp3","wav","ogg","flac","aac","m4a"].includes(n)?"audio":"application/pdf"===t||"pdf"===n?"pdf":t.includes("document")||t.includes("word")||["doc","docx","rtf","odt"].includes(n)?"document":t.includes("spreadsheet")||t.includes("excel")||["xlsx","xls","csv","ods"].includes(n)?"xlsx":"text/plain"===t||"txt"===n?"document":"file"}formatFileSize(e){if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]}validateFile(e){const t=e.name.split(".").pop().toLowerCase();if(!(["image/jpeg","image/jpg","image/png","image/gif","image/webp","video/mp4","video/avi","video/mov","video/wmv","video/webm","audio/mp3","audio/wav","audio/ogg","audio/flac","audio/aac","application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/plain","text/csv"].includes(e.type)||["jpg","jpeg","png","gif","webp","svg","mp4","avi","mov","wmv","webm","mkv","mp3","wav","ogg","flac","aac","m4a","pdf","doc","docx","txt","rtf","xlsx","xls","csv"].includes(t)))throw new Error("File type ".concat(e.type||t," is not supported"));return!0}},Dn=S("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);class Fn{constructor(){this.increment=Math.floor(16777215*Math.random())}static generate(){const e=Math.floor(Date.now()/1e3),t=Math.floor(0xffffffffff*Math.random());Fn.prototype.increment=(Fn.prototype.increment+1)%16777215;return e.toString(16).padStart(8,"0")+t.toString(16).padStart(10,"0")+Fn.prototype.increment.toString(16).padStart(6,"0")}static isValid(e){return"string"===typeof e&&/^[0-9a-fA-F]{24}$/.test(e)}}Fn.prototype.increment=Math.floor(16777215*Math.random());const Bn=Fn,zn=e=>{let{notifications:t,onNotificationClick:n,onDismiss:r,isDark:s}=e;const[o,i]=(0,a.useState)([]);(0,a.useEffect)(()=>{t&&t.length>0&&i(t)},[t]);const l=e=>{i(t=>t.filter(t=>t.id!==e)),r&&r(e)};return(0,a.useEffect)(()=>{o.forEach(e=>{const t=setTimeout(()=>{l(e.id)},5e3);return()=>clearTimeout(t)})},[o]),0===o.length?null:(0,f.jsx)("div",{className:"fixed top-4 right-4 z-[9999] space-y-3",children:o.map(e=>{var t,r,a,s;return(0,f.jsx)("div",{className:"w-96 bg-white/95 dark:bg-gray-800/95 backdrop-blur-md rounded-2xl shadow-2xl border border-gray-200/50 dark:border-gray-700/50 transform transition-all duration-500 ease-out hover:scale-[1.02] hover:shadow-3xl cursor-pointer animate-in slide-in-from-right-full relative z-[9999]",onClick:()=>(e=>{n&&n(e),l(e.id)})(e),style:{animation:"slideInRight 0.5s ease-out",zIndex:9999},children:(0,f.jsx)("div",{className:"p-3",children:(0,f.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,f.jsx)("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center shadow-md flex-shrink-0 ".concat("broadcast"===e.conversation.type?"bg-gradient-to-br from-purple-500 to-pink-600":"group"===e.conversation.type?"bg-gradient-to-br from-green-500 to-teal-600":"bg-gradient-to-br from-blue-500 to-purple-600"),children:(0,f.jsx)("span",{className:"text-white text-sm font-bold",children:e.conversation.avatar||(null===(t=e.conversation.name)||void 0===t?void 0:t.charAt(0).toUpperCase())||(null===(r=e.sender)||void 0===r||null===(a=r.name)||void 0===a?void 0:a.charAt(0).toUpperCase())||"\ud83d\udc64"})}),(0,f.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,f.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,f.jsx)("p",{className:"text-sm font-semibold text-gray-900 dark:text-white truncate",children:e.conversation.name||(null===(s=e.sender)||void 0===s?void 0:s.name)||"Unknown"}),(0,f.jsx)("button",{onClick:t=>{t.stopPropagation(),l(e.id)},className:"flex-shrink-0 p-1 rounded-full hover:bg-gray-100/80 dark:hover:bg-gray-700/80 transition-all duration-200 ml-2",children:(0,f.jsx)(z,{className:"w-4 h-4 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"})})]}),(0,f.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 line-clamp-1 leading-relaxed",children:e.messagePreview})]})]})})},e.id)})})},qn=()=>{const{currentUser:e,setCurrentUser:t,isDark:n,setIsDark:r,conversations:s,updateConversations:i,showVerificationAlert:l,setShowVerificationAlert:c,activeChat:u,setActiveChat:h,onlineUsers:p,updateOnlineUsers:g,updateUserProfile:y,isLoading:v,setIsLoading:b,loginUser:x,logoutUser:w,refreshSessionInfo:k,error:S,clearError:N,fetchCompleteUserProfile:j,popupAlert:_,setPopupAlert:C}=m(),[E,T]=(0,a.useState)({}),[A,P]=(0,a.useState)(new Set),[O,U]=(0,a.useState)(!e),[R,I]=(0,a.useState)({}),[L,D]=(0,a.useState)(null),[F,B]=(0,a.useState)([]);(0,a.useEffect)(()=>{U(!e)},[e]),(0,a.useEffect)(()=>{e&&void 0!==e.blockedUsers?(console.log("Current user with blocked users ready, initializing data..."),G(),V(),"Notification"in window&&"default"===Notification.permission&&Notification.requestPermission()):e&&void 0===e.blockedUsers?console.log("Current user exists but missing blockedUsers, waiting..."):(console.log("No current user, disconnecting socket"),H())},[null===e||void 0===e?void 0:e.blockedUsers]),(0,a.useEffect)(()=>{null!==e&&void 0!==e&&e._id&&void 0===e.blockedUsers&&(console.log("User exists but blockedUsers missing, fetching complete profile..."),j())},[null===e||void 0===e?void 0:e._id,null===e||void 0===e?void 0:e.blockedUsers]),(0,a.useEffect)(()=>(e&&Mn.isSocketConnected()&&W(),()=>{K()}),[e,s,u]),(0,a.useEffect)(()=>{const e=()=>{window.lastUserInteraction=Date.now()},t=["click","keypress","scroll","touchstart","mousemove"];return t.forEach(t=>{window.addEventListener(t,e)}),window.lastUserInteraction=Date.now(),()=>{t.forEach(t=>{window.removeEventListener(t,e)})}},[]),(0,a.useEffect)(()=>{null===e||void 0===e||!e._id||null!==e&&void 0!==e&&e.blockedUsers||(console.log("Fetching user profile because blockedUsers is missing"),q())},[null===e||void 0===e?void 0:e._id]);const z=function(e){D({message:e,type:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success"}),setTimeout(()=>D(null),3e3)},q=async()=>{try{const e=await d.default.authenticatedRequest("/users/me/profile");if(e.ok){const n=await e.json();if(n.success)return console.log("Fresh user profile loaded:",n.user),t(e=>(0,o.A)((0,o.A)((0,o.A)({},e),n.user),{},{blockedUsers:n.user.blockedUsers||[]})),n.user}}catch(S){console.error("Failed to fetch user profile:",S)}return null},V=()=>{const t=d.default.getCurrentSession();null!==t&&void 0!==t&&t.accessToken&&(Mn.connect(t.accessToken),e&&Mn.joinUserRoom(e._id),Mn.onConnect(()=>{$()}))},H=()=>{Mn.disconnect()},W=()=>{Mn.onNewMessage(t=>{const{conversationId:n,message:r}=t,a=s.find(e=>e._id===n);T(e=>{const t=e[n]||[];return t.some(e=>e._id===r._id)?e:(0,o.A)((0,o.A)({},e),{},{[n]:[...t,r]})}),a&&r.sender&&r.sender._id!==e._id&&((t,n,r)=>{if((null===u||void 0===u?void 0:u._id)===n._id)return;if(r._id===e._id)return;if("system"===t.messageType)return;const a="".concat(t._id,"-").concat(Date.now());let s=t.content||"";if("text"!==t.messageType&&t.fileInfo){const e=t.fileInfo.displayName||t.fileInfo.originalName||"File",n="image"===t.messageType?"\ud83d\uddbc\ufe0f":"video"===t.messageType?"\ud83c\udfa5":"audio"===t.messageType?"\ud83c\udfb5":"pdf"===t.messageType?"\ud83d\udcc4":"\ud83d\udcce";s="".concat(n," ").concat(e)}if("group"===n.type||"broadcast"===n.type){const e=r.name||"Someone";s="".concat(e,": ").concat(s)}const o={id:a,messageId:t._id,conversationId:n._id,conversation:n,sender:r,messagePreview:s,timestamp:t.createdAt||(new Date).toISOString()};if(B(e=>[...e,o]),"Notification"in window&&"granted"===Notification.permission){const e=n.name||r.name||"Unknown";new Notification("New message from ".concat(e),{body:s,icon:"/favicon.ico",tag:n._id,requireInteraction:!1})}})(r,a,r.sender),i(t=>t.map(t=>{if(t._id===n){let a=r.content;if("text"!==r.messageType&&r.fileInfo){const e=r.fileInfo.displayName||r.fileInfo.originalName||"File",t="image"===r.messageType?"\ud83d\uddbc\ufe0f":"video"===r.messageType?"\ud83c\udfa5":"audio"===r.messageType?"\ud83c\udfb5":"pdf"===r.messageType?"\ud83d\udcc4":"\ud83d\udcce";a="".concat(t," ").concat(e)}const s=r.sender._id===e._id,i=(null===u||void 0===u?void 0:u._id)===n,l=t.unreadCount||0;return(0,o.A)((0,o.A)({},t),{},{lastMessage:{content:a,sender:r.sender._id,timestamp:r.createdAt,messageType:r.messageType,fileInfo:r.fileInfo},updatedAt:r.createdAt,unreadCount:s||i?l:l+1})}return t}))}),Mn.onMessageStatusUpdate(e=>{const{messageId:t,status:n,timestamp:r,deliveredTo:a,readBy:s}=e;T(e=>{const i=(0,o.A)({},e);return Object.keys(i).forEach(e=>{i[e]=i[e].map(e=>e._id===t?(0,o.A)((0,o.A)({},e),{},{status:n,statusTimestamp:r,deliveredTo:a||e.deliveredTo||[],readBy:s||e.readBy||[]}):e)}),i}),I(e=>(0,o.A)((0,o.A)({},e),{},{[t]:{status:n,timestamp:r,deliveredTo:a||[],readBy:s||[]}}))}),Mn.onMessagesSeenBulk(t=>{const{messageIds:n,seenBy:r,conversationId:a,timestamp:s}=t;T(e=>{const t=(0,o.A)({},e);return t[a]&&(t[a]=t[a].map(e=>n.includes(e._id)?(0,o.A)((0,o.A)({},e),{},{status:"read",statusTimestamp:s,readBy:[...e.readBy||[],{user:r,readAt:s}]}):e)),t}),i(t=>t.map(t=>t._id===a?(console.log("\ud83d\udd0d Updating unread count to 0 for conversation ".concat(a)),(0,o.A)((0,o.A)({},t),{},{unreadCount:0,participants:t.participants.map(t=>t.user._id===e._id?(0,o.A)((0,o.A)({},t),{},{lastRead:s}):t)})):t))}),Mn.onMessageEdited(e=>{const{messageId:t,content:n,editedAt:r}=e;T(e=>{const a=(0,o.A)({},e);return Object.keys(a).forEach(e=>{a[e]=a[e].map(e=>e._id===t?(0,o.A)((0,o.A)({},e),{},{content:n,isEdited:!0,editedAt:r}):e)}),a})}),Mn.onMessageDeleted(e=>{const{messageId:t,conversationId:n,newLastMessage:r}=e;n&&i(s.map(e=>{if(e._id===n){if(r){let t=r.content;if("text"!==r.messageType){const e=r.content,n="image"===r.messageType?"\ud83d\uddbc\ufe0f":"video"===r.messageType?"\ud83c\udfa5":"audio"===r.messageType?"\ud83c\udfb5":"pdf"===r.messageType?"\ud83d\udcc4":"\ud83d\udcce";t="".concat(n," ").concat(e)}return(0,o.A)((0,o.A)({},e),{},{lastMessage:{content:t,sender:r.sender,timestamp:r.timestamp,messageType:r.messageType,fileInfo:r.fileInfo},updatedAt:(new Date).toISOString()})}return(0,o.A)((0,o.A)({},e),{},{lastMessage:null,updatedAt:(new Date).toISOString()})}return e})),T(e=>{const n=(0,o.A)({},e);return Object.keys(n).forEach(e=>{n[e]=n[e].filter(e=>e._id!==t)}),n})}),Mn.onMessageReaction(e=>{const{messageId:t,reactions:n}=e;T(e=>{const r=(0,o.A)({},e);return Object.keys(r).forEach(e=>{r[e]=r[e].map(e=>e._id===t?(0,o.A)((0,o.A)({},e),{},{reactions:n}):e)}),r})}),Mn.onConversationCreated(t=>{const{conversation:n,createdBy:r}=t;console.log("\ud83d\udd14 New conversation created:",{conversationId:n._id,conversationType:n.type,createdBy:null===r||void 0===r?void 0:r.name,conversationName:n.name});if(!s.find(e=>e._id===n._id)){const t=(0,o.A)((0,o.A)({},n),{},{unreadCount:0});i([t,...s]),T(e=>(0,o.A)((0,o.A)({},e),{},{[n._id]:[]})),Mn.joinConversation(n._id),r&&((t,n)=>{if(n._id===e._id)return;const r="conv-".concat(t._id,"-").concat(Date.now());let a="";a="group"===t.type?'You were added to group "'.concat(t.name,'"'):"broadcast"===t.type?'You were added to broadcast channel "'.concat(t.name,'"'):"New conversation with ".concat(n.name);const s={id:r,conversationId:t._id,conversation:t,sender:n,messagePreview:a,timestamp:t.createdAt||(new Date).toISOString(),type:"conversation"};if(B(e=>[...e,s]),"Notification"in window&&"granted"===Notification.permission){const e=t.name||n.name||"Unknown";new Notification("New conversation: ".concat(e),{body:a,icon:"/favicon.ico",tag:"conv-".concat(t._id),requireInteraction:!1})}})(n,r)}}),Mn.onConversationDeleted(t=>{const{conversationId:n,deletedBy:r}=t;if(i(s.filter(e=>e._id!==n)),T(e=>{const t=(0,o.A)({},e);return delete t[n],t}),(null===u||void 0===u?void 0:u._id)===n&&h(null),r!==e._id){const e=s.find(e=>e._id===n),t="group"===(null===e||void 0===e?void 0:e.type)?e.name:"Conversation";z("".concat(t," was deleted"),"success")}}),Mn.onTypingStart(t=>{const{userId:n,userName:r,conversationId:a}=t;a===(null===u||void 0===u?void 0:u._id)&&n!==(null===e||void 0===e?void 0:e._id)&&P(e=>new Set(e).add(r))}),Mn.onTypingStop(e=>{const{userId:t,userName:n,conversationId:r}=e;r===(null===u||void 0===u?void 0:u._id)&&P(e=>{const t=new Set(e);return t.delete(n),t})}),Mn.onUserOnline(e=>{const{userId:t}=e;g([...p,t])}),Mn.onUserOffline(e=>{var t;const{userId:n}=e;g(null===(t=[...p])||void 0===t?void 0:t.filter(e=>e!==n))}),Mn.onUserStatusUpdate(e=>{const{userId:t,status:n}=e;i(s.map(e=>(0,o.A)((0,o.A)({},e),{},{participants:e.participants.map(e=>e.user._id===t?(0,o.A)((0,o.A)({},e),{},{user:(0,o.A)((0,o.A)({},e.user),{},{status:n})}):e)})))}),Mn.onUserProfileUpdate(t=>{const{userId:n,user:r}=t;console.log("\ud83d\udd14 User profile updated:",{userId:n,user:r}),i(s.map(e=>(0,o.A)((0,o.A)({},e),{},{participants:e.participants.map(e=>e.user._id===n?(0,o.A)((0,o.A)({},e),{},{user:(0,o.A)((0,o.A)({},e.user),r)}):e)}))),n===(null===e||void 0===e?void 0:e._id)&&y(r)}),Mn.onConversationUpdate(e=>{const{conversation:t,updateType:n}=e;if(console.log("\ud83d\udd14 Conversation update received:",{conversationId:t._id,updateType:n,lastMessage:t.lastMessage,updatedAt:t.updatedAt}),i(e=>{const n=e.map(e=>e._id===t._id?t:e),r=e.find(e=>e._id===t._id);return console.log("\ud83d\udd04 Updating conversations state:",{conversationId:t._id,conversationIdType:typeof t._id,foundConversation:r?"YES":"NO",foundConvId:null===r||void 0===r?void 0:r._id,foundConvIdType:typeof(null===r||void 0===r?void 0:r._id),totalConversations:e.length,updatedConversations:n.length,allConvIds:e.map(e=>({id:e._id,type:typeof e._id}))}),n}),(null===u||void 0===u?void 0:u._id)===t._id&&h(t),"new_message"===n)console.log("Conversation updated with new message:",t._id);else if("admin_added"===n){t.participants.find(e=>{var n;return"admin"===e.role&&(null===(n=t.admins)||void 0===n?void 0:n.some(t=>t._id===e.user._id))})}}),Mn.onUserBlocked(e=>{const{blockedUserId:n,blockedUser:r,timestamp:a}=e;console.log("Socket: User blocked event received",{blockedUserId:n,blockedUser:r}),t(e=>{const t=e.blockedUsers||[],r=t.includes(n)?t:[...t,n];return(0,o.A)((0,o.A)({},e),{},{blockedUsers:r})}),i(s.map(e=>{if("direct"===e.type){if(e.participants.find(e=>e.user._id===n))return(0,o.A)((0,o.A)({},e),{},{participants:e.participants.map(e=>e.user._id===n?(0,o.A)((0,o.A)({},e),{},{user:(0,o.A)((0,o.A)({},e.user),{},{isBlockedByCurrentUser:!0})}):e)})}return e}))}),Mn.onUserUnblocked(e=>{const{unblockedUserId:n,unblockedUser:r,timestamp:a}=e;console.log("Socket: User unblocked event received",{unblockedUserId:n,unblockedUser:r}),t(e=>{const t=(e.blockedUsers||[]).filter(e=>e!==n);return(0,o.A)((0,o.A)({},e),{},{blockedUsers:t})}),i(s.map(e=>{if("direct"===e.type){if(e.participants.find(e=>e.user._id===n))return(0,o.A)((0,o.A)({},e),{},{participants:e.participants.map(e=>e.user._id===n?(0,o.A)((0,o.A)({},e),{},{user:(0,o.A)((0,o.A)({},e.user),{},{isBlockedByCurrentUser:!1})}):e)})}return e}))}),Mn.onUserBlockedYou(e=>{const{blockedByUserId:t,blockedByUser:n,timestamp:r}=e;if(i(s.map(e=>{if("direct"===e.type){if(e.participants.find(e=>e.user._id===t))return(0,o.A)((0,o.A)({},e),{},{participants:e.participants.map(e=>e.user._id===t?(0,o.A)((0,o.A)({},e),{},{user:(0,o.A)((0,o.A)({},e.user),{},{hasBlockedCurrentUser:!0})}):e)})}return e})),"direct"===(null===u||void 0===u?void 0:u.type)){u.participants.find(e=>e.user._id===t)&&h((0,o.A)((0,o.A)({},u),{},{participants:u.participants.map(e=>e.user._id===t?(0,o.A)((0,o.A)({},e),{},{user:(0,o.A)((0,o.A)({},e.user),{},{hasBlockedCurrentUser:!0})}):e)}))}}),Mn.onUserUnblockedYou(e=>{const{unblockedByUserId:t,unblockedByUser:n,timestamp:r}=e;if(i(s.map(e=>{if("direct"===e.type){if(e.participants.find(e=>e.user._id===t))return(0,o.A)((0,o.A)({},e),{},{participants:e.participants.map(e=>e.user._id===t?(0,o.A)((0,o.A)({},e),{},{user:(0,o.A)((0,o.A)({},e.user),{},{hasBlockedCurrentUser:!1})}):e)})}return e})),"direct"===(null===u||void 0===u?void 0:u.type)){u.participants.find(e=>e.user._id===t)&&h((0,o.A)((0,o.A)({},u),{},{participants:u.participants.map(e=>e.user._id===t?(0,o.A)((0,o.A)({},e),{},{user:(0,o.A)((0,o.A)({},e.user),{},{hasBlockedCurrentUser:!1})}):e)}))}}),Mn.onConversationLeft(e=>{const{conversationId:t,timestamp:n}=e;i(s.filter(e=>e._id!==t)),T(e=>{const n=(0,o.A)({},e);return delete n[t],n}),(null===u||void 0===u?void 0:u._id)===t&&h(null)}),Mn.onAdminTransferred(e=>{const{conversationId:t,newAdminId:n,newAdminName:r,previousAdminName:a,conversation:o,timestamp:l}=e;i(s.map(e=>e._id===t?o:e)),(null===u||void 0===u?void 0:u._id)===t&&h(o)}),Mn.onPromotedToAdmin(e=>{const{conversationId:t,conversationName:n,conversationType:r,previousAdminName:a,timestamp:s}=e}),Mn.onConversationCleared(e=>{const{conversationId:t,timestamp:n}=e;T(e=>(0,o.A)((0,o.A)({},e),{},{[t]:[]})),i(s.map(e=>e._id===t?(0,o.A)((0,o.A)({},e),{},{lastMessage:null,updatedAt:(new Date).toISOString()}):e))}),Mn.onConversationHidden(e=>{const{conversationId:t}=e;i(e=>e.filter(e=>e._id!==t)),(null===u||void 0===u?void 0:u._id)===t&&h(null)}),Mn.onConversationReappeared(e=>{const{conversationId:t,senderId:n}=e;console.log("\ud83c\udf89 FRONTEND: Conversation ".concat(t," reappeared due to message from ").concat(n)),console.log("\ud83c\udf89 FRONTEND: Current activeChat:",null===u||void 0===u?void 0:u._id),console.log("\ud83c\udf89 FRONTEND: Current conversations count:",s.length),Y(t),console.log("\ud83c\udf89 FRONTEND: Fetching messages for reappeared conversation ".concat(t)),Z(t)}),Mn.onConversationDeleted(e=>{const{conversationId:t}=e;console.log("FRONTEND: Received conversation_deleted event for conversation ".concat(t)),T(e=>(0,o.A)((0,o.A)({},e),{},{[t]:[]})),i(e=>e.filter(e=>e._id!==t)),(null===u||void 0===u?void 0:u._id)===t&&h(null)})},K=()=>{Mn.off("new_message"),Mn.off("message_status_update"),Mn.off("messages_seen_bulk"),Mn.off("message_edited"),Mn.off("message_deleted"),Mn.off("message_reaction"),Mn.off("typing_start"),Mn.off("typing_stop"),Mn.off("user_online"),Mn.off("user_offline"),Mn.off("user_status_update"),Mn.off("user_profile_updated"),Mn.off("conversation_updated"),Mn.off("conversation_created"),Mn.off("conversation_deleted"),Mn.off("user_blocked"),Mn.off("user_unblocked"),Mn.off("user_blocked_you"),Mn.off("user_unblocked_you"),Mn.off("conversation_left"),Mn.off("admin_transferred"),Mn.off("promoted_to_admin"),Mn.off("conversation_cleared")},G=async()=>{if(e)if(void 0!==e.blockedUsers)try{b(!0),console.log("Initializing user data with blocked users:",e.blockedUsers);const t=await d.default.authenticatedRequest("/conversations");if(!t.ok)throw new Error("HTTP ".concat(t.status,": ").concat(t.statusText));const n=await t.json();if(n.success){const t=await d.default.authenticatedRequest("/conversations/unread-counts");let r={};if(t.ok){const e=await t.json();e.success&&(r=e.unreadCounts)}const a=n.data.map(e=>(0,o.A)((0,o.A)({},e),{},{unreadCount:r[e._id]||0})),s=a.map(t=>(0,o.A)((0,o.A)({},t),{},{participants:t.participants.map(t=>(0,o.A)((0,o.A)({},t),{},{user:(0,o.A)((0,o.A)({},t.user),{},{isBlockedByCurrentUser:e.blockedUsers.includes(t.user._id),hasBlockedCurrentUser:t.user.hasBlockedCurrentUser||!1})}))}));console.log("Setting conversations with blocked status applied"),i(s),a.forEach(e=>{Mn.joinConversation(e._id)});const l={};await Promise.all(a.map(async e=>{try{console.log("Loading messages for conversation: ".concat(e._id));const t=await d.default.authenticatedRequest("/messages/".concat(e._id,"?page=1&limit=50"));if(t.ok){const n=await t.json();if(n.success){const t=n.data||n.messages||[];l[e._id]=t,console.log("\u2705 Loaded ".concat(t.length," messages for ").concat(e._id))}else console.log("\u26a0\ufe0f No messages for ".concat(e._id,":"),n.message),l[e._id]=[]}else console.error("\u274c Failed to load messages for ".concat(e._id,": ").concat(t.status)),l[e._id]=[]}catch(S){console.error("Failed to fetch messages for conversation ".concat(e._id,":"),S),l[e._id]=[]}})),console.log("Setting messages data for",Object.keys(l).length,"conversations"),T(l)}try{const e=await d.default.authenticatedRequest("/users/online");if(e.ok){const t=await e.json();if(t.success){const e=t.onlineUsers.map(e=>e._id);g(e)}}}catch(S){console.error("Failed to fetch online users:",S)}}catch(S){console.error("Failed to initialize user data:",S),z("Failed to load chat data. Please try refreshing the page.","error")}finally{b(!1)}else console.log("User missing blockedUsers, cannot initialize properly");else console.log("No current user for initialization")},$=async()=>{try{const e=await d.default.authenticatedRequest("/conversations/unread-counts");if(e.ok){const t=await e.json();t.success&&i(e=>e.map(e=>(0,o.A)((0,o.A)({},e),{},{unreadCount:t.unreadCounts[e._id]||0})))}}catch(S){console.error("Error refreshing unread counts:",S)}},Y=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{console.log("Refreshing conversations list...");const n=await d.default.authenticatedRequest("/conversations");if(!n.ok)throw new Error("HTTP ".concat(n.status,": ").concat(n.statusText));const r=await n.json();if(r.success){const n=await d.default.authenticatedRequest("/conversations/unread-counts");let a={};if(n.ok){const e=await n.json();e.success&&(a=e.unreadCounts)}const s=r.data.map(e=>(0,o.A)((0,o.A)({},e),{},{unreadCount:a[e._id]||0})).map(t=>(0,o.A)((0,o.A)({},t),{},{participants:t.participants.map(t=>(0,o.A)((0,o.A)({},t),{},{user:(0,o.A)((0,o.A)({},t.user),{},{isBlockedByCurrentUser:e.blockedUsers.includes(t.user._id),hasBlockedCurrentUser:t.user.hasBlockedCurrentUser||!1})}))}));if(console.log("Setting refreshed conversations with blocked status applied"),console.log("FRONTEND: Refreshed conversations count: ".concat(s.length)),console.log("FRONTEND: Refreshed conversations:",s.map(t=>{var n;return{id:t._id,name:t.name||"Direct",isHidden:null===(n=t.participants.find(t=>t.user._id===e._id))||void 0===n?void 0:n.isHidden}})),i(s),t){const e=s.find(e=>e._id===t);e&&(console.log("\ud83c\udf89 FRONTEND: Setting reappeared conversation as active: ".concat(t)),h(e))}}}catch(S){console.error("Failed to refresh conversations list:",S)}};(0,a.useEffect)(()=>{u&&e&&(i(s.map(e=>e._id===u._id?(0,o.A)((0,o.A)({},e),{},{unreadCount:0}):e)),B(e=>e.filter(e=>e.conversationId!==u._id)))},[null===u||void 0===u?void 0:u._id,e]);const Q=(0,a.useCallback)(e=>{Mn.markConversationRead(e),window.lastUserInteraction=Date.now(),i(t=>t.map(t=>t._id===e?(0,o.A)((0,o.A)({},t),{},{unreadCount:0}):t))},[i]),J=async e=>{try{z("","success");const t=await x(e);console.log("Loggingin user"),t.success?(console.log("Loggingin user success"),U(!1),k()):t.emailVerificationRequired&&(console.log("Loggingin user email"),c(!0),z("Account created! Please check your email for verification instructions.","success"),console.log("Account created! Please check your email for verification instructions."),setTimeout(()=>{c(!1)},8e3))}catch(S){console.error("Login error:",S),z(S.message||"Login failed. Please try again.","error")}},X=async function(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{if(!le(n).valid)return;const a=await Ln.uploadFile(n),s=Bn.generate();console.log("Sending file message with client-generated ID:",s),window.lastUserInteraction=Date.now();const i=se(n),l=ie(n,a),c={_id:s,sender:e,conversation:t,content:a.url,messageType:i,fileInfo:l,status:"sending",createdAt:(new Date).toISOString(),replyTo:r,deliveredTo:[],readBy:[]};T(e=>(0,o.A)((0,o.A)({},e),{},{[t]:[...e[t]||[],c]}));const u={_id:s,content:a.url,messageType:i,fileInfo:l};r&&(u.replyTo=r._id);const f=await d.default.authenticatedRequest("/messages/".concat(t),{method:"POST",body:u}),h=await f.json();if(!h.success)throw T(e=>(0,o.A)((0,o.A)({},e),{},{[t]:e[t].filter(e=>e._id!==s)})),new Error(h.message||"Failed to send file message");T(e=>(0,o.A)((0,o.A)({},e),{},{[t]:e[t].map(e=>e._id===s?(0,o.A)((0,o.A)({},e),{},{status:"sending"===e.status?"sent":e.status,createdAt:h.data.createdAt}):e)}))}catch(S){console.error("Failed to send file:",S)}},Z=async e=>{try{console.log("\ud83d\udd04 Fetching initial messages for conversation ".concat(e));const t=await d.default.authenticatedRequest("/messages/".concat(e,"?page=1&limit=50"));if(!t.ok)throw new Error("HTTP ".concat(t.status,": ").concat(t.statusText));const n=await t.json();if(console.log("\ud83d\udce5 Messages API response for ".concat(e,":"),n),n.success){const t=n.data||n.messages||[];console.log("\u2705 Fetched ".concat(t.length," messages for conversation ").concat(e)),console.log("\ud83d\udccb Messages:",t.map(e=>{var t,n;return{id:e._id,content:e.content,sender:(null===(t=e.sender)||void 0===t?void 0:t.name)||(null===(n=e.sender)||void 0===n?void 0:n._id)}})),T(n=>{var r;const a=(0,o.A)((0,o.A)({},n),{},{[e]:t});return console.log("\ud83d\udcbe Updated messages state for ".concat(e,":"),(null===(r=a[e])||void 0===r?void 0:r.length)||0,"messages"),a})}else console.error("\u274c Failed to fetch messages:",n.message)}catch(S){console.error("\u274c Error fetching messages for conversation ".concat(e,":"),S)}};return v?(0,f.jsx)("div",{className:"min-h-screen flex items-center justify-center ".concat(n?"bg-gray-900 text-white":"bg-gray-50"),children:(0,f.jsxs)("div",{className:"text-center",children:[(0,f.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),(0,f.jsx)("p",{className:"text-lg",children:"Loading..."})]})}):O?(0,f.jsxs)("div",{children:[S&&(0,f.jsxs)("div",{className:"fixed top-4 left-1/2 transform -translate-x-1/2 z-50 bg-red-100 border border-red-300 text-red-700 px-4 py-2 rounded-lg",children:[S,(0,f.jsx)("button",{onClick:N,className:"ml-2 text-red-500 hover:text-red-700",children:"\xd7"})]}),_.show&&(0,f.jsx)("div",{className:"fixed top-4 left-1/2 transform -translate-x-1/2 z-[9999] max-w-md mx-4",children:(0,f.jsx)("div",{className:"bg-green-50 border-l-4 border-green-400 p-6 rounded-lg shadow-2xl",children:(0,f.jsxs)("div",{className:"flex items-start",children:[(0,f.jsx)("div",{className:"flex-shrink-0",children:(0,f.jsx)(Dn,{className:"h-6 w-6 text-green-500"})}),(0,f.jsx)("div",{className:"ml-3 flex-1",children:(0,f.jsx)("p",{className:"text-sm text-green-800 font-medium",children:_.message})}),(0,f.jsx)("button",{onClick:()=>C({show:!1,message:""}),className:"ml-3 flex-shrink-0 text-green-500 hover:text-green-700 bg-green-100 hover:bg-green-200 rounded-full w-6 h-6 flex items-center justify-center",children:(0,f.jsx)("span",{className:"text-sm font-bold leading-none",children:"\xd7"})})]})})}),(0,f.jsx)(M,{onLogin:J,isDark:n,setIsDark:r,showVerificationAlert:l})]}):(0,f.jsxs)("div",{children:[L&&""!==L.message&&(0,f.jsx)("div",{className:"fixed top-4 left-1/2 transform -translate-x-1/2 z-50 px-4 py-2 rounded-lg shadow-lg transition-all ".concat("success"===L.type?"bg-green-100 border border-green-300 text-green-700":"bg-red-100 border border-red-300 text-red-700"),children:(0,f.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,f.jsx)("span",{children:L.message}),(0,f.jsx)("button",{onClick:()=>D(null),className:"ml-2 text-current hover:opacity-70",children:"\xd7"})]})}),(0,f.jsx)(zn,{notifications:F,onNotificationClick:e=>{const t=s.find(t=>t._id===e.conversationId);t&&(h(t),"function"===typeof Q&&Q(t._id))},onDismiss:e=>{B(t=>t.filter(t=>t.id!==e))},isDark:n}),(0,f.jsx)(dt,{messages:E,setMessages:T,messageStatuses:R,typingUsers:A,setTypingUsers:P,onLogout:async()=>{try{H(),await w(),U(!0),T({}),P(new Set),I({}),N()}catch(S){console.error("Logout error:",S),U(!0),T({}),P(new Set),I({}),N()}},onSendMessage:async function(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const i=t||(null===u||void 0===u?void 0:u._id);if(!i)return;const l=s.find(e=>e._id===i);if(l&&"broadcast"===l.type){var c;console.log("admins",l.admin,l.admins,e._id);const t=("string"===typeof l.admin?l.admin:null===(c=l.admin)||void 0===c?void 0:c._id)===e._id,n=l.admins&&Array.isArray(l.admins)&&l.admins.some(t=>("string"===typeof t?t:null===t||void 0===t?void 0:t._id)===e._id);if(!(t||n))return void z("Only administrators can send messages in broadcast channels","error")}r?await X(i,r,a):null!==n&&void 0!==n&&n.trim()&&await async function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;try{const a=Bn.generate();window.lastUserInteraction=Date.now();const s={_id:a,sender:n,conversation:e,content:t,messageType:"text",status:"sending",createdAt:(new Date).toISOString(),replyTo:r,deliveredTo:[],readBy:[]};T(t=>(0,o.A)((0,o.A)({},t),{},{[e]:[...t[e]||[],s]}));const i={_id:a,content:t,messageType:"text"};r&&(i.replyTo=r);const l=await d.default.authenticatedRequest("/messages/".concat(e),{method:"POST",body:JSON.stringify(i)}),c=await l.json();if(!c.success)throw T(t=>(0,o.A)((0,o.A)({},t),{},{[e]:t[e].filter(e=>e._id!==a)})),new Error(c.message||"Failed to send message");T(t=>(0,o.A)((0,o.A)({},t),{},{[e]:t[e].map(e=>e._id===a?(0,o.A)((0,o.A)({},e),{},{status:"sending"===e.status?"sent":e.status,createdAt:c.data.createdAt}):e)}))}catch(S){console.error("Failed to send message:",S),z("Failed to send message. Please try again.","error")}}(i,n.trim(),e,a)},onCreateConversation:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"group",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};try{b(!0);const a={participants:e,name:t,type:n};r.description&&(a.description=r.description),r.avatar&&(a.avatar=r.avatar),r.admins&&r.admins.length>0&&(a.admins=r.admins),(r.isBroadcast||"broadcast"===n)&&(a.isBroadcast=!0);const l=await d.default.authenticatedRequest("/conversations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),c=await l.json();if(!c.success)throw new Error(c.message||"Failed to create ".concat(n));{const e=(0,o.A)((0,o.A)({},c.data),{},{unreadCount:0});i([e,...s]),T(e=>(0,o.A)((0,o.A)({},e),{},{[c.data._id]:[]})),h(e),Mn.joinConversation(c.data._id),console.log("\u2705 ".concat("broadcast"===n?"Broadcast Channel":"group"===n?"Group":"Conversation"," created:"),c.data._id),z("".concat("broadcast"===n?"Broadcast Channel":"group"===n?"Group":"Conversation",' "').concat(t||"Chat",'" created successfully!'),"success")}}catch(S){console.error("Failed to create ".concat(n,":"),S),z("Failed to create ".concat("broadcast"===n?"broadcast channel":n,". Please try again."),"error")}finally{b(!1)}},onCreateDirectConversation:async e=>{try{const t=await d.default.authenticatedRequest("/users/".concat(e,"/conversation"),{method:"POST"}),n=await t.json();if(n.success){if(!s.find(e=>e._id===n.conversation._id)){const e=(0,o.A)((0,o.A)({},n.conversation),{},{unreadCount:0});i([e,...s]),T(e=>(0,o.A)((0,o.A)({},e),{},{[n.conversation._id]:[]})),Mn.joinConversation(n.conversation._id)}h(n.conversation)}}catch(S){console.error("Failed to create direct conversation:",S),z("Failed to create conversation. Please try again.","error")}},onEditMessage:async(e,t)=>{try{window.lastUserInteraction=Date.now();const n=await d.default.authenticatedRequest("/messages/".concat(e),{method:"PUT",body:JSON.stringify({content:t})}),r=await n.json();if(!r.success)throw new Error(r.message||"Failed to edit message")}catch(S){console.error("Failed to edit message:",S),z("Failed to edit message. Please try again.","error")}},onDeleteMessage:async e=>{try{if(window.lastUserInteraction=Date.now(),!e.match(/^[0-9a-fA-F]{24}$/))return console.error("Invalid message ID format:",e),void z("Invalid message ID","error");const t=await d.default.authenticatedRequest("/messages/".concat(e),{method:"DELETE"}),n=await t.json();if(!n.success)throw new Error(n.message||"Failed to delete message");z("Message deleted successfully","success")}catch(S){console.error("Failed to delete message:",S),z("Failed to delete message. Please try again.","error")}},onReactToMessage:async(e,t)=>{try{window.lastUserInteraction=Date.now();const n=t?{emoji:t}:{},r=await d.default.authenticatedRequest("/messages/".concat(e,"/react"),{method:"POST",body:JSON.stringify(n)}),a=await r.json();if(!a.success)throw new Error(a.message||"Failed to react to message")}catch(S){console.error("Failed to react to message:",S),z("Failed to react to message. Please try again.","error")}},onDeleteConversation:async function(e){try{const t=await d.default.authenticatedRequest("/conversations/".concat(e,"/delete"),{method:"POST"}),n=await t.json();if(!n.success)throw new Error(n.message||"Failed to delete conversation");i(s.filter(t=>t._id!==e)),T(t=>{const n=(0,o.A)({},t);return delete n[e],n}),(null===u||void 0===u?void 0:u._id)===e&&h(null),z("Conversation removed from your chat list. It will reappear when someone sends a new message.","success")}catch(S){throw console.error("Failed to delete conversation:",S),z(S.message||"Failed to delete conversation","error"),S}},onSendFile:X,onLoadMoreMessages:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;try{console.log("Loading messages for conversation ".concat(e,", page ").concat(t));const n=t,r=await d.default.authenticatedRequest("/messages/".concat(e,"?page=").concat(n,"&limit=20"));if(!r.ok)return console.error("HTTP Error: ".concat(r.status," ").concat(r.statusText)),0;const a=await r.json();if(a.success){const t=a.data||a.messages||[];return console.log("Loaded ".concat(t.length," messages for page ").concat(n)),t.length>0?(T(r=>{const a=r[e]||[];return 1===n||0===a.length?(console.log("Replacing messages for conversation ".concat(e)),(0,o.A)((0,o.A)({},r),{},{[e]:t})):(console.log("Prepending ".concat(t.length," messages to conversation ").concat(e)),(0,o.A)((0,o.A)({},r),{},{[e]:[...t,...a]}))}),t.length):(console.log("No messages returned for page ".concat(n)),0)}return console.error("API returned success: false",a.message),0}catch(S){return console.error("Failed to load more messages:",S),0}},onUpdateUserStatus:async e=>{try{Mn.updateUserStatus(e);const n=await d.default.authenticatedRequest("/users/status",{method:"PUT",body:JSON.stringify({status:e})});(await n.json()).success&&t(t=>(0,o.A)((0,o.A)({},t),{},{status:e}))}catch(S){console.error("Failed to update status:",S),z("Failed to update status. Please try again.","error")}},onTypingStart:e=>{e&&(window.lastUserInteraction=Date.now(),Mn.startTyping(e))},onTypingStop:e=>{e&&Mn.stopTyping(e)},onConversationViewed:Q,onAddAdmin:async(e,t)=>{try{const n=await d.default.authenticatedRequest("/conversations/".concat(e,"/admins"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t})}),r=await n.json();if(!r.success)throw new Error(r.message||"Failed to add admin");i(s.map(t=>t._id===e?r.data:t)),(null===u||void 0===u?void 0:u._id)===e&&h(r.data)}catch(S){console.error("Failed to add admin:",S)}},onRemoveAdmin:async(e,t)=>{try{const n=await d.default.authenticatedRequest("/conversations/".concat(e,"/admins/").concat(t),{method:"DELETE"}),r=await n.json();if(!r.success)throw new Error(r.message||"Failed to remove admin");i(s.map(t=>t._id===e?r.data:t)),(null===u||void 0===u?void 0:u._id)===e&&h(r.data)}catch(S){console.error("Failed to remove admin:",S)}},onAddParticipant:async function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"member";try{const r=await d.default.authenticatedRequest("/conversations/".concat(e,"/participants"),{method:"POST",body:JSON.stringify({userId:t,role:n})}),a=await r.json();if(!a.success)throw new Error(a.message||"Failed to add participant");i(s.map(t=>t._id===e?a.data:t)),(null===u||void 0===u?void 0:u._id)===e&&h(a.data),z("Participant added successfully","success")}catch(S){throw console.error("Failed to add participant:",S),z("Failed to add participant. Please try again.","error"),S}},onRemoveParticipant:async(t,n)=>{try{const r=await d.default.authenticatedRequest("/conversations/".concat(t,"/participants/").concat(n),{method:"DELETE"}),a=await r.json();if(!a.success)throw new Error(a.message||"Failed to remove participant");i(s.map(e=>e._id===t?a.data:e)),(null===u||void 0===u?void 0:u._id)===t&&h(a.data),n===e._id?(i(s.filter(e=>e._id!==t)),T(e=>{const n=(0,o.A)({},e);return delete n[t],n}),(null===u||void 0===u?void 0:u._id)===t&&h(null),z("You were removed from the conversation","info")):z("Participant removed successfully","success")}catch(S){throw console.error("Failed to remove participant:",S),z("Failed to remove participant. Please try again.","error"),S}},onUpdateConversation:async(e,t)=>{try{window.lastUserInteraction=Date.now();const n=await d.default.authenticatedRequest("/conversations/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),r=await n.json();if(r.success)return i(s.map(t=>t._id===e?r.data:t)),(null===u||void 0===u?void 0:u._id)===e&&h(r.data),z("Conversation updated successfully","success"),r.data;throw new Error(r.message||"Failed to update conversation")}catch(S){throw console.error("Failed to update conversation:",S),z(S.message||"Failed to update conversation. Please try again.","error"),S}},onClearChat:async e=>{try{window.lastUserInteraction=Date.now();const t=await d.default.authenticatedRequest("/conversations/".concat(e,"/clear"),{method:"POST"}),n=await t.json();if(!n.success)throw new Error(n.message||"Failed to clear chat");T(t=>(0,o.A)((0,o.A)({},t),{},{[e]:[]})),i(s.map(t=>t._id===e?(0,o.A)((0,o.A)({},t),{},{lastMessage:null,updatedAt:(new Date).toISOString()}):t)),z("Chat cleared successfully for you","success")}catch(S){throw console.error("Failed to clear chat:",S),z(S.message||"Failed to clear chat. Please try again.","error"),S}},onHideChat:async e=>{try{window.lastUserInteraction=Date.now();const t=await d.default.authenticatedRequest("/conversations/".concat(e,"/hide"),{method:"POST"}),n=await t.json();if(!n.success)throw new Error(n.message||"Failed to hide conversation");i(t=>t.filter(t=>t._id!==e)),(null===u||void 0===u?void 0:u._id)===e&&h(null),z("Conversation hidden. It will reappear when someone sends a new message.","success")}catch(S){throw console.error("Failed to hide conversation:",S),z(S.message||"Failed to hide conversation. Please try again.","error"),S}},onDeleteChat:async e=>{try{window.lastUserInteraction=Date.now();const t=await d.default.authenticatedRequest("/conversations/".concat(e,"/delete"),{method:"POST"}),n=await t.json();if(!n.success)throw new Error(n.message||"Failed to delete conversation");T(t=>(0,o.A)((0,o.A)({},t),{},{[e]:[]})),i(t=>t.filter(t=>t._id!==e)),(null===u||void 0===u?void 0:u._id)===e&&h(null),z("Conversation deleted successfully. It will reappear when someone sends a new message.","success")}catch(S){throw console.error("Failed to delete conversation:",S),z(S.message||"Failed to delete conversation. Please try again.","error"),S}},onBlockUser:async n=>{try{window.lastUserInteraction=Date.now(),console.log("ChatApp: handleBlockUser called for userId:",n);const a=await d.default.authenticatedRequest("/users/".concat(n,"/block-status"));let l=!1;if(a.ok){const e=await a.json();l=e.isBlocked,console.log("Current block status from server:",e)}else{var r;console.error("Failed to get block status:",a.status),l=(null===e||void 0===e||null===(r=e.blockedUsers)||void 0===r?void 0:r.includes(n))||!1}const c=l?"unblock":"block";console.log("Calling ".concat(c," for user ").concat(n,", currently blocked: ").concat(l));const u=await d.default.authenticatedRequest("/users/".concat(n,"/").concat(c),{method:"POST"}),f=await u.json();if(f.success){t(e=>{const t=l?(e.blockedUsers||[]).filter(e=>e!==n):[...e.blockedUsers||[],n];return console.log("Updated current user blocked list:",t),(0,o.A)((0,o.A)({},e),{},{blockedUsers:t})}),i(s.map(e=>{if("direct"===e.type){if(e.participants.find(e=>e.user._id===n))return(0,o.A)((0,o.A)({},e),{},{participants:e.participants.map(e=>e.user._id===n?(0,o.A)((0,o.A)({},e),{},{user:(0,o.A)((0,o.A)({},e.user),{},{isBlockedByCurrentUser:!l})}):e)})}return e}));void 0!==f.isBlocked&&f.isBlocked;return f}throw new Error(f.message||"Failed to block/unblock user")}catch(S){throw console.error("Failed to block/unblock user:",S),z(S.message||"Failed to block/unblock user. Please try again.","error"),S}},onLeaveConversation:async e=>{try{window.lastUserInteraction=Date.now();const n=await d.default.authenticatedRequest("/conversations/".concat(e,"/leave"),{method:"POST"}),r=await n.json();if(!r.success)throw new Error(r.message||"Failed to leave conversation");if(i(s.filter(t=>t._id!==e)),T(t=>{const n=(0,o.A)({},t);return delete n[e],n}),(null===u||void 0===u?void 0:u._id)===e&&h(null),r.conversationDeleted)z("Conversation deleted (no members left)","info");else if(r.adminTransferred){var t;z("Left conversation successfully. ".concat(null===(t=r.newAdmin)||void 0===t?void 0:t.name," is now the administrator."),"success")}else z("Left conversation successfully","success")}catch(S){throw console.error("Failed to leave conversation:",S),z(S.message||"Failed to leave conversation. Please try again.","error"),S}}})]})},Vn=()=>(0,f.jsx)(p,{children:(0,f.jsx)(qn,{})});s.createRoot(document.getElementById("root")).render((0,f.jsx)(a.StrictMode,{children:(0,f.jsx)(Vn,{})}))})();
//# sourceMappingURL=main.74930453.js.map